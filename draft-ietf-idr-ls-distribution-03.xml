<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std" docName="draft-ietf-idr-ls-distribution-03"
     ipr="trust200902">
  <front>
    <title abbrev="Link-State Info Distribution using BGP">North-Bound
    Distribution of Link-State and TE Information using BGP</title>

    <author fullname="Hannes Gredler" initials="H." surname="Gredler">
      <organization>Juniper Networks, Inc.</organization>
      <address>
        <postal>
          <street>1194 N. Mathilda Ave.</street>
          <city>Sunnyvale</city>
          <region>CA</region>
          <code>94089</code>
          <country>US</country>
        </postal>
        <email>hannes@juniper.net</email>
      </address>
    </author>

    <author fullname="Jan Medved" initials="J." surname="Medved">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>170, West Tasman Drive</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>US</country>
        </postal>
        <email>jmedved@cisco.com</email>
      </address>
    </author>

    <author fullname="Stefano Previdi" initials="S." surname="Previdi">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>Via Del Serafico, 200</street>
          <city>Rome</city>
          <code>00142</code>
          <country>Italy</country>
        </postal>
        <email>sprevidi@cisco.com</email>
      </address>
    </author>

    <author fullname="Adrian Farrel" initials="A." surname="Farrel">
      <organization>Juniper Networks, Inc.</organization>
      <address>
        <postal>
          <street>1194 N. Mathilda Ave.</street>
          <city>Sunnyvale</city>
          <region>CA</region>
          <code>94089</code>
          <country>US</country>
        </postal>
        <email>afarrel@juniper.net</email>
      </address>
    </author>

    <author fullname="Saikat Ray" initials="S." surname="Ray">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>170, West Tasman Drive</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>US</country>
        </postal>
        <email>sairay@cisco.com</email>
      </address>
    </author>

    <date day="21" month="May" year="2013"/>

    <workgroup>Inter-Domain Routing</workgroup>

    <abstract>
      <t>In a number of environments, a component external to a network is
      called upon to perform computations based on the network topology and
      current state of the connections within the network, including traffic
      engineering information. This is information typically distributed by
      IGP routing protocols within the network</t>

      <t>This document describes a mechanism by which links state and traffic
      engineering information can be collected from networks and shared with
      external components using the BGP routing protocol. This is achieved
      using a new BGP Network Layer Reachability Information (NLRI) encoding
      format. The mechanism is applicable to physical and virtual IGP links. The
      mechanism described is subject to policy control.</t>

      <t>Applications of this technique include Application Layer Traffic
      Optimization (ALTO) servers, and Path Computation Elements (PCEs).</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>The contents of a Link State Database (LSDB) or a Traffic Engineering
      Database (TED) has the scope of an IGP area. Some applications, such as
      end-to-end Traffic Engineering (TE), would benefit from visibility
      outside one area or Autonomous System (AS) in order to make better
      decisions.</t>

      <t>The IETF has defined the Path Computation Element (PCE) <xref
      target="RFC4655"></xref> as a mechanism for achieving the computation of
      end-to-end TE paths that cross the visibility of more than one TED or
      which require CPU-intensive or coordinated computations. The IETF has
      also defined the ALTO Server <xref target="RFC5693"></xref> as an entity
      that generates an abstracted network topology and provides it to
      network-aware applications.</t>

      <t>Both a PCE and an ALTO Server need to gather information about the
      topologies and capabilities of the network in order to be able to
      fulfill their function.</t>

      <t>This document describes a mechanism by which Link State and TE
      information can be collected from networks and shared with external
      components using the BGP routing protocol <xref
      target="RFC4271"></xref>. This is achieved using a new BGP Network Layer
      Reachability Information (NLRI) encoding format. The mechanism is
      applicable to physical and virtual links. The mechanism described is
      subject to policy control.</t>

      <t>A router maintains one or more databases for storing link-state
      information about nodes and links in any given area. Link attributes
      stored in these databases include: local/remote IP addresses,
      local/remote interface identifiers, link metric and TE metric, link
      bandwidth, reservable bandwidth, per CoS class reservation state,
      preemption and Shared Risk Link Groups (SRLG). The router's BGP process
      can retrieve topology from these LSDBs and distribute it to a consumer,
      either directly or via a peer BGP Speaker (typically a dedicated Route
      Reflector), using the encoding specified in this document.</t>

      <t>The collection of Link State and TE link state information and its
      distribution to consumers is shown in the following figure.</t>

      <figure anchor="MECHANISM-OVERVIEW"
              title="TE Link State info collection">
        <artwork>
                        +-----------+
                        | Consumer  |
                        +-----------+
                              ^
                              |
                        +-----------+
                        |    BGP    |               +-----------+
                        |  Speaker  |               | Consumer  |
                        +-----------+               +-----------+
                          ^   ^   ^                       ^
                          |   |   |                       |
          +---------------+   |   +-------------------+   |
          |                   |                       |   |
    +-----------+       +-----------+             +-----------+
    |    BGP    |       |    BGP    |             |    BGP    |
    |  Speaker  |       |  Speaker  |    . . .    |  Speaker  |
    +-----------+       +-----------+             +-----------+
          ^                   ^                         ^
          |                   |                         |
         IGP                 IGP                       IGP
	  </artwork>
      </figure>

      <t>A BGP Speaker may apply configurable policy to the information that
      it distributes. Thus, it may distribute the real physical topology from
      the LSDB or the TED. Alternatively, it may create an abstracted
      topology, where virtual, aggregated nodes are connected by virtual
      paths. Aggregated nodes can be created, for example, out of multiple
      routers in a POP. Abstracted topology can also be a mix of physical and
      virtual nodes and physical and virtual links. Furthermore, the BGP
      Speaker can apply policy to determine when information is updated to the
      consumer so that there is reduction of information flow form the network
      to the consumers. Mechanisms through which topologies can be aggregated
      or virtualized are outside the scope of this document</t>
    </section>

    <section title="Motivation and Applicability">
      <t>This section describes use cases from which the requirements can be
      derived.</t>

      <section title="MPLS-TE with PCE">
        <t>As described in <xref target="RFC4655"></xref> a PCE can be used to
        compute MPLS-TE paths within a "domain" (such as an IGP area) or
        across multiple domains (such as a multi-area AS, or multiple ASes).
        <list style="symbols">
            <t>Within a single area, the PCE offers enhanced computational
            power that may not be available on individual routers,
            sophisticated policy control and algorithms, and coordination of
            computation across the whole area.</t>

            <t>If a router wants to compute a MPLS-TE path across IGP areas
            its own TED lacks visibility of the complete topology. That means
            that the router cannot determine the end-to-end path, and cannot
            even select the right exit router (Area Border Router - ABR) for
            an optimal path. This is an issue for large-scale networks that
            need to segment their core networks into distinct areas, but which
            still want to take advantage of MPLS-TE.</t>
          </list></t>

        <t>Previous solutions used per-domain path computation <xref
        target="RFC5152"></xref>. The source router could only compute the
        path for the first area because the router only has full topological
        visibility for the first area along the path, but not for subsequent
        areas. Per-domain path computation uses a technique called
        "loose-hop-expansion" <xref target="RFC3209"></xref>, and selects the
        exit ABR and other ABRs or AS Border Routers (ASBRs) using the IGP
        computed shortest path topology for the remainder of the path. This
        may lead to sub-optimal paths, makes alternate/back-up path
        computation hard, and might result in no TE path being found when one
        really does exist.</t>

        <t>The PCE presents a computation server that may have visibility into
        more than one IGP area or AS, or may cooperate with other PCEs to
        perform distributed path computation. The PCE obviously needs access
        to the TED for the area(s) it serves, but <xref
        target="RFC4655"></xref> does not describe how this is achieved. Many
        implementations make the PCE a passive participant in the IGP so that
        it can learn the latest state of the network, but this may be
        sub-optimal when the network is subject to a high degree of churn, or
        when the PCE is responsible for multiple areas.</t>

        <t>The following figure shows how a PCE can get its TED information
        using the mechanism described in this document.</t>

        <figure anchor="PCE-REFERENCE"
                title="External PCE node using a TED synchronization mechanism">
          <artwork>
             +----------+                           +---------+
             |  -----   |                           |   BGP   |
             | | TED |&lt;-+--------------------------&gt;| Speaker |
             |  -----   |   TED synchronization     |         |
             |    |     |        mechanism:         +---------+
             |    |     | BGP with Link-State NLRI
             |    v     |
             |  -----   |
             | | PCE |  |
             |  -----   |
             +----------+
                  ^
                  | Request/
                  | Response
                  v
    Service  +----------+   Signaling  +----------+
    Request  | Head-End |   Protocol   | Adjacent |
    --------&gt;|  Node    |&lt;------------&gt;|   Node   |
             +----------+              +----------+
	  </artwork>
        </figure>

        <t>The mechanism in this document allows the necessary TED information
        to be collected from the IGP within the network, filtered according to
        configurable policy, and distributed to the PCE as necessary.</t>
      </section>

      <section title="ALTO Server Network API">
        <t>An ALTO Server <xref target="RFC5693"></xref> is an entity that
        generates an abstracted network topology and provides it to
        network-aware applications over a web service based API. Example
        applications are p2p clients or trackers, or CDNs. The abstracted
        network topology comes in the form of two maps: a Network Map that
        specifies allocation of prefixes to Partition Identifiers (PIDs), and
        a Cost Map that specifies the cost between PIDs listed in the Network
        Map. For more details, see <xref
        target="I-D.ietf-alto-protocol"></xref>.</t>

        <t>ALTO abstract network topologies can be auto-generated from the
        physical topology of the underlying network. The generation would
        typically be based on policies and rules set by the operator. Both
        prefix and TE data are required: prefix data is required to generate
        ALTO Network Maps, TE (topology) data is required to generate ALTO
        Cost Maps. Prefix data is carried and originated in BGP, TE data is
        originated and carried in an IGP. The mechanism defined in this
        document provides a single interface through which an ALTO Server can
        retrieve all the necessary prefix and network topology data from the
        underlying network. Note an ALTO Server can use other mechanisms to
        get network data, for example, peering with multiple IGP and BGP
        Speakers.</t>

        <t>The following figure shows how an ALTO Server can get network
        topology information from the underlying network using the mechanism
        described in this document.</t>

        <figure anchor="ALTO-REFERENCE"
                title="ALTO Server using network topology information">
          <artwork>
  +--------+
  | Client |&lt;--+
  +--------+   |                  
               |    ALTO    +--------+     BGP with    +---------+
  +--------+   |  Protocol  |  ALTO  | Link-State NLRI |   BGP   |  
  | Client |&lt;--+------------| Server |&lt;----------------| Speaker | 
  +--------+   |            |        |                 |         |
               |            +--------+                 +---------+
  +--------+   |
  | Client |&lt;--+
  +--------+           
	  </artwork>
        </figure>
      </section>
    </section>

    <section title="Carrying Link State Information in BGP">
      <t>This specification contains two parts: definition of a new
      BGP NLRI that describes links, nodes and prefixes comprising IGP
      link state information, and definition of a new BGP path
      attribute (BGP-LS attribute) that carries link, node and prefix
      properties and attributes, such as the link and prefix metric or
      auxiliary Router-IDs of nodes, etc.</t>

      <section anchor="TLV-section" title="TLV Format">
        <t>Information in the new link state NLRIs and attributes is encoded
        in Type/Length/Value triplets. The TLV format is shown in <xref
        target="TLV-figure"></xref>.</t>

        <figure anchor="TLV-figure" title="TLV format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                        Value (variable)                     //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  </artwork>
        </figure>

        <t>The Length field defines the length of the value portion in octets
        (thus a TLV with no value portion would have a length of zero). The
        TLV is not padded to four-octet alignment. Unrecognized types are
        preserved and propagated. In order to compare NLRIs with unknown
	TLVs all TLVs MUST be ordered in ascending order. If there are
	more TLVs of the same type, then the TLVs MUST be ordered
	in ascending order of the TLV value within the set of TLVs with
	the same type.
	All TLVs that are not specified as mandatory are considered
        optional.
	</t>
      </section>

      <section title="The Link State NLRI">
        <t>The MP_REACH and MP_UNREACH attributes are BGP's containers for
        carrying opaque information. Each Link State NLRI describes either a
        node, a link or a prefix.</t>

        <t>All non-VPN link, node and prefix information SHALL be
        encoded using AFI 16388 / SAFI 71. VPN link, node and prefix
        information SHALL be encoded using AFI 16388 / SAFI 128.</t>

        <t>In order for two BGP speakers to exchange Link-State NLRI, they
        MUST use BGP Capabilities Advertisement to ensure that they both are
        capable of properly processing such NLRI. This is done as specified in
        <xref target="RFC4760"></xref>, by using capability code 1
        (multi-protocol BGP), with an AFI 16388 / SAFI 71 and
	AFI 16388 / SAFI 128 for the VPN flavor.</t>

        <t>The format of the Link State NLRI is shown in the following
        figure.</t>

        <figure anchor="LSSAFI" title="Link State AFI 16388 / SAFI 71 NLRI Format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            NLRI Type          |     Total NLRI Length         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  //                  Link-State NLRI (variable)                 //
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  </artwork>
        </figure>

        <figure anchor="LSVPNSAFI" title="Link State VPN AFI 16388 / SAFI 128 NLRI Format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            NLRI Type          |     Total NLRI Length         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                       Route Distinguisher                     +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  //                  Link-State NLRI (variable)                 //
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	  </artwork>
        </figure>

        <t>The 'Total NLRI Length' field contains the cumulative
        length, in octets, of rest of the NLRI not including the NLRI
        Type field or itself. For VPN applications it also includes
        the length of the Route Distinguisher.</t>

        <t>The 'NLRI Type' field can contain one of the following values:
        <list style="hanging">
            <t>Type = 1: Node NLRI</t>
            <t>Type = 2: Link NLRI</t>
            <t>Type = 3: IPv4 Topology Prefix NLRI</t>
            <t>Type = 4: IPv6 Topology Prefix NLRI</t>
          </list></t>

        <t>The Node NLRI (NLRI Type = 1) is shown in the following figure.</t>

        <figure anchor="NODE-NLRI" title="The Node NLRI format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+  
  |  Protocol-ID  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                           Identifier                          |
  |                            (64 bits)                          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                Local Node Descriptors (variable)            //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	  </artwork>
        </figure>

        <t>The Link NLRI (NLRI Type = 2) is shown in the following figure.</t>

        <figure anchor="LINK-NLRI" title="The Link NLRI format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+  
  |  Protocol-ID  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                           Identifier                          |
  |                            (64 bits)                          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+       
  //               Local Node Descriptors (variable)             //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //               Remote Node Descriptors (variable)            //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                  Link Descriptors (variable)                //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	  </artwork>
        </figure>

        <t>The IPv4 and IPv6 Prefix NLRIs (NLRI Type = 3 and Type = 4) use the
        same format as shown in the following figure.</t>

        <figure anchor="PREFIX-NLRI"
                title="The IPv4/IPv6 Topology Prefix NLRI format">
          <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+  
  |  Protocol-ID  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                           Identifier                          |
  |                            (64 bits)                          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //              Local Node Descriptor (variable)               //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                Prefix Descriptors (variable)                //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	  </artwork>
        </figure>

        <t>The 'Protocol-ID' field can contain one of the following values:
        <list style="hanging">
          <t>Protocol-ID = 0: Unknown, The source of NLRI information could
          not be determined</t>
	  
          <t>Protocol-ID = 1: IS-IS Level 1, The NLRI information has been
          sourced by IS-IS Level 1</t>
	  
          <t>Protocol-ID = 2: IS-IS Level 2, The NLRI information has been
          sourced by IS-IS Level 2</t>
	  
          <t>Protocol-ID = 3: OSPF, The NLRI information has been sourced by
          OSPF</t>
	  
          <t>Protocol-ID = 4: Direct, The NLRI information has been sourced
          from local interface state</t>

          <t>Protocol-ID = 5: Static, The NLRI information has been sourced
          by static configuration</t>
        </list>
	</t>

        <t>Both OSPF and IS-IS may run multiple routing protocol
        instances over the same link. See <xref
        target="RFC6822"></xref> and <xref
        target="RFC6549"></xref>. These instances define independent
        "routing universes". The 64-Bit 'Identifier' field is
        used to identify the "routing universe" where the NLRI belongs.
        The NLRIs representing IGP objects (nodes, links or prefixes)
        from the same routing universe MUST have the same 'Identifier'
        value; NLRIs with different 'Identifier' values MUST be considered
        to be from different routing universes.
        Table <xref target="well_known_instances"></xref> lists the 
        'Identifier' values that are defined as well-known in this draft.
	</t>
        <texttable anchor="well_known_instances"
                   title="Well-known Instance Identifiers">
          <ttcol align="center">Identifier</ttcol>
          <ttcol align="left">Routing Universe</ttcol>
	  
          <c>0</c>
          <c>L3 packet topology</c>
	  
          <c>1</c>
          <c>L1 optical topology</c>
        </texttable>
	
        <t>
	  Each Node Descriptor and Link Descriptor consists of one or
	  more TLVs described in the following sections.
	</t>

        <section title="Node Descriptors">
          <t>Each link is anchored by a pair of Router-IDs that are
          used by the underlying IGP, namely, 48 Bit ISO
          System-ID for IS-IS and 32 bit Router-ID for OSPFv2 and
          OSPFv3. An IGP may use one or more additional
          auxiliary Router-IDs, mainly for traffic engineering
          purposes. For example, IS-IS may have one or more IPv4 and
          IPv6 TE Router-IDs <xref target="RFC5305"/>, <xref
          target="RFC6119"/>. These auxiliary Router-IDs MUST be
          included in the link attribute described in Section <xref
          target="link_attribute"/>.
	  </t>

          <t>It is desirable that the Router-ID assignments inside the
          Node Descriptor are globally unique. However there may be
          Router-ID spaces (e.g. ISO) where no global registry
          exists, or worse, Router-IDs have been allocated following
          private-IP <xref target="RFC1918">RFC 1918</xref>
          allocation. We use Autonomous System (AS) Number and BGP-LS
          Identifier in order to disambiguate the Router-IDs, as
          described in <xref target="gbl_uniqueness"></xref>.</t>

          <section anchor="gbl_uniqueness"
                   title="Globally Unique Node/Link/Prefix Identifiers">
            <t>One problem that needs to be addressed is the ability to identify
            an IGP node globally (by "global", we mean within the BGP-LS
            database collected by all BGP-LS speakers that talk to each other).
            This can be expressed through the following two requirements:</t>

            <t>(A) The same node must not be represented by two keys (otherwise
            one node will look like two nodes).</t>

            <t>(B) Two different nodes must not be represented by the same key
            (otherwise, two nodes will look like one node).</t>

            <t>We define an "IGP domain" to be the set of nodes
            (hence, by extension links and prefixes), within which,
            each node has a unique IGP representation by using the
            combination of Area-ID, Router-ID, Protocol, Topology-ID,
            and Instance ID. The problem is that BGP may receive
            node/link/prefix information from multiple independent
            "IGP domains" and we need to distinguish between them.
            Moreover, we can't assume there is always one and only one
            IGP domain per AS. During IGP transitions it may
            happen that two redundant IGPs are in place.</t>

            <t>In section <xref target="node_desc_tlvs"></xref> a set of sub-TLVs
            is described, which allows to specify a flexible key for any given
            Node/Link information such that global uniqueness of the NLRI is
            ensured.
	    </t>
          </section>

          <section anchor="LOCALNODEDESC" title="Local Node Descriptors">
            <t>The Local Node Descriptors TLV contains Node
            Descriptors for the node anchoring the local end of the
            link. This is a mandatory TLV in all three types of
            NLRIs. The length of this TLV is variable. The value
            contains one or more Node Descriptor Sub-TLVs defined in
            <xref target="node_desc_tlvs"></xref>.</t>

            <figure anchor="LOCALNODEDESCTLV"
                    title="Local Node Descriptors TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  //              Node Descriptor Sub-TLVs (variable)            //
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>
	  
          <section anchor="REMOTENODEDESC" title="Remote Node Descriptors">
            <t>The Remote Node Descriptors contains Node Descriptors
            for the node anchoring the remote end of the link. This is
            a mandatory TLV for link NLRIs. The length of this TLV is
            variable. The value contains one or more Node Descriptor
            Sub-TLVs defined in <xref
            target="node_desc_tlvs"></xref>.</t>

            <figure anchor="REMOTENODEDESCTLV"
                    title="Remote Node Descriptors TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  //              Node Descriptor Sub-TLVs (variable)            //
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>

          <section anchor="node_desc_tlvs" title="Node Descriptor Sub-TLVs">
            <t>The Node Descriptor Sub-TLV type codepoints and lengths are
            listed in the following table:</t>

            <texttable anchor="table_local_anchor_node_tlv"
                       title="Node Descriptor Sub-TLVs">
              <ttcol align="center">Sub-TLV Code Point</ttcol>
              <ttcol align="left">Description</ttcol>
              <ttcol align="right">Length</ttcol>

              <c>512</c>
              <c>Autonomous System</c>
              <c>4</c>

              <c>513</c>
              <c>BGP-LS Identifier</c>
              <c>4</c>

              <c>514</c>
              <c>Area-ID</c>
              <c>4</c>

              <c>515</c>
              <c>IGP Router-ID</c>
              <c>Variable</c>

            </texttable>

            <t>The sub-TLV values in Node Descriptor TLVs are defined as
            follows:</t>

            <t><list style="hanging">
              <t hangText="Autonomous System:">opaque value (32 Bit AS
              Number)</t>
	      
              <t hangText="BGP-LS Identifier:">opaque value (32 Bit
              ID). In conjunction with ASN, uniquely identifies the
              BGP-LS domain. The combination of ASN and BGP-LS ID MUST
              be globally unique. All BGP-LS speakers within an IGP
              flooding-set (set of IGP nodes within which an LSP/LSA
              is flooded) MUST use the same ASN, BGP-LS ID tuple. If
              an IGP domain consists of multiple flooding-sets, then
              all BGP-LS speakers within the IGP domain SHOULD use the
              same ASN, BGP-LS ID tuple.  The ASN, BGP Router-ID tuple
              (which is globally unique <xref target="RFC6286"></xref> ) of one of the BGP-LS speakers
              within the flooding-set (or IGP domain) may be used for
              all BGP-LS speakers in that flooding-set (or IGP
              domain).
              </t>

              <t hangText="Area ID:">It is used to identify the 32 Bit area to
              which the NLRI belongs. Area Identifier allows the different NLRIs
              of the same router to be discriminated.
              </t>
              
              <t hangText="IGP Router ID:">opaque value. This is a
              mandatory TLV.  For an IS-IS non-Pseudonode, this
              contains 6 octet ISO node-ID (ISO system-ID). For an
              IS-IS Pseudonode corresponding to a LAN, this contains 6
              octet ISO node-ID of the "Designated Intermediate
              System" (DIS) followed by one octet nonzero PSN
              identifier (7 octet in total).  For an OSPFv2 or OSPFv3
              non-"Pseudonode", this contains 4 octet Router-ID.  For
              an OSPFv2 "Pseudonode" representing a LAN, this contains
              4 octet Router-ID of the designated router (DR) followed
              by 4 octet IPv4 address of the DR's interface to the LAN
              (8 octet in total). Similarly, for an OSPFv3
              "Pseudonode", this contains 4 octet Router-ID of the DR
              followed by 4 octet interface identifier of the DR's
              interface to the LAN (8 octet in total). The TLV size in
              combination with protocol identifier enables the decoder
              to determine the type of the node.
              </t>

<!--HG> shall we add a note what to do when a violation is detected ?
i.e. consider the protocol-source being IS-IS and somebody
accidentially encoding just 4 cotets of ID space, should we raise hell or
just proceed with the advertised length field ? -->

              <t>There can be at most one instance of each sub-TLV type
              present in any Node Descriptor. The TLV ordering within
              a Node descriptor MUST be kept in order of increasing
              numeric value of type. This needs to be done in order to
              compare NLRIs, even when an implementation encounters an
              unknown sub-TLV. Using stable sorting an implementation
              can do binary comparison of NLRIs and hence allow
              incremental deployment of new key sub-TLVs.</t>
            </list>
            </t>
          </section>


          <section anchor="MT-ID" title="Multi-Topology ID">
            <t >The Multi-Topology ID (MT-ID) TLV carries one or more
            IS-IS or OSPF Multi-Topology IDs for a link, node or
            prefix.</t>

            <t>Semantics of the IS-IS MT-ID are defined in <xref
            target="RFC5120">RFC5120, Section 7.2</xref>.  Semantics of the OSPF
            MT-ID are defined in <xref target="RFC4915">RFC4915,
            Section 3.7</xref>. If the value in the MT-ID TLV is
            derived from OSPF, then the upper 9 bits MUST be set to 0.
            Bits R are reserved, SHOULD be set to 0 when originated and
            ignored on receipt.</t>

            <t>The format of the MT-ID TLV is shown in the following
            figure.
	    </t>

            <figure anchor="MTIDTLV" title="Multi-Topology ID TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |          Length=2*n           | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |R R R R|  Multi-Topology ID 1  |             ....             //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //             ....             |R R R R|  Multi-Topology ID n  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>

            <t>where Type is 263, Length is 2*n and n is the number of
            MT-IDs carried in the TLV.</t>

            <t>The MT-ID TLV MAY be present in a Link Descriptor, a
            Prefix Descriptor, or in the BGP-LS attribute of a node
            NLRI. In Link or Prefix Descriptor, only one MT-ID TLV
            containing only the MT-ID of the topology where the link or
            the prefix belongs is allowed. In the BGP-LS attribute of a
            node NLRI, one MT-ID TLV containing the array of MT-IDs of
            all topologies where the node belongs can be present.
	    </t>
	    
          </section>

	</section>
	<section title="Link Descriptors">
          <t>The 'Link Descriptor' field is a set of Type/Length/Value
          (TLV) triplets. The format of each TLV is shown in <xref
          target="TLV-section"></xref>. The 'Link descriptor' TLVs
          uniquely identify a link among multiple parallel links
          between a pair of anchor routers. A link described by the
          Link descriptor TLVs actually is a "half-link", a
          unidirectional representation of a logical link. In order to
          fully describe a single logical link two originating routers
          advertise a half-link each, i.e. two link NLRIs are
          advertised for a given point-to-point link.</t>

          <t>The format and semantics of the 'value' fields in most 'Link
          Descriptor' TLVs correspond to the format and semantics of value
          fields in IS-IS Extended IS Reachability sub-TLVs, defined in <xref
          target="RFC5305"></xref>, <xref target="RFC5307"></xref> and <xref
          target="RFC6119"></xref>. Although the encodings for 'Link
          Descriptor' TLVs were originally defined for IS-IS, the TLVs can
          carry data sourced either by IS-IS or OSPF.</t>
	
          <t>The following TLVs are valid as Link Descriptors in the Link
          NLRI:</t>

          <texttable anchor="table_link_descriptor_tlv"
                     title="Link Descriptor TLVs">
            <ttcol align="center">TLV Code Point</ttcol>
            <ttcol align="left">Description</ttcol>
            <ttcol align="center">IS-IS TLV/Sub-TLV</ttcol>
            <ttcol align="left">Value defined in:</ttcol>

            <c>258</c>
            <c>Link Local/Remote Identifiers</c>
            <c>22/4</c>
            <c><xref target="RFC5307"></xref>/1.1</c>

            <c>259</c>
            <c>IPv4 interface address</c>
            <c>22/6</c>
            <c><xref target="RFC5305"></xref>/3.2</c>

            <c>260</c>
            <c>IPv4 neighbor address</c>
            <c>22/8</c>
            <c><xref target="RFC5305"></xref>/3.3</c>

            <c>261</c>
            <c>IPv6 interface address</c>
            <c>22/12</c>
            <c><xref target="RFC6119"></xref>/4.2</c>

            <c>262</c>
            <c>IPv6 neighbor address</c>
            <c>22/13</c>
            <c><xref target="RFC6119"></xref>/4.3</c>

            <c>263</c>
            <c>Multi-Topology Identifier</c>
            <c>---</c>
            <c><xref target="MT-ID"/></c>
          </texttable>

        </section>

        <section anchor="PREFIXDESC" title="Prefix Descriptors">
          <t>The 'Prefix Descriptor' field is a set of Type/Length/Value (TLV)
          triplets. 'Prefix Descriptor' TLVs uniquely identify an IPv4 or IPv6
          Prefix originated by a Node. The following TLVs are valid as Prefix
          Descriptors in the IPv4/IPv6 Prefix NLRI:</t>

          <texttable anchor="table_prefix_descriptor_tlv"
                     title="Prefix Descriptor TLVs">
            <ttcol align="center">TLV Code Point</ttcol>
            <ttcol align="left">Description</ttcol>
            <ttcol align="center">Length</ttcol>
            <ttcol align="left">Value defined in:</ttcol>

            <c>263</c>
            <c>Multi-Topology Identifier</c>
            <c>variable</c>
            <c><xref target="MT-ID"/></c>

            <c>264</c>
            <c>OSPF Route Type</c>
            <c>1</c>
            <c><xref target="OSPFRTETYPE"/></c>

            <c>265</c>
            <c>IP Reachability Information</c>
            <c>variable</c>
            <c><xref target="IPREACHINFO"/></c>
          </texttable>

          <section anchor="OSPFRTETYPE" title="OSPF Route Type">
            <t> OSPF Route Type is an optional TLV that MAY be present in Prefix
            NLRIs. It is used to identify the OSPF route-type of the prefix. It
            is used when an OSPF prefix is advertised in the OSPF domain with
            multiple different route-types. The Route Type TLV allows to
            discriminate these advertisements. The format of the OSPF Route Type
            TLV is shown in the following figure.</t>

            <figure anchor="ROUTETYPETLV" title="OSPF Route Type TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |  Route Type   |
  +-+-+-+-+-+-+-+-+
              </artwork>
            </figure>

            <t>where the Type and Length fields of the TLV are defined in
            <xref target="table_prefix_descriptor_tlv"/>. The OSPF Route Type
            field values are defined in the OSPF protocol, and can be one of
            the following:

            <list style="hanging">
              <t>Intra-Area (0x1)</t>
              <t>Inter-Area (0x2)</t>
              <t>External 1 (0x3)</t>
              <t>External 2 (0x4)</t>
              <t>NSSA 1 (0x5)</t>
              <t>NSSA 2 (0x6)</t>
            </list>
            </t>
          </section>

          <section anchor="IPREACHINFO" title="IP Reachability Information">
            <t>The IP Reachability Information is a mandatory TLV that
            contains one IP address prefix (IPv4 or IPv6) originally
            advertised in the IGP topology. Its purpose is to glue a particular
	    BGP service NLRI vi virtue of its BGP next-hop
	    to a given Node in the LSDB. A router SHOULD advertise an
	    IP Prefix NLRI for each of its BGP Next-hops.
	    The format of the IP Reachability
            Information TLV is shown in the following figure:</t>
	    
            <figure anchor="IPREACHABILITYTLV" title="IP Reachability Information TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | Prefix Length | IP Prefix (variable)                         //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>
            <t>The Type and Length fields of the TLV are defined in
            <xref target="table_prefix_descriptor_tlv"/>. The
            following two fields determine the address-family
            reachability information.  The 'Prefix Length' field
            contains the length of the prefix in bits.  The 'IP
            Prefix' field contains the most significant octets of
            the prefix; i.e., 1 octet for prefix length 1
            up to 8, 2 octets for prefix length 9 to 16, 3 octets
            for prefix length 17 up to 24 and 4 octets for prefix
            length 25 up to 32, etc.</t>
          </section>
        </section>
      </section>

      <section title="The LINK_STATE Attribute">
        <t>This is an optional, non-transitive BGP attribute that is used to
        carry link, node and prefix parameters and attributes. It is defined
        as a set of Type/Length/Value (TLV) triplets, described in the
        following section. This attribute SHOULD only be included with Link
        State NLRIs. This attribute MUST be ignored for all other address-families.</t>

        <section title="Node Attribute TLVs">
          <t>Node attribute TLVs are the TLVs that may be encoded in
          the BGP-LS attribute with a node NLRI.  The following node
          attribute TLVs are defined:</t>

          <texttable anchor="node-attribute_tlv" title="Node Attribute TLVs">
            <ttcol align="center">TLV Code Point</ttcol>
            <ttcol align="left">Description</ttcol>
            <ttcol align="right">Length</ttcol>
            <ttcol align="left">Value defined in:</ttcol>

            <c>263</c>
            <c>Multi-Topology Identifier</c>
            <c>variable</c>
            <c><xref target="MT-ID"/></c>

            <c>1024</c>
            <c>Node Flag Bits</c>
            <c>1</c>
            <c><xref target="NODEFLAGBITS"/></c>

            <c>1025</c>
            <c>Opaque Node Properties</c>
            <c>variable</c>
            <c><xref target="OPAQUENODE"/></c>

            <c>1026</c>
            <c>Node Name</c>
            <c>variable</c>
            <c><xref target="NODENAME"/></c>

            <c>1027</c>
            <c>IS-IS Area Identifier</c>
            <c>variable</c>
            <c><xref target="ISISAREA"/></c>

            <c>1028</c>
            <c>IPv4 Router-ID of Local Node</c>
            <c>4</c>
            <c><xref target="RFC5305"></xref>/4.3</c>

            <c>1029</c>
            <c>IPv6 Router-ID of Local Node</c>
            <c>16</c>
            <c><xref target="RFC6119"></xref>/4.1</c>

          </texttable>

          <section anchor="NODEFLAGBITS" title="Node Flag Bits TLV">
            <t>The Node Flag Bits TLV carries a bit mask describing node
            attributes. The value is a variable length bit array of flags, where
            each bit represents a node capability.</t>

            <figure anchor="node_flag_bits" title="Node Flag Bits TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |O|T|E|A| Reserved|  
  +-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>The bits are defined as follows:</t>

            <texttable anchor="table_node_flag_bits_tlv"
                       title="Node Flag Bits Definitions">
              <ttcol align="center">Bit</ttcol>
              <ttcol align="left">Description</ttcol>
              <ttcol align="left">Reference</ttcol>

              <c>'O'</c>
              <c>Overload Bit</c>
              <c><xref target="RFC1195"></xref></c>

              <c>'T'</c>
              <c>Attached Bit</c>
              <c><xref target="RFC1195"></xref></c>

              <c>'E'</c>
              <c>External Bit</c>
              <c><xref target="RFC2328"></xref></c>

              <c>'A'</c>
              <c>ABR Bit</c>
              <c><xref target="RFC2328"></xref></c>
              
              <c>Reserved</c>
              <c>Reserved for future use</c>
              <c></c>
            </texttable>
          </section>

          <section anchor="ISISAREA"
                   title="IS-IS Area Identifier TLV">
            <t>An IS-IS node can be part of one or more IS-IS
            areas. Each of these area addresses is carried in the IS-IS
            Area Identifier TLV. If more than one Area Addresses are
            present, multiple TLVs are used to encode them. The IS-IS
            Area Identifier TLV may be present in the LINK_STATE
            attribute only with the Link State Node NLRI.
            </t>

            <figure anchor="ISISAREAIDTLV" title="IS-IS Area Identifier TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                 Area Identifier (variable)                  //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>
          </section>

          <section anchor="NODENAME"
                   title="Node Name TLV">
	    <t>The Node Name TLV is optional. Its structure and encoding
	    has been borrowed from <xref target="RFC5301"/>.
	    The value field identifies the symbolic name of the router node.
	    This symbolic name can be the FQDN for the router, it can be a
	    subset of the FQDN, or it can be any string operators want to
	    use for the router. The use of FQDN or a subset of it is
	    strongly recommended.
	    </t>

	    <t>
	    The Value field is encoded in 7-bit ASCII.  If a user-interface for
	    configuring or displaying this field permits Unicode characters, that
	    user-interface is responsible for applying the ToASCII and/or
	    ToUnicode algorithm as described in <xref target="RFC3490"/>
	    to achieve the correct format for transmission or display.
	    </t>

	    <t>Altough <xref target="RFC5301"/> is a IS-IS specific extension,
	    usage of the Node Name TLV is possible for all protocols. How
	    a router derives and injects node names for e.g. OSPF nodes,
	    is outside of the scope of this document.
	    </t>

            <figure anchor="optional-node-name-tlv"
                    title="Node Name format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                     Node Name (variable)                    //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>


          <section anchor="aux_routerid_node" title="Local IPv4/IPv6 Router-ID">
          <t>The local IPv4/IPv6 Router-ID TLVs are used to describe
          auxiliary Router-IDs that the IGP might be using,
          e.g., for TE and migration purposes like correlating a Node-ID between
	  different protocols. If there is more than one auxiliary
          Router-ID of a given type, then each one is encoded in its own TLV.
          </t>
	  </section>

          <section anchor="OPAQUENODE"
                   title="Opaque Node Attribute TLV">
            <t>The Opaque Node attribute TLV is an envelope that
            transparently carries optional node attribute TLVs advertised by a
            router. An originating router shall use this TLV
            for encoding information specific to the protocol advertised
	    in the NLRI header Protocol-ID field or new protocol extensions
	    to the protocol as advertised in the NLRI header
	    Protocol-ID field for which there is no protocol neutral
	    representation in the BGP link-state NLRI.

	    A router for example could use this extension in order to
	    advertise the native protocols node attribute TLVs,
	    such as the OSPF Router Informational Capabilities
            TLV defined in <xref target="RFC4970"></xref>, or the IGP TE Node
            Capability Descriptor TLV described in <xref
            target="RFC5073"></xref>. </t>

            <figure anchor="optional_opaque_node-attribute_tlv"
                    title="Opaque Node attribute format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //               Opaque node attributes (variable)             //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>
        </section>

        <section anchor="link_attribute" title="Link Attribute TLVs">
          <t>Link attribute TLVs are TLVs that may be encoded in the
          BGP-LS attribute with a link NLRI.  Each 'Link Attribute' is
          a Type/Length/Value (TLV) triplet formatted as defined in
          <xref target="TLV-section"></xref>. The format and semantics
          of the 'value' fields in some 'Link Attribute' TLVs
          correspond to the format and semantics of value fields in
          IS-IS Extended IS Reachability sub-TLVs, defined in <xref
          target="RFC5305"></xref> and <xref
          target="RFC5307"></xref>. Other 'Link Attribute' TLVs are
          defined in this document. Although the encodings for 'Link
          Attribute' TLVs were originally defined for IS-IS, the TLVs
          can carry data sourced either by IS-IS or OSPF.</t>

          <t>The following 'Link Attribute' TLVs are are valid in the
          LINK_STATE attribute:</t>

          <texttable anchor="table_link_attribute_tlv"
                     title="Link Attribute TLVs">
            <ttcol align="center">TLV Code Point</ttcol>
            <ttcol align="left">Description</ttcol>
            <ttcol align="center">IS-IS TLV/Sub-TLV</ttcol>
            <ttcol align="left">Defined in:</ttcol>

            <c>1028</c>
            <c>IPv4 Router-ID of Local Node</c>
            <c>134/---</c>
            <c><xref target="RFC5305"></xref>/4.3</c>

            <c>1029</c>
            <c>IPv6 Router-ID of Local Node</c>
            <c>140/---</c>
            <c><xref target="RFC6119"></xref>/4.1</c>

            <c>1030</c>
            <c>IPv4 Router-ID of Remote Node</c>
            <c>134/---</c>
            <c><xref target="RFC5305"></xref>/4.3</c>

            <c>1031</c>
            <c>IPv6 Router-ID of Remote Node</c>
            <c>140/---</c>
            <c><xref target="RFC6119"></xref>/4.1</c>

            <c>1088</c>
            <c>Administrative group (color)</c>
            <c>22/3</c>
            <c><xref target="RFC5305"></xref>/3.1</c>

            <c>1089</c>
            <c>Maximum link bandwidth</c>
            <c>22/9</c>
            <c><xref target="RFC5305"></xref>/3.3</c>

            <c>1090</c>
            <c>Max. reservable link bandwidth</c>
            <c>22/10</c>
            <c><xref target="RFC5305"></xref>/3.5</c>

            <c>1091</c>
            <c>Unreserved bandwidth</c>
            <c>22/11</c>
            <c><xref target="RFC5305"></xref>/3.6</c>

            <c>1092</c>
            <c>TE Default Metric</c>
            <c>22/18</c>
            <c><xref target="RFC5305"></xref>/3.7</c>

            <c>1093</c>
            <c>Link Protection Type</c>
            <c>22/20</c>
            <c><xref target="RFC5307"></xref>/1.2</c>

            <c>1094</c>
            <c>MPLS Protocol Mask</c>
            <c>---</c>
            <c><xref target="MPLSPROTOTLV"></xref></c>

            <c>1095</c>
            <c>Metric</c>
            <c>---</c>
            <c><xref target="METTLV"></xref></c>

            <c>1096</c>
            <c>Shared Risk Link Group</c>
            <c>---</c>
            <c><xref target="SRLGTLV"></xref></c>

            <c>1097</c>
            <c>Opaque link attribute</c>
            <c>---</c>
            <c><xref target="OPAQUELINK"></xref></c>

            <c>1098</c>
            <c>Link Name attribute</c>
            <c>---</c>
            <c><xref target="LINKNAME"></xref></c>
          </texttable>
          <section anchor="aux_routerid_link" title="IPv4/IPv6 Router-ID">
            <t>The local/remote IPv4/IPv6 Router-ID TLVs are used to
            describe auxiliary Router-IDs that the IGP might be
            using, e.g., for TE purposes. All auxiliary Router-IDs of
            both the local and the remote node MUST be included in the
            link attribute of each link NLRI. If there are more than one
            auxiliary Router-ID of a given type, then multiple TLVs are
            used to encode them.
            </t>
	  </section>
          <section anchor="MPLSPROTOTLV" title="MPLS Protocol Mask TLV">
            <t>The MPLS Protocol TLV carries a bit mask describing which MPLS
            signaling protocols are enabled. The length of this TLV is 1. The
            value is a bit array of 8 flags, where each bit represents an MPLS
            Protocol capability.</t>

            <figure anchor="MPLSPROTO" title="MPLS Protocol TLV">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |L|R|  Reserved | 
  +-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>The following bits are defined:</t>

            <texttable anchor="table_mpls_protocols_tlv"
                       title="MPLS Protocol Mask TLV Codes">
              <ttcol align="center">Bit</ttcol>
              <ttcol align="left">Description</ttcol>
              <ttcol align="left">Reference</ttcol>

              <c>'L'</c>
              <c>Label Distribution Protocol (LDP)</c>
              <c><xref target="RFC5036"></xref></c>

              <c>'R'</c>
              <c>Extension to RSVP for LSP Tunnels (RSVP-TE)</c>
              <c><xref target="RFC3209"></xref></c>

              <c>'Reserved'</c>
              <c>Reserved for future use</c>
              <c></c>
            </texttable>
          </section>

          <section anchor="METTLV" title="Metric TLV">
            <t>
	      The IGP Metric TLV carries the metric for this link.
	      The length of this TLV is variable, depending
	      on the metric width of the underlying protocol.
	      IS-IS small metrics have a length of 1 octet
	      (the two most significant bits are ignored).
	      OSPF metrics have a length of two octects.
	      IS-IS wide-metrics have a length of three octets.
	    </t>

            <figure anchor="MET" title="Metric TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //      IGP Link Metric (variable length)      // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>

          <section anchor="SRLGTLV" title="Shared Risk Link Group TLV">
            <t>The Shared Risk Link Group (SRLG) TLV carries the Shared Risk
            Link Group information (see Section 2.3, "Shared Risk Link Group
            Information", of <xref target="RFC4202"></xref>). It contains a data
            structure consisting of a (variable) list of SRLG values, where each
            element in the list has 4 octets, as shown in <xref
            target="SRLG"></xref>. The length of this TLV is 4 * (number of SRLG
            values).</t>

            <figure anchor="SRLG" title="Shared Risk Link Group TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                  Shared Risk Link Group Value                 | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                         ............                        // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                  Shared Risk Link Group Value                 | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>Note that there is no SRLG TLV in OSPF-TE. In IS-IS the
            SRLG information is carried in two different TLVs: the
            IPv4 (SRLG) TLV (Type 138) defined in <xref
            target="RFC5307"></xref>, and the IPv6 SRLG TLV (Type 139)
            defined in <xref target="RFC6119"></xref>.  In Link State
            NLRI both IPv4 and IPv6 SRLG information are carried in a
            single TLV.</t>
          </section>

          <section anchor="OPAQUELINK"
                   title="Opaque Link Attribute TLV">
            <t>The Opaque link attribute TLV is an envelope that
            transparently carries optional link atrribute TLVs advertised by a
            router. An originating router shall use this TLV
            for encoding information specific to the protocol advertised
	    in the NLRI header Protocol-ID field or new protocol extensions
	    to the protocol as advertised in the NLRI header Protocol-ID field
	    for which there is no protocol neutral
	    representation in the BGP link-state NLRI.
	    </t>

            <figure anchor="OPAQUELINKTLV"
                    title="Opaque link attribute format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                Opaque link attributes (variable)            //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>
          </section>

          <section anchor="LINKNAME"
                   title="Link Name TLV">
	    <t>The Link Name TLV is optional.
	    The value field identifies the symbolic name of the router link.
	    This symbolic name can be the FQDN for the link, it can be a
	    subset of the FQDN, or it can be any string operators want to
	    use for the link. The use of FQDN or a subset of it is
	    strongly recommended.
	    </t>

	    <t>
	    The Value field is encoded in 7-bit ASCII.  If a user-interface for
	    configuring or displaying this field permits Unicode characters, that
	    user-interface is responsible for applying the ToASCII and/or
	    ToUnicode algorithm as described in <xref target="RFC3490"/>
	    to achieve the correct format for transmission or display.
	    </t>

	    <t>How a router derives and injects link names
	    is outside of the scope of this document.
	    </t>

            <figure anchor="optional-link-name-tlv"
                    title="Link Name format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                     Link Name (variable)                    //
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>
          </section>

        </section>

        <section title="Prefix Attribute TLVs">
          <t>Prefixes are learned from the IGP topology (IS-IS or OSPF) with a
          set of IGP attributes (such as metric, route tags, etc.) that MUST
          be reflected into the LINK_STATE attribute. This section describes
          the different attributes related to the IPv4/IPv6 prefixes. Prefix
          Attributes TLVs SHOULD be used when advertising NLRI types 3 and 4
          only. The following attributes TLVs are defined:</t>

          <texttable anchor="prefix-attribute_tlv"
                     title="Prefix Attribute TLVs">
            <ttcol align="center">TLV Code Point</ttcol>
            <ttcol align="left">Description</ttcol>
            <ttcol align="right">Length</ttcol>
            <ttcol align="left">Reference</ttcol>

            <c>1152</c>
            <c>IGP Flags</c>
            <c>1</c>
            <c><xref target="IGPFLAGS"></xref></c>

            <c>1153</c>
            <c>Route Tag</c>
            <c>4*n</c>
            <c><xref target="route_tag"></xref></c>

            <c>1154</c>
            <c>Extended Tag</c>
            <c>8*n</c>
            <c><xref target="ext_route_tag"></xref></c>

            <c>1155</c>
            <c>Prefix Metric</c>
            <c>4</c>
            <c><xref target="prefix_metric"></xref></c>

            <c>1156</c>
            <c>OSPF Forwarding Address</c>
            <c>4</c>
            <c><xref target="ospf_fwd_addr"></xref></c>

            <c>1157</c>
            <c>Opaque Prefix Attribute</c>
            <c>variable</c>
            <c><xref target="OPAQUEPREFIX"></xref></c>
          </texttable>

          <section anchor="IGPFLAGS" title="IGP Flags TLV">
            <t>IGP Flags TLV contains IS-IS and OSPF flags and bits originally
            assigned to the prefix. The IGP Flags TLV is encoded as
            follows:</t>

            <figure anchor="IGPFLAGSTLV" title="IGP Flag TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |D|   Reserved  |
  +-+-+-+-+-+-+-+-+
  </artwork>
            </figure>

            <t>The value field contains bits defined according to the table
            below:</t>

            <texttable anchor="table_igp_flag_bits_tlv"
                       title="IGP Flag Bits Definitions">
              <ttcol align="center">Bit</ttcol>
              <ttcol align="left">Description</ttcol>
              <ttcol align="left">Reference</ttcol>

              <c>'D'</c>
              <c>IS-IS Up/Down Bit</c>
              <c><xref target="RFC5305"></xref></c>

              <c>Reserved</c>
              <c>Reserved for future use.</c>
              <c></c>
            </texttable>

          </section>

          <section anchor="route_tag" title="Route Tag">
            <t>Route Tag TLV carries original IGP TAGs (IS-IS <xref
            target="RFC5130"></xref> or OSPF) of the prefix and is
            encoded as follows:</t>

            <figure anchor="IGPROUTETAG" title="IGP Route TAG TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                    Route Tags (one or more)                 // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>Length is a multiple of 4.</t>

            <t>The value field contains one or more Route Tags as learned in the
            IGP topology.</t>
          </section>

          <section anchor="ext_route_tag" title="Extended Route Tag">
            <t>Extended Route Tag TLV carries IS-IS Extended Route
            TAGs of the prefix <xref target="RFC5130"></xref> and is
            encoded as follows:</t>

            <figure anchor="IGPEXTROUTETAG"
                    title="Extended IGP Route TAG TLV format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                Extended Route Tag (one or more)             // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>Length is a multiple of 8.</t>

            <t>The 'Extended Route Tag' field contains one or more Extended
            Route Tags as learned in the IGP topology.</t>
          </section>

          <section anchor="prefix_metric" title="Prefix Metric TLV">
            <t>Prefix Metric TLV carries the metric of the prefix as
            known in the IGP topology <xref target="RFC5305"></xref>.
            The attribute is mandatory and can only appear once.</t>

            <figure anchor="PREFIXMETRIC" title="Prefix Metric TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                            Metric                             | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure>

            <t>Length is 4.</t>
          </section>

          <section anchor="ospf_fwd_addr" title="OSPF Forwarding Address TLV">
            <t>OSPF Forwarding Address TLV <xref
            target="RFC2328"></xref> carries the OSPF forwarding
            address as known in the original OSPF
            advertisement. Forwarding address can be either IPv4 or
            IPv6.</t>

            <figure anchor="OSPFFORWADDR"
                    title="OSPF Forwarding Address TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //                Forwarding Address (variable)                // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>

            <t>Length is 4 for an IPv4 forwarding address an 16 for an IPv6
            forwarding address.</t>
          </section>

          <section anchor="OPAQUEPREFIX"
		   title="Opaque Prefix Attribute TLV">

            <t>The Opaque Prefix attribute TLV is an envelope that
            transparently carries optional prefix attribute TLVs advertised by a
            router. An originating router shall use this TLV
            for encoding information specific to the protocol advertised
	    in the NLRI header Protocol-ID field or new protocol extensions
	    to the protocol as advertised in the NLRI header Protocol-ID field
	    for which there is no protocol neutral
	    representation in the BGP link-state NLRI.
	    </t>

            <t>The format of the TLV is as follows:</t>

            <figure anchor="OPAQUEPREFIXTLV"
                    title="Opaque Prefix Attribute TLV Format">
              <artwork>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |              Type             |             Length            | 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  //              Opaque Prefix Attributes  (variable)           // 
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              </artwork>
            </figure>

            <t>Type is as specified in <xref target="prefix-attribute_tlv"/> and
            Length is variable.</t>
          </section>
        </section>
      </section>

      <section title="BGP Next Hop Information">
        <t>BGP link-state information for both IPv4 and IPv6 networks
        can be carried over either an IPv4 BGP session, or an IPv6 BGP
        session. If IPv4 BGP session is used, then the next hop in the
        MP_REACH_NLRI SHOULD be an IPv4 address. Similarly, if IPv6
        BGP session is used, then the next hop in the MP_REACH_NLRI
        SHOULD be an IPv6 address.  Usually the next hop will be set
        to the local end-point address of the BGP session. The next
        hop address MUST be encoded as described in <xref
        target="RFC4760"></xref>. The length field of the next hop
        address will specify the next hop address-family. If the next
        hop length is 4, then the next hop is an IPv4 address; if the
        next hop length is 16, then it is a global IPv6 address and if
        the next hop length is 32, then there is one global IPv6
        address followed by a link-local IPv6 address. The link-local
        IPv6 address should be used as described in <xref
        target="RFC2545"></xref>. For VPN SAFI, as per custom, an 8 byte
        route-distinguisher set to all zero is prepended to the next hop.
	</t>

        <t>The BGP Next Hop attribute is used by each BGP-LS speaker to
        validate the NLRI it receives. However, this specification doesn't
        mandate any rule regarding the re-write of the BGP Next Hop
        attribute.</t>
      </section>

      <section title="Inter-AS Links">
        <t>The main source of TE information is the IGP, which is not
        active on inter-AS links. In some cases, the IGP may have
        information of inter-AS links (<xref target="RFC5392"></xref>,
        <xref target="RFC5316"></xref>). In other cases, for injecting
        a non-IGP enabled link into the BGP link-state RIB, an
        implementation MUST support configuration of either 'Static'
	or 'Direct' links.</t>
      </section>

      <section title="Router-ID Anchoring Example: ISO Pseudonode">
	<t>Encoding of a broadcast LAN in IS-IS provides a good
	example of how Router-IDs are encoded. Consider <xref
	target="ISISPseudonodes"></xref>. This represents a
	Broadcast LAN between a pair of routers. The "real" (=non
	pseudonode) routers have both an IPv4 Router-ID and IS-IS
	Node-ID. The pseudonode does not have an IPv4
	Router-ID. Node1 is the DIS for the LAN. Two
	unidirectional links (Node1, Pseudonode 1) and (Pseudonode1, 
        Node2) are being generated.</t>

	<t>The link NRLI of (Node1, Pseudonode1) is encoded as
	follows: the IGP Router-ID TLV of the local node
	descriptor is 6 octets long containing ISO-ID of Node1,
	1920.0000.2001; the IGP Router-ID TLV of the remote node
	descriptor is 7 octets long containing the ISO-ID of
	Pseudonode1, 1920.0000.2001.02. The BGP-LS attribute of
	this link contains one local IPv4 Router-ID TLV (TLV type
	1028) containing 192.0.2.1, the IPv4 Router-ID of Node1.
	</t>
	<t>The link NRLI of (Pseudonode1. Node2) is encoded as
	follows: the IGP Router-ID TLV of the local node
	descriptor is 7 octets long containing the ISO-ID of
	Pseudonode1, 1920.0000.2001.02; the IGP Router-ID TLV of
	the remote node descriptor is 6 octets long containing
	ISO-ID of Node2, 1920.0000.2002. The BGP-LS attribute of
	this link contains one remote IPv4 Router-ID TLV (TLV type
	1030) containing 192.0.2.2, the IPv4 Router-ID of Node2.
	</t>

	<figure anchor="ISISPseudonodes" title="IS-IS Pseudonodes">
          <artwork>
  +-----------------+    +-----------------+    +-----------------+
  |      Node1      |    |   Pseudonode1   |    |      Node2      |
  |1920.0000.2001.00|---&gt;|1920.0000.2001.02|---&gt;|1920.0000.2002.00|
  |     192.0.2.1   |    |                 |    |     192.0.2.2   |
  +-----------------+    +-----------------+    +-----------------+
	  </artwork>
	</figure>
      </section>

      <section title="Router-ID Anchoring Example: OSPFv2 to IS-IS Migration">
	<t>Graceful migration from one IGP to another requires
	coordinated operation of both protocols during the migration
	period.  Such a coordination requires identifying a given
	physical link in both IGPs. The IPv4 Router-ID provides that
	"glue" which is present in the node descriptors of the OSPF link
	NLRI and in the link attribute of the IS-IS link NLRI.
	</t>
	<t>
          Consider a point-to-point link between two routers, A and B,
          that initially were OSPFv2-only routers and then IS-IS is
          enabled on them. Node A has IPv4 Router-ID and ISO-ID; node B
          has IPv4 Router-ID, IPv6 Router-ID and ISO-ID.  Each protocol
          generates one link NLRI for the link (A, B), both of which are
          carried by BGP-LS. The OSPFv2 link NLRI for the link is
          encoded with the IPv4 Router-ID of nodes A and B in the local
          and remote node descriptors, respectively.  The IS-IS link
          NLRI for the link is encoded with the ISO-ID of nodes A and B
          in the local and remote node descriptors, respectively. In
          addition, the BGP-LS attribute of the IS-IS link NLRI contains
          the the TLV type 1028 containing the IPv4 Router-ID of node A;
          TLV type 1030 containing the IPv4 Router-ID of node B and TLV
          type 1031 containing the IPv6 Router-ID of node B. In this
          case, by using IPv4 Router-ID, the link (A, B) can be
          identified in both IS-IS and OSPF protocol.
	</t>
      </section>
    </section>

    <section title="Link to Path Aggregation">
      <t>Distribution of all links available in the global Internet is
      certainly possible, however not desirable from a scaling and privacy
      point of view. Therefore an implementation may support link to path
      aggregation. Rather than advertising all specific links of a domain, an
      ASBR may advertise an "aggregate link" between a non-adjacent pair of
      nodes. The "aggregate link" represents the aggregated set of link
      properties between a pair of non-adjacent nodes. The actual methods to
      compute the path properties (of bandwidth, metric) are outside the scope
      of this document. The decision whether to advertise all specific links
      or aggregated links is an operator's policy choice. To highlight the
      varying levels of exposure, the following deployment examples are
      discussed.</t>

      <section title="Example: No Link Aggregation">
        <t>Consider <xref target="no-link-aggregation"></xref>. Both AS1 and
        AS2 operators want to protect their inter-AS {R1,R3}, {R2, R4} links
        using RSVP-FRR LSPs. If R1 wants to compute its link-protection LSP to
        R3 it needs to "see" an alternate path to R3. Therefore the AS2
        operator exposes its topology. All BGP TE enabled routers in AS1 "see"
        the full topology of AS and therefore can compute a backup path. Note
        that the decision if the direct link between {R3, R4} or the {R4, R5,
        R3) path is used is made by the computing router.</t>

        <figure anchor="no-link-aggregation" title="No link aggregation">
          <artwork>
       AS1   :   AS2
             :
        R1-------R3
         |   :   | \ 
         |   :   |  R5
         |   :   | /
        R2-------R4
             :
             :
	  </artwork>
        </figure>
      </section>

      <section title="Example: ASBR to ASBR Path Aggregation">
        <t>The brief difference between the "no-link aggregation" example and
        this example is that no specific link gets exposed. Consider <xref
        target="asbr-link-aggregation"></xref>. The only link which gets
        advertised by AS2 is an "aggregate" link between R3 and R4. This is
        enough to tell AS1 that there is a backup path. However the actual
        links being used are hidden from the topology.</t>

        <figure anchor="asbr-link-aggregation" title="ASBR link aggregation">
          <artwork>
       AS1   :   AS2
             :
        R1-------R3
         |   :   |
         |   :   |
         |   :   |
        R2-------R4
             :
             :
	  </artwork>
        </figure>
      </section>

      <section title="Example: Multi-AS Path Aggregation">
        <t>Service providers in control of multiple ASes may even decide to
        not expose their internal inter-AS links. Consider <xref
        target="multi-as-aggregation"></xref>. AS3 is modeled as a single node
        which connects to the border routers of the aggregated domain. <figure
        anchor="multi-as-aggregation" title="Multi-AS aggregation">
        <artwork>
       AS1   :   AS2   :   AS3 
             :         :
        R1-------R3-----   
         |   :         : \ 
         |   :         :   vR0
         |   :         : /
        R2-------R4-----
             :         :
             :         :
	</artwork>
        </figure></t>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document requests a code point from the registry of Address
      Family Numbers. As per early allocation procedure this is AFI 16388.</t>

      <t>This document requests a code point from the registry of Subsequent
      Address Family Numbers. As per early allocation procedure this is SAFI 71.</t>

      <t>This document requests a code point from the BGP Path Attributes
      registry.</t>

      <t>This document requests creation of a new registry for node anchor, link
      descriptor and link attribute TLVs. Values 0-255 are reserved.  Values
      256-65535 will be used for Codepoints. The registry will be initialized as
      shown in <xref target="BGPLSCODEPOINTS"/>. Allocations within the registry
      will require documentation of the proposed use of the allocated value and
      approval by the Designated Expert assigned by the IESG (see <xref
      target="RFC5226"></xref>).</t>

      <t>Note to RFC Editor: this section may be removed on publication as an
      RFC.</t>
    </section>

    <section anchor="Manageability" title="Manageability Considerations">
      <t>This section is structured as recommended in <xref
      target="RFC5706"></xref>.</t>

      <section anchor="Operational-Considerations"
               title="Operational Considerations">
        <section anchor="Operations" title="Operations">
          <t>Existing BGP operational procedures apply. No new operation
          procedures are defined in this document. It is noted that the
          NLRI information present in this document purely carries application
          level data that has no immediate corresponding forwarding state
          impact. As such, any churn in reachability information has different
          impact than regular BGP updates which need to change forwarding state
          for an entire router. Furthermore it is anticipated that distribution
          of this NLRI will be handled by dedicated route-reflectors providing a
          level of isolation and fault-containment between different NLRI
          types.</t>
        </section>

        <section anchor="Initial-Setup" title="Installation and Initial Setup">
          <t>Configuration parameters defined in <xref
          target="Configuration-Management"></xref> SHOULD be initialized to
          the following default values: <list style="symbols">
          <t>The Link-State NLRI capability is turned off for all
          neighbors.</t>
	  
          <t>The maximum rate at which Link State NLRIs will be
          advertised/withdrawn from neighbors is set to 200 updates per
          second.</t>
          </list></t>
        </section>

        <section anchor="Migration-Path" title="Migration Path">
          <t>The proposed extension is only activated between BGP peers after
          capability negotiation. Moreover, the extensions can be turned
          on/off an individual peer basis (see <xref
          target="Configuration-Management"></xref>), so the extension can be
          gradually rolled out in the network.</t>
        </section>

        <section anchor="Other-Protocols"
                 title="Requirements on Other Protocols and Functional Components">
          <t>The protocol extension defined in this document does not put new
          requirements on other protocols or functional components.</t>
        </section>

        <section anchor="Network-Operation"
                 title="Impact on Network Operation">
          <t>Frequency of Link-State NLRI updates could interfere with regular
          BGP prefix distribution. A network operator MAY use a dedicated
          Route-Reflector infrastructure to distribute Link-State NLRIs.</t>

          <t>Distribution of Link-State NLRIs SHOULD be limited to a single
          admin domain, which can consist of multiple areas within an AS or
          multiple ASes.</t>
        </section>

        <section anchor="Verifying-Correct-Operation"
                 title="Verifying Correct Operation">
          <t>Existing BGP procedures apply. In addition, an implementation
          SHOULD allow an operator to: <list style="symbols">
              <t>List neighbors with whom the Speaker is exchanging Link-State
              NLRIs</t>
            </list></t>
        </section>
      </section>

      <section anchor="Management-Considerations"
               title="Management Considerations">
        <section anchor="Management-Information"
                 title="Management Information"></section>

        <section anchor="Fault-Management" title="Fault Management">
          <t>TBD.</t>
        </section>

        <section anchor="Configuration-Management"
                 title="Configuration Management">
          <t>An implementation SHOULD allow the operator to specify neighbors
          to which Link-State NLRIs will be advertised and from which
          Link-State NLRIs will be accepted.</t>

          <t>An implementation SHOULD allow the operator to specify the
          maximum rate at which Link State NLRIs will be advertised/withdrawn
          from neighbors</t>

          <t>An implementation SHOULD allow the operator to specify the
          maximum number of Link State NLRIs stored in router's RIB.</t>

          <t>An implementation SHOULD allow the operator to create abstracted
          topologies that are advertised to neighbors; Create different
          abstractions for different neighbors.</t>

          <t>An implementation SHOULD allow the operator to configure a 64-bit
          instance ID.</t>

          <t>An implementation SHOULD allow the operator to configure a pair
          of ASN and BGP-LS identifier per flooding set the node participates
          in.</t>
        </section>
	
        <section anchor="Accounting-Management" title="Accounting Management">
          <t>Not Applicable.</t>
        </section>

        <section anchor="Performance-Management"
                 title="Performance Management">
          <t>An implementation SHOULD provide the following statistics: <list
              style="symbols">
          <t>Total number of Link-State NLRI updates sent/received</t>

          <t>Number of Link-State NLRI updates sent/received, per
          neighbor</t>

          <t>Number of errored received Link-State NLRI updates, per
          neighbor</t>

          <t>Total number of locally originated Link-State NLRIs</t>
          </list></t>
        </section>

        <section anchor="Security-Management" title="Security Management">
          <t>An operator SHOULD define ACLs to limit inbound updates as
          follows: <list style="symbols">
          <t>Drop all updates from Consumer peers</t>
          </list></t>
        </section>
      </section>
    </section>
    <section anchor="TLVSUMMARY" title="TLV/Sub-TLV Code Points Summary">
      <t>This section contains the global table of all TLVs/Sub-TLVs defined in
      this document.</t>
      
      <texttable anchor="BGPLSCODEPOINTS"
                 title="Summary Table of TLV/Sub-TLV Codepoints">
        <ttcol align="center">TLV Code Point</ttcol>
        <ttcol align="left">Description</ttcol>
        <ttcol align="center">IS-IS TLV/ Sub-TLV</ttcol>
        <ttcol align="left">Value defined in:</ttcol>

        <!-- NLRI TLVs -->
        <c>256</c>
        <c>Local Node Descriptors</c>
        <c>---</c><c>
        <xref target="LOCALNODEDESC"></xref></c>
        
        <c>257</c>
        <c>Remote Node Descriptors</c>
        <c>---</c>
        <c><xref target="REMOTENODEDESC"></xref></c>

        <c>258</c>
        <c>Link Local/Remote Identifiers</c>
        <c>22/4</c>
        <c><xref target="RFC5307"></xref>/1.1</c>

        <c>259</c>
        <c>IPv4 interface address</c>
        <c>22/6</c>
        <c><xref target="RFC5305"></xref>/3.2</c>

        <c>260</c>
        <c>IPv4 neighbor address</c>
        <c>22/8</c>
        <c><xref target="RFC5305"></xref>/3.3</c>

        <c>261</c>
        <c>IPv6 interface address</c>
        <c>22/12</c>
        <c><xref target="RFC6119"></xref>/4.2</c>

        <c>262</c>
        <c>IPv6 neighbor address</c>
        <c>22/13</c>
        <c><xref target="RFC6119"></xref>/4.3</c>

        <c>263</c>
        <c>Multi-Topology ID</c>
        <c>---</c>
        <c><xref target="MT-ID"></xref></c>

        <c>264</c>
        <c>OSPF Route Type</c>
        <c>---</c>
        <c><xref target="PREFIXDESC"></xref></c>

        <c>265</c>
        <c>IP Reachability Information</c>
        <c>---</c>
        <c><xref target="PREFIXDESC"></xref></c>

        <!-- NLRI SubTLVs -->

        <c>512</c>
        <c>Autonomous System</c>
        <c>---</c>
        <c><xref target="node_desc_tlvs"></xref></c>

        <c>513</c>
        <c>BGP-LS Identifier</c>
        <c>---</c>
        <c><xref target="node_desc_tlvs"></xref></c>

        <c>514</c>
        <c>Area ID</c>
        <c>---</c>
        <c><xref target="node_desc_tlvs"></xref></c>

        <c>515</c>
        <c>IGP Router-ID</c>
        <c>---</c>
        <c><xref target="node_desc_tlvs"></xref></c>

        <!-- Link State Attribute TLVs -->

        <!-- Node Attributes TLVs -->
        <c>1024</c>
        <c>Node Flag Bits</c>
        <c>---</c>
        <c><xref target="NODEFLAGBITS"></xref></c>

        <c>1025</c>
        <c>Opaque Node Properties</c>
        <c>---</c>
        <c><xref target="OPAQUENODE"></xref></c>

	<c>1026</c>
	<c>Node Name</c>
	<c>variable</c>
	<c><xref target="NODENAME"/></c>

        <c>1027</c>
        <c>IS-IS Area Identifier</c>
        <c>variable</c>
        <c><xref target="ISISAREA"/></c>

        <c>1028</c>
        <c>IPv4 Router-ID of Local Node</c>
        <c>134/---</c>
        <c><xref target="RFC5305"></xref>/4.3</c>

        <c>1029</c>
        <c>IPv6 Router-ID of Local Node</c>
        <c>140/---</c>
        <c><xref target="RFC6119"></xref>/4.1</c>

        <c>1030</c>
        <c>IPv4 Router-ID of Remote Node</c>
        <c>134/---</c>
        <c><xref target="RFC5305"></xref>/4.3</c>

        <c>1031</c>
        <c>IPv6 Router-ID of Remote Node</c>
        <c>140/---</c>
        <c><xref target="RFC6119"></xref>/4.1</c>

       <!-- Link  Attribute TLVs -->

        <c>1088</c>
        <c>Administrative group (color)</c>
        <c>22/3</c>
        <c><xref target="RFC5305"></xref>/3.1</c>

        <c>1089</c>
        <c>Maximum link bandwidth</c>
        <c>22/9</c>
        <c><xref target="RFC5305"></xref>/3.3</c>

        <c>1090</c>
        <c>Max. reservable link bandwidth</c>
        <c>22/10</c>
        <c><xref target="RFC5305"></xref>/3.5</c>

        <c>1091</c>
        <c>Unreserved bandwidth</c>
        <c>22/11</c>
        <c><xref target="RFC5305"></xref>/3.6</c>

        <c>1092</c>
        <c>TE Default Metric</c>
        <c>22/18</c>
        <c><xref target="RFC5305"></xref>/3.7</c>

        <c>1093</c>
        <c>Link Protection Type</c>
        <c>22/20</c>
        <c><xref target="RFC5307"></xref>/1.2</c>

        <c>1094</c>
        <c>MPLS Protocol Mask</c>
        <c>---</c>
        <c><xref target="MPLSPROTOTLV"></xref></c>

        <c>1095</c>
        <c>Metric</c>
        <c>---</c>
        <c><xref target="METTLV"></xref></c>

        <c>1096</c>
        <c>Shared Risk Link Group</c>
        <c>---</c>
        <c><xref target="SRLGTLV"></xref></c>

        <c>1097</c>
        <c>Opaque link attribute</c>
        <c>---</c>
        <c><xref target="OPAQUELINK"></xref></c>

	<c>1098</c>
	<c>Link Name attribute</c>
	<c>---</c>
	<c><xref target="LINKNAME"></xref></c>

        <!-- Prefix Attributes TLVs -->

        <c>1152</c>
        <c>IGP Flags</c>
        <c>---</c>
        <c><xref target="IGPFLAGS"></xref></c>

        <c>1153</c>
        <c>Route Tag</c>
        <c>---</c>
        <c><xref target="RFC5130"></xref></c>

        <c>1154</c>
        <c>Extended Tag</c>
        <c>---</c>
        <c><xref target="RFC5130"></xref></c>

        <c>1155</c>
        <c>Prefix Metric</c>
        <c>---</c>
        <c><xref target="RFC5305"></xref></c>

        <c>1156</c>
        <c>OSPF Forwarding Address</c>
        <c>---</c>
        <c><xref target="RFC2328"></xref></c>

        <c>1157</c>
        <c>Opaque Prefix Attribute</c>
        <c>---</c>
        <c><xref target="OPAQUEPREFIX"></xref></c>
      </texttable>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>Procedures and protocol extensions defined in this document
      do not affect the BGP security model. See <xref
      target="I-D.ietf-karp-routing-tcp-analysis"></xref> for
      details.</t>

      <t>A BGP Speaker SHOULD NOT accept updates from a Consumer peer.</t>
      
      <t>An operator SHOULD employ a mechanism to protect a BGP Speaker
      against DDOS attacks from Consumers.</t>
    </section>

    <section anchor="Contributors" title="Contributors">
      <t>We would like to thank Robert Varga for the significant contribution
      he gave to this document.</t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>We would like to thank Nischal Sheth, Alia Atlas, David Ward, Derek
      Yeung, Murtuza Lightwala, John Scudder, Kaliraj Vairavakkalai, Les
      Ginsberg, Liem Nguyen, Manish Bhardwaj, Mike Shand, Peter Psenak, Rex
      Fernando, Richard Woundy, Steven Luong, Tamas Mondal, Waqas Alam, Vipin
      Kumar, Naiming Shen, Balaji Rajagopalan and Yakov Rekhter for their comments.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5130.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.6822"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2545.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.1195.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.1918.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2328.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3209.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3490.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4202.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4760.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4915.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5036.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5120.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5301.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5305.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5307.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.6119.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.6286.xml"?>
    </references>

    <references title="Informative References">
      <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-alto-protocol-13.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5392.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5316.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4655.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-karp-routing-tcp-analysis.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4970.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5073.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5152.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5693.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.5706.xml"?>
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.6549.xml"?>
    </references>
  </back>
</rfc>
