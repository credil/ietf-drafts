


6TSCH                                                    P. Thubert, Ed.
Internet-Draft                                                     cisco
Intended status: Standards Track                            RA. Assimiti
Expires: January 14, 2014                                          Nivis
                                                             T. Watteyne
                                       Linear Technology / Dust Networks
                                                           July 15, 2013

       An Architecture for IPv6 over Timeslotted Channel Hopping
                  draft-thubert-6tsch-architecture-02

Abstract

   This document presents an architecture for an IPv6 multilink subnet
   that is composed of a high speed powered backbone and a number of
   IEEE802.15.4e TSCH wireless networks attached and synchronized by
   Backbone Routers.  Route Computation may be achieved in a centralized
   fashion by a Path Computation Element, in a distributed fashion using
   the Routing Protocol for Low Power and Lossy Networks, or in a mixed
   mode.  The Backbone Routers perform proxy Neighbor discovery
   operations over the backbone on behalf of the wireless device, so
   they can share a same subnet and appear to be connected to the same
   backbone as classical devices.

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in RFC
   2119 [RFC2119].

Status of this Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference









Thubert, Assimiti & WattExpires January 14, 2014                [Page 1]

Internet-Draft             6tsch-architecture                  July 2013

   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 14, 2014.

Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (http://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Simplified BSD License text
   as described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Simplified BSD License.

Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  2
   2.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  3
   3.  Applications and Goals . . . . . . . . . . . . . . . . . . . .  3
   4.  Overview and Scope . . . . . . . . . . . . . . . . . . . . . .  4
   5.  Centralized vs. Distributed Routing  . . . . . . . . . . . . .  7
   6.  Forwarding Models  . . . . . . . . . . . . . . . . . . . . . .  7
     6.1.  Track Forwarding . . . . . . . . . . . . . . . . . . . . .  7
       6.1.1.  Transport Mode . . . . . . . . . . . . . . . . . . . .  8
       6.1.2.  Tunnel Mode  . . . . . . . . . . . . . . . . . . . . .  8
       6.1.3.  Tunnel Metadata  . . . . . . . . . . . . . . . . . . .  9
     6.2.  Fragment Forwarding  . . . . . . . . . . . . . . . . . . . 10
     6.3.  IPv6 Forwarding  . . . . . . . . . . . . . . . . . . . . . 11
   7.  Functional Flows . . . . . . . . . . . . . . . . . . . . . . . 12
   8.  Network Synchronization  . . . . . . . . . . . . . . . . . . . 12
   9.  TSCH and 6top  . . . . . . . . . . . . . . . . . . . . . . . . 12
     9.1.  6top . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
     9.2.  Slotframes and Priorities  . . . . . . . . . . . . . . . . 13
     9.3.  Centralized Flow Reservation . . . . . . . . . . . . . . . 13
     9.4.  Distributed Flow Reservation . . . . . . . . . . . . . . . 13
     9.5.  Packet Marking and Handling  . . . . . . . . . . . . . . . 14
   10. Management . . . . . . . . . . . . . . . . . . . . . . . . . . 14
   11. IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 14
   12. Security Considerations  . . . . . . . . . . . . . . . . . . . 14
   13. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 14
   14. References . . . . . . . . . . . . . . . . . . . . . . . . . . 14
     14.1.  Normative References  . . . . . . . . . . . . . . . . . . 14
     14.2.  Informative References  . . . . . . . . . . . . . . . . . 15
     14.3.  External Informative References . . . . . . . . . . . . . 16
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 17

1.  Introduction




Thubert, Assimiti & WattExpires January 14, 2014                [Page 2]

Internet-Draft             6tsch-architecture                  July 2013


   The emergence of radio technology enabled a large variety of new
   types of devices to be interconnected, at a very low marginal cost
   compared to wire, at any range from Near Field to interplanetary
   distances, and in circumstances where wiring could be less than
   practical, for instance rotating devices.

   At the same time, a new breed of Time Sensitive Networks is being
   developped to enable traffic that is highly sensitive to jitter and
   quite sensitive to latency.  Such traffic is not limited to voice and
   video, but also includes command and control operations such as found
   in industrial automation or in-vehicule sensors and actuators.

   At IEEE802.1, the "Audio/Video Task Group", was renamed TSN for Time
   Sensitive Networking to address Deterministic Ethernet.  The
   IEEE802.15.4 Medium Access Control (MAC) has evolved with
   IEEE802.15.4e that provides in particular the Timeslotted Channel
   Hopping (TSCH) mode for industrial-type applications.

   Though at a different time scale, both standards provide
   Deterministic capabilities to the point that a packet that pertains
   to a certain flow will cross the network from node to node following
   a very precise schedule, like a train leaves intermediate stations at
   precise times along its path.  The time slotted aspect reduces
   collisions, and saves energy, and enables to more closely engineer
   the network for deterministic properties.  The channel hopping aspect
   is a simple and efficient technique to get around statistical
   interference by WiFi emitters.

   This document presents an architecture for an IPv6 multilink subnet
   that is composed of a high speed powered backbone and a number of
   IEEE802.15.4e TSCH wireless networks attached and synchronized by
   backbone routers.  Route Computation may be achieved in a centralized
   fashion by a Path Computation Element (PCE), in a distributed fashion
   using the Routing Protocol for Low Power and Lossy Networks (RPL), or
   in a mixed mode.  The Backbone Routers perform proxy Ipv6 Neighbor
   Discovery (ND) operations over the backbone on behalf of the wireless
   devices, so they can share a same IPv6 subnet and appear to be
   connected to the same backbone as classical devices.

2.  Terminology

   The draft uses terminology defined in [I-D.palattella-6tsch-
   terminology], [I-D.chakrabarti-nordmark-6man-efficient-nd], [RFC5191]
   and [RFC4080].

   It conforms to the terms and models described for IPv6 in [RFC5889]
   and uses the vocabulary and the concepts defined in [RFC4291] for
   IPv6.

3.  Applications and Goals




Thubert, Assimiti & WattExpires January 14, 2014                [Page 3]

Internet-Draft             6tsch-architecture                  July 2013


   The architecture derives from existing industrial standards for
   Process Control by its focus on Deterministic Networking, in
   particular with the use of the IEEE802.15.4e TSCH MAC and the
   centralized path computation element.  This approach leverages the
   TSCH MAC benefits for high reliability against interference, low-
   power consumption on deterministic traffic, and its Traffic
   Engineering capabilities.  Deterministic Networking applies in
   particular to open and closed control loops, as well as supervisory
   control flows, and management.

   Additional industrial use cases are addressed with the addition of a
   more autonomic and distributed routing based on RPL. These use cases
   include plant setup and decommissioning, as well as monitoring of
   lots of lesser importance measurements such as corrosion and events.
   RPL also enables mobile use cases such as mobile workers and cranes.

   A Backbone Router is included in order to scale the factory plant
   subnet to address large deployments, with proxy ND and time
   synchronization over a high speed backbone.

   The architecture also applies to building automation that leverage
   RPL's storing mode to address multipath over a large number of hops,
   in-vehicule command and control that can be as demanding as
   industrial applications, commercial automation and asset Tracking
   with mobile scenarios, home automation and domotics which become more
   reliable and thus provide a better user experience, and resource
   management (energy, water, etc.).

4.  Overview and Scope

   The scope of the present work is a subnet that, in its basic
   configuration, is made of a IEEE802.15.4e Timeslotted Channel Hopping
   (TSCH) [I-D.watteyne-6tsch-tsch-lln-context] MAC Route-Over Low Power
   Lossy Network (LLN).

   
               +-----+
               |     | LLN Border
               |     | router
               +-----+
             o    o   o
      o     o   o     o
         o   o LLN   o    o     o
            o   o   o       o
                    o









Thubert, Assimiti & WattExpires January 14, 2014                [Page 4]

Internet-Draft             6tsch-architecture                  July 2013


   The LLN devices communicate over IPv6 [RFC2460] using the 6LoWPAN
   Header Compression (6LoWPAN HC) [RFC6282].  From the Layer 3
   perspective, a single LLN interface (typically an IEEE802.15.4 radio)
   may be seen as a collection of Links with different capabilities for
   unicast or multicast services.  An IPv6 subnet will span over
   multiple links, effectively forming a multilink subnet.  Within that
   subnet, Neighbor Devices are discovered with 6LoWPAN Neighbor
   Discovery (6LoWPAN ND) [RFC6775].  The Routing Protocol for Low Power
   and Lossy Networks (RPL)  [RFC6550] enables routing within the LLN,
   typically within the multilink subnet in the so called Routing Over
   fashion.  RPL forms Destination Oriented Directed Acyclic Graphs
   (DODAGs) within instances of the protocol, each instance being
   associated with an Objective Function (OF) to form a routing
   topology.  A particular LLN device, usually powered, acts as RPL
   root, 6LoWPAN HC terminator, and LLN Border Router (LBR) to the
   outside.

   An extended configuration of the subnet comprises multiple LLNs.  The
   LLNs are interconnected and synchronized over a backbone, that can be
   wired or wireless.  The backbone can be a classical IPv6 network,
   with Neighbor Discovery operating as defined in [RFC4861] and
   [RFC4862].  The backbone can also support Efficiency aware IPv6
   Neighbor Discovery Optimizations  [I-D.chakrabarti-nordmark-6man-
   efficient-nd] in mixed mode as described in [I-D.thubert-6lowpan-
   backbone-router].

   Security is often handled at layer 2 and Layer 4. Authentication
   during the join process is handled with the Protocol for Carrying
   Authentication for Network Access (PANA) [RFC5191].

   The LLN devices are time-synchronized at MAC level.  The MAC
   coordinator that serves as time source is loosely coupled with the
   RPL parent; this way, the time synchronization starts at the RPL root
   and follows the RPL DODAGs with no timing loop.

   In the extended configuration, the functionality of the LBR is
   enhanced to that of Backbone Router (BBR). A BBR is an LBR, but also
   an Energy Aware Default Router (NEAR) as defined in [I-D.chakrabarti-
   nordmark-6man-efficient-nd].  The BBR performs ND proxy operations
   between the registered devices and the classical ND devices that are
   located over the backbone.  6TSCH BBRs synchronize with one another
   over the backbone, so as to ensure that the multiple LLNs that form
   the IPv6 subnet stay tightly synchronized.  If the Backbone is
   Deterministic (such as defined by the Time Sensitive Networking WG at
   IEEE), then the Backbone Router ensures that the end-to-end
   deterministic behavior is maintained between the LLN and the








Thubert, Assimiti & WattExpires January 14, 2014                [Page 5]

Internet-Draft             6tsch-architecture                  July 2013

   backbone.

               ---+------------------------
                  |      External Network
                  |
               +-----+                  +-----+
               |     | Router           |     | PCE
               |     |                  |     |
               +-----+                  +-----+
                  |                        |
                  |     Subnet Backbone    |
            +--------------------+------------------+
            |                    |                  |
         +-----+             +-----+             +-----+
         |     | Backbone    |     | Backbone    |     | Backbone
    o    |     | router      |     | router      |     | router
         +-----+             +-----+             +-----+
    o                  o                   o                 o   o
        o    o   o         o   o  o   o         o  o   o    o
   o             o        o  LLN      o      o         o      o
      o   o    o      o      o o     o  o   o    o    o     o

   The main architectural blocks are arranged as follows:

        +-----+-----+-----+-----+-------+-----+
        |PCEP |   CoAP    |PANA |6LoWPAN| RPL |
        | PCC |DTLS |     |     |   ND  |     |
        +-----+-----+-----+-----+-------+-----+-----+
        | TCP |       UDP       |    ICMP     |RSVP |
        +-----+-----+-----+-----+-------+-----+-----+
        |                 IPv6                      |
        +-------------------------------------------+
        |               6LoWPAN HC                  |
        +-------------------------------------------+
        |                   6top                    |
        +-------------------------------------------+
        |             802.15.4e   TSCH              |
        +-------------------------------------------+

   RPL is the routing protocol of choice for LLNs.  (TBD RPL) whether
   there is a need to define a 6TSCH OF.

   (tbd NME) COMAN is working on network Management for LLN.  They are
   considering the Open Mobile Alliance (OMA) Lightweight M2M (LWM2M)
   Objet system.  This standard includes DTLS, CoAP (core plus the Block
   and Observe patterns), SenML and CoAP Resource Directory.

   (tbd PCC) need to work with PCE WG to define flows to PCE, and define
   how to accomodate PCE routes and reservation.  Will probably look a
   lot like GMPLS

   (tbd Backbone Router) need to work with 6MAN to define ND proxy.
   Also need BBR sync sync between deterministic ethernet and 6TSCH


Thubert, Assimiti & WattExpires January 14, 2014                [Page 6]

Internet-Draft             6tsch-architecture                  July 2013

   LLNs.

   IEEE802.1TSN: external, maintain consistency.

   IEEE802.15.4: external, (tbd need updates?).

   ISA100.20 Common Network Management: external, maintain consistency.

   IoT6 European Project: external, maintain consistency.

5.  Centralized vs.  Distributed Routing

   6TSCH supports a mix model of centralized routes that are computed by
   a Path Computation Entity and distributed routes that are computed by
   RPL over a common physical LLN.

   Both RPL and the PCE may inject routes in the Routing Tables of the
   6TSCH routers.  In either case, each route is associated with a
   topology that is indexed by an instanceID, as defined in RPL
   [RFC6550].  RPL and PCE rely on shared sources to define Global and
   Local InstanceIDs.

   It is possible for RPL and PCE to share a same topology, in which
   case the PCE routes have precedence over RPL routes in case of a
   conflict.

   Inside the 6TSCH domain, the flow label is used to indicate the
   topology that must be used for routing and the associated Routing
   Tables as discussed in [I-D.thubert-roll-flow-label].

6.  Forwarding Models

   6TSCH supports three different forwarding model, G-MPLS Track
   Forwarding (TF), 6LoWPAN Fragment Forwarding (FF) and IPv6 Forwarding
   (6F).

6.1.  Track Forwarding

   Track Forwarding is the simplest and fastest.  A set of input cells
   are uniquely bound to a set of output cells, representing a
   forwarding state that can be used regardless of the uppoer layer
   protocol.  This model can effectively be seen as a G-MPLS operation
   in that the information used to switch is not an explicit label but
   related to other properties of the way the packet was received, a
   particular cell in the case of 6TSCH.  As a result, as long as the
   TSCH MAC (and Layer 2 security) accepts a frame, that frame can be
   switched regardless of the protocol, whether this is an IPv6 packet,
   a 6LoWPAN fragment, or a frame from an alternate protocol such as
   WirelessHART of ISA100.11a.






Thubert, Assimiti & WattExpires January 14, 2014                [Page 7]

Internet-Draft             6tsch-architecture                  July 2013


   A Track is defined end-to-end as a succession of Timeslots and a
   Timeslot belongs to at most one Track.  For a given iteration of a
   Slotframe, the Timeslot is associated uniquely with a cell which
   indicates the channel at which the Timeslot operates for that
   iteration.

   A frame that is forwarded along a Track has a destination MAC address
   set to broadcast or a multicast address depending on the MAC support.
   This way, the MAC layer in the intermediate nodes will accept the
   incoming frame and 6top will switch it without incurring a change in
   the MAC header.  In the case of 802.15.4e, this means effectively
   broadcast, so that along the Track the short address for the
   destination is set to 0xFFFF.

   Conversely, a frame that is received along a Track with a destination
   MAC address set to this node is extracted from the Track stream and
   delivered to the upper layer.  A frame with an unrecognized MAC
   address is just ignored at the MAC layer and thus is not received at
   the 6top sublayer.

   There are 2 modes for a Track, transport mode and tunnel mode.

6.1.1.  Transport Mode

                             |                                    ^
         +--------------+    |                                    |
         |     IPv6     |    |                                    |
         +--------------+    |                                    |
         |  6LoWPAN HC  |    |                                    |
         +--------------+  ingress                              egress
         |     6top     |   sets     +----+          +----+     restores
         +--------------+  dmac to   |    |          |    |     dmac to
         |   TSCH MAC   |   brdcst   |    |          |    |      self
         +--------------+    |       |    |          |    |       |
         |   LLN PHY    |    +-------+    +--...-----+    +-------+
         +--------------+
   

   In transport mode, the PDU is associated with flow information that
   refers uniquely to the Track, so the 6top sublayer can place the
   frame in the appropriate Timeslot without ambiguity.  In the case of
   IPv6 traffic, the identification of that flow information is
   transported in the Flow Label in the IPv6 header.  Associated with
   the source IPv6 address, the flow label forms a globally unique
   identifier for that particular Track that is validated at egress
   before restoring the dmac and punting to the upper layer.

6.1.2.  Tunnel Mode






Thubert, Assimiti & WattExpires January 14, 2014                [Page 8]

Internet-Draft             6tsch-architecture                  July 2013


   In tunnel mode, the frames originate from an arbitrary protocol over
   a compatible MAC that may or may not be perfectly synchronized with
   the 6TSCH network.  An example of this would be a router with a dual
   radio that is capable to receive and send WirelessHART or ISA100.11a
   frames with the second radio, by presenting itself as an Access Point
   or a Backbone Router, respectively.

   In that mode, the PCE may coordinate with a WirelessHART Network
   Manager or an ISA100.11a System Manager in order to specify the flows
   that are to be transported transparently over the Track.

   
           +--------------+
           |     IPv6     |
           +--------------+
           |  6LoWPAN HC  |
           +--------------+             set            restore
           |     6top     |            +dmac+          +dmac+
           +--------------+            |    |          |    |
           |   TSCH MAC   |            |    |          |    |
           +--------------+            |    |          |    |
           |   LLN PHY    |    +-------+    +--...-----+    +-------+
           +--------------+    |   ingress                 egress   |
                               |                                    |
           +--------------+    |                                    |
           |   LLN PHY    |    |                                    |
           +--------------+    |                                    |
           |   TSCH MAC   |    |                                    |
           +--------------+    |                                    |
           |ISA100/WiHART |    |                                    v
           +--------------+

   In that case, the flow information that identifies the Track is
   uniquely derived from the information at the receiving end, for
   instance the incoming Timeslots, or an ISA100.11a ContractId.  At the
   ingress 6TSCH router, the packet destination is recognized as self
   but the flow information indicates that the frame must be tunneled
   over a particular 6top Track so the packet is not punted to upper
   layer.  Instead, it is passed to the 6top sublayer for switching.
   The 6top sublayer in the ingress router overrides the destination MAC
   to broadcast and forwards.

   At the egress 6top router, the reverse operation occurs.  Based on
   metadata associated to the Track, the frame is passed to the
   appropriate link layer with the destination MAC restored.

6.1.3.  Tunnel Metadata

   Metadata coming with the Track configuration is expected to provide
   the destination MAC address of the egress endpoint as well as the
   tunnel mode and specific data depending on the mode, for instance a
   service acces point for frame delivery at egress.


Thubert, Assimiti & WattExpires January 14, 2014                [Page 9]

Internet-Draft             6tsch-architecture                  July 2013


   If the tunnel egress point does not have a MAC address that matches
   the configuration, the Track installation fails.

   In transport mode, if the final layer 3 destination is the tunnel
   termination, then it is possible that the IPv6 address of the
   destination is compressed at the 6LoWPAN sublayer based on the MAC
   address.  It is thus mandatory at the ingress point to validate that
   the MAC address that was used at the 6LoWPAN sublayer for compression
   matches that of the tunnel egress point.  For that reason, the node
   that injects a packet on a Track checks that the destination is
   effectively that of the tunnel egress point before it overwrites it
   to broadcast.  The 6top sublayer at the tunnel egress point reverts
   that operation to the MAC address obtained from the tunnel metadata.

6.2.  Fragment Forwarding

   Considering that 6LoWPAN packets can be as large as 1280 bytes, which
   is the IPv6 MTU, and that the non-storing mode of RPL implies Source
   Routing that requires space for routing headers, and that a 802.15.4
   frame with security may carry in the order of 80 bytes of effective
   payload, an IPv6 packet might be fragmented into more than 16
   fragments at the 6LoWPAN sublayer.

   This level of fragmentation is much higher than that traditionally
   experienced over the Internet with IPv4 fragments, where
   fragmentation is already known as harmful.

   In the case to a multihop route within a 6TSCH network, Hop-by-Hop
   recomposition would occur at each hop in order to reform the packet
   and route it.  This creates additional latency and forces
   intermediate nodes to store a portion of a packet for an indetermined
   time, thus impacting critical resources such as memory and battery.

   [I-D.thubert-roll-forwarding-frags] describes a mechanism whereby the
   datagram tag in the 6LoWPAN Fragment is used as a label for switching
   at the 6LoWPAN sublayer.  The draft allows for a degree of flow
   control base on an Explicit Congestion Notification, as well as end-
   to-end individual fragment recovery.  In that model, the first
   fragment is routed based on the IPv6 header that is present in that
   fragment.














Thubert, Assimiti & WattExpires January 14, 2014               [Page 10]

Internet-Draft             6tsch-architecture                  July 2013


                               |                                    ^
           +--------------+    |                                    |
           |     IPv6     |    |       +----+          +----+       |
           +--------------+    |       |    |          |    |       |
           |  6LoWPAN HC  |    |       learn           learn        |
           +--------------+    |       |    |          |    |       |
           |     6top     |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   TSCH MAC   |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   LLN PHY    |    +-------+    +--...-----+    +-------+
           +--------------+
   
   
   

   The 6LoWPAN sublayer learns the next hop selection, generates a new
   datagram tag for transmission to the next hop, and stores that
   information indexed by the incoming MAC address and datagram tag.
   The next fragments are then switched based on that stored state.

                               |                                    ^
           +--------------+    |                                    |
           |     IPv6     |    |                                    |
           +--------------+    |                                    |
           |  6LoWPAN HC  |    |       replay          replay       |
           +--------------+    |       |    |          |    |       |
           |     6top     |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   TSCH MAC   |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   LLN PHY    |    +-------+    +--...-----+    +-------+
           +--------------+
   
   
   

   A bitmap and an ECN echo in the end-to-end acknowledgement enable the
   source to resend the missing fragments selectively.  The first
   fragment may be resent to carve a new path in case of a path failure.
   The ECN echo set indicates that the number of outstanding fragments
   should be reduced.

6.3.  IPv6 Forwarding

   As the packets are routed at layer 3, traditional QoS and RED
   operations are expected to prioritize flows with differentiated
   services.  A new class of service for Deterministic Forwarding is
   being defined to that effect in [I-D.svshah-tsvwg-lln-diffserv-
   recommendations].




Thubert, Assimiti & WattExpires January 14, 2014               [Page 11]

Internet-Draft             6tsch-architecture                  July 2013


                               |                                    ^
           +--------------+    |                                    |
           |     IPv6     |    |       +-QoS+          +-QoS+       |
           +--------------+    |       |    |          |    |       |
           |  6LoWPAN HC  |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |     6top     |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   TSCH MAC   |    |       |    |          |    |       |
           +--------------+    |       |    |          |    |       |
           |   LLN PHY    |    +-------+    +--...-----+    +-------+
           +--------------+
   
   
   

7.  Functional Flows

8.  Network Synchronization

   Nodes in a TSCH are time synchronized.  A node keeps synchronized to
   its time source neighbor(s) through a combination of frame-based and
   acknowledgment-based synchronization.  In order to maximize battery
   life and network throughput, it is advisable that RPL ICMP discovery
   and maintenance traffic (governed by the trickle timer) be somehow
   coordinated with the transmission of time synch packets (especially
   with enhanced beacons).  This could be achieved through an
   interaction of the 6top sublayer and the RPL objective Function, or
   could be controlled by the Device Management Entity.

9.  TSCH and 6top

9.1.  6top

   6top is a sublayer which is the next higher layer to TSCH and which
   offers a set of commands defining data and management interfaces.
   6top is defined in [I-D.draft-wang-6tsch-6top]

   The management interface of 6top enables an upper layer to schedule
   cells and Slotframes in the TSCH schedule.

   If the scheduling entity explicitly specifies the slotOffset/
   channelOffset of the cells to be added/deleted, those cells are
   marked as "hard".  6top cannot move hard cells in the TSCH schedule.
   Hard cells are typically used by an central PCE.









Thubert, Assimiti & WattExpires January 14, 2014               [Page 12]

Internet-Draft             6tsch-architecture                  July 2013


   6top contains a monitoring process which monitors the performance of
   cells, and can move a cell in the TSCH schedule when it performs bad.
   This is only applicable to cells which are marked as "soft".  To
   reserve a soft cell, the higher layer does not indicate the
   slotOffset/channelOffset of the cell to add, but rather the resulting
   bandwidth and QoS requirements.  When the monitoring process triggers
   a cell reallocation, the two neighbor motes communicating over this
   cell negociate its new position in the TSCH schedule.

9.2.  Slotframes and Priorities

   6top uses priority queues to manage concurrent data flows of
   different priorities.  When a packet is received from an higher layer
   for transmission, the I-MUX module of 6top inserts that packet in the
   outgoing queue which matches the packet best (DSCP can therefore be
   used). At each scheduled transmit slot, the MUX module looks for the
   frame in all the outgoing queues that best matches the cells.  If a
   frame is found, it is given to TSCH for transmission.

9.3.  Centralized Flow Reservation

   In a centralized setting, a PCE computes the TSCH schedule, and
   communicates with the different nodes in the network to configure
   their TSCH schedule.  Since it has full knowledge of the network's
   topology, the PCE can compute a collision-free schedule, which
   results in a high degree of communication determinism.

   The protocol for the PCE to communicate with the motes is not yet
   defined.  This protocol typically reserves hard cells on the
   transmitter side of a dedicated cell, and the negociation protocol of
   6top takes care of reserving the same cell on the receiver node.

9.4.  Distributed Flow Reservation

   In a distributed setting, no central PCE in present in the network.
   Nodes use 6top to reserve soft cells with their neighbors.  Since no
   node has full knowledge of the network's topology and the traffic
   requirements, scheduling collisions are possible, for example because
   of a hidden terminal problem.

   A schedule collision can be detected if two motes have multiple
   dedicated cells schedule to one another.  The monitoring process of
   6top can be configured to continuously compute the packet delivery
   ratio of those cells, and it can declare a soft cell to perform bad
   when the statistics for that cell are significantly worse than for
   the other cells to the same neighbor.

   When this happens, the monitoring process of 6top moves the cell to
   another location in the 6TSCH schedule, through a re-negociation
   procedure with the neighbor.

   The entity that builds and maintains the schedule in a distributed
   fashion is not yet defined.

Thubert, Assimiti & WattExpires January 14, 2014               [Page 13]

Internet-Draft             6tsch-architecture                  July 2013


9.5.  Packet Marking and Handling

                  ---+----------------
          Sender                                              Receiver
      +-----------+     +----+     +----+      +----+      +-----------+
      |Application|---->| R1 |---->| R2 |----->|BBR |----->|Application|
      |   +--+    |     |+--+|     |+--+|      |+--+|      |   +--+    |
      |   |NE|====|=====||NE||=====||NE||======||NE||======|===|NE|    |
      |   +--+    |     |+--+|     |+--+|      |+--+|      |   +--+    |
      |    |^     |     | |^ |     | |^ |      | |^ |      |    |^     |
      |    v|     |     | v| |     | v| |      | v| |      |    v|     |
      |   +--+    |     |+--+|     |+--+|      |+--+|      |   +--+    |
      |   |6T|    |     ||6T||     ||6T||      ||6T||      |   |6T|    |
      |   |us|    |     ||us||     ||us||      ||us||      |   |us|    |
      |   +--+    |     |+--+|     |+--+|      |+--+|      |   +--+    |
      +-----------+     +----+     +----+      +----+      +-----------+
   
         +--+
         |NE| = NSIS      ==== = Signaling    ---> = Data flow messages
         +--+   Entity           Messages            (unidirectional)
   
         +--+
         |6T|   6top layer
         |us| (and IEEE802.15.4e TSCH MAC below)
         +--+
   

   reservation Deterministic flow allocation (hard reservation of
   Timeslots) eg centralized RSVP? metrics?  Hop-by-hop interaction with
   6top.  Lazy reservation (use shared slots to transport extra burst
   and then dynamically (de)allocate) Classical QoS (dynamic based on
   observation)

10.  Management

11.  IANA Considerations

   This specification does not require IANA action.

12.  Security Considerations

   This specification is not found to introduce new security threat.

13.  Acknowledgements

14.  References

14.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.



Thubert, Assimiti & WattExpires January 14, 2014               [Page 14]

Internet-Draft             6tsch-architecture                  July 2013


   [RFC2460]  Deering, S.E. and R.M. Hinden, "Internet Protocol, Version
              6 (IPv6) Specification", RFC 2460, December 1998.

   [RFC4080]  Hancock, R., Karagiannis, G., Loughney, J. and S. Van den
              Bosch, "Next Steps in Signaling (NSIS): Framework", RFC
              4080, June 2005.

   [RFC4291]  Hinden, R. and S. Deering, "IP Version 6 Addressing
              Architecture", RFC 4291, February 2006.

   [RFC4861]  Narten, T., Nordmark, E., Simpson, W. and H. Soliman,
              "Neighbor Discovery for IP version 6 (IPv6)", RFC 4861,
              September 2007.

   [RFC4862]  Thomson, S., Narten, T. and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", RFC 4862, September 2007.

   [RFC5191]  Forsberg, D., Ohba, Y., Patil, B., Tschofenig, H. and A.
              Yegin, "Protocol for Carrying Authentication for Network
              Access (PANA)", RFC 5191, May 2008.

   [RFC5889]  Baccelli, E. and M. Townsley, "IP Addressing Model in Ad
              Hoc Networks", RFC 5889, September 2010.

   [RFC5974]  Manner, J., Karagiannis, G. and A. McDonald, "NSIS
              Signaling Layer Protocol (NSLP) for Quality-of-Service
              Signaling", RFC 5974, October 2010.

   [RFC6282]  Hui, J. and P. Thubert, "Compression Format for IPv6
              Datagrams over IEEE 802.15.4-Based Networks", RFC 6282,
              September 2011.

   [RFC6550]  Winter, T., Thubert, P., Brandt, A., Hui, J., Kelsey, R.,
              Levis, P., Pister, K., Struik, R., Vasseur, JP. and R.
              Alexander, "RPL: IPv6 Routing Protocol for Low-Power and
              Lossy Networks", RFC 6550, March 2012.

   [RFC6775]  Shelby, Z., Chakrabarti, S., Nordmark, E. and C. Bormann,
              "Neighbor Discovery Optimization for IPv6 over Low-Power
              Wireless Personal Area Networks (6LoWPANs)", RFC 6775,
              November 2012.

14.2.  Informative References

   [I-D.chakrabarti-nordmark-6man-efficient-nd]
              Chakrabarti, S., Nordmark, E. and M. Wasserman,
              "Efficiency aware IPv6 Neighbor Discovery Optimizations",
              Internet-Draft draft-chakrabarti-nordmark-6man-efficient-
              nd-01, November 2012.

   [I-D.draft-wang-6tsch-6top]



Thubert, Assimiti & WattExpires January 14, 2014               [Page 15]

Internet-Draft             6tsch-architecture                  July 2013

              Wang, Q., Ed., Vilajosana, X. and T. Watteyne, "6TSCH
              Operation Sublayer (6top). draft-wang-6tsch-6top-00 (work
              in progress) ", July 2013.

   [I-D.ohba-6tsch-security]
              Chasko, S., Das, S., Lopez, R., Ohba, Y., Thubert, P. and
              A. Yegin, "Security Framework and Key Management Protocol
              Requirements for 6TSCH", Internet-Draft draft-ohba-6tsch-
              security-01, July 2013.

   [I-D.palattella-6tsch-terminology]
              Palattella, M., Thubert, P., Watteyne, T. and Q. Wang,
              "Terminology in IPv6 over Time Slotted Channel Hopping",
              Internet-Draft draft-palattella-6tsch-terminology-00,
              March 2013.

   [I-D.svshah-tsvwg-lln-diffserv-recommendations]
              Shah, S. and P. Thubert, "Differentiated Service Class
              Recommendations for LLN Traffic", Internet-Draft draft-
              svshah-tsvwg-lln-diffserv-recommendations-00, February
              2013.

   [I-D.svshah-tsvwg-lln-diffserv-recommendations]
              Shah, S. and P. Thubert, "Differentiated Service Class
              Recommendations for LLN Traffic", Internet-Draft draft-
              svshah-tsvwg-lln-diffserv-recommendations-00, February
              2013.

   [I-D.thubert-6lowpan-backbone-router]
              Thubert, P., "6LoWPAN Backbone Router", Internet-Draft
              draft-thubert-6lowpan-backbone-router-03, February 2013.

   [I-D.thubert-roll-flow-label]
              Thubert, P., "Use of the IPv6 Flow Label within an LLN",
              Internet-Draft draft-thubert-roll-flow-label-02, November
              2012.

   [I-D.thubert-roll-forwarding-frags]
              Thubert, P. and J. Hui, "LLN Fragment Forwarding and
              Recovery", Internet-Draft draft-thubert-roll-forwarding-
              frags-01, February 2013.

   [I-D.vilajosana-6tsch-basic]
              Vilajosana, X. and K. Pister, "Minimal 6TSCH
              Configuration", Internet-Draft draft-vilajosana-6tsch-
              basic-01, July 2013.

   [I-D.watteyne-6tsch-tsch-lln-context]
              Watteyne, T., "Using IEEE802.15.4e TSCH in an LLN context:
              Overview, Problem Statement and Goals", Internet-Draft
              draft-watteyne-6tsch-tsch-lln-context-01, February 2013.

14.3.  External Informative References


Thubert, Assimiti & WattExpires January 14, 2014               [Page 16]

Internet-Draft             6tsch-architecture                  July 2013


   [HART]     www.hartcomm.org, "Highway Addressable Remote Transducer,
              a group of specifications for industrial process and
              control devices administered by the HART Foundation", .

   [IEEE802.1TSNTG]
              IEEE Standards Association, "IEEE 802.1 Time-Sensitive
              Networks Task Group", March 2013, <http://www.ieee802.org/
              1/pages/avbridges.html>.

   [ISA100.11a]
              ISA, "ISA100, Wireless Systems for Automation", May 2008,
              <http://www.isa.org/Community/
              SP100WirelessSystemsforAutomation>.

Authors' Addresses

   Pascal Thubert, editor
   Cisco Systems, Inc
   Building D
   45 Allee des Ormes - BP1200
   MOUGINS - Sophia Antipolis, 06254
   FRANCE
   
   Phone: +33 497 23 26 34
   Email: pthubert@cisco.com


   Robert Assimiti
   Nivis
   1000 Circle 75 Parkway SE, Ste 300
   Atlanta, GA 30339
   USA
   
   Phone: +1 678 202 6859
   Email: robert.assimiti@nivis.com


   Thomas Watteyne
   Linear Technology / Dust Networks
   30695 Huntwood Avenue
   Hayward, CA 94544
   USA
   
   Phone: +1 (510) 400-2978
   Email: twatteyne@linear.com








Thubert, Assimiti & WattExpires January 14, 2014               [Page 17]
