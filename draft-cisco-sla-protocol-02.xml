<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="4"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="info" docName="draft-cisco-sla-protocol-02" ipr="trust200902">
  <front>
    <title abbrev="Cisco SLA Protocol">Cisco Service Level Assurance
    Protocol</title>

    <author fullname="Murtaza S. Chiba" initials="" surname="Murtaza S. Chiba">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>mchiba@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Alexander Clemm" initials="" surname="Alexander Clemm">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>alex@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Steven Medley" initials="" surname="Steven Medley">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>stmedley@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Joseph Salowey" surname="Joseph Salowey">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>jsalowey@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Sudhir Thombare" surname="Sudhir Thombare">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>thombare@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Eshwar Yedavalli" surname="Eshwar Yedavalli">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>170 West Tasman Drive</street>

          <city>San Jose</city>

          <region></region>

          <code>95134</code>

          <country>USA</country>
        </postal>

        <phone>1-408-526-4000</phone>

        <facsimile></facsimile>

        <email>eshwar@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <date day="12" month="August" year="2012" />

    <abstract>
      <t>Cisco's Service Level Assurance Protocol is a protocol that has been
      widely deployed. The protocol is used to measure service level
      parameters such as network latency, delay variation, and packet/frame
      loss. This draft describes the protocol.</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>Network performance measurements are becoming critical data points
      for administrators monitoring the health of the network. As Service
      Providers look to differentiate their offerings, performance measurement
      is an important tool to monitor Service Level guarantees and, in
      general, is a useful tool for administrators to monitor the health of a
      network.</t>

      <t>Performance metrics can be used for pre-deployment validation as well
      as for measuring in-band live network performance characteristics.
      Cisco's Service Level Assurance Protocol measures both round trip and
      one-way metrics. It can be used to measure service levels in L2 and L3
      networks and applications running on top of L3. The performance
      measurement is achieved by actively generating synthetic test packets
      and sending them across the network, and analyzing those packets and
      packets that are returned in response. This is in contrast to passive
      measurements that analyze production traffic flowing through a
      particular network element.</t>

      <t>The Cisco Service Level Assurance Protocol has a rich set of
      measurement types that can be classified as those that test connectivity
      (ping like) by providing round trip or, one-way latency measures and
      those that provide a greater variety of statistics including network
      jitter and packet/frame loss. Each type of active measurement simulates
      an actual protocol exchange.</t>

      <t>The UDP measurement type message exchanges, as covered in this
      document, simulates an UDP application and can be used to simulate both
      Voice and Video traffic that is carried in RTP frames within UDP
      envelopes. The UDP measurement type message exchanges carry information
      that provide the ability to derive a robust set of statistics.</t>

      <t></t>
    </section>

    <section title="Protocol">
      <t>The Cisco Service Level Assurance Protocol consists of two distinct
      phases, the Control Phase and the Measurement Phase. Each phase is
      comprised of exchange of information between a network element acting as
      the Sender and another element designated as the Responder.</t>

      <t>The Control Phase is the first phase of message exchanges and forms
      the base protocol. This phase establishes the identity of the Sender and
      provides information for the Measurement Phase. A single message pair of
      Control Request and Control Response marks this phase. The Sender
      initiates a Control Request message that is acknowledged by the
      Responder with a Control Response message. The Control Request may be
      sent multiple times if a Control Response has not been received; the
      number of times the message is retried is configurable on the Sender
      element.</t>

      <t>The Measurement Phase forms the second phase and is comprised of a
      sequence of Request/Response messages. These messages may be exchanged
      as often as required. Each Measurement Request message is acknowledged
      by the Responder with a Measurement Response Message.</t>

      <t>The number and frequency with which messages are sent SHOULD be
      controlled by configuration on the Sender element, along with the
      waiting time for a Control Response.</t>

      <t>The following sequence diagram depicts the message exchanges:</t>

      <t><figure>
          <artwork><![CDATA[
    +-+-+-+-+-+-+-+      Control Request           +-+-+-+-+-+-+-+  
    |             |                                |             |
    |    Sender   |                                |  Responder  |
    |             |                                |             |
    |             |                                |             |
    +-+-+-+-+-+-+-+                                +-+-+-+-+-+-+-+
           |                                              |
           |             Control Request                  |
           | -------------------------------------------->|
           |                                              |
           |             Control Response                 |
           |<---------------------------------------------|
           |                                              |
           |                                              |
           |             Measurement Request(1)           |
           | -------------------------------------------->|
           |                                              |
           |             Measurement Response(1)          |
           |<---------------------------------------------|
           |                                              |
           .                                              .
           .                                              .
           .                                              .
           .                                              .
           .             Measurement Request(n)           .
           | -------------------------------------------->|
           |                                              |
           |             Measurement Response(n)          |
           |<---------------------------------------------|
           |                                              | ]]></artwork>
        </figure></t>

      <t></t>

      <section title="Control Phase">
        <t>The Control Phase begins with the Sender sending a Control Request
        message to the Responder. The Control Request message is sent to UDP
        port 1167 on the Responder requesting a measurement phase UDP port be
        opened and indicates the requested amount of time that the port needs
        to be opened for. The Responder replies by sending a Control Response
        with appropriate Status indicating Success when the sender identity is
        verified (if used) and that the UDP port was successfully opened. In
        all other cases a non-zero Status is returned.</t>

        <t>The sequence of exchanges is as indicated in the diagram.</t>

        <t></t>

        <t><figure>
            <artwork><![CDATA[                

    +-+-+-+-+-+-+-+      Control Request           +-+-+-+-+-+-+-+  
    |             |------------------------------->|             |
    |    Sender   |                                |  Responder  |
    |             |      Control Response          |             |
    |             |<-------------------------------|             |
    +-+-+-+-+-+-+-+                                +-+-+-+-+-+-+-+
            ]]></artwork>
          </figure></t>

        <section title="Control Request">
          <t>The Control Request message consists of a Command Header followed
          by one or more Command, Status, Length and Data sections (henceforth
          known as CSLD). At the minimum, there SHOULD be at the least two
          CSLD sections, one of which is the authentication CSLD section and
          the other carries information for the Measurement Phase simulation
          type.</t>

          <t><figure>
              <artwork><![CDATA[     0                   1                   2                   3 
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                      Command Header                           |
    +                                                               +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Command                   |           Status              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    |                          Command Length                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                          Data                                 .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Command                   |          Status               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Command Length                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                          Data                                 .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+]]></artwork>
            </figure></t>

          <t></t>

          <section title="Command Header">
            <t>The Command Header is the first section of the Control Request
            message and is depicted below:</t>

            <t><figure>
                <artwork><![CDATA[     0                   1                   2                   3 
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Version = 2   |     Reserved  |          Status               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Sequence Number                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Total Length                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Send Timestamp                         |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+]]></artwork>
              </figure></t>

            <t></t>

            <t>The Command Header fields hold the following meaning:</t>

            <texttable>
              <ttcol>Field</ttcol>

              <ttcol>Size (bits)</ttcol>

              <ttcol>Usage</ttcol>

              <c>Version</c>

              <c>8</c>

              <c>Current version supported and is to be set to 2.</c>

              <c>---------</c>

              <c>---------</c>

              <c>--------------------------</c>

              <c>Reserved</c>

              <c>8</c>

              <c>Reserved field, MUST be set to 0</c>

              <c>---------</c>

              <c>---------</c>

              <c>--------------------------</c>

              <c>Status</c>

              <c>16</c>

              <c>Indicates success or failure for the entire message; not used
              for request and MUST be set to 0</c>

              <c>---------</c>

              <c>---------</c>

              <c>--------------------------</c>

              <c>Sequence Number</c>

              <c>32</c>

              <c>Used to map requests to responses. This is a monotonically
              increasing number. Implementations MAY reset the sequence number
              to 0 after a reboot, and SHOULD wrap around after all bits have
              been exceeded.</c>

              <c>---------</c>

              <c>---------</c>

              <c>--------------------------</c>

              <c>Total Length</c>

              <c>32</c>

              <c>Carries the total length of the control message in number of
              octets</c>

              <c>---------</c>

              <c>---------</c>

              <c>--------------------------</c>

              <c>Send Timestamp</c>

              <c>64</c>

              <c>This field is set to the time the command was submitted for
              transmission and is updated for a response. This field MAY be
              used for secure environment. SHOULD be updated for a response.
              When not being used it MUST be set to all 0's. The format is as
              given in RFC5905</c>
            </texttable>

            <t>The sequence number field MUST include a new number for each
            new request and is monotonically increasing. When the Control
            Request is to be retried, the sequence number MUST remain
            unchanged.</t>

            <t></t>
          </section>

          <section title="CSLDs">
            <t>The two CSLDs to be included, in order, along with the Command
            Header are:<list style="symbols">
                <t>The Authentication CSLD</t>

                <t>A Measurement Type CSLD</t>
              </list></t>

            <t>In this revision of the protocol, only a single Measurement
            Type CSLD has been defined, the UDP Measurement Type CSLD. For
            future extensions it is possible to add additional Measurement
            Type CSLDs. For more details please see the section on
            Extensions.</t>

            <t></t>

            <section title="Authentication CSLD">
              <t>The Authentication CSLD provides the message authentication
              and verifies the requester knows the shared-secret. The
              following is the format for the Authentication CSLD</t>

              <t><figure>
                  <artwork><![CDATA[     0                   1                   2                   3 
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Command = 1         |            Status             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                      Command Length                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Mode      |   Reserved    |          Key Id               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                  Random Number                                +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                                                               |
    .                                                               .
    .                                                               .
    .                  Message Authentication Digest                .
    .                                                               .
    .                                                               .
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+]]></artwork>
                </figure></t>

              <t></t>

              <t>The fields for the Authentication CSLD have the following
              meaning</t>

              <texttable>
                <ttcol>Field</ttcol>

                <ttcol>Size (bits)</ttcol>

                <ttcol>Description</ttcol>

                <c>Command</c>

                <c>16</c>

                <c>Indicates the CSLD is of type Authentication</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Status</c>

                <c>16</c>

                <c>Not used for a request and MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Command Length</c>

                <c>16</c>

                <c>Indicates the length of the CSLD</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Mode</c>

                <c>8</c>

                <c>Indicates the type of authentication being used and is set
                as follows: 0 - No Authentication, 1 - SHA256 Authentication,
                2 - HMAC-SHA-256</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Reserved</c>

                <c>8</c>

                <c>This field is reserved for future extensions and MUST be
                set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Key ID</c>

                <c>16</c>

                <c>Indicates the index number of the shared-secret to be used
                for authenticating the Control Request Message</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Random Number</c>

                <c>128</c>

                <c>This field is to be unique over the shared secret life and
                is used to make it difficult to predict the shared secret via
                multiple packet captures. The value is reflected in a response
                message. This field MAY be used in a more secure environments.
                When not being used it should be set to all 0's</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Message Authentication Digest</c>

                <c>256</c>

                <c>Contains the message authentication digest and is computed
                over the entire control packet including this field set to all
                0s</c>
              </texttable>

              <t></t>
            </section>

            <section title="UDP Measurement CSLD">
              <t>The UDP Measurement CSLD indicates the Measurement Type to be
              used during the Measurement Phase and specifies the addresses
              and UDP port to be opened as well as the duration the port has
              to be kept open for the measurement phase. The format of the
              CSLD is as follows:</t>

              <t><figure>
                  <artwork><![CDATA[     0                   1                   2                   3      
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Command = 2         |            Status             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Command length                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Address Type  |     Role      |          Reserved             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Session Identifier                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                  Control Source Address                       |
    +                                                               +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+      
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                  Control Destination Address                  |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+      
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                  Measurement Source Address                   |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+      
    |                                                               |
    +                                                               +
    |                                                               |
    +                                                               +
    |                  Measurement Destination Address              |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Control Source Port          |          Reserved             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Measurement Source Port      | Measurement Destination Port  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Duration                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+]]></artwork>
                </figure></t>

              <t></t>

              <t>The fields in the UDP Measurement CSLD have the following
              meaning:</t>

              <texttable>
                <ttcol>Field</ttcol>

                <ttcol>Size (bits)</ttcol>

                <ttcol>Definition</ttcol>

                <c>Command</c>

                <c>16</c>

                <c>Indicates that the CSLD is to simulate UDP traffic
                measurements.</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Status</c>

                <c>16</c>

                <c>Not used for a request and MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Command Length</c>

                <c>32</c>

                <c>Indicates the length of the CSLD</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Address Type</c>

                <c>8</c>

                <c>Indicates the address type and is set to one of the values
                in the Cisco Service Level Performance Measurement Protocol -
                Address Registry. (1 - IPv4 addresses, 2 - IPv6 addresses)</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Role</c>

                <c>8</c>

                <c>Indicates the role of the endpoint receiving the control
                message and is set as follows: 1 - Responder</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Reserved</c>

                <c>16</c>

                <c>Reserved and MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Session Identifier</c>

                <c>32</c>

                <c>Carries a session identifier that is a locally significant
                unique value to the originator of the message. MUST be 0 when
                not specified.</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Control Source Address</c>

                <c>128</c>

                <c>Set to the address from which the Sender initiates control
                messages. For IPv4 addresses only the first 32 bits are filled
                and the remaining bits MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Control Destination Address</c>

                <c>128</c>

                <c>Set to the address on the Responder where the control
                message will be sent. For IPv4 addresses only the first 32
                bits are filled and the remaining bits MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Measurement Source Address</c>

                <c>128</c>

                <c>Set to the address of the Sender from where the measurement
                packets will originate. For IPv4 addresses only the first 32
                bits are filled and the remaining bits MUST be set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Measurement Destination Address</c>

                <c>128</c>

                <c>Set to the address on the Responder towards which the
                measurement packets will be sent and is a way to identify an
                ingress interface on the Responder. For IPv4 addresses only
                the first 32 bits are filled and the remaining bits MUST be
                set to 0</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Control Source Port</c>

                <c>16</c>

                <c>Indicates the port on the Sender from which Control message
                is sent. If unset the value should be derived from the
                incoming packet.</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Reserved</c>

                <c>16</c>

                <c>Reserved Field, MUST be set to 0.</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Measurement Source Port</c>

                <c>16</c>

                <c>Indicates the UDP Port on the Sender from which the
                measurement packets will be sent</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Measurement Destination Port</c>

                <c>16</c>

                <c>Indicates the UDP Port on the Responder towards which the
                measurement packets will be sent</c>

                <c>---------</c>

                <c>---------</c>

                <c>--------------------------</c>

                <c>Duration</c>

                <c>32</c>

                <c>This is the duration in seconds the port needs to be kept
                open for accepting measurement phase messages. Measurement
                messages received after the duration MUST be ignored</c>
              </texttable>

              <t>Note: The source addresses are only indicative of identity of
              the originator and cannot be used as destination for responses
              in a NAT environment.</t>
            </section>
          </section>
        </section>

        <section title="Control Response Message">
          <t>In response to the Control Request Message the network element
          designated the Responder sends back a Control Response Message that
          reflects the Command Header with an updated Status field and
          includes the two CSLD sections that also carry updated Status
          fields. Hence, the format is identical to the Control Request
          message as described above.</t>

          <t>Following table shows the supported values of the Status
          fields:</t>

          <texttable>
            <ttcol>Status Value</ttcol>

            <ttcol>Description</ttcol>

            <c>0</c>

            <c>Success</c>

            <c>---------</c>

            <c>--------------------------</c>

            <c>1</c>

            <c>Fail - catch all</c>

            <c>---------</c>

            <c>--------------------------</c>

            <c>2</c>

            <c>Authentication Failure</c>

            <c>---------</c>

            <c>--------------------------</c>

            <c>3</c>

            <c>Format error - sent when any CSLD type is not recognized or any
            part of a CSLD has a value that is not recognized</c>

            <c>---------</c>

            <c>--------------------------</c>

            <c>4</c>

            <c>Port in use - the UDP/TCP port is already being used by some
            other application and cannot be reserved</c>

            <c>---------</c>

            <c>--------------------------</c>

            <c>5+</c>

            <c>Future extension and experimental values, please refer to
            Status Types Registry in the IANA Considerations section</c>
          </texttable>

          <t>The Command Header Status indicates Success only if all the CSLD
          sections have Status as Success. It is non-zero otherwise. Future
          extensions MAY extend these values as appropriate.</t>

          <t>The Control Response message, besides the update of the Status
          fields, SHOULD also update the Sent Timestamp (if used) in the
          Command Header and the Message Authentication Digest in the
          Authentication CSLD. The Message Authentication Digest is computed
          in the same way as the Control Request message. The Random Number
          field can be reflected without modification. The Session Identifier
          MAY be updated to reflect a locally significant unique value, MUST
          be 0 if not specified.</t>

          <t></t>
        </section>
      </section>

      <section title="Measurement Phase">
        <t>Upon receiving the Control Response message with the Status set to
        Success, the second phase of the protocol, the Measurement Phase, is
        initiated. In all other cases when the Status is not success no
        measurement traffic is initiated. In the Measurement Phase the Sender
        sends a stream of measurement messages. The measurement message stream
        consists of packets/frames that are spaced a configured number of
        milliseconds apart.</t>

        <t></t>

        <t><figure>
            <artwork><![CDATA[                

    +-+-+-+-+-+-+-+      Measurement Request(n)    +-+-+-+-+-+-+-+  
    |             |------------------------------->|             |
    |    Sender   |                                |  Responder  |
    |             |      Measurement Response(n)   |             |
    |             |<-------------------------------|             |
    +-+-+-+-+-+-+-+                                +-+-+-+-+-+-+-+
            ]]></artwork>
          </figure></t>

        <t></t>

        <t>The format of the Measurement messages as defined by this document
        for UDP Measurements is as shown below and is the same for the
        exchange in both directions, that is the format is the same when sent
        from the Sender to the Responder and when sent back from the Responder
        to the Sender with the only difference being the update of those
        fields that are designated with the Responder prefix, all other fields
        MUST remain unchanged.</t>

        <t></t>

        <t><figure>
            <artwork><![CDATA[     0                   1                   2                   3 
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Measurement Type = 3        |         Reserved              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Sender Send Time                           |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Responder Receive Time                     |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Responder Send Time                        |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Sender Receive Time                        |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Sender Clock Offset                        |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Responder Clock Offset                     |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Sender Sequence No.                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Responder Sequence No.                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    
    |                                                               | 
    .                                                               .
    .                          Data                                 .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+]]></artwork>
          </figure></t>

        <t></t>

        <t>The fields for the UDP Measurement Request have the following
        meaning:</t>

        <texttable>
          <ttcol>Field</ttcol>

          <ttcol>Size (bits)</ttcol>

          <ttcol>Description</ttcol>

          <c>Measurement Type</c>

          <c>16</c>

          <c>Carries the type of measurement being performed; 1 - Reserved, 2
          - Reserved, 3 - UDP</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Reserved</c>

          <c>16</c>

          <c>Reserved field and MUST be set to 0</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Sender Send Time</c>

          <c>64</c>

          <c>Carries the timestamp when the measurement message was submitted
          for transmission by Sender</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Responder Receive Time</c>

          <c>64</c>

          <c>Carries the timestamp when the measurement message was received
          by Responder</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Responder Send Time</c>

          <c>64</c>

          <c>Carries the timestamp when the measurement message was submitted
          for transmission by the Responder. It MUST be 0 in the Sender to
          Responder direction</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Sender Receive Time</c>

          <c>64</c>

          <c>Carries the timestamp when the Sender received the measurement
          message. It MUST be 0 in both directions on the wire and is filled
          on the Sender side as soon as the measurement message is
          received</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Sender Clock Offset</c>

          <c>64</c>

          <c>Gives an estimate of the Sender clock skew measured in second and
          fractional seconds</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Responder Clock Offset</c>

          <c>64</c>

          <c>Gives an estimate of the Responder clock skew measured in seconds
          and fractional seconds</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Sender Sequence Number</c>

          <c>32</c>

          <c>The sequence number of the measurement message on the Sender
          side. This field is monotonically increasing and MAY wraparound</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Responder Sequence Number</c>

          <c>32</c>

          <c>The sequence number of the measurement message on the Responder
          side. This field is monotonically increasing and MAY wraparound</c>

          <c>---------</c>

          <c>---------</c>

          <c>--------------------------</c>

          <c>Data</c>

          <c>32 bit aligned</c>

          <c>This field is used to pad up to the configured request data size.
          The minimum requested data size SHOULD be 512 bytes and this field
          will be of length 512 minus the length of the previous fields</c>
        </texttable>

        <t></t>

        <t>Note: All timestamps have the format as described in <xref
        target="RFC5905">RFC 5905</xref> and is as follows: the first 32 bits
        represent the unsigned integer number of seconds elapsed since 0h on 1
        January 1900; the next 32 bits represent the fractional part of a
        second thereof. The timestamp definition is also similar to <xref
        target="RFC4656">RFC 4656</xref></t>

        <t>In addition, the timestamp format used can be as described for the
        low-order 64 bits of the IEEE 1588-2008 (1588v2) Precision Time
        Protocol timestamp format [IEEE1588]. This truncated format consists
        of a 32-bit seconds field followed by a 32-bit nanoseconds field, and
        is the same as the IEEE 1588v1 timestamp format. This timestamp
        definition is similar to the default timestamp as specified in <xref
        target="RFC6374">RFC 6374</xref></t>

        <t>Implementations MUST use only one of the two formats. The chosen
        format is negotiated out-of-band between the endpoints.</t>
      </section>
    </section>

    <section title="Implementation notes">
      <t>Responder implementations SHOULD support simultaneous measurements
      destined to a single port either from the same or a different Sender.
      For different measurements that originate from the same sender, there
      MUST be a clear method for the Responder to distinguish the traffic, for
      example per a unique 5-tuple of protocol, source address, source port,
      destination address and destination port.</t>

      <t>A Control Request that is received for the same measurement request
      as identified by the 5-tuples, for instance, SHOULD result in the
      resetting of the duration timer as well as the Responder Sequence
      Number.</t>

      <t>A Control Phase followed by the Measurement Phase can be repeated to
      have continuous measurement over the entire time a device is alive.</t>

      <t>The Random Number field in the Measurement packets is to be set to a
      random value in environments where security is a concern. It MUST always
      be included, when not used it MUST be set to all 0s.</t>

      <t>The Authentication CSLD MUST always be included. When the mode field
      is set to 0, the Random Number field and the Message Authentication
      Digest MUST both be set to all 0s. For the SHA256 authenticator mode the
      shared secret is prepended to the Control Message and the authentication
      algorithm is then run over the complete data including the shared
      secret.</t>

      <t>If the UDP port indicated in the UDP Measurement CSLD is busy, the
      Responder MAY suggest an alternative port, the Status of the UDP
      Measurement CSLD MUST be set to Success in that case. The Sender MAY set
      a value of 0 in the field, in which case the Responder MAY choose to
      open a port and send that back along with the Status of Success. It
      should be noted that this behavior has security ramifications and the
      port needs to be chosen very carefully by the Responder.</t>

      <t>The measurement stream typically consists of packets/frames with a
      periodic inter-packet distribution. The Sender need not wait for a
      Measurement Response packet to arrive before sending another Measurement
      Request packet, and in many cases it will not be possible in order to
      maintain the desired inter-packet distribution.</t>

      <t>All messages and all fields within a message are assumed to be in
      network order. In addition, all data fields are unsigned unless
      mentioned otherwise.</t>
    </section>

    <section title="Extensions">
      <t>This section describes how the protocol can be extended to allow for
      additional functionality, such as new types of measurements.</t>

      <t>In order to allow for new types of measurements, additional
      Measurement Type CSLDs can be defined, to be carried in place of the UDP
      Measurement CSLD defined in this document within the Control Request and
      Control Response messages. The meaning and precise format of such CSLD
      needs to be defined in a separate specification. Such a specification
      will also need to describe the appropriate formats for the messages in
      the Measurement Phase.</t>

      <t>In addition, the protocol can be extended by adding support for new
      registry values for registries defined in this document.</t>

      <t></t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>The following registries are needed to maintain the extensibility of
      the protocol.</t>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Version Number Registry</t>

      <texttable>
        <ttcol>Version</ttcol>

        <ttcol>Description</ttcol>

        <c>1</c>

        <c>Reserved</c>

        <c>2</c>

        <c>Version for protocol in this document</c>

        <c>3 - 200</c>

        <c>Available or future extensions</c>

        <c>201 - 255</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t>The version number should only be changed when the structure of the
      Command Messages is different from the basic Command Header and CSLD
      structure described in this document.</t>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - CSLD Command Registry</t>

      <texttable>
        <ttcol>CSLD Type</ttcol>

        <ttcol>Description</ttcol>

        <c>1</c>

        <c>Authentication CSLD</c>

        <c>2</c>

        <c>UDP Measurements</c>

        <c>3 - 52</c>

        <c>Reserved</c>

        <c>53 - 2047</c>

        <c>Available for future extensions</c>

        <c>2048+</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t>It is envisioned that future documents will provide their own
      measurement type number along with the format of the Data portion.</t>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Status Types Registry</t>

      <texttable>
        <ttcol>Status</ttcol>

        <ttcol>Description</ttcol>

        <c>0</c>

        <c>Success</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>1</c>

        <c>Fail - catch all</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>2</c>

        <c>Authentication failure</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>3</c>

        <c>Format error - sent when any CSLD type is not recognized or any
        part of a CSLD has a value that is not recognized</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>4</c>

        <c>Port in use - the UDP/TCP port is already being used by some other
        application and cannot be reserved</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>5 - 4095</c>

        <c>Available for future extensions</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>4096+</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Authenticator Modes
      Registry</t>

      <texttable>
        <ttcol>Mode</ttcol>

        <ttcol>Description</ttcol>

        <c>0</c>

        <c>No Authentication</c>

        <c>1</c>

        <c>SHA256</c>

        <c>2</c>

        <c>HMAC-SHA-256</c>

        <c>3 - 200</c>

        <c>Available for future extensions</c>

        <c>201 - 255</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Address Registry</t>

      <texttable>
        <ttcol>Address Type</ttcol>

        <ttcol>Description</ttcol>

        <c>1</c>

        <c>IPv4</c>

        <c>2</c>

        <c>IPv6</c>

        <c>3 - 200</c>

        <c>Available for future extensions</c>

        <c>201 - 255</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Roles Registry</t>

      <texttable>
        <ttcol>Role</ttcol>

        <ttcol>Description</ttcol>

        <c>1</c>

        <c>Sender</c>

        <c>2</c>

        <c>Responder</c>

        <c>3 - 2047</c>

        <c>Available for future extensions</c>

        <c>2048+</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t></t>

      <t>Cisco Service Level Assurance Protocol - Measurement Type
      Registry</t>

      <texttable>
        <ttcol>Measurement Type</ttcol>

        <ttcol>Description</ttcol>

        <c>1</c>

        <c>Reserved</c>

        <c>2</c>

        <c>Reserved</c>

        <c>3</c>

        <c>UDP</c>

        <c>4 - 52</c>

        <c>Reserved</c>

        <c>53-2047</c>

        <c>Available for future extensions</c>

        <c>2048+</c>

        <c>Experimental values for private use</c>
      </texttable>

      <t></t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t></t>

      <section title="Message Authentication">
        <t>When the mode for the Authentication CSLD is set to 1, the Message
        Authentication Digest is generated using the SHA 256 algorithm and is
        to be calculated over the entire packet including the Message
        Authentication Digest field which MUST be set to all 0s.</t>

        <t>When the mode for the Authentication CSLD is set to 2, the Message
        Authentication Digest is generated using the HMAC-SHA-256 as described
        in <xref target="RFC4868">RFC 4868</xref>algorithm and is to be
        calculated over the entire packet including the Message Authentication
        Digest field which MUST be set to all 0s</t>

        <t>When the mode field is set to 0, the Random Number field and the
        Message Authentication Digest MUST both be set to all 0s.</t>
      </section>

      <section title="IPSec Considerations">
        <t>It is RECOMMENDED that IPSec be employed to afford better security.
        IPSec provides enhanced privacy as well as an automated key
        distribution mechanism. The following recommendations are similar to
        <xref target="RFC3579">RFC3579, Section 2</xref></t>

        <section title="Control Traffic">
          <t>For Senders implementing this specification, the IPSec policy
          would be "Initiate IPSec, from me to any, destination port UDP
          1167". This causes the Sender to initiate IPSec when sending Control
          traffic to any Responder. If some Responders contacted by the Sender
          do not support IPSec, then a more granular policy will be required,
          such as "Initiate IPSec, from me to IPSec-Capable-Responder,
          destination port UDP 1167".</t>

          <t>For Responders implementing this specification, the IPSec policy
          would be "Require IPSec, from any to me, destination port UDP 1167".
          This causes the Responder to require use of IPSec. If some Sender
          does not support IPSec, then a more granular policy will be
          required: "Require IPSec, from IPSec-Capable-Sender to me".</t>
        </section>

        <section title="Measurement Traffic">
          <t>As the Control Phase occurs before the Measurement Phase, it
          should be possible to build an IPSec Security Association once a
          successful Control Response is received.</t>

          <t>For Senders implementing this specification, the IPSec policy
          would be "Initiate IPSec, from me to negotiated address, destination
          is negotiated port". This causes the Sender to initiate IPSec when
          sending Measurement traffic to the Responder. If some Responders
          contacted by the Sender do not support IPSec, then a more granular
          policy will be required, such as "Initiate IPSec, from me to
          IPSec-Capable-Responder, destination is negotiated port".</t>

          <t>For Responders implementing this specification, the IPSec policy
          would be "Require IPSec, from negotiated address to me, destination
          is negotiated port". This causes the Responder to require use of
          IPSec. If some Sender does not support IPSec, then a more granular
          policy will be required: "Require IPSec, from IPSec-Capable-Sender
          to me, destination is negotiated port".</t>
        </section>
      </section>

      <section title="Replay Protection">
        <t>For the Control Messages the originator of the message MAY choose
        to include a current value in the Sent Timestamp field indicating the
        time the message was submitted for transmission, it MUST be set to 0
        otherwise. The receiver of the message MAY choose to validate if the
        timestamp is within an acceptable range. The Measurement Traffic
        described in this document contains a timestamp to indicate the sent
        time and hence no new field is required.</t>

        <t></t>
      </section>
    </section>

    <section title="Terminology">
      <t></t>

      <texttable>
        <ttcol>Term</ttcol>

        <ttcol>Description</ttcol>

        <c>Control Phase</c>

        <c>A phase during which Control Request and Control Response is
        exchanged.</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>L2</c>

        <c>OSI Data Link Layer</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>L3</c>

        <c>OSI Network Layer</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>Measurement Phase</c>

        <c>Active measurement phase that is marked by a sequence of
        Measurement Request and Measurement Response exchanges.</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>Metric</c>

        <c>A particular characteristic of the network data traffic, for
        example latency, jitter, packet/frame loss</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>Responder</c>

        <c>A network element that responds to a message</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>RTP</c>

        <c>Real-time Transport Protocol</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>Sender</c>

        <c>A network element that is the initiator of a message exchange</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>Service Level</c>

        <c>This is the level of service that is agreed upon between the
        Provider and the Customer</c>

        <c>---------</c>

        <c>--------------------------</c>

        <c>UDP</c>

        <c>User Datagram Protocol</c>
      </texttable>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>The authors wish to acknowledge the contributions of several key
      people who contributed to the current form of the document. Hanlin Fang,
      David Wang, Anantha Ramaiah, Max Pritikin, and Malini Vijayamohan.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119.xml"
include="reference.RFC.5905.xml"
include="reference.RFC.4868.xml"
       ?>

      <reference anchor="IEEE1588">
        <front>
          <title>1588-2008 Standard for a Precision Clock Synchronization
          Protocol for Networked Measurement and Control Systems</title>

          <author>
            <organization>IEEE</organization>
          </author>

          <date month="March" year="2008" />
        </front>
      </reference>
    </references>

    <references title="Informative References">
      <?rfc include="reference.RFC.3579.xml"?>

      <?rfc include="reference.RFC.4656.xml"?>

      <?rfc include="reference.RFC.6374.xml"?>
    </references>
  </back>
</rfc>
