


Softwire WG                                                 T. Mrugalski
Internet-Draft                                                       ISC
Intended status: Standards Track                           O. Troan, Ed.
Expires: April 18, 2014                                    Cisco Systems
                                                                  W. Dec
                                                                   Cisco
                                                                C.X. Bao
                                                     Tsinghua University
                                                                  L. Yeh
                                                 Freelancer Technologies
                                                                 X. Deng
                                                        October 15, 2013


  DHCPv6 Options for configuration of Softwire Address and Port Mapped
                                Clients
                    draft-ietf-softwire-map-dhcp-05

Abstract

   This document specifies DHCPv6 options, termed Softwire46 options,
   for the provisioning of Softwire46 Customer Edge (CE) devices.
   Softwire46 is a collective term used to refer to architectures based
   on the notion of IPv4 Address+Port (A+P) for providing IPv4
   connectivity across an IPv6 network.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on April 18, 2014.

Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.






Mrugalski, et al.        Expires April 18, 2014                 [Page 1]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  2
   2.  Softwire 46 approaches discussed . . . . . . . . . . . . . . .  3
   3.  Conventions  . . . . . . . . . . . . . . . . . . . . . . . . .  3
   4.  Softwire 46 Overview . . . . . . . . . . . . . . . . . . . . .  3
   5.  Common Softwire 46 DHCPv6 Options  . . . . . . . . . . . . . .  4
     5.1.  S46 Rule Option  . . . . . . . . . . . . . . . . . . . . .  5
     5.2.  S46 BR Option  . . . . . . . . . . . . . . . . . . . . . .  6
     5.3.  S46 DMR Option . . . . . . . . . . . . . . . . . . . . . .  7
     5.4.  S46 IPv4 Address Option  . . . . . . . . . . . . . . . . .  7
     5.5.  S46 Port Parameters Option . . . . . . . . . . . . . . . .  8
   6.  Softwire 46 Container DHCPv6 Options . . . . . . . . . . . . .  9
     6.1.  Softwire46 MAP-E Container Option  . . . . . . . . . . . .  9
     6.2.  Softwire46 MAP-T Container Option  . . . . . . . . . . . . 10
     6.3.  Softwire46 LightWeight 46 Container Option . . . . . . . . 10
   7.  DHCPv6 Server Behavior . . . . . . . . . . . . . . . . . . . . 11
   8.  DHCPv6 Client Behavior . . . . . . . . . . . . . . . . . . . . 11
   9.  Security Considerations  . . . . . . . . . . . . . . . . . . . 12
   10. IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 12
   11. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 12
   12. References . . . . . . . . . . . . . . . . . . . . . . . . . . 13
     12.1.  Normative References  . . . . . . . . . . . . . . . . . . 13
     12.2.  Informative References  . . . . . . . . . . . . . . . . . 13
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 14

1.  Introduction

   A number of architectural solution proposals discussed in the IETF
   Softwires Working Group use Address and Port (A+P) as their
   technology base in providing IPv4 connectivity service to end users
   using CE devices across a service provider's IPv6 network, while
   allowing for shared or dedicated IPv4 addressing of the CEs.

   An example is Mapping of Address and Port (MAP) defined in [I-D.ietf-
   softwire-map].  The MAP solution consists of one or more MAP Border
   Relay (BR) routers, responsible for stateless forwarding between a
   MAP IPv6 domain and an IPv4 network, and one or more MAP Customer
   Edge (CE) routers, responsible for forwarding between a user's
   private IPv4 network and the MAP IPv6 network domain.  Collectively




Mrugalski, et al.        Expires April 18, 2014                 [Page 2]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013

   the MAP CE and BR form a domain when configured with common service
   parameters.  This characteristic is common to all of the Softwire46
   proposals.

   To function in such a domain, a CE requires to be provisioned with
   the appropriate A+P service parameters for that domain.  This
   consists primarily of the IPv4 address the CE should use and the
   transport layer port-range(s).  Furthermore the IPv6 transport mode
   (e.g.  encapsulation or translation) needs to be specified.

   This memo specifies a set of DHCPv6 [RFC3315] options to provision
   Softwire46 information to CE routers.  Configuration of the BR is out
   of scope of this document.

2.  Softwire 46 approaches discussed

   ***To be removed***

   The approach laid out in this document was taken after consideration
   of a couple of alternatives.  The first alternative was to have
   everything in the single option.  However, given that in practice
   some CPEs might not implement all of the mechanism, this means the
   single option would not work.  The CPE would have to come up with the
   mechanism to signal its capabilities to DHCPv6 server.  Thus, the
   conclusion was made that each mechanism requires its own option,
   containing the per-mechanism configuration.  The container design was
   selected because the configuration elements are similar between the
   mechanisms and having the smaller building blocks within them should
   help to reuse the code, for the CPEs that implement multiple
   mechanisms.  After the multi-container approach was taken, the choice
   was to keep everything in the single document or split into several
   documents - one per mechanism.

3.  Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

4.  Softwire 46 Overview

   This document describes a set of common DHCPv6 options for MAP-E [I-D
   .ietf-softwire-map], MAP-T [I-D.ietf-softwire-map-t] and Lightweight
   4over6 [I-D.ietf-softwire-lw4over6] mechanisms.











Mrugalski, et al.        Expires April 18, 2014                 [Page 3]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   MAP-E, MAP-T and Lightweight 4over6 are essentially providing the
   same functionality: IPv4 service to a CE router over an IPv6 only
   access network.  MAP-E and MAP-T may embed parts of the IPv4 address
   in IPv6 prefixes, thereby supporting many clients with a fixed set of
   mapping rules and mesh mode (direct CE to CE communication).  MAP-E
   and MAP-T CEs may also be provisioned in hub and spoke mode, and in
   1:1 mode (no embedded address bits).  The difference between MAP-E
   and MAP-T is that they use different means to connect to the IPv6
   domain.  MAP-E uses RFC2473 [RFC2473] IPv4 over IPv6 tunnelling,
   while MAP-T uses NAT64 [RFC6145] based translation.  Lightweight
   4over6 is a strict subset of MAP-E in hub and spoke mode with zero
   embedded address bits.  Lightweight 4over6 is restricted to
   supporting only a full IPv4 address or shared IPv4 address,
   provisioning an IPv4 prefix is not supported.

   To support more than one mechanism at a time and to allow for a
   possibility of transition between them, the Option Request Option
   DHCPv6 [RFC3315] function is used.  Each mechanism has a
   corresponding container option.  A DHCPv6 client can request a
   particular mechanism by including the option code for a particular
   container option in its ORO option.  The provisioning parameters for
   that mechanism are expressed by embedding the common format options
   within the respective container.

   This approach implies that the all the provisioning options MUST
   appear only within the container options.  The client MUST NOT
   request any of the provisioning options directly within an ORO.
   Likewise, the server MUST NOT send the provisioning options directly
   within DHCPv6 message, without encapsulating them in the
   corresponding container options.

   The document is organized with the common sub-options described
   first, and then the three container options.  Some of the sub-options
   are mandatory in some of the containers and some are optional, or not
   permitted at all.

5.  Common Softwire 46 DHCPv6 Options

   The DHCPv6 protocol is used for Softwire46 CE provisioning following
   regular DHCPv6 notions, with the CE assuming the role of a DHCPv6
   client, and the DHCPv6 server providing options following typical
   DHCPv6 server side policies.  The format and usage of the options is
   defined in the following sub-sections.











Mrugalski, et al.        Expires April 18, 2014                 [Page 4]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   Each CE needs to be provisioned with enough information to calculate
   its IPv4 address, IPv4 prefix or shared IPv4 address.  MAP-E and
   MAP-T uses the OPTION_S46_RULE, while for Lightweight 4over6, the
   OPTION_S46_IPV4ADDRESS option is used.  A CE that needs to
   communicate outside of the A+P domain, also needs the address or
   prefix of the BR.  MAP-E and Lightweight 4over6 use the OPTION_S46_BR
   option to communicate the IPv6 address of the BR.  MAP-T forms an
   IPv6 destination address by embedding an IPv4 destination address
   into the BR's IPv6 prefix conveyed via the OPTION_S46_DMR option.
   Optionally all mechanisms can include the OPTION_S46_PORTPARAMS to
   specify parameters and port sets for the port range algorithm.

5.1.  S46 Rule Option

   Figure 1 shows the format of the S46 Rule option used for conveying
   the BMR and FMR.

   A server MAY send more than one S46 Rule Option in a container, if it
   is configured to do so.  Clients MUST NOT send a S46 Rule Option.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_S46_RULE        |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     flags     |     ea-len    |  prefix4-len  | ipv4-prefix   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  (continued)                  |  prefix6-len  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           ipv6-prefix                         |
   |                       (variable length)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                        S46_RULE-options                       .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   

                       Figure 1: S46 Rule Option

   o  option-code: OPTION_S46_RULE (TBD1)
   o  option-length: length of the option, excluding option-code and
      option-length fields, including length of all encapsulated
      options, expressed in bytes.
   o  flags: 8 bits long field carrying flags applicable to the rule.
      The meaning of specific bits is explained in Figure 2.
   o  ea-len: 8 bits long field that specifies the Embedded-Address (EA)
      bit length.  Values allowed range from 0 to 48.
   o  prefix4-len: 8 bits long field expressing the prefix length of the
      IPv4 prefix specified in the rule-ipv4-prefix field.  Valid values
      0 to 32.
   o  ipv4-prefix: a fixed length 32 bit field that specifies the IPv4
      prefix for the S46 rule.  Zero-padded.

Mrugalski, et al.        Expires April 18, 2014                 [Page 5]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013

   o  prefix6-len: 8 bits long field expressing the prefix length of the
      IPv6 prefix specified in the rule-ipv6-prefix field.
   o  ipv6-prefix: a variable length field that specifies the IPv6
      domain prefix for the S46 rule.  The field is padded with follow
      up zero bits up to the nearest octet boundary when prefix6-len is
      not divisible by 8.
   o  S46_RULE-options: a variable field that may contain zero or more
      options that specify additional parameters for this S46 rule, e.g.
      a Port Parameter Option.

   The Format of the S46 Rule Flags field is:

                            0 1 2 3 4 5 6 7
                           +-+-+-+-+-+-+-+-+
                           |Reserved     |F|
                           +-+-+-+-+-+-+-+-+

                        Figure 2: S46 Rule Flags

   o  Reserved: 7-bits reserved for future use as flags.
   o  F-Flag: 1 bit field that specifies whether the rule is to be used
      for forwarding (FMR).  If set, this rule is used as a FMR, if not
      set this rule is only a BMR.  Note: BMR rules can be also FMR
      rules by setting the F flag.  BMR rules are determined by a match
      of the Rule-IPv6-prefix against the CPE's prefix(es).

   It is expected that in a typical mesh deployment scenarios, there
   will be a single BMR, which could also be designated as an FMR using
   the F-Flag.

5.2.  S46 BR Option

   S46 BR Option is used to convey the IPv6 address of the Border Relay.
   Figure Figure 4 shows the format of the BR option.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         OPTION_S46_BR         |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      br-ipv6-address                          |
   |                                                               |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   

                        Figure 3: S46 DMR Option

   o  option-code: OPTION_S46_BR (TBD2)
   o  option-length: 16
   o  br-ipv6-address: a fixed length field of 16 octets that specifies
      the IPv6 address for the S46 BR.


Mrugalski, et al.        Expires April 18, 2014                 [Page 6]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   BR redundancy can be implemented by using an anycast address for the
   BR IPv6 address.  Multiple BR options MAY be included in the
   container; this document does not further explore the use of multiple
   BR IPv6 addresses.

5.3.  S46 DMR Option

   S46 DMR Option is used to convey values for Default Mapping Rule.
   Figure Figure 4 shows the format of the MAP Rule option used for
   conveying a DMR.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_S46_DMR         |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |dmr-prefix6-len|            dmr-ipv6-prefix                    |
   +-+-+-+-+-+-+-+-+           (variable length)                   |
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   
   

                        Figure 4: S46 DMR Option

   o  option-code: OPTION_S46_DMR (TBD3)
   o  option-length: 1 + length of dmr-ipv6-prefix specified in bytes.
   o  dmr-prefix6-len: 8 bits long field expressing the bit mask length
      of the IPv6 prefix specified in the dmr-ipv6-prefix field.
   o  dmr-ipv6-prefix: a variable length field that specifies the IPv6
      prefix or address for the S46 BR.  This field is padded with
      follow up zeros to the nearest octet boundary when dmr-prefix6-len
      is not divisible by 8.

5.4.  S46 IPv4 Address Option

   The IPv4 address Option MAY be used to specify the full or shared
   IPv4 address of the CE.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     OPTION_S46_IPV4ADDRESS    |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         ipv4-address                          |









Mrugalski, et al.        Expires April 18, 2014                 [Page 7]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                    S46_IPV4ADDRESS-options                    .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   

                   Figure 5: S46 IPv4 address Option

   o  option-code: OPTION_S46_IPV4ADDRESS (TBD4)
   o  option-length: 4
   o  ipv4-address: A fixed field of 4 octets specifying an IPv4
      address.
   o  S46_IPV4ADDRESS-options: a variable field that may contain zero or
      more options that specify additional parameters e.g.  a Port
      Parameter Option.

5.5.  S46 Port Parameters Option

   The Port Parameters Option specifies optional Rule Port Parameters
   that MAY be provided as part of the Mapping Rule for CEs using the
   MAP algorithm.

   See [I-D.ietf-softwire-map], Section 5.1 for detailed description of
   MAP algorithm that explains meaning of all parameters.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     OPTION_S46_PORTPARAMS     |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   offset      |    PSID-len   |              PSID             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 6: S46 Port Parameters Option

   o  option-code: OPTION_S46_PORTPARAMS (TBD5)
   o  option-length: 4
   o  offset: (PSID offset) 8 bits long field that specifies the numeric
      value for the S46 algorithm's excluded port range/offset bits
      (A-bits), as per section 5.1.1 in [I-D.ietf-softwire-map].
      Allowed values are between 0 and 16, with the default value being
      6.
   o  PSID-len: Bit length value of the number of significant bits in
      the PSID field.  (also known as 'k').  When set to 0, the PSID
      field is to be ignored.  After the first 'a' bits, there are k
      bits in the port number representing valid of PSID.  Subsequently,
      the address sharing ratio would be 2^k.
   o  PSID: Explicit 16-bit (unsigned word) PSID value.  The PSID value
      algorithmically identifies a set of ports assigned to a CE.  The
      first k-bits on the left of this 2-octets field is the PSID value.
      The remaining (16-k) bits on the right are padding zeros.



Mrugalski, et al.        Expires April 18, 2014                 [Page 8]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   When receiving the Port Parameters option with an explicit PSID, the
   client MUST use this explicit PSID in configuring its MAP interface.
   If the conveyed IPv4 address is not 32 bit-long.  The formula for
   this check is "prefix4-len + ea-len = 32" and serves to ensure that
   the explicit PSID is only applied to configurations with a completely
   formed IPv4 address.

   The OPTION_S46_PORTPARAMS option MUST be encapsulated in a
   OPTION_S46_RULE option or an OPTION_S46_IPV4ADDRESS option.  It MUST
   NOT appear directly within a container option.

6.  Softwire 46 Container DHCPv6 Options

    +------------------------+-------+-------+--------------------+
    | Option                 | MAP-E | MAP-T | Lightweight 4over6 |
    +------------------------+-------+-------+--------------------+
    | OPTION_S46_RULE        |   M   |   M   |         -          |
    | OPTION_S46_BR          |   M   |   -   |         M          |
    | OPTION_S46_PORTPARAMS  |   O   |   O   |         O          |
    | OPTION_S46_DMR         |   -   |   M   |         -          |
    | OPTION_S46_IPV4ADDRESS |   -   |   -   |         M          |
    +------------------------+-------+-------+--------------------+

              M - Mandatory, O - Optional, - - Not Applicable

                 Table 1: Option to Container Mappings

6.1.  Softwire46 MAP-E Container Option

   This MAP-E Container Option specifies the container used to group all
   rules and optional port parameters for a specified domain.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_S46_CONT_MAPE   |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .            encapsulated-options (variable length)             .
   .                                                               .
   +---------------------------------------------------------------+

                    Figure 7: MAP-E Container Option

   o  option-code: OPTION_S46_CONT_MAPE (TBD6)
   o  option-length: Length of encapsulated options
   o  encapsulated-options: options associated with this Softwire46
      MAP-E domain.






Mrugalski, et al.        Expires April 18, 2014                 [Page 9]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   The encapsulated options field encapsulates those options that are
   specific to this MAP Option.  Currently there are two options
   specified for the OPTION_S46_CONT_MAPE option, OPTION_S46_RULE and
   OPTION_S46_BR. There MUST be at least one OPTION_S46_RULE option and
   at least one OPTION_S46_BR.

   Other options suitable for a domain may be defined in the future.  A
   DHCP message MAY include multiple S46 MAPE Container Options
   (representing multiple domains).

6.2.  Softwire46 MAP-T Container Option

   This MAP-T Container Option specifies the container used to group all
   rules and optional port parameters for a specified domain.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_S46_CONT_MAPT   |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .            encapsulated-options (variable length)             .
   .                                                               .
   +---------------------------------------------------------------+

                    Figure 8: MAP-E Container Option

   o  option-code: OPTION_S46_CONT_MAPT (TBD7)
   o  option-length: Length of encapsulated options
   o  encapsulated-options: options associated with this Softwire46
      MAP-T domain.

   The encapsulated options field encapsulates those options that are
   specific to this MAP Option.  Currently there are two options
   specified for the OPTION_S46_CONT_MAPT option, OPTION_S46_RULE and
   OPTION_S46_DMR options.  There MUST be at least one OPTION_S46_RULE
   option and exactly one OPTION_S46_DMR.

6.3.  Softwire46 LightWeight 46 Container Option

   This LW46 Container Option specifies the container used to group all
   rules and optional port parameters for a specified domain.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_S46_CONT_LW     |         option-length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+






Mrugalski, et al.        Expires April 18, 2014                [Page 10]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013

   |                                                               |
   +            encapsulated-options (variable length)             .
   .                                                               .
   +---------------------------------------------------------------+

                    Figure 9: LW46 Container Option

   o  option-code: OPTION_S46_CONT_LW (TBD8)
   o  option-length: Length of encapsulated options
   o  encapsulated-options: options associated with this Softwire46
      domain.

   The encapsulated options field encapsulates those options that are
   specific to this Lightweight 4over6 Option.  Currently there are two
   options specified for the OPTION_S46_CONT_LW option,
   OPTION_S46_IPV4ADDRESS and OPTION_S46_BR. There MUST be exactly one
   OPTION_S46_IPV4ADDRESS option and at least one OPTION_S46_BR.

7.  DHCPv6 Server Behavior

   RFC 3315 Section 17.2.2 [RFC3315] describes how a DHCPv6 client and
   server negotiate configuration values using the ORO.  As a
   convenience to the reader, we mention here that a server will by
   default not reply with a Softwire 46 Container Option if the client
   has not explicitly enumerated it in its Option Request Option.

   A CE router may support several or all of the mechanisms mentioned
   here.  In the case where a client requests multiple mechanisms in its
   ORO option, the server SHOULD reply with all the corresponding
   Softwire 46 Container options, enumerated in the Option Request
   Option, it is configured for.

8.  DHCPv6 Client Behavior

   A S46 CE acting as DHCPv6 client will request S46 configuration to be
   assigned by the DHCPv6 server located in the IPv6 network.  Such a
   client SHOULD include the S46 Container option(s) that it is
   interested in, in its ORO in SOLICIT, REQUEST, RENEW, REBIND and
   INFORMATION-REQUEST messages.

   When processing received S46 container options the following
   behaviour is expected:

   o  A client MUST support processing multiple received OPTION_S46_RULE
      options in a container OPTION_S46_CONT_MAPE or
      OPTION_S46_CONT_MAPT option
   o  A client receiving an unsupported S46 option, or an invalid
      parameter value SHOULD discard that S46 Container option and log
      the event.

   The behavior of a client supporting multiple Softwire 46 mechanisms,
   is out of scope of this document.  See: [I-D.ietf-softwire-unified-
   cpe] for how to prioritise and handle multiple simulatanous
   mechanisms in use.

Mrugalski, et al.        Expires April 18, 2014                [Page 11]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   DISCUSS: There are many ways of delivering IPv4 to a CE router.
   Native IPv4 with global addressing, native IPv4 with private
   addressing, DS-lite, 464XLAT, 4rd, MAP-E, MAP-T, Lightweight 4over6.
   Should a CPE prefer a single option (per interface), should it
   configure multiple, and handle a smooth transition between them?
   [I-D.townsley-troan-ipv6-ce-transitioning] proposes one of the
   approaches to handle this scenario by having an implicit order.
   Other approaches are possible and should be discussed, however, this
   is out of scope for this particular document.

   Note that system implementing CE functionality may have multiple
   network interfaces, and these interfaces may be configured
   differently; some may be connected to networks that call for MAP, and
   some may be connected to networks that are using normal dual stack or
   other means.  The CE system should approach this specification on an
   interface-by-interface basis.  For example, if the CE system is MAP
   capable and is attached to multiple networks that provide the MAP
   Mapping Rule Option, then the CE system MUST configure a MAP service
   (i.e.  a translation or encapsulation) for each interface separately
   as each MAP provides IPv4 connectivity for each distinct interface.
   Means to bind a MAP configuration to a given interface in a multiple
   interfaces device are out of scope of this document.

9.  Security Considerations

   Implementation of this document does not present any new security
   issues, but as with all DHCPv6-derived configuration state, it is
   completely possible that the configuration is being delivered by a
   third party (Man In The Middle).  As such, there is no basis to trust
   that the access over the MAP can be trusted, and it should not
   therefore bypass any security mechanisms such as IP firewalls.

   Readers concerned with security of MAP provisioning over DHCPv6 are
   encouraged to read [I-D.ietf-dhc-secure-dhcpv6].

   Section XX of [I-D.ietf-softwire-map] discusses security issues of
   the MAP mechanism.

   Section 23 of [RFC3315] discusses DHCPv6-related security issues.

10.  IANA Considerations

   IANA is kindly requested to allocate the following DHCPv6 option
   codes: TBD1 for OPTION_S46_RULE, TBD2 for OPTION_S4_BR, TBD3 for
   OPTION_S46_DMR, TBD4 for OPTION_S46_IPV4ADDRESS, TBD5 for
   OPTION_S46_PORTPARAMS, and TBD6 for OPTION_S46_CONT_MAPE, TBD7 for
   OPTION_S46_CONT_MAPT and TBD8 for OPTION_S46_CONT_LW All values
   should be added to the DHCPv6 option code space defined in Section
   24.3 of [RFC3315].

11.  Acknowledgements



Mrugalski, et al.        Expires April 18, 2014                [Page 12]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   This document was created as a product of a MAP design team.
   Following people were members of that team: Congxiao Bao, Mohamed
   Boucadair, Gang Chen, Maoke Chen, Wojciech Dec, Xiaohong Deng, Jouni
   Korhonen, Xing Li, Satoru Matsushima, Tomasz Mrugalski, Tetsuya
   Murakami, Jacni Qin, Necj Scoberne, Qiong Sun, Tina Tsou, Dan Wing,
   Leaf Yeh and Jan Zorz.

   Former MAP design team members are: Remi Despres.

   Authors would like to thank Bernie Volz for his insightful comments
   and suggestions.

12.  References

12.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC3315]  Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C.,
              and M. Carney, "Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6)", RFC 3315, July 2003.

   [RFC3633]  Troan, O. and R. Droms, "IPv6 Prefix Options for Dynamic
              Host Configuration Protocol (DHCP) version 6", RFC 3633,
              December 2003.

12.2.  Informative References

   [I-D.ietf-dhc-option-guidelines]
              Hankins, D., Mrugalski, T., Siodelski, M., Jiang, S., and
              S. Krishnan, "Guidelines for Creating New DHCPv6 Options",
              draft-ietf-dhc-option-guidelines-13 (work in progress),
              July 2013.

   [I-D.ietf-dhc-secure-dhcpv6]
              Jiang, S. and S. Shen, "Secure DHCPv6 Using CGAs", draft-
              ietf-dhc-secure-dhcpv6-07 (work in progress), September
              2012.

   [I-D.ietf-homenet-arch]
              Chown, T., Arkko, J., Brandt, A., Troan, O., and J. Weil,
              "Home Networking Architecture for IPv6", draft-ietf-
              homenet-arch-06 (work in progress), October 2012.

   [I-D.ietf-softwire-lw4over6]
              Cui, Y., Sun, Q., Boucadair, M., Tsou, T., Lee, Y., and I.
              Farrer, "Lightweight 4over6: An Extension to the DS-Lite
              Architecture", draft-ietf-softwire-lw4over6-01 (work in
              progress), July 2013.

   [I-D.ietf-softwire-map-t]


Mrugalski, et al.        Expires April 18, 2014                [Page 13]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013

              Li, X., Bao, C., Dec, W., Troan, O., Matsushima, S., and
              T. Murakami, "Mapping of Address and Port using
              Translation (MAP-T)", draft-ietf-softwire-map-t-04 (work
              in progress), September 2013.

   [I-D.ietf-softwire-map]
              Troan, O., Dec, W., Li, X., Bao, C., Matsushima, S.,
              Murakami, T., and T. Taylor, "Mapping of Address and Port
              with Encapsulation (MAP)", draft-ietf-softwire-map-07
              (work in progress), May 2013.

   [I-D.ietf-softwire-unified-cpe]
              Boucadair, M., Farrer, I., Perreault, S., and S.
              Sivakumar, "Unified IPv4-in-IPv6 Softwire CPE", draft-
              ietf-softwire-unified-cpe-01 (work in progress), May 2013.

   [I-D.mdt-softwire-map-deployment]
              Sun, Q., Chen, M., Chen, G., Sun, C., Tsou, T., and S.
              Perreault, "Mapping of Address and Port (MAP) - Deployment
              Considerations", draft-mdt-softwire-map-deployment-02
              (work in progress), June 2012.

   [I-D.townsley-troan-ipv6-ce-transitioning]
              Townsley, M. and O. Troan, "Basic Requirements for
              Customer Edge Routers - multihoming and transition",
              draft-townsley-troan-ipv6-ce-transitioning-02 (work in
              progress), December 2011.

   [RFC2473]  Conta, A. and S. Deering, "Generic Packet Tunneling in
              IPv6 Specification", RFC 2473, December 1998.

   [RFC5226]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", BCP 26, RFC 5226,
              May 2008.

   [RFC6145]  Li, X., Bao, C., and F. Baker, "IP/ICMP Translation
              Algorithm", RFC 6145, April 2011.

   [RFC6335]  Cotton, M., Eggert, L., Touch, J., Westerlund, M., and S.
              Cheshire, "Internet Assigned Numbers Authority (IANA)
              Procedures for the Management of the Service Name and
              Transport Protocol Port Number Registry", BCP 165, RFC
              6335, August 2011.

Authors' Addresses










Mrugalski, et al.        Expires April 18, 2014                [Page 14]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013


   Tomasz Mrugalski
   Internet Systems Consortium, Inc.
   950 Charter Street
   Redwood City, CA  94063
   USA
   
   Phone: +1 650 423 1345
   Email: tomasz.mrugalski@gmail.com
   URI:   http://www.isc.org/


   Ole Troan (editor)
   Cisco Systems
   Philip Pedersens vei 1
   Lysaker  1366
   Norway
   
   Email: ot@cisco.com


   Wojciech Dec
   Cisco Systems, Inc.
   The Netherlands
   
   Email: wdec@cisco.com
   URI:   http://cisco.com


   Congxiao Bao
   CERNET Center/Tsinghua University
   Room 225, Main Building, Tsinghua University
   Beijing  100084
   CN
   
   Phone: +86 10-62785983
   Email: congxiao@cernet.edu.cn


   Leaf Y. Yeh
   Freelancer Technologies
   Shenzhen, Guangdong
   P. R. China
   
   Email: leaf.yeh.sdo@gmail.com


   Xiaohong Deng
   6 Cordelia St.
   South Brisbane  QLD 4101
   Australia
   
   Phone: +61 3858 3128
   Email: dxhbupt@gmail.com

Mrugalski, et al.        Expires April 18, 2014                [Page 15]

Internet-Draft         DHCPv6 for Softwire 46 CEs           October 2013























































Mrugalski, et al.        Expires April 18, 2014                [Page 16]
