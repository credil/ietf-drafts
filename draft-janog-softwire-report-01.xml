<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
    which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
    There has to be one entity for each item to be referenced. 
    An alternate method (rfc include) is described in the references. -->

<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC2629 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2629.xml">
<!ENTITY RFC3552 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3552.xml">
<!ENTITY RFC5226 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml">
<!ENTITY RFC5569 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5569.xml">
<!ENTITY RFC5969 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5969.xml">
<!ENTITY RFC5952 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5952.xml">
<!ENTITY RFC5737 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5737.xml">
<!ENTITY RFC3849 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3849.xml">
<!ENTITY RFC6104 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6104.xml">
<!ENTITY RFC4787 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4787.xml">
<!ENTITY RFC6586 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6586.xml">
<!ENTITY RFC6145 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6145.xml">
<!ENTITY RFC6052 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6052.xml">
<!ENTITY RFC6346 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6346.xml">
<!ENTITY RFC4443 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4443.xml">
<!ENTITY RFC5387 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5387.xml">
<!ENTITY RFC4347 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4347.xml">
<!ENTITY RFC2401 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2401.xml">
<!ENTITY RFC3948 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3948.xml">
<!ENTITY RFC5508 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5508.xml">
<!ENTITY RFC2428 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2428.xml">
<!ENTITY RFC6586 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6586.xml">
<!ENTITY RFC5382 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5382.xml">
<!ENTITY RFC5508 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5508.xml">
<!ENTITY RFC0959 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.0959.xml">
<!ENTITY RFC2637 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2637.xml">
<!ENTITY RFC3193 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3193.xml">
<!ENTITY RFC5780 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5780.xml">


<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs), 
    please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
    (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc='yes'?>
<!-- generate a ToC -->
<?rfc tocdepth='4'?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc toc='yes'?>
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space 
    (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="info" docName="draft-janog-softwire-report-01" ipr="trust200902">
 <!-- category values: std, bcp, info, exp, and historic
    ipr values: trust200902, noModificationTrust200902, noDerivativesTrust200902,
       or pre5378Trust200902
    you can add the attributes updates="NNNN" and obsoletes="NNNN" 
    they will automatically be output with "(if approved)" -->

  <!-- ***** FRONT MATTER ***** -->

  <front>
    <!-- The abbreviated title is used in the page header - it is only necessary if the 
         full title is longer than 39 characters -->
      <title abbrev="IPv4 over IPv6 report">
      Stateless IPv4 over IPv6 report
     </title>

    <!-- add 'role="editor"' below for the editors if appropriate -->

    <!-- Another author who claims to be an editor -->
    <author fullname="Shishio Tsuchiya" initials="S.T." role="editor"
            surname="Tsuchiya">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street>Midtown Tower, 9-7-1,Akasaka</street>
          <city>Minato-Ku</city>
          <region>Tokyo</region>
          <code>107-6227</code>
          <country>Japan</country>
        </postal>
        <phone>+81 3 6434 6543</phone>
        <email>shtsuchi@cisco.com</email>
      </address>
    </author>

<author fullname="Shuichi Ohkubo" initials="S.O" role=""
            surname="Ohkubo">
      <organization>Sakura Internet</organization>
      <address>
        <postal>
          <street>33F Sumitomo fudosan Nishi shinjuku Bldg.,7-20-1 Nishi shinjuku</street>
          <city>Shinjuku-Ku</city>
          <region>Tokyo</region>
          <code>160-0023</code>
          <country>Japan</country>
        </postal>
        <phone>+81 3 5332 7070</phone>
        <email>ohkubo@sakura.ad.jp</email>
      </address>
    </author>

<author fullname="Yuya Kawakami" initials="Y.K" role=""
            surname="Kawakami">
      <organization>INTERNET MULTIFEED CO.</organization>
      <address>
        <postal>
          <street>OTEMACHI 1st.SQUARE EAST TOWER,3F 1-5-1,Otemachi,</street>
          <city>Chiyoda-ku</city>
          <region>Tokyo</region>
          <code>100-0004</code>
          <country>Japan</country>
        </postal>
        <phone>+81 3 3282 1040</phone>
        <email>kawakami@mfeed.ad.jp</email>
      </address>
    </author>
    



    <date month="Nov" year="2012" />

    <!-- If the month and year are both specified and are the current ones, xml2rfc will fill 
         in the current day for you. If only the current year is specified, xml2rfc will fill 
	 in the current day and month for you. If the year is not the current one, it is 
	 necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the 
	 purpose of calculating the expiry date).  With drafts it is normally sufficient to 
	 specify just the year. -->

    <!-- Meta-data Declarations -->

    <area></area>

    <workgroup>Internet Engineering Task Force</workgroup>

 <!-- WG name at the upperleft corner of the doc,
         IETF is fine for individual submissions.  
	 If this element is not present, the default is "Network Working Group",
         which is used by the RFC Editor as a nod to the history of the IETF. -->

    <keyword>template</keyword>

    <!-- Keywords will be incorporated into HTML output
         files in a meta tag but they have no effect on text or nroff
         output. If you submit your draft to the RFC Editor, the
         keywords will be used for the search engine. -->

    <abstract>
      <t>Stateless IPv4 over IPv6 tunnel such as MAP(Mapping of Address and Port) designs to support IPv4 over IPv6 island and resolve IPv4 shortage problem by Address and Port Mapping technique.</t>
<t>This document describes supported vendor's implementation, ipv4 functionality over IPv6 and interoperability report. </t>
    </abstract>
  </front>

  <middle>

<section title="Introduction">
      <t>Stateless IPv4 over IPv6 tunnel such as MAP(Mapping of Address and Port) designs to support IPv4 over IPv6 island and resolve IPv4 shortage problem by Address and Port Mapping technique.</t>
<t>JApan Network Operators Group [JANOG] made a Working Group to evaluate this feature.</t>
<t>7 vendors and 9 implementations attended to the interop events which hold at Nagaoka city of Niigata, Japan.</t>
<t>This document describes MAP-E [I-D.ietf-softwire-map] supported vendor's implementation, ipv4 functionality over IPv6 and interoperability report.</t>
 </section>

<section title="Implementation Report">
 <t>MAP-E [I-D.ietf-softwire-map] is already supported by a lot of vendors. The total number was 7 vendors and 9 implementations at this point.</t>
<t>In this section, describes about interop event participant list, security mechanism and provisioning method and reachability to BR address. </t>

<section title="Participant List">

<section title="MAP-E Border Relay (BR)">
<texttable align='left'>
    <ttcol align='left'>Vendor</ttcol>
    <ttcol align='left'>OS/Equipment</ttcol>
    <c>IP Infusion</c>
    <c>Linux 2.6.18</c>
    <c>IP Infusion</c>
    <c>NetBSD 4.0.1</c>
    <c>Furukawa Network Solution Corp.</c>
    <c>FX5000</c>
    <c>ASAMAP</c>
    <c>Vyatta</c>
    <c>Internet Initiative Japan Inc.</c>
    <c>SEIL/X1</c>
    <c>Cisco Systems</c>
    <c>IOS-XR/ASR9000</c>
 </texttable>
</section>

<section title="MAP-E Customer Edge (CE)">
<texttable align='left'>
    <ttcol align='left'>Vendor</ttcol>
    <ttcol align='left'>OS/Equipment</ttcol>
    <c>IP Infusion</c>
    <c>Linux 2.6.18</c>
    <c>IP Infusion</c>
    <c>NetBSD 4.0.1</c>
    <c>Furukawa Network Solution Corp.</c>
    <c>F60W</c>
    <c>ASAMAP</c>
    <c>Vyatta</c>
    <c>CERNET</c>
    <c>OpenWRT</c>
    <c>Internet Initiative Japan Inc.</c>
    <c>SEIL/X1</c>
    <c>Yamaha Corporation</c>
    <c>RTX1200</c> 
 </texttable>
</section>

</section>

<section title="Security mechanism">
<t>We took a survey to participant about security considerations which is described on Section 13 of [I-D.ietf-softwire-map]. </t> 
<section title="Question">
<t>Q1. How to behave when CE/BR receives IPv4 packets which does not match MAP cpe domain?</t>
<t>Q2. How to behave when CE/BR receives IPv6 packets which has inconsistency between IPv6 src address and IPv4 src address?</t>
<t>Q3. How to behave when CE/BR receives IPv6 packets which has inconsistency between IPv6 dst address and IPv4 dst address?</t>
<t>Q4. How to behave when CE receives IPv6 packets which is not from BR address?</t>
</section>

<section title="Typical implementation">
<t>A1. Most of vendor look up IP routing table, then routing to next hop or drops. But some vendors check routing table at first, then check consistency between the Rule IPv4 prefix and IPv4 destination packets. As the result, routing to next hop or drops. </t>

<t>A2. All of BRs checks inconsistency between IPv6 src address  and IPv4 src address. Most of CE checks inconsistency between IPv6 src address and IPv4 src address. If IPv6 src address is included in the Rule IPv6 prefix then validates IPv4 src address. If the src address is BR address, then it does not validate.</t>

<t>A3. Most of BR only checks whether the IPv6 dst address is BR address. Most of CE validates inconsistency between IPv6 dst address and IPv4 dst address before NAT process. </t>

<t>A4. Depends on configuration. If CE is configured as "Hub and Spoke mode" or permit only from BR address, then the packets will be dropped. If CE is configured as "Mesh mode" or no filter, then packets will transit.</t>
  
</section>

</section>

<section title="Provisioning method">
<t>Section 7 of [I-D.ietf-softwire-map] describes configuration of MAP-E. All of CE and BR who attended the event are supported manual configuration only at this time.</t>
<t>Most of vendors directly configures "Length of EA bits", but some vendors configures "sharing ratio" and "contiguous-ports", "length of EA bits" would be calculated as the result.</t>
<t>The former configuration type would be useful for operation and trouble shooting, because "rule in the packets" is visible on configurations.</t>
<t>On the other hand, latter type configuration would be easy to understand design such as how many user will be shared one address.</t>
</section>

<section title="Reachability to BR address">
<t>3 BR implementations are required to configure BR address as interface address.</t>
<t>The rest of 2 BR implementations must not configure BR address as interface address.</t>
<t>The former implementation, can confirm reachability of BR address from IPv6 network. But latter implementation, can not confirm reachability to BR address but of course can confirm reachability to BR themselves. </t>
</section>


</section>

<section title="Test Parameter">
<t>MAP-E Parameter</t>
<texttable align='left'>
    <ttcol align='left'>Parameter</ttcol>
    <ttcol align='left'>Value</ttcol> 
    <c>Rule IPv6 prefix</c>
    <c>2403:9200::/32</c>
    <c>Rule IPv4 prefix</c>
    <c>203.86.225.0/28</c>
    <c>End-user IPv6 prefix</c>
    <c>2403:9200:fff1::/48 - 2403:9200:fff7::/48</c>
    <c>EA bits</c>
    <c>16bit(48-32)</c>
    <c>Port-Set ID</c>
    <c>12bit</c>
    <c>PSID offset</c>
    <c>4</c>
    <c>BR IPv6 address</c>
    <c>2403:9200:fff0:0::2</c>
    <c>Topology</c>
    <c>Mesh</c>
 </texttable>
<t>Each of MAP-E has only 15 TCP/UDP ports,1 IP address is shared by 4096 users.</t>
<t>MAP Simulation Tool shows <eref target="http://6lab.cisco.com/map/MAP.php?W1siUnVsZSAwIiwiMjQwMzo5MjAwOjA6MC8zMiIsIjIwMy44Ni4yMjUuMC8yOCIsMTYsNCwxXV0=">this rule.</eref></t>

<t>MTU Parameter</t>
<texttable align='left'>
    <ttcol align='left'>Parameter</ttcol>
    <ttcol align='left'>IPv6 MTU</ttcol>
    <ttcol align='left'>TCP MSS clamp</ttcol>
    <ttcol align='left'>Tunnel IF IPv4 MTU</ttcol>
    <c>Value</c>
    <c>1500byte</c>
    <c>Enable</c>
    <c>1460byte</c>
    </texttable>
</section>

<section title="IPv4 functionality over IPv6">
<t>MAP-E [I-D.ietf-softwire-map] uses A+P technologies with NAT44. Basic NAT requirement is defined as [RFC4787], [RFC5508] and [RFC5382]. But there is difference of implementation among vendors. ALG support also depends on vendors implementations.  </t>
<section title="T-1:ICMP">
<t>Section 9 of [I-D.ietf-softwire-map] describes about ICMP handling in MAP domain.</t>
 <t>T-1-1: echo request/echo reply</t>
<t>Confirmed from MAP-E CE network to global internet.</t>
<t>Echo request (ICMP type 8 code 0) has identifier, so MAP-E CE has to rewrite this field from ports-set value. Echo reply(ICMP type 0 code 0) has same identifier as echo request. MAP-BR must handle from this identifier field.</t>
<t>Therefore the test could confirm capability of ICMP both CE and BR.</t>
<t>All of CE and BR are supported this feature.</t>

 <t>T-1-2: Host Unreachable</t>
<t>Confirmed from MAP-E CE network to global internet.</t>
<t>Layer3 switch reply "Host unreachable" (ICMP type 3 code 1) message, the message does not has identifier field. So MAP-BR has to inspect ICMP payload.</t>
<t>The test could confirm capability to handling for null identifier ICMP of MAP-BR.</t>
<t>3 BR already supported this feature.2 BR does not support this feature at this time.</t>

 <t>T-1-3: TTL equals 0 during transit</t>
<t>Confirmed traceroute from MAP-E CE network to global internet.</t>
<t>Layer3 switch reply "TTL equals 0 during transit" (ICMP type 11 code 0) message, the message does not has identifier field. So MAP-BR has to inspect ICMP payload.</t>
<t>The test could confirm capability to handling for null identifier ICMP of MAP-BR.</t>
<t>3 BR already supported this feature.2 BR does not support this feature at this time.</t>

<t>T-1-4: Fragmentation needed but no frag. bit set </t>
<t>Confirmed Echo with DF-bit from MAP-E CE network to global internet.</t>
<t>Layer3 switch reply "Fragmentation needed but no frag. bit set" (ICMP type 3 code 4) message, the message does not has identifier field. So MAP-BR has to inspect ICMP payload.</t>
<t>The test could confirm capability to handling for null identifier ICMP of MAP-BR.</t>
<t>3 BR already supported this feature.2 BR does not support this feature at this time.</t>

</section>

<section title="T-2:IPSec VPN">
 <t>IPSec VPN [RFC2401] uses ESP packets, therefore MAP-E CE should support NAT traversal [RFC3948]. </t>
 <t>T-2-1:IPSec</t>
 <t>All of CE failed.This result is expected behavior. </t>

 <t>T-2-2:IPSec VPN(UDP:NAT Traversal)</t>
 <t>All of CE succeeded.</t>

</section>

<section title="T-3:SSL VPN">
<t>It should be no problem, because SSL VPN[RFC4347] uses TCP sockets.</t>
<t>All of CE succeeded.</t>
</section>

<section title="T-4:FTP">
<t>FTP[RFC0959] PORT(Active) and PASV(Passive) mode had sometimes problem in NAT44. [RFC2428] is enhancement FTP for IPv6/NAT. MAP-E devices may need support FTP ALG if the customer required FTP Active mode. </t>
 <t>T-4-1:Passive(PASV) mode</t>
 <t>All of CE succeeded.</t>
 <t>T-4-2:Active(PORT) mode</t>
 <t>Only 2 vendor's CE succeeded.</t>
</section>

<section title="T-5:PPTP">
<t>PPTP[RFC2637] uses GRE and TCP port 1723. Unless configuring to pass GRE and TCP port 1723, can not use PPTP on MAP-E .NOTE:Microsoft is warning use of PPTP due to security reason. [2743314]</t>

<t>All of CE failed.This result is expected behavior.</t>

</section>

<section title="T-6:L2TP">
<t>L2TP/IPsec[RFC3193] should support on MAP-E using with NAT Traversal[RFC3948].  </t>
 <t>All of CE succeeded.</t>
</section>


<section title="T-7:Instant Messaging and VoIP">
<t>Verified functionality of Instant Messaging and VoIP tool that described on  <eref target="http://tools.ietf.org/html/rfc6586#section-5.3">section 5.3 of [RFC6586]</eref> and facetime within same MAP-E CE, different MAP-E CEs and between MAP-E BR and CE. </t>

  <section title ="Facebook on the web (http)">
  <t>All of combination basically succeeded. Tested both chat and video. </t>
</section>

  <section title="Facebook via a client (xmpp)">
 <t>All of combination succeeded. </t>
</section>
 
  <section title="Jabber.org chat service (xmpp)">
  <t>Not tested</t>
</section>

<section title="Gmail chat on the web (http)">  
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>

  <section title="Gmail chat via a client (xmpp)">
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>

  <section title="Google Talk client">
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>      

  <section title="AIM (AOL)">            
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>
            
  <section title="ICQ (AOL)">
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>
                     
  <section title="Skype">
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>                         

  <section title="MSN">              
<t>All of combination basically succeeded. Tested chat,voice and video. </t>
</section>
  <section title="Webex">                      
<t>All of combination succeeded. Tested chat,voice and video in the meeting.</t>  </section>

<section title="Sametime">     
    <t>Not tested</t>
</section>

 <section title="facetime">             
<t>All of combination succeeded. </t>
</section>

 </section>

<section title="T-8:NAT verification tool">
<t>Acording to <eref target="http://tools.ietf.org/html/draft-ietf-softwire-map-02#section-11">Section-11 of [I-D.ietf-softwire-map]</eref>, MAP CE should support [RFC4787], [RFC5508] and [RFC5382] . This section describes the result of MAP CEs which were verified by test tool.</t>

<section title="T-8-1:RFC4787">
<t>STUN [RFC5389], NAT Behavior Discovery [RFC5780] and UDP hole punching are used for online game. [RFC4787] is Best Current Practise of  NAT behavior requirement for UDP. Konami Digital Entertainment Co., Ltd. provided [RFC4787] verification tool.</t>
<t>The test result will be update.</t>
<t>REQ-1: Endpoint-Independent Mapping</t>
<t>REQ-8: Filtering Behavior</t>
<t>REQ-9: Hairpinning</t>
<t>REQ-3: Port overloading</t>
</section>

<section title="T-8-2:NAT-Analyzer">
<t>[NAT-Analyzer] is JAVA applet in the browser to verify NAT functionality.</t><t>The test result will be update.</t>

</section>
</section>

<section title="Result summary">
<t>Even DNS queries could occupy to MAP-E CE NAT table in this port restricted (only 15 ports) environments.</t>
<t>There is two solution; one is specific short timer for DNS or UDP. Another is configured DNS transport proxy on MAP-E CE.</t>
<t>As section-3 of [I-D.draft-dec-stateless-4v6] describes, MAP-E CE expected to act as a DNS resolver proxy, using native DNS over IPv6 to the SP network.</t>

<t>IPv6 MTU expected as 1500byte, but some vendors had the implicit limitation which does not configured over 1280byte. It could not see a lot of site if the vendor which had limitation works as BR. Also there was complex issue even if the vendor works as CE.</t>
<t>As section 10.1 of [I-D.ietf-softwire-map], IPv6 MTU in the MAP domain should configured well managed value.</t>

<t>Most of modern applications and VPN protocols could use in multi vendor MAP-E[I-D.ietf-softwire-map]. </t>

<t>But there is the difference of test result of [RFC4787] and FTP Active mode. It's depends on vendor's NAT implementation.</t>
</section>
</section>

<section title="BR redundancy">
<t>As MAP-E is stateless,so specific technic is not required for redundancy.</t><t>Tested BR redundancy between 2 BRs by routing convergence. Skype session had been kept and could communicate after route convergence(about 2 sec).</t>

</section>

<section title="Interoperability">
<t>MAP-E stateless technology that means does not need maintenance of state machine. So there are no problem of interoperability.</t>

<t>But there was one issue about "ipv6 interface identifier" from misunderstanding of section-6 of [I-D.ietf-softwire-map].</t>
<t>If it could add example to explain format in this section, then it would be more understandable.</t> 
<t>The issue is already fixed.</t>
</section>

<section title="Conclusion">
<t>A lot of vendors already implemented MAP-E.</t>
<t>There is no critical issue about interoperability between different vendor's CE and CE, CE and BR, BR and BR.</t>
<t>Most of issue were already discussed on IETF.</t>
<t> MAP-E [I-D.ietf-softwire-map] is mature.</t>
</section>

<section title="Contributor">
<t>Test netork Contributors</t>
<artwork align="left">
Chisato Kashiwagi Chisato.Kashiwagi@ipinfusion.com
Shuuichi Saito shuu@fnsc.co.jp
Takuya Iimura tiimura@cisco.com
Tomoki Murai murai@fnsc.co.jp
Tomoyuki Sahara  tsahara@iij.ad.jp
Ryo Sato sr.10005@konami.com
Motohiko Sato sm.64846@konami.com
Congxiao Bao  congxiao@cernet.edu.cn
Guoliang Han  bupthgl@gmail.com
Kohei Ono Kohei.Ono@ipinfusion.com
Naohide Kamitani kamitani@fnsc.co.jp
Masakazu Asama m-asama@ginzado.ne.jp
Kazuhiko Satoyoshi satoyoshi@soundnet.yamaha.co.jp
Takehiro Sukizaki  sukizaki@soundnet.yamaha.co.jp
Tetsuya Innami tinnami@cisco.com
Satoshi Kubota sa-kubota@jpne.co.jp
Yuji Yamazaki yuji.yamazaki@g.softbank.co.jp
Satoru Matsushima satoru.matsushima@gmail.com
Kaoru Oka kaoru.oka@g.softbank.co.jp
Miki Takata miki@baking.jp
Takayuki Osabe osabet@nscs.jp
Satoshi Ebe satoshie@nscs.jp
Yasuyuki Kaneko yasuyuki.kaneko@global-netcore.jp
Maoke Chen fibrib@gmail.com
</artwork>

</section>


<section anchor="Acknowledgements" title="Acknowledgements">
      <t>The author would like to thanks NS Comuputer Service, ENOG and JANOG committee. The authors would like to thank you Satoru Matsushima, Seiichi Kawamura for their thorough review and comments. </t> 
    <!-- Possibly a 'Contributors' section ... -->
</section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document has no actions for IANA. </t>
</section>

    <section anchor="Security" title="Security Considerations">
      <t>There is no additional security requirement. </t>
</section>

</middle>

  <!--  *****BACK MATTER ***** -->

  <back>
    <!-- References split into informative and normative -->

    <!-- There are 2 ways to insert reference entries from the citation libraries:
     1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
     2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
        (for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

     Both are cited textually in the same manner: by using xref elements.
     If you use the PI option, xml2rfc will, by default, try to find included files in the same
     directory as the including file. You can also define the XML_LIBRARY environment variable
     with a value containing a set of directories to search.  These can be either in the local
     filing system or remote ones accessed by http (http://domain/dir/... ).-->

    <references title="Normative References">
      <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->
      &RFC2119;
      &RFC4787;
      &RFC3489;
      &RFC4347;
      &RFC2401;
      &RFC3948;
      &RFC5508;
      &RFC2408;
      &RFC6586;
      &RFC0959;
      &RFC2637;
      &RFC3193;
      &RFC5780;
     <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-murakami-softwire-4rd-00.xml"?>
     <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-softwire-map-00.xml"?>
     <?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-dec-stateless-4v6-00.xml"?>

     </references>

<references title="Informative References">
      &RFC5569;
      &RFC5952;
      &RFC5737;
      &RFC3849;
      &RFC6104;
      &RFC6587;
      &RFC6145;
      &RFC6052;
      &RFC6346;
      &RFC4443;
      &RFC5387;
<?rfc include="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-softwire-stateless-4v6-motivation-00.xml"?>

 <reference anchor="2743314" target="http://technet.microsoft.com/en-us/security/advisory/2743314">
       <front><title>"Microsoft Security Advisory (2743314) Unencapsulated MS-CHAP v2 Authentication Could Allow Information Disclosure
"</title>
       </front>
 </reference>

<reference anchor="JANOG" target="http://www.janog.gr.jp/en">
       <front><title>"JApan Network Operators Group"</title>
       </front>
 </reference>

<reference anchor="NAT-Analyzer" target="http://nattest.net.in.tum.de/">
       <front><title>"Network Measurement Activites at TUM"</title>
       </front>
 </reference>

<reference anchor="ENOG" target="http://enog.jp/">
       <front><title>"Echigo Network Operators' Group"</title>
       </front>
 </reference>


 </references>

<section anchor="app-additional" title="Additional Stuff">
   <section title="test network toplogy and parameters">
        <figure align="left" anchor="Figure.1">
          <preamble></preamble>

          <artwork align="left">
                                .--.
                              _(.   `)
                            _(  IPv4  `)_
                           (  Internet   `)
                          ( `  .        )  )
                           `--(_______)---'
                                  |     
			    +----------+
			    | MAP-E BR |
                            +----------+      MAP-E BR IPv6 address
                                  |           2403:9200:fff0:0::2 
                                .--.
                              _(.   `)
                            _(  IPv6  `)_
                           (  Backbone   `)    Rule IPv6 prefix:2403:9200::/32
                          ( `  .        )  )   Rule IPv4 prefix:203.86.225.0/28
                           `--(_______)---'    CE IPv6 prefix:
                                  |            2403:9200:fff1::/48 - 2403:9200:fff7::/48
                                  |            EA bits:16bit(48-32)
                                  |            Port-Set ID:12bit	
                          +---------------+    PSID offset:4
			  |  IPv6 Switch  |    Tunnel Interface IPv4 MTU: 1460 
                          +---------------+   
                          |       |       |     
                          
        </artwork>

          <postamble></postamble>
        </figure>

</section>
   <section title="Configuration">
<section title="IP Infusion NetBSD 4.0.1:BR ">
<artwork align="left">
---- MAP tunnel I/F ----
# cat /etc/ifconfig.map0
up
mtu 1460
inet 10.99.99.1/24
rule_ipv6_prefix 2403:9200::/32
rule_ipv4_prefix 203.86.225.0/28
rule_eabits_length 16
psid_offset 4
encap_src_check 0
fmr 1
</artwork>
</section>

<section title="IP Infusion Linux 2.6.18:BR ">
<artwork align="left">
---- MAP tunnel I/F ----
ip -6 tunnel change map1 rule_ipv6_prefix 2403:9200::/32
ip -6 tunnel change map1 rule_ipv4_prefix 203.86.225.0/28
ip -6 tunnel change map1 rule_eabits_length 16
ip -6 tunnel change map1 psid_offset 4
ip -6 tunnel change map1 fmr 1
ip -6 tunnel change map1 map_autosetaddr 1
ip -6 tunnel change map1 map_autosetgw 1
ip -4 addr add 203.86.225.18/30 dev map1
</artwork>
</section>


<section title="Furukawa Network Solution Corp.:BR">
<artwork align="left">
!
interface tunnel 1
 tunnel mode ipinip ipv4 ipv6-tunnel-profile 1
exit
!
ipv4 ipv6-tunnel-profile 1
 profile-mode map-encap
 rule-ipv4-prefix 203.86.225.0/28
 rule-ipv6-prefix 2403:9200::/32
 user-len 16
 source-address 2403:9200:fff0::2
exit

</artwork>
</section>

<section title="Vyatta ASAMAP:BR">
<artwork align="left">
interfaces {
     loopback lo {
     }
     map map0 {
         br-address 2403:9200:fff0::2/64
         default-forwarding-mode encapsulation
         default-forwarding-rule true
         role br
         rule 1 {
             ea-length 16
             ipv4-prefix 203.86.225.0/28
             ipv6-prefix 2403:9200::/32
         }
     }
 
</artwork>
</section>

<section title="Internet Initiative Japan Inc. SEIL:BR">
<artwork align="left">
interface frd0 mtu 1460
frd mode br
frd br-address 2403:9200:fff0::2
frd rule add R0 external-ipv4-prefix 203.86.225.0/28 internal-ipv6-prefix 2403:9200::/32 index-length 16 psid-offset 4
</artwork>
</section>

<section title="Cisco IOS-XR:BR">
<artwork align="left">
!
interface ServiceApp5
 ipv4 address 203.0.113.5 255.255.255.252
 load-interval 30
 service cgn JANOG service-type map-e
 logging events link-status
!
interface ServiceApp6
 ipv6 address 2001:db8:1:1::1/64
 load-interval 30
 service cgn JANOG service-type map-e
 logging events link-status
!
interface ServiceInfra1
 ipv4 address 203.0.113.1 255.255.255.252
 service-location 0/0/CPU0
!
service cgn JANOG
 service-location preferred-active 0/0/CPU0
 service-type map-e Softwire
  cpe-domain ipv4 prefix 203.86.225.0/28
  cpe-domain ipv6 prefix 2403:9200::/32
  sharing-ratio 12
  aftr-endpoint-address 2403:9200:fff0::2
  contiguous-ports 0
  address-family ipv4
   interface ServiceApp5
  !
  address-family ipv6
   interface ServiceApp6
  !
end

</artwork>
</section>

<section title="IP Infusion NetBSD 4.0.1:CE ">
<artwork align="left">
-- ifconfig.map0 -- actual MAP-E parameter
up
mtu 1460
rule_ipv6_prefix 2403:9200::/32
rule_ipv4_prefix 203.86.225.0/28
lan_if_name any
wan_if_name lo1
map_autosetaddr 1
map_autosetgw 1
rule_eabits_length 16
psid_offset 4
map_border_router 2403:9200:fff0:0::2
map_mss auto
fmr 1

</artwork>
</section>

<section title="IP Infusion Linux 2.6.18:CE ">
<artwork align="left">
---- MAP tunnel I/F ----

ip -6 tunnel change map1 rule_ipv6_prefix 2403:9200::/32
ip -6 tunnel change map1 rule_ipv4_prefix 203.86.225.0/28
ip -6 tunnel change map1 rule_eabits_length 16
ip -6 tunnel change map1 psid_offset 4
ip -6 tunnel change map1 map_border_router 2403:9200:fff0:0::2
ip -6 tunnel change map1 fmr 1
ip -6 tunnel change map1 map_autosetaddr 1
ip -6 tunnel change map1 map_autosetgw 1
</artwork>
</section>


<section title="Furukawa Network Solution Corp.:CE">
<artwork align="left">
ip nat ap_pool ADDR-POOL1
 ipv6-mape-profile 1
exit
ip ipv6-mape-profile 1
 user-len 16
 br-address 2403:9200:fff0:0::2
 rule-ipv6-prefix reference-interface loopback 1
 rule-ipv6-prefix-len 32
 rule-ipv4-prefix 203.86.225.0 255.255.255.240
exit
interface tunnel 1
 tunnel mode ipip ipv6-mape-profile 1
 tunnel source reference-interface ipv6 loopback 1
 ip mtu 1460
 ip nat inside source list 10 ap_pool ADDR-POOL1
exit
</artwork>
</section>

<section title="Vyatta ASAMAP:CE">
<artwork align="left">
 interfaces {
     map map0 {
         br-address 2403:9200:fff0::2/64
         default-forwarding-mode encapsulation
         default-forwarding-rule true
         role ce
         rule 1 {
             ea-length 16
             ipv4-prefix 203.86.225.0/28
             ipv6-prefix 2403:9200::/32
         }
         tunnel-source eth1
     }
</artwork>
</section>

<section title="Internet Initiative Japan Inc. SEIL:CE">
<artwork align="left">
interface frd0 mtu 1460
interface frd0 tcp-mss 1420
nat napt add private 192.168.1.0-192.168.1.255 interface frd0
nat option port-assignment random
frd mode ce
frd ce-address 2403:9200:fff6:0:cb:56e1:f0f:f600
frd br-address 2403:9200:fff0::2
frd rule add R0 external-ipv4-prefix 203.86.225.0/28 internal-ipv6-prefix 2403:9200::/32 index-length 16 psid-offset 4
</artwork>
</section>

<section title="Yamaha :CE">
<artwork align="left">
tunnel select 1
 tunnel encapsulation ipip
 tunnel endpoint address 2403:9200:fff7:0:cb:56e1:f0f:f700 2403:9200:fff0::2
 tunnel map-e 203.86.225.0/28 2403:9200::/32 16 4 ::2
 ip tunnel mtu 1460
 ip tunnel nat descriptor 1000
 tunnel enable 1
nat descriptor type 1000 masquerade
nat descriptor timer 1000 30
nat descriptor timer 1000 tcpfin 5
nat descriptor address outer 1000 map-e
</artwork>
</section>

<section title="CERNET OpenWRT :CE">
<artwork align="left">
# configure eth1 -- IPv4 interface
ifconfig br-lan 192.168.1.1/24

./control start

#janog softwire interop event
utils/ivictl -r -d -P 2403:9200:fff0:0::2/128
utils/ivictr -r -p 203.86.225.0/28 -P 2403:9200::/32 -R 4096 - M 1 -f -E
utils/ivictr -s -i br-lan -I eth0.1 -H -N -a 192.168.1.0/24 -A 203.86.225.1/28 -P 2403:9200::/32 -R 4096 - M 1 -o 4 -f -c 1400 -E
service iptables stop
service ip6tables stop
</artwork>
</section>

</section>

</section>

    <!-- Change Log

v00 2006-03-15  EBD   Initial version

v01 2006-04-03  EBD   Moved PI location back to position 1 -
                      v3.1 of XMLmind is better with them at this location.
v02 2007-03-07  AH    removed extraneous nested_list attribute,
                      other minor corrections
v03 2007-03-09  EBD   Added comments on null IANA sections and fixed heading capitalization.
                      Modified comments around figure to reflect non-implementation of
                      figure indent control.  Put in reference using anchor="DOMINATION".
                      Fixed up the date specification comments to reflect current truth.
v04 2007-03-09 AH     Major changes: shortened discussion of PIs,
                      added discussion of rfc include.
v05 2007-03-10 EBD    Added preamble to C program example to tell about ABNF and alternative 
                      images. Removed meta-characters from comments (causes problems).  -->
</back>
</rfc>
