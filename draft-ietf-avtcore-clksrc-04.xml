<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std" docName="draft-ietf-avtcore-clksrc-04" ipr="trust200902">
  <front>
    <title abbrev="RTP Clock Source Signalling">RTP Clock Source
    Signalling</title>

    <author fullname="Aidan Williams" initials="A.M." surname="Williams">
      <organization>Audinate</organization>

      <address>
        <postal>
          <street>Level 1, 458 Wattle St</street>

          <city>Ultimo</city>

          <code>2007</code>

          <region>NSW</region>

          <country>Australia</country>
        </postal>

        <phone>+61 2 8090 1000</phone>

        <facsimile>+61 2 8090 1001</facsimile>

        <email>aidan.williams@audinate.com</email>

        <uri>http://www.audinate.com/</uri>
      </address>
    </author>

    <author fullname="Kevin Gross" initials="K." surname="Gross">
      <organization>AVA Networks</organization>

      <address>
        <postal>
          <street></street>

          <city>Boulder</city>

          <region>CO</region>

          <country>US</country>
        </postal>

        <email>kevin.gross@avanw.com</email>

        <uri>http://www.avanw.com/</uri>
      </address>
    </author>

    <author fullname="Ray van Brandenburg" initials="R."
            surname="van Brandenburg">
      <organization>TNO</organization>

      <address>
        <postal>
          <street>Brassersplein 2</street>

          <city>Delft</city>

          <code>2612CT</code>

          <country>the Netherlands</country>
        </postal>

        <phone>+31-88-866-7000</phone>

        <email>ray.vanbrandenburg@tno.nl</email>
      </address>
    </author>

    <author fullname="Hans Stokking" initials="H.M." surname="Stokking">
      <organization>TNO</organization>

      <address>
        <postal>
          <street>Brassersplein 2</street>

          <city>Delft</city>

          <code>2612CT</code>

          <country>the Netherlands</country>
        </postal>

        <email>hans.stokking@tno.nl</email>
      </address>
    </author>

    <date day="8" month="May" year="2013" />

    <area>Real-time Applications and Infrastructure</area>

    <workgroup>Audio/Video Transport Core Maintenance</workgroup>

    <keyword>Clock</keyword>

    <keyword>Source</keyword>

    <abstract>
      <t>NTP format timestamps are used by several RTP protocols for
      synchronisation and statistical measurements. This memo specifies SDP
      signalling identifying timestamp reference clock sources and SDP
      signalling identifying the media clock sources in a multimedia
      session.</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>RTP protocols use NTP format timestamps to facilitate multimedia
      session synchronisation and for providing estimates of round trip time
      (RTT) and other statistical parameters.</t>

      <t>Information about media clock timing exchanged in NTP format
      timestamps may come from a clock which is synchronised to a global time
      reference, but this cannot be assumed nor is there a standardised
      mechanism available to indicate that timestamps are derived from a
      common reference clock. Therefore, RTP implementations typically assume
      that NTP timestamps are taken using unsynchronised clocks and must
      compensate for absolute time differences and rate differences. Without a
      shared reference clock, RTP can time align flows from the same source at
      a given receiver using relative timing, however tight synchronisation
      between two or more different receivers (possibly with different network
      paths) or between two or more senders is not possible.</t>

      <t>High performance AV systems often use a reference media clock
      distributed to all devices in the system. The reference media clock is
      often distinct from the reference clock used to provide timestamps. A
      reference media clock may be provided along with an audio or video
      signal interface, or via a dedicated clock signal (e.g. <xref
      target="SMPTE-318-1999">genlock</xref> or <xref
      target="AES11-2009">audio word clock</xref>). If sending and receiving
      media clocks are known to be synchronised to a common reference clock,
      performance can improved by minimising buffering and avoiding rate
      conversion.</t>

      <t>This specification defines SDP signalling of timestamp reference clock sources
      and media reference clock sources.</t>
    </section>

    <section anchor="applications" title="Applications">
      <t>Timestamp reference clock source and media clock signalling benefit
      applications requiring synchronised media capture or playout and low
      latency operation.</t>

      <t>Examples include, but are not limited to:</t>

      <t><list style="hanging">
          <t hangText="Social TV">: <xref target="I-D.ietf-avtcore-idms">RTCP
          for inter-destination media synchronization</xref> defines social TV
          as the combination of media content consumption by two or more users
          at different devices and locations and real-time communication
          between those users. An example of Social TV, is where two or more
          users are watching the same television broadcast at different
          devices and/or locations, while communicating with each other using
          text, audio and/or video. A skew in the media playout of the two or
          more users can have adverse effects on their experience. A
          well-known use case here is one friend experiencing a goal in a
          football match well before or after other friends.</t>

          <t hangText="Video Walls">: A video wall consists of multiple
          computer monitors, video projectors, or television sets tiled
          together contiguously or overlapped in order to form one large
          screen. Each of the screens reproduces a portion of the larger
          picture. In some implementations, each screen or projector may be
          individually connected to the network and receive its portion of the
          overall image from a network-connected video server or video scaler.
          Screens are refreshed at 50 or 60 hertz or potentially faster. If
          the refresh is not synchronized, the effect of multiple screens
          acting as one is broken.</t>

          <t hangText="Networked Audio">: Networked loudspeakers, amplifiers
          and analogue I/O devices transmitting or receiving audio signals via
          RTP can be connected to various parts of a building or campus
          network. Such situations can for example be found in large
          conference rooms, legislative chambers, classrooms (especially those
          supporting distance learning) and other large-scale environments
          such as stadiums. Since humans are more susceptible to differences
          in audio delay, this use case needs even more accuracy than the
          video wall use case. Depending on the exact application, the need
          for accuracy can then be <eref
          target="http://www.ieee802.org/1/files/public/docs2007/as-dolsen-time-accuracy-0407.pdf">in
          the range of microseconds</eref>.</t>

          <t hangText="Sensor Arrays">: Sensor arrays contain many
          synchronised measurement elements producing signals which are then
          combined to form an overall measurement. Accurate capture of the
          phase relationships between the various signals arriving at each
          element of the array is critically important for proper operation.
          Examples include towed or fixed sonar arrays, seismic arrays and
          phased arrays used in radar applications, for instance.</t>
        </list></t>
    </section>

    <section anchor="definitions" title="Definitions">
      <t>The following definitions are used in this draft:<list
          style="hanging">
          <t hangText="media level">: Media level information applies to a
          single SDP media stream. In an SDP description, media-level
          information appears after each "m"-line.</t>

          <t hangText="multimedia session">: A set of multimedia senders and
          receivers as well as the data streams flowing from senders to
          receivers. The <xref target="RFC4566">Session Description Protocol
          (SDP)</xref> describes multimedia sessions.</t>

          <t hangText="RTP media stream">: A single stream of RTP packets
          identified by an RTP SSRC.</t>

          <t hangText="RTP media sender">: The device generating an associated
          RTP media stream</t>

          <t hangText="SDP media stream">: An RTP session potentially
          containing more than one RTP source. SDP media descriptions
          beginning with an "m"-line define the parameters of an SDP media
          stream.</t>

          <t hangText="session level">: Session level information applies to
          an entire multimedia session. In an SDP description, session-level
          information appears before the first "m"-line.</t>

          <t hangText="source level">: Source level information applies to a
          RTP media stream <xref target="RFC5576">Source-Specific Media
          Attributes in the Session Description Protocol (SDP)</xref> defines
          how source-level information is included into an SDP session
          description.</t>

          <t hangText="traceable time">: A clock is considered to provide
          traceable time if it can be proven to be synchronised to
          International Atomic Time (TAI). Coordinated Universal Time (UTC) is
          a time standard synchronized to TAI. UTC is therefore also
          considered traceable time once leap seconds have been taken unto
          account. <xref target="IS-GPS-200F">GPS</xref> is commonly used to
          provide a TAI traceable time reference. Some network time
          synchronisation protocols (e.g. <xref
          target="IEEE1588-2008">PTP</xref>, NTP) can explicitly indicate that
          the master clock is providing a traceable time reference over the
          network.</t>
        </list></t>
    </section>

    <section title="Timestamp Reference Clock Source Signalling">
      <t>The NTP format timestamps used by RTP are taken by reading a local
      real-time clock at the sender or receiver. This local clock may be
      synchronised to another clock (time source) by some means or it may be
      unsynchronised. A variety of methods are available to synchronise local
      clocks to a reference time source, including network time protocols
      (e.g. <xref target="RFC5905">NTP</xref>, <xref
      target="IEEE1588-2008">PTP</xref>) and radio clocks (e.g. <xref
      target="IS-GPS-200F">GPS</xref>).</t>

      <t>The following sections describe and define SDP signalling, indicating
      whether and how the local timestamping clock in an RTP sender/receiver
      is synchronised to a reference clock.</t>

      <section title="Clock synchronization">
        <t>Two or more local clocks that are sufficiently synchronised will
        produce timestamps for a given RTP event can be used as if they came
        from the same clock. Providing they are sufficiently synchronised,
        timestamps produced in one RTP sender or receiver can be directly
        compared to a local clock in another RTP sender or receiver.</t>

        <t>The accuracy of synchronisation required is application dependent.
        See <xref target="applications">Applications</xref> section for a
        discussion of applications and their corresponding requirements. To
        serve as a reference clock, clocks must minimally be syntonised
        (exactly frequency matched) to one another.</t>

        <t>Sufficient synchronisation can typically be achieving by using a
        network time protocol (e.g. NTP, 802.1AS, IEEE 1588-2008) to
        synchronize all devices to a single master clock.</t>

        <t>Another approach is to use clocks providing a global time reference
        (e.g. GPS, Galileo). This concept may be used in conjunction with
        network time protocols as some protocols (e.g. PTP, NTP) allow master
        clocks to indicate explicitly that they are providing traceable
        time.</t>
      </section>

      <section title="Identifying NTP Reference Clocks">
        <t>A single NTP server is identified by hostname (or IP address) and
        an optional port number. If the port number is not indicated, it is
        assumed to be the standard NTP port (123).</t>

        <t>Two or more NTP servers MAY be listed at the same level in the
        session description to indicate that all of the listed servers deliver the same reference time and may be used interchangeably. RTP senders and receivers are assured proper synchronization regardless of which server they choose and, in support of fault tolerance, may switch servers while streaming.</t>
      </section>

      <section title="Identifying PTP Reference Clocks">
        <t>The IEEE 1588 Precision Time Protocol (PTP) family of clock
        synchronisation protocols provides a shared reference clock in an
        network - typically a LAN. IEEE 1588 provides sub-microsecond
        synchronisation between devices on a LAN and typically locks within
        seconds at startup. With support from Ethernet switches, IEEE 1588
        protocols can achieve nanosecond timing accuracy in LANs. Network
        interface chips and cards supporting hardware time-stamping of timing
        critical protocol messages are also available.</t>

        <t>Three flavours of IEEE 1588 are in use today:<list style="symbols">
            <t><xref target="IEEE1588-2002">IEEE 1588-2002</xref>: the
            original "Standard for a Precision Clock Synchronization Protocol
            for Networked Measurement and Control Systems". This is also known
            as IEEE1588v1 or PTPv1.</t>

            <t><xref target="IEEE1588-2008">IEEE 1588-2008</xref>: the second
            version of the "Standard for a Precision Clock Synchronization
            Protocol for Networked Measurement and Control Systems". This is a
            revised version of the original IEEE1588-2002 standard and is also
            known as IEEE1588v2 or PTPv2. IEEE 1588-2008 is not protocol
            compatible with IEEE 1588-2002.</t>

            <t><xref target="IEEE802.1AS-2011">IEEE 802.1AS</xref>: "Timing
            and Synchronization for Time Sensitive Applications in Bridged
            Local Area Networks". This is a Layer-2 only profile of IEEE
            1588-2008 for use in Audio/Video Bridged LANs as described in
            <xref target="IEEE802.1BA-2011">IEEE 802.1BA-2011</xref>.</t>
          </list></t>

        <t>Each IEEE 1588 clock is identified by a globally unique EUI-64
        called a "ClockIdentity". A slave clock using one of the IEEE 1588
        family of network time protocols acquires the ClockIdentity/EUI-64 of
        the grandmaster clock that is the ultimate source of timing
        information for the network. A boundary clock which is itself slaved
        to another boundary clock or the grandmaster passes the grandmaster
        ClockIdentity through to its slaves.</t>

        <t>Several instances of the IEEE 1588 protocol may operate
        independently on a single network, forming distinct PTP domains, each
        of which may have a different grandmaster clock. As the IEEE 1588
        standards have developed, the definition of PTP domains has changed.
        IEEE 1588-2002 identifies protocol subdomains by a textual name, but
        IEEE 1588-2008 identifies protocol domains using a numeric domain
        number. 802.1AS is a Layer-2 profile of IEEE 1588-2008 supporting a
        single numeric clock domain (0).</t>

        <t>When PTP domains are signalled via SDP, senders and receivers
        SHOULD check that both grandmaster ClockIdentity and PTP domain match
        when determining clock equivalence.</t>

        <t>Two or more IEEE 1588 clocks MAY be listed at the same level in the
        session description to indicate that all of the listed clocks are candidate grandmaster clocks for the domain or deliver the same reference time and may be used interchangeably. RTP senders and receivers are assured proper synchronization regardless of which synchronization source they choose and, in support of fault tolerance, may switch refence clock source while streaming.</t>
        
        <t>The PTP protocols employ a distributed election protocol called the
        "Best Master Clock Algorithm" (BMCA) to determine the active clock
        master. The clock master choices available to BMCA can be restricted
        or biased by configuration parameters to influence the election
        process. In some systems it may be desirable to limit the number of
        possible PTP clock masters to avoid the need to re-signal timestamp
        reference clock sources when the clock master changes.</t>
      </section>

      <section title="Identifying Global Reference Clocks">
        <t>Global reference clocks provide a source of traceable time,
        typically via a hardware radio receiver interface. Examples include
        GPS and Galileo. Apart from the name of the reference clock system, no
        further identification is required.</t>
      </section>

      <section title="Other Reference Clocks">
        <t>RFC 3550 allows senders and receivers to either use a local
        wallclock reference for their NTP timestamps or, by setting the
        timestamp field to 0, to supply no timestamps at all. Both are common
        practice in embedded RTP implementations. These clocks are identified
        as "local" and can only be assumed to be equivalent to clocks
        originating from the same device.</t>

        <t>In other systems, all RTP senders and receivers may use a timestamp
        reference clock that is not provided by one of
        the methods listed above. Examples may include the reference time
        information provided by digital television or cellular services. These
        sources are identified as "private" reference clocks. All RTP senders
        and receivers in a session using a private reference clock are assumed
        to have a mechanism outside this specification for determining whether
        their timestamp reference clocks are equivalent.</t>
      </section>

      <section title="Traceable Reference Clocks">
        <t>A timestamp reference clock source may be labelled "traceable" if it is known
        to be to delivering traceable time. Providing adjustments are made for
        differing epochs, timezones and leap seconds, timestamps taken using
        clocks synchronised to a traceable time source can be directly
        compared even if the clocks are synchronised to different sources or
        via different mechanisms.</t>

        <t>Since all NTP and PTP servers providing traceable time can be
        directly compared, it is not necessary to identify traceable time
        servers by protocol address or other identifiers.</t>
      </section>

      <section anchor="rcgrammar"
               title="SDP Signalling of Timestamp Reference Clock Source">
        <t>Specification of the timestamp reference clock source may be at any
        or all levels (session, media or source) of an SDP description (see
        <xref target="definitions">level definitions</xref> earlier in this
        document for more information).</t>

        <t>Timestamp reference clock source signalling included at session-level
        provides default parameters for all RTP sessions and sources in the
        session description. More specific signalling included at the media
        level overrides default session level signalling. More specific
        signalling included at the source level overrides default media level
        signalling.</t>

        <t>If timestamp reference clock source signalling is included anywhere in an SDP
        description, it must be properly defined for all levels in the
        description. This may simply be achieved by providing default
        signalling at the session level.</t>

        <t>Timestamp reference clock parameters may be repeated at a given
        level (i.e. for a session or source) to provide information about
        additional servers or clock sources. If the attribute is repeated at a
        given level, all clocks described at that level are assumed to be
        equivalent. Traceable time sources MUST NOT be mixed with
        non-traceable time sources at any given level.</t>

        <t>Note that clock source parameters may change from time to time, for
        example, as a result of a PTP clock master election. The <xref
        target="RFC3261">SIP</xref> protocol supports re-signalling of updated
        SDP information, however other protocols may require additional
        notification mechanisms.</t>

        <t><xref target="abnf-ts-refclk"></xref> shows the <xref
        target="RFC5234">ABNF</xref> grammar for the SDP reference clock
        source information.</t>

        <figure align="center" anchor="abnf-ts-refclk"
                title="Timestamp Reference Clock Source Signalling">
          <artwork><![CDATA[
timestamp-refclk = "a=ts-refclk:" clksrc CRLF
clksrc = ntp / ptp / gps / gal / local / private / clksrc-ext

ntp             =  "ntp=" ntp-server-addr
ntp-server-addr =  host [ ":" port ]
ntp-server-addr =/ "traceable"

ptp             =  "ptp=" ptp-version ":" ptp-server
ptp-version     =  "IEEE1588-2002"
ptp-version     =/ "IEEE1588-2008"
ptp-version     =/ "IEEE802.1AS-2011"
ptp-version     =/  ptp-version-ext
ptp-version-ext =   token
   
ptp-server      =  ptp-gmid [":" ptp-domain] / "traceable"
ptp-gmid        =  EUI64
ptp-domain      =  ptp-domain-name / ptp-domain-nmbr
ptp-domain-name =  "domain-name=" 16ptp-domain-char
ptp-domain-char =  %x21-7E / %x00
                   ; allowed characters: 0x21-0x7E (IEEE 1588-2002)
ptp-domain-nmbr =  "domain-nmbr=" %x00-7f
                   ; allowed number range: 0-127 (IEEE 1588-2008)

gps      =  "gps"
gal      =  "gal"
local    =  "local"
private  =  "private" [ ":" "traceable" ]

clksrc-ext	= token

host          = hostname / IPv4address / IPv6reference
hostname      =  *( domainlabel "." ) toplabel [ "." ]
toplabel      =  ALPHA / ALPHA *( alphanum / "-" ) alphanum
domainlabel   =  alphanum
                 / alphanum *( alphanum / "-" ) alphanum
IPv4address   =  1*3DIGIT "." 1*3DIGIT "." 1*3DIGIT "." 1*3DIGIT
IPv6reference =  "[" IPv6address "]"
IPv6address   =  hexpart [ ":" IPv4address ]
hexpart       =  hexseq / hexseq "::" [ hexseq ] / "::" [ hexseq ]
hexseq        =  hex4 *( ":" hex4)
hex4          =  1*4HEXDIG

port = 1*DIGIT

EUI64 = 7(2HEXDIG "-") 2HEXDIG
]]></artwork>
        </figure>

        <section title="Examples">
          <t><xref target="example-session-level"></xref> shows an example SDP
          description with a timestamp reference clock source defined at the
          session level.</t>

          <figure align="center" anchor="example-session-level"
                  title="Timestamp reference clock definition at the session level">
            <artwork><![CDATA[
v=0
o=jdoe 2890844526 2890842807 IN IP4 192.0.2.1
s=SDP Seminar
i=A Seminar on the session description protocol
u=http://www.example.com/seminars/sdp.pdf
e=j.doe@example.com (Jane Doe)
c=IN IP4 233.252.0.1/64
t=2873397496 2873404696
a=recvonly
a=ts-refclk:ntp=traceable
m=audio 49170 RTP/AVP 0
m=video 51372 RTP/AVP 99
a=rtpmap:99 h263-1998/90000
]]></artwork>
          </figure>

          <t></t>

          <t><xref target="example-media-level"></xref> shows an example SDP
          description with timestamp reference clock definitions at the media
          level overriding the session level defaults.</t>

          <figure align="center" anchor="example-media-level"
                  title="Timestamp reference clock definition at the media level">
            <artwork><![CDATA[
v=0
o=jdoe 2890844526 2890842807 IN IP4 192.0.2.1
s=SDP Seminar
i=A Seminar on the session description protocol
u=http://www.example.com/seminars/sdp.pdf
e=j.doe@example.com (Jane Doe)
c=IN IP4 233.252.0.1/64
t=2873397496 2873404696
a=recvonly
a=ts-refclk:local
m=audio 49170 RTP/AVP 0
a=ts-refclk:ntp=203.0.113.10
a=ts-refclk:ntp=198.51.100.22
m=video 51372 RTP/AVP 99
a=rtpmap:99 h263-1998/90000
a=ts-refclk:ptp=IEEE802.1AS-2011:39-A7-94-FF-FE-07-CB-D0
]]></artwork>
          </figure>

          <t></t>

          <t><xref target="example-source-level"></xref> shows an example SDP
          description with a timestamp reference clock definition at the
          source level overriding the session level default.</t>

          <figure align="center" anchor="example-source-level"
                  title="Timestamp reference clock signalling at the source level">
            <artwork><![CDATA[
v=0
o=jdoe 2890844526 2890842807 IN IP4 192.0.2.1
s=SDP Seminar
i=A Seminar on the session description protocol
u=http://www.example.com/seminars/sdp.pdf
e=j.doe@example.com (Jane Doe)
c=IN IP4 233.252.0.1/64
t=2873397496 2873404696
a=recvonly
a=ts-refclk:local
m=audio 49170 RTP/AVP 0
m=video 51372 RTP/AVP 99
a=rtpmap:99 h263-1998/90000
a=ssrc:12345 ts-refclk:ptp=IEEE802.1AS-2011:39-A7-94-FF-FE-07-CB-D0
]]></artwork>
          </figure>
        </section>
      </section>
    </section>

    <section title="Media Clock Source Signalling">
      <t>The media clock source for a stream determines the timebase used to
      advance the RTP timestamps included in RTP packets. The media clock may
      be asynchronously generated by the sender, it may be generated in fixed
      relationship to the reference clock or it may be generated with respect
      to another stream on the network (which is presumably being received by
      the sender).</t>

      <section anchor="asyncmc" title="Asynchronously Generated Media Clock">
        <t>In the simplest sender implementation, the sender generates media
        by sampling audio or video according to a free-running local clock.
        The RTP timestamps in media packets are advanced according to this
        media clock and packet transmission is typically timed to regular
        intervals on this timeline. The sender may or may not include an NTP
        timestamp in sender reports to allow mapping of this asynchronous
        media clock to a reference clock.</t>

        <t>The asynchronously generated media clock is the assumed mode of
        operation when there is no signalling of media clock source.
        Alternatively, asynchronous media clock may be explicitly
        signalled.<list>
            <t>a=mediaclk:sender</t>
          </list></t>
      </section>

      <section anchor="directmc" title="Direct-Referenced Media Clock">
        <t>A media clock may be directly derived from a reference clock. For
        this case it is required that a reference clock be specified with an
        a=ts-refclk attribute (<xref target="rcgrammar"></xref>).</t>

        <t>The signalling optionally indicates a media clock offset value. The
        offset indicates the RTP timestamp value at the epoch (time of origin)
        of the reference clock. If no offset is signalled, the offset can be
        inferred at the receiver by examining RTCP sender reports which
        contain NTP and RTP timestamps which combined define a mapping.</t>

        <t>A rate modifier may be specified. The modifier is expressed as the
        ratio of two integers and modifies the rate specified or implied by
        the media description by this ratio. If omitted, the rate is assumed
        to be the exact rate specified or implied by the media format. For
        example, without a rate specification, the media clock for an 8 kHz
        G.711 audio stream will advance exactly 8000 units for each second
        advance in the reference clock from which it is derived.</t>

        <t>The rate modifier is primarily useful for accommodating certain
        "oddball" audio sample rates associated with NTSC video (see <xref
        target="example-mediaclk-2"></xref>). Modified rates are not advised
        for video streams which generally use a 90 kHz RTP clock regardless of
        frame rate or sample rate used for embedded audio. <list>
            <t>a=mediaclk:direct[=&lt;offset&gt;] [rate=&lt;rate
            numerator&gt;/&lt;rate denominator&gt;]</t>
          </list></t>
      </section>

      <section anchor="streammc" title="Stream-Referenced Media Clock">
        <t>A common synchronisation architecture for audio/visual systems
        involves distributing a reference media clock from a master device to
        a number of slave devices, typically by means of a cable. Examples
        include audio word clock distribution and video black burst
        distribution. In this case, the media clock is locally generated,
        often by a crystal oscillator and is not locked to a timestamp
        reference clock.</t>

        <t>To support this architecture across a network, a master clock
        identifier is associated with an RTP media stream carrying media clock
        timing information from a master device. The master clock identifier
        represents a media clock source in the master device. Slave devices in
        turn associate the master media clock identifier with streams they
        transmit, signalling the synchronisation relationship between the
        master and slave devices.</t>

        <t>Slave devices recover media clock timing from the clock master
        stream, using it to synchronise the slave media clock with the master.
        Timestamps in the master clock RTP media stream are taken using the
        timestamp reference clock shared by the master and slave devices. The
        timestamps communicate information about media clock timing (rate,
        phase) from the master to the slave devices. Timestamps are
        communicated in the usual RTP fashion via RTCP SRs, or via the <xref
        target="RFC6051">RFC6051</xref> header extension. The stream media
        format may indicate other clock information, such as the nominal
        rate.</t>

        <t>Note that slaving of a device media clock to a master device does
        not affect the usual RTP lip sync / time alignment algorithms. Time
        aligned playout of two or more RTP sources still relies upon NTP
        timestamps supplied via RTCP SRs or by the RFC6051 timestamp header
        extension.</t>

        <t>In a given system, master clock identifiers must be unique. Such
        identifiers MAY be manually configured, however 17 octet string
        identifiers SHOULD be generated according to the "short-term
        persistent RTCP CNAME" algorithm as described in <xref
        target="RFC6222">RFC6222</xref>.</t>

        <t>A reference stream can be an RTP stream or AVB stream based on the
        <xref target="IEEE1722">IEEE 1722</xref> standard.</t>

        <t>An RTP clock master stream SHOULD be identified at the source level
        by an SSRC and master clock identifier. If master clock identifiers
        are declared at the media or session level, all RTP sources at or
        below the level of declaration MUST provide equivalent timing to a
        slave receiver.<list>
            <t>a=ssrc:&lt;media-clock-master-ssrc-id&gt;
            mediaclk:master-id=&lt;media-clock-master-id&gt;</t>
          </list></t>

        <t>An RTP media sender indicates that it is slaved to a clock master
        via a clock master identifier:<list>
            <t>a=mediaclk:master-id=&lt;media-clock-master-id&gt;</t>
          </list></t>

        <t>An RTP media sender indicates that it is slaved to an IEEE 1722
        clock master via a stream identifier (an EUI-64):<list>
            <t>a=mediaclk:IEEE1722=&lt;StreamID&gt;</t>
          </list></t>
      </section>

      <section anchor="mcgrammar" title="SDP Signalling of Media Clock Source">
        <t>Specification of the media clock source may be at any or all levels
        (session, media or source) of an SDP description (see level
        definitions (Section 3) earlier in this document for more
        information).</t>

        <t>Media clock source signalling included at session level provides
        default parameters for all RTP sessions and sources in the session
        description. More specific signalling included at the media level
        overrides default session level signalling. Further, source-level
        signalling overrides media clock source signalling at the enclosing
        media level and session level.</t>

        <t>Media clock source signalling may be present or absent on a
        per-stream basis. In the absence of media clock source signals,
        receivers assume an asynchronous media clock generated by the
        sender.</t>

        <t>Media clock source parameters may be repeated at a given level
        (i.e. for a session or source) to provide information about additional
        clock sources. If the attribute is repeated at a given level, all
        clocks described at that level are comparable clock sources and may be
        used interchangeably.</t>

        <t><xref target="abnf-mediaclk"></xref> shows the <xref
        target="RFC5234">ABNF</xref> grammar for the SDP media clock source
        information.</t>

        <figure align="center" anchor="abnf-mediaclk"
                title="Media Clock Source Signalling">
          <artwork><![CDATA[
mediaclk-master = "a=ssrc:" integer SP clk-master-id

clk-master-id = "mediaclk:master-id=" master-id
          
timestamp-mediaclk = "a=mediaclk:" mediaclock
 
mediaclock = sender / refclk / streamid / mediaclock-ext
 
sender = "sender" sender-ext

sender-ext = token
 
refclk = "direct" [ "=" 1*DIGIT ] [rate] [direct-ext]
 
rate = [ SP "rate=" integer "/" integer ]
 
direct-ext = token
 
streamid = "master-id=" master-id
streamid =/ "IEEE1722=" avb-stream-id
streamid =/ streamid-ext
 
master-id = EUI48
avb-stream-id = EUI64
 
EUI48 = 5(2HEXDIG ":") 2HEXDIG
EUI64 = 7(2HEXDIG ":") 2HEXDIG
 
streamid-ext = token
 
mediaclock-ext = token [SP byte-string]
]]></artwork>
        </figure>
      </section>

      <section title="Examples">
        <t><xref target="example-mediaclk-1"></xref> shows an example SDP
        description 8 channels of 24-bit, 48 kHz audio transmitted as a
        multicast stream. Media clock is derived directly from an IEEE
        1588-2008 reference.</t>

        <figure align="center" anchor="example-mediaclk-1"
                title="Media clock directly referenced to IEEE 1588-2008">
          <artwork><![CDATA[
v=0
o=- 1311738121 1311738121 IN IP4 192.0.2.1
c=IN IP4 233.252.0.1/64
s= 
t=0 0
m=audio 5004 RTP/AVP 96
a=rtpmap:96 L24/48000/8
a=sendonly
a=ts-refclk:ptp=IEEE1588-2008:39-A7-94-FF-FE-07-CB-D0:0
a=mediaclk:direct=963214424
]]></artwork>
        </figure>

        <t><xref target="example-mediaclk-2"></xref> shows an example SDP
        description 2 channels of 24-bit, 44056 kHz NTSC "pull-down" media
        clock derived directly from an IEEE 1588-2008 reference clock</t>

        <figure align="center" anchor="example-mediaclk-2"
                title="&quot;Oddball&quot; sample rate directly referenced to IEEE 1588-2008">
          <artwork><![CDATA[
v=0
o=- 1311738121 1311738121 IN IP4 192.0.2.1
c=IN IP4 233.252.0.1/64
s= 
t=0 0
m=audio 5004 RTP/AVP 96
a=rtpmap:96 L24/44100/2
a=sendonly
a=ts-refclk:ptp=IEEE1588-2008:39-A7-94-FF-FE-07-CB-D0:0
a=mediaclk:direct=963214424 rate=1000/1001
]]></artwork>
        </figure>

        <t><xref target="example-mediaclk-3"></xref> shows the same 48 kHz
        audio transmission from <xref target="example-mediaclk-1"></xref> with
        media clock derived from another RTP stream.</t>

        <figure align="center" anchor="example-mediaclk-3"
                title="RTP stream with media clock slaved to a master device">
          <artwork><![CDATA[
v=0
o=- 1311738121 1311738121 IN IP4 192.0.2.1
c=IN IP4 233.252.0.1/64
s= 
t=0 0
m=audio 5004 RTP/AVP 96
a=rtpmap:96 L24/48000/2
a=sendonly
a=ts-refclk:ptp=IEEE1588-2008:39-A7-94-FF-FE-07-CB-D0:0
a=mediaclk:master-id=00:60:2b:20:12:1f
]]></artwork>
        </figure>

        <t><xref target="example-mediaclk-4"></xref> shows the same 48 kHz
        audio transmission from <xref target="example-mediaclk-1"></xref> with
        media clock derived from an IEEE 1722 AVB stream.</t>

        <figure align="center" anchor="example-mediaclk-4"
                title="RTP stream with media clock slaved to an IEEE1722 master device">
          <artwork><![CDATA[
v=0
o=- 1311738121 1311738121 IN IP4 192.0.2.1
c=IN IP4 233.252.0.1/64
s= 
t=0 0
m=audio 5004 RTP/AVP 96
a=rtpmap:96 L24/48000/2
a=sendonly
a=ts-refclk:ptp=IEEE1588-2008:39-A7-94-FF-FE-07-CB-D0:0
a=mediaclk:IEEE1722=38-D6-6D-8E-D2-78-13-2F
]]></artwork>
        </figure>
      </section>
    </section>

    <section title="Signalling considerations">
      <t>Signaling for <xref target="rcgrammar">timestamp reference clock source</xref>
      and <xref target="mcgrammar">media clock source</xref> is defined to be
      used either by applications that implement the SDP Offer/Answer model
      <xref target="RFC3264"></xref> or by applications that use SDP to
      describe media and transport configurations.</t>

      <t>A description or offer may include reference clock signalling, media
      clock signalling neither or both. When a direct-referenced media clock (<xref target="directmc"></xref>) is specified, reference clock signalling is REQUIRED. If no media clock is signalled, an asynchronous media clock
      (<xref target="asyncmc"></xref>) is assumed. Asynchronous and stream-referenced media clocks (<xref target="streammc"></xref>) may be used with or without reference clock signalling. If a reference clock is not signalled, the corresponding media clock may be established as rate synchronized with no assurance of time synchronisation.</t>

      <section title="Usage in Offer/Answer">
        <t>Usage of reference clock and media clock signalling in offer/answer allows the offerer to declare the reference clock and media clock in use and allows the answerer to acknowledge that a connection according to these declarations will be successful or, in limited cases described below, specify a simplified synchronization mode.</t>
        
        <t>While full negotiation of reference clock and media clock attributes is not directly supported in the clock source signalling defined in this document, negotiation MAY be accomplished using capabilities negotiation procedures defined in <xref target="RFC5939"/>.</t>
        
        <t>An answer to an offer with direct-referenced media clock SHOULD include the same media clock and
        reference clock signalling in which case a connection is established
        using the specified synchronisation. Alternatively the answer MAY omit
        both signals or include only the reference clock specified in the offer. In
        this case, a connection with asynchronous media clock is established.</t>

        <t>An answer to an offer with stream-referenced media clock
        signalling SHOULD include the same media clock specification. If the offer contains reference clock signalling, the answer SHOULD include the same reference clock specification. The answer MAY omit reference clock signalling. If reference clock signalling is not
        present in the answer, either due to not being present in the offer or
        due to being dropped in the answer, the stream may be established as
        rate synchronised but not time synchronised.</t>

        <t>An asynchronous media clock is the default media clock mode. This
        mode may be explicitly signalled (a=mediaclk:sender) or presumed due to lack of
        signalling. If explicit signalling of asynchronous media clock is included in the offer, it SHOULD also be included in the answer. An offer with asynchronous media clocking MAY
        include reference clock signalling. An answer to an asynchronous media clock offer with reference clock signalling SHOULD include the same reference clock specification. Alternatively, the answer MAY drop
        reference clock signalling in which case the connection may be established as
        rate synchronised but not time synchronised.</t>
      </section>

      <section title="Usage Outside of Offer/Answer">
        <t>SDP can be employed outside of the Offer/Answer context, for
        instance for multimedia sessions that are announced through the
        Session Announcement Protocol (SAP) <xref target="RFC2974"></xref>, or
        streamed through the Real Time Streaming Protocol (RTSP) <xref
        target="RFC2326"></xref>. The signaling model is simpler, as the
        sender does not negotiate parameters, but the functionality expected
        from specifying media clock and reference clock attributes is the
        same as in Offer/Answer.</t>
      </section>
    </section>

    <section title="Security Considerations">
      <t>Entities receiving and acting upon an SDP message SHOULD be aware
      that a session description cannot be trusted unless it has been obtained
      by an authenticated transport protocol from a known and trusted source.
      Many different transport protocols may be used to distribute session
      description, and the nature of the authentication will differ from
      transport to transport. For some transports, security features are often
      not deployed. In case a session description has not been obtained in a
      trusted manner, the endpoint SHOULD exercise care because, among other
      attacks, the media sessions received may not be the intended ones, the
      destination where media is sent to may not be the expected one, any of
      the parameters of the session may be incorrect.</t>

      <t>Incorrect reference or media clock parameters may cause devices or
      streams to synchronize to unintended clock sources. Normally this simply
      results in failure to make a media connection or failure to synchronize
      once connected. Enough devices fraudulently assigned to a specific clock
      source (e.g. a particular IEEE 1588 grandmaster) may, however,
      constitute a successful a denial of service attack on that source.
      Devices MAY wish to validate the integrity of the clock description
      through some means before connecting to unfamiliar clock sources.</t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <section title="Reference clock registry">
      <t>The SDP attribute "ts-refclk" defined by this document is registered
      with the IANA registry of SDP Parameters as follows:</t>

      <figure>
        <artwork><![CDATA[
SDP Attribute ("att-field"):

  Attribute name:     ts-refclk

  Long form:          Timestamp reference clock source

  Type of name:       att-field

  Type of attribute:  Session, media and source level

  Subject to charset: No

  Purpose:            See section 4 of this document

  Reference:          This document

  Values:             See this document and registrations below

]]></artwork>
      </figure>
        <t>The attribute has an extensible parameter field and
        therefore a registry for these parameters is required. This document
        creates an IANA registry called the Timestamp Reference Clock Source
        Parameters Registry. It contains the six parameters defined in <xref
        target="abnf-ts-refclk"></xref>: "ntp", "ptp", "gps", "gal", "local",
        "private". New entries MAY be added to this registry according to well-known Specification Required policy <xref target="RFC5226"/>.</t>
        </section>
        
        <section title="Media clock registry">
      <t>The SDP attribute "mediaclk" defined by this document is registered
      with the IANA registry of SDP Parameters as follows:</t>

      <figure>
        <artwork><![CDATA[
SDP Attribute ("att-field"):

  Attribute name:     mediaclk

  Long form:          Media clock source

  Type of name:       att-field

  Type of attribute:  session and media level

  Subject to charset: No

  Purpose:            See section 5 of this document

  Reference:          This document

  Values:             See this document and registrations below

]]></artwork>
      </figure>
      <t>The attribute has an extensible parameter field and
        therefore a registry for these parameters is required. This document
        creates an IANA registry called the Media Clock Source Parameters
        Registry. It contains the three parameters defined in <xref
        target="abnf-mediaclk"></xref>: "sender", "direct", "master", "slave"
        and "IEEE1722". New entries MAY be added to this registry according to well-known Specification Required policy <xref target="RFC5226"/>.</t>
      </section>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>

      <?rfc include="reference.RFC.5234"?>

      <?rfc include="reference.RFC.3261"?>

      <?rfc include="reference.RFC.3264"?>

      <?rfc include="reference.RFC.4566"?>
      
      <?rfc include="reference.RFC.5226"?>

      <?rfc include="reference.RFC.5576"?>

      <?rfc include="reference.RFC.5939"?>

      <?rfc include="reference.RFC.6051"?>

      <?rfc include="reference.RFC.6222"?>
    </references>

    <references title="Informative References">
      <?rfc include="reference.RFC.2326"?>

      <?rfc include="reference.RFC.2974"?>

      <?rfc include="reference.RFC.5905"?>

      <?rfc include="reference.I-D.ietf-avtcore-idms"?>

      <reference anchor="IEEE1588-2002"
                 target="http://standards.ieee.org/findstds/standard/1588-2002.html">
        <front>
          <title>1588-2002 - IEEE Standard for a Precision Clock
          Synchronization Protocol for Networked Measurement and Control
          Systems</title>

          <author>
            <organization>Institute of Electrical and Electronics
            Engineers</organization>
          </author>

          <date year="2002" />
        </front>

        <seriesInfo name="" value="IEEE Std 1588-2002" />
      </reference>

      <reference anchor="IEEE1588-2008"
                 target="http://standards.ieee.org/findstds/standard/1588-2008.html">
        <front>
          <title>1588-2008 - IEEE Standard for a Precision Clock
          Synchronization Protocol for Networked Measurement and Control
          Systems</title>

          <author>
            <organization>Institute of Electrical and Electronics
            Engineers</organization>
          </author>

          <date year="2008" />
        </front>

        <seriesInfo name="" value="IEEE Std 1588-2008" />
      </reference>

      <reference anchor="IEEE802.1AS-2011"
                 target="http://standards.ieee.org/findstds/standard/802.1AS-2011.html">
        <front>
          <title>Timing and Synchronization for Time-Sensitive Applications in
          Bridged Local Area Networks</title>

          <author>
            <organization>Institute of Electrical and Electronics
            Engineers</organization>
          </author>

          <date />
        </front>
      </reference>

      <reference anchor="IEEE802.1BA-2011"
                 target="http://standards.ieee.org/findstds/standard/802.1BA-2011.html">
        <front>
          <title>Audio Video Bridging (AVB) Systems</title>

          <author>
            <organization>Institute of Electrical and Electronics
            Engineers</organization>
          </author>

          <date />
        </front>
      </reference>

      <reference anchor="IS-GPS-200F">
        <front>
          <title>Navstar GPS Space Segment/Navigation User Segment
          Interfaces</title>

          <author>
            <organization>Global Positioning Systems
            Directorate</organization>
          </author>

          <date day="21" month="September" year="2011" />
        </front>
      </reference>

      <reference anchor="IEEE1722"
                 target="http://standards.ieee.org/findstds/standard/1722-2011.html">
        <front>
          <title>IEEE Standard for Layer 2 Transport Protocol for Time
          Sensitive Applications in a Bridged Local Area Network</title>

          <author>
            <organization>Institute of Electrical and Electronics
            Engineers</organization>
          </author>

          <date />
        </front>
      </reference>

      <reference anchor="SMPTE-318-1999" target="http://standards.smpte.org/">
        <front>
          <title>Television and Audio &ndash; Synchronization of 59.94- or
          50-Hz Related Video and Audio Systems in Analog and Digital Areas
          &ndash; Reference Signals</title>

          <author>
            <organization>Society of Motion Picture &amp; Television
            Engineers</organization>
          </author>

          <date />
        </front>
      </reference>

      <reference anchor="AES11-2009" target="http://www.aes.org/standards/">
        <front>
          <title>AES11-2009: AES recommended practice for digital audio
          engineering - Synchronization of digital audio equipment in studio
          operations </title>

          <author>
            <organization>Audio Engineering Society</organization>
          </author>

          <date />
        </front>
      </reference>
    </references>
  </back>
</rfc>
