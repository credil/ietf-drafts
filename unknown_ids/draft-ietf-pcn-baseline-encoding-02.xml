<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" >
<rfc ipr="trust200811" docName="draft-ietf-pcn-baseline-encoding-02" category="std">
<?xml-stylesheet type='text/xsl' href='http://xml.resource.org/authoring/rfc2629.xslt' ?>

<!-- Alterations to I-D/RFC boilerplate -->
<?rfc private="" ?>    <!-- Default private="" Produce an internal memo 2.5pp shorter than an I-D or RFC -->
<?rfc topblock="yes" ?>    <!-- Default topblock="yes" put the famous header block on the first page -->
<?rfc footer="" ?>    <!-- Default footer="Expires <date>" override the center footer string -->
<?rfc header="" ?>    <!-- Default header="Internet-Draft" override the leftmost header string -->
<?rfc authorship="yes" ?>    <!-- Default authorship="yes" Render authors' addresses section -->
<?rfc rfcprocack="yes" ?>    <!-- Default rfcprocack="no" add a short sentence acknowledging xml2rfc -->
<?rfc strict="no" ?>    <!-- Default strict="no" Don't check I-D nits -->
<?rfc rfcedstyle="yes" ?>    <!-- Default rfcedstyle="yes" attempt to closely follow finer details from the latest observable RFC-Editor style -->

<!-- IETF process -->
<?rfc iprnotified="no" ?> <!-- Default iprnotified="no" I haven't disclosed existence of IPR to IETF -->

<!-- ToC format -->
<?rfc toc="yes" ?>      <!-- Default toc="no" No Table of Contents -->
<?rfc tocappendix="yes" ?>    <!-- Default tocappendix="yes" control whether the word `Appendix' appears in the table-of-content -->
<?rfc tocdepth="3" ?>    <!-- Default tocdepth="3" if toc is "yes", then this determines the depth of the table-of-contents -->
<?rfc tocindent="yes" ?>    <!-- Default tocindent="yes" if toc is "yes", indent subsections in the table-of-contents -->
<?rfc tocnarrow="yes" ?>    <!-- Default tocnarrow="yes" affects horizontal spacing in the table-of-content -->
<?rfc tocompact="yes" ?>    <!-- Default tocompact="yes" if toc is "yes", then setting this to "no" will make it a little less compact -->

<!-- Cross referencing, footnotes, comments -->
<?rfc symrefs="yes" ?>  <!-- Default symrefs="no" Don't use anchors, but use numbers for refs -->
<?rfc sortrefs="yes"?>  <!-- Default sortrefs="no" Don't sort references into order -->
<?rfc comments="no" ?>    <!-- Default comments="no" Don't render comments -->
<?rfc inline="no" ?>    <!-- Default inline="no" if comments is "yes", then render comments inline; otherwise render them in an `Editorial Comments' section -->
<?rfc editing="no" ?>    <!-- Default editing="no" Don't insert editing marks for ease of discussing draft versions -->

<!-- Pagination control -->
<?rfc compact="yes"?>   <!-- Default compact="no" Start sections on new pages -->
<?rfc subcompact="no"?> <!-- Default subcompact="(as compact setting)" yes/no is not quite as compact as yes/yes -->
<?rfc autobreaks="yes" ?>    <!-- Default autobreaks="yes" avoid widows and orphans (not perfect) -->

<!-- HTML formatting control -->
<?rfc emoticonic="yes" ?>    <!-- Default emoticonic="no" Doesn't prettify HTML format -->
<?rfc background="" ?>    <!-- Default background="" when producing a html file, use this image -->
<?rfc useobject="no" ?>    <!-- Default useobject="no" use <object> not <src> when outputting HTML -->
<?rfc linkmailto="yes" ?>    <!-- Default linkmailto="yes" generate mailto: URL, as appropriate -->


    <front>
        <title abbrev="Baseline PCN Encoding">
            Baseline Encoding and Transport of Pre-Congestion Information
        </title>
        <author initials="T." surname="Moncaster" fullname="Toby Moncaster">
            <organization>BT</organization>
            <address>
                <postal>
                    <street>B54/70, Adastral Park</street>
                    <street>Martlesham Heath</street>
                    <city>Ipswich</city>
                    <code>IP5 3RE</code>
                    <country>UK</country>
                </postal>
                <phone>+44 1473 648734</phone>
                <email>toby.moncaster@bt.com</email>
            </address>
        </author>
        <author initials="B." surname="Briscoe" fullname="Bob Briscoe">
            <organization>BT &amp; UCL</organization>
            <address>
                <postal>
                    <street>B54/77, Adastral Park</street>
                    <street>Martlesham Heath</street>
                    <city>Ipswich</city>
                    <code>IP5 3RE</code>
                    <country>UK</country>
                </postal>
                <phone>+44 1473 645196</phone>
                <email>bob.briscoe@bt.com</email>
            </address>
        </author>
        <author initials="M." surname="Menth" fullname="Michael Menth">
            <organization>University of Wuerzburg</organization>
            <address>
                <postal>
                    <street>room B206, Institute of Computer Science</street>
                    <street>Am Hubland</street>
                    <city> Wuerzburg</city>
                    <code>D-97074</code>
                    <country>Germany</country>
                </postal>
                <phone>+49 931 888 6644</phone>
                <email>menth@informatik.uni-wuerzburg.de</email>
            </address>
        </author>
        <date day="10" month="February" year="2009"></date>
        <area>Transport</area>
        <workgroup>Congestion and Pre Congestion</workgroup>
        <keyword>Quality of Service</keyword>
        <keyword>QoS</keyword>
        <keyword>Differentiated Services</keyword>
        <keyword>Admission Control</keyword>
        <keyword>Codepoint</keyword>
        <keyword>Protocol</keyword>
        <abstract>
   <t>Pre-congestion notification (PCN) provides information to support 
   admission control and flow termination in order to protect
   the Quality of Service of inelastic flows.  It does this by marking packets 
   when traffic load on a link is approaching or has exceeded a threshold
   below the physical link rate. This document specifies how such marks are to 
   be encoded into the IP header.  The baseline encoding described here provides 
   for only two PCN encoding states. It is designed to be easily extended to
   provide more encoding states but such schemes will be described in other documents.

            </t>
        </abstract>

<!-- ================================================================ -->
</front>

<middle>
<!-- ================================================================ -->
<section anchor="pcn_enc_intro" title="Introduction">
 <t>
   Pre-congestion notification (PCN) provides information to support admission 
   control and flow termination in order to protect the quality of service (QoS) 
   of inelastic flows.  This is achieved by marking packets according to the 
   level of pre-congestion at nodes within a PCN-domain. These 
   markings are evaluated by the egress nodes of the PCN-domain. <xref target="pcn-arch"></xref> 
   describes how PCN packet markings can be used to assure the QoS of inelastic 
   flows within a single DiffServ domain.</t> 
<t>
This document specifies how these PCN marks are encoded into the IP header. 
It also describes how packets are identified as belonging to a PCN flow.  Some 
deployment models require two PCN encoding states, others require more. The baseline 
encoding described here only provides for two PCN encoding states. An extension of the baseline 
   encoding described in <xref target="PCN-3-enc-state"></xref> provides for 
   three PCN encoding states. Other extensions have also been suggested all of which
   can build on the baseline encoding. In order to ensure backward compatibility
   any alternative encoding schemes that claim compliance with PCN standards
   MUST extend this baseline scheme.
     </t>

 <t>
Changes from previous drafts (to be removed by the RFC Editor):
<list style="hanging">
		  <t hangText="From -01 to -02:"> </t>
		  <t> Removed Appendix A and replaced with reference to <xref target="ecn-tunneling"></xref></t>
		  <t> Moved Appendix B into main body of text.</t>
		  <t> Changed Appendix C to give deployment advice.</t>
		  <t> Minor changes throughout including checking consistency of capitalisation of defined terms.</t>
		  <t> Clarified that LU was deliberately excluded from encoding.</t>
        <t hangText="From -00 to -01:"> </t>
        <t>Added section on restrictions for extension encoding schemes.</t>
        <t>Included table in Appendix showing encoding transitions at different PCN nodes.</t>
        <t>Checked for consistency of terminology.</t>
        <t>Minor language changes for clarity.</t>
        <t hangText="Changes from previous filename"> </t>
        <t>Filename changed from draft-moncaster-pcn-baseline-encoding.</t>
        <t>Terminology changed for clarity (PCN-compatible DSCP and PCN-enabled packet).</t>
        <t>Minor changes throughout.</t>
        <t> Modified meaning of ECT(1) state to EXP.</t>
        <t>Moved text relevant to behaviour of nodes into appendix for later transfer to new document on edge behaviours.
        </t>
        <t hangText="From draft-moncaster -01 to -02:">
        </t>
        <t>Minor changes throughout including tightening up language to remain 
        consistent with the PCN Architecture terminology</t>
        <t hangText="From draft-moncaster -00 to -01:">
        </t>
        <t>Change of title from "Encoding and Transport of (Pre-)Congestion Information from within a
        DiffServ Domain to the Egress"</t>
        <t>Extensive changes to Introduction and abstract.</t>
        <t>Added a section on the implications of re-using a DSCP.</t>
        <t>Added appendix listing possible operator scenarios for using this baseline encoding.</t>
        <t>Minor changes throughout.</t>
    </list>
  </t>
</section>
<!-- ================================================================ -->
<section anchor="pcn_enc_Reqs_notation" title="Requirements notation">

    <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119"></xref>.
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_terminology" title="Terminology">

    <t>  The following terms are used in this document:
<list style="symbols">
<t>Not-PCN - packets that are not PCN-enabled.</t>
<t>PCN-marked - codepoint indicating packets that have been marked at a 
PCN-interior-node using some PCN marking behaviour <xref target="pcn-marking-behaviour"></xref>. Also PM.</t>
<t>Not-marked - codepoint indicating packets that are PCN-capable but are not 
PCN-marked. Also NM.</t>
 <t>PCN-enabled codepoints - collective term for all the NM and PM codepoints. 
 By definition packets carrying such codepoints are PCN-packets.</t>
<t>PCN-compatible Diffserv codepoint - a Diffserv codepoint for which the ECN field 
is used to carry PCN markings rather than <xref target="RFC3168"></xref> markings.</t>
</list>
In addition the document uses the terminology defined in <xref target="pcn-arch"></xref>.
</t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_IP" title="Encoding two PCN States in IP">

<t> 
   The PCN encoding states are defined using a combination of the DSCP and ECN 
   fields within the IP header. The baseline PCN encoding closely follows the semantics 
   of ECN [RFC3168]. It allows the encoding of two PCN states: Not-Marked and PCN-Marked. 
   It also allows for traffic that is not PCN capable to be marked as such (Not-PCN). 
   Given the scarcity of codepoints within the IP header the baseline encoding leaves
   one codepoint free for experimental use. The following table defines 
   how to encode these states in IP:</t> 
<texttable anchor="pcn_enc_Tab_Default_coding" title="Encoding PCN in IP">
    <ttcol align="center">ECN codepoint</ttcol>
    <ttcol align="center">Not-ECT (00)</ttcol>
    <ttcol align="center">ECT(0) (10)</ttcol>
    <ttcol align="center">ECT(1) (01)</ttcol>
    <ttcol align="center">CE (11)</ttcol>
    <c>DSCP n</c><c>Not-PCN</c><c>NM</c><c>EXP</c><c>PM</c>
     <postamble>Where DSCP n is a PCN-compatible DiffServ codepoint (see <xref target="pcn_enc_DSCPs"></xref>) 
     and EXP means available for Experimental use. N.B. we deliberately reserve this codepoint for experimental 
     use only (and not local use) to prevent any possible future compatability issues.</postamble>
 </texttable>

 <t>
The following rules apply to all PCN traffic:
<list style="symbols">
      <t>PCN-traffic MUST be marked with a PCN-compatible DiffServ Codepoint. To conserve DSCPs, 
      DiffServ Codepoints SHOULD be chosen that are already defined for use with 
      admission controlled traffic, such as the Voice-Admit codepoint defined in 
      <xref target="voice-admit"></xref>. Guidelines for mixing traffic-types within
      a PCN-domain are given in <xref target="pcn-marking-behaviour"></xref>.</t>

      <t>Any packet that is not PCN-enabled (Not-PCN) but which shares the same 
      DiffServ codepoint as PCN-enabled traffic MUST have the ECN field equal to 00.  </t>

      </list> 
</t>
<t> The following table sets out the valid and invalid codepoint transitions at 
PCN-nodes for this baseline encoding. Extension encodings may have different rules
regarding the validity of the transitions.
 Note that this table assumes there is a functional separation between a PCN-boundary-node 
 and a PCN-interior-node such that PCN-boundary-nodes do not perform packet metering or
 marking functions. PCN-nodes MUST follow the encoding transition rules set out 
 in this table (e.g. they MUST NOT set invalid codepoints on packets they forward).
 This table only applies to PCN-packets.
<artwork>
+-----------+-------------+-----------------+-----------------------+
| PCN node  |  Codepoint  | Valid codepoint | Invalid codepoint out |
|   type    |      in     |        out      |                       |
+-----------+-------------+-----------------+-----------------------+
|  ingress  |     Any     | NM (or Not-PCN) |          PM           |
| interior  |     NM      |     NM or PM    |     Not-PCN or EXP    |
| interior  |     EXP +   |     EXP or PM   |        Not-PCN        |
| interior  |   Not-PCN   |      Not-PCN    |  Any other codepoint  |
| interior  |     PM      |        PM       |  Any other codepoint  |
|  egress   |     Any     |        00       | Any other codepoint * |
+-----------+-------------+-----------------+-----------------------+
 + This SHOULD cause an alarm to be raised at a higher layer. The
   packet MUST be treated as if it were NM.
 * Except where the egress node knows that other marks may be safely
   exposed outside the PCN-domain (e.g. [PCN-3-enc-state]).

         Table 2: Valid and Invalid Codepoint Transitions for
                     PCN-packets at PCN-nodes         
       </artwork>     </t>
<t>
If a pcn-interior-node compliant with this baseline encoding receives a
 </t>
<!-- ================================================================ -->
<section anchor="pcn_enc_rationale" title="Rationale for Encoding">

<t> 
 The exact choice of encoding was dictated by the constraints imposed by existing 
 IETF RFCs, in particular <xref target="RFC3168"></xref>, <xref target="RFC4301"></xref> and 
 <xref target="RFC4774"></xref>. One of the tightest constraints was 
 the need for any PCN encoding to survive being tunnelled through either an 
 IP in IP tunnel or an IPSec Tunnel. <xref target="ecn-tunneling"></xref> 
 explains this in more detail. The main effect of this constraint is that any PCN 
 marking has to carry the 11 codepoint in the ECN field. If the packet is 
 being tunneled then only the 11 codepoint gets copied into the inner header upon 
 decapsulation. An additional constraint is the need to minimise the use of DiffServ 
 codepoints as there is a limited supply of standards track codepoints remaining. 
 <xref target="pcn_enc_DSCPs"></xref> explains how we have minimised this still 
 further by reusing pre-existing Diffserv codepoint(s) such that non-PCN traffic 
 can still be distinguished from PCN traffic. There are a number of factors that
 were considered before deciding to set 10 as the NM state. These included similarity to 
 ECN, presence of tunnels within the domain, leakage into and out of PCN-domain and
 incremental deployment.
</t><t>
The encoding scheme above seems to meet all these constraints and ends up looking very similar to ECN. This is 
perhaps not surprising given the similarity in architectural intent between PCN and ECN. 

</t>

</section>
<!-- ================================================================ -->
<section anchor="pcn_enc_DSCPs" title="PCN-Compatible DiffServ Codepoints">

<t> 
 Equipment complying with the baseline PCN encoding MUST allow PCN to be enabled 
 for certain Diffserv codepoints. This document defines the term 
 "PCN-compatible Diffserv codepoint" for such a DSCP. Enabling PCN for a DSCP 
 switches on PCN marking behaviour for packets with that DSCP, but only if those 
 packets also have their ECN field set to indicate a codepoint other than Not-PCN.
 </t> <t>
Enabling PCN marking behaviour disables any other marking behaviour (e.g. enabling 
PCN  disables the default ECN marking behaviour introduced in 
<xref target="RFC3168"></xref>). All traffic scheduling and conditioning behaviours are discussed in 
<xref target="pcn-marking-behaviour"></xref>. This ensures compliance with the 
BCP guidance set out in <xref target="RFC4774"></xref>.

</t>

</section>
 <!-- ================================================================ -->

</section>      
<section anchor="pcn_enc_experiments" title="Rules for Experimental Encoding Schemes">
<t>
Any experimental encoding scheme MUST follow these rules to ensure backward compatibility
with this baseline scheme: 
<list style="symbols">
<t>The 00 codepoint in the ECN field MUST mean Not-PCN.
</t>
<t>The 11 codepoint in the ECN field MUST mean PCN-marked (though this doesn't 
exclude other codepoints from carrying the same meaning).
</t>
<t>Once set the 11 codepoint in the ECN field MUST NOT be changed to any other codepoint.
</t>
<t>Any experimental scheme MUST include details of all valid and invalid codepoint 
transitions at any PCN nodes.</t>
</list>
</t>
</section>

<section anchor="pcn_enc_compat" title="Backwards Compatibility">

<t>  BCP 124 <xref target="RFC4774"></xref> gives guidelines for specifying 
alternative semantics for the ECN field. It sets out a number of factors to be 
taken into consideration. It also suggests various techniques to allow 
the co-existence of default ECN and alternative ECN semantics. The baseline encoding 
specified in this document defines PCN-compatible DiffServ codepoints as no longer 
supporting the default ECN semantics. As such this document is compatible with 
BCP 124. It should be noted that this baseline encoding effectively disables end-to-end ECN 
except where mechanisms are put in place to tunnel such traffic across the PCN-domain. 
</t>

</section>

<!-- ================================================================ -->

<!-- ================================================================ -->
<section title="IANA Considerations">
    <t>This document makes no request to IANA. 
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_security" title="Security Considerations">
    <t>Packets claim entitlement to be PCN marked by carrying a PCN-Compatible DSCP 
    and a PCN-Enabled ECN codepoint. This encoding document is intended to stand 
    independently of the architecture used to determine whether specific packets 
    are authorised to be PCN marked, which will be described in a future separate 
    document on PCN edge-node behaviour. 
    </t>
    <t>The PCN working group has initially been 
    chartered to only consider a PCN-domain to be entirely under the control of
    one operator, or a set of operators who trust each other 
    <xref target="PCN-charter"></xref>. However there is a requirement to 
    keep inter-domain scenarios in mind when defining the PCN encoding. One way to 
    extend to multiple domains would be to concatenate PCN-domains and use 
    PCN-boundary-nodes back to back at borders. Then any one domain's security 
    against its neighbours would be described as part of the proposed edge-node behaviour document.
     </t>
    <t>One proposal on the table allows one to extend PCN across multiple domains without
    PCN-boundary-nodes back-to-back at borders <xref target="re-PCN"></xref>. It is 
    believed that the encoding described here would be compatible with the security 
    framework described there.

    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_Conclusions" title="Conclusions">

    <t>This document defines the baseline PCN encoding utilising a combination of a 
    PCN-enabled DSCP and the ECN field in the IP header. This baseline encoding 
    allows the existence of two PCN encoding states, not-Marked and PCN-Marked. 
    It also allows for the co-existence of competing traffic within 
    the same DSCP so long as that traffic doesn't require end-to-end ECN support.
    The encoding scheme is conformant with <xref target="RFC4774"></xref>. 
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_Acknowledgements" title="Acknowledgements">

    <t>This document builds extensively on work done in the PCN working group by 
    Kwok Ho Chan, Georgios Karagiannis, Philip Eardley, Anna Charny, Joe Babiarz and others. 
    Thanks to Ruediger Geib for providing detailed comments on this document.
    </t>

</section>
<!-- ================================================================ -->
<section anchor="pcn_enc_Comments_Solicited" title="Comments Solicited">

    <t>Comments and questions are encouraged and very welcome. They can be 
    addressed to the IETF congestion and pre-congestion working group mailing 
    list &lt;pcn@ietf.org&gt;, and/or to the authors.
    </t>

</section>
    </middle>
    <back>
<!-- ================================================================ -->
<references title="Normative References">
  
    <?rfc include="refs/reference.RFC.2119" ?>
    <?rfc include="refs/reference.RFC.4774" ?>
    

</references>

<references title="Informative References">
    <?rfc include="refs/reference.I-D.ietf-pcn-architecture"    ?>
    <?rfc include="refs/reference.RFC.3168" ?>
    <?rfc include="refs/reference.RFC.4301" ?>
    <?rfc include="refs/reference.RFC.5127" ?>
    <?rfc include="refs/localref.I-D.briscoe-re-pcn-border-cheat" ?>
    <?rfc include="refs/localref.PCN-charter"?>

    <?rfc include="refs/reference.I-D.ietf-tsvwg-admitted-realtime-dscp"    ?>
    <?rfc include="refs/localref.I-D.draft-moncaster-pcn-3-state-encoding-00"  ?>
    <?rfc include="refs/reference.I-D.ietf-tsvwg-ecn-tunnel"  ?>
    <?rfc include="refs/reference.I-D.ietf-pcn-marking-behaviour"  ?>
</references>
<section anchor="pcn_enc_app_deployment" title="PCN Deployment Considerations">
<section anchor="pcn_enc_app_DSCP_choice" title ="Choice of Suitable DSCPs">
<t>The choice of which DSCP is most suitable for the PCN-domain is dependant on the nature of the traffic entering that domain and the link rates of all the links making up that domain. In PCN-domains with uniformly high link rates, the appropriate DSCPs would currently be those for the Real Time Traffic Class <xref target="RFC5127"></xref>. If the PCN domain includes lower speed links it would also be appropriate to use the DSCPs of the other traffic classes that <xref target="voice-admit"></xref> defines for use with admission control, such as the three video classes CS4, CS3 and AF4 and the Admitted Telephony Class.
</t></section>
<section anchor="pcn_enc_app_rationale" title="Rationale for Using ECT(0) for Not Marked">
<t> The choice of which ECT codepoint to use for the Not Marked state was based on the following considerations: 
<list style="symbols">
<t><xref target="RFC3168"></xref> full functionality tunnel within PCN-domain: Either ECT is safe.</t>
<t> Leakage of traffic into PCN-domain: ECT(1) is less often correct.</t>
<t> Leakage of traffic out of PCN-domainL Either ECT is equally unsafe (since this would incorrectly indicate the traffic was ECN capable outside the controlled PCN-domain).</t>
<t> Incremental deployment: Either ECT is suitable  as long as they are used consistently.</t>
<t> Conceptual consistency with other schemes: ECT(0) is conceptually consistent with <xref target="RFC3168"></xref>.</t>
</list>
</t>
</section>
</section>
</back>
</rfc>
