<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc3667.dtd">
<?rfc toc='yes'?>
<?rfc tocdepth='4'?>
<?rfc compact="yes"?>
<!--rfc category="info" ipr="full3978"-->
<rfc category="std" ipr='trust200902'>
	<front>
		<title abbrev="SIP Recording Metadata">Session Initiation Protocol (SIP) Recording Metadata</title>
		   <author initials="Ram Mohan" surname="Ravindranath" fullname="Ram Mohan Ravindranath">
			<organization>Cisco Systems, Inc.</organization>
			<address>
				<postal>
					<street>Cessna Business Park,</street>
                                        <street>Kadabeesanahalli Village, Varthur Hobli,</street>
                                        <street>Sarjapur-Marathahalli Outer Ring Road</street>
					<city>Bangalore</city>
					<region>Karnataka</region>
					<code>560103</code>
					<country>India</country>
				</postal>
				<email>rmohanr@cisco.com</email>
			</address>
		    </author>
                <author initials="Parthasarathi" surname="Ravindran" fullname="Parthasarathi Ravindran">
			<organization>Sonus Networks</organization>
			<address>
				<postal>
					<street>Prestige Shantiniketan - Business Precinct</street>
                              <street>Whitefield Road</street>          
					<city>Bangalore</city>
					<region>Karnataka</region>
					<code>560066</code>
					<country>India</country>
				</postal>
				<email>pravindran@sonusnet.com</email>
			</address>
		</author>
		<author initials="Paul" surname="Kyzivat" fullname="Paul Kyzivat">
			<organization>Unaffiliated</organization>
			<address>
				<postal>
					<region>Boxborough, MA</region>
					<country>USA</country>
				</postal>
				<email>pkyzivat@alum.mit.edu</email>
			</address>
		</author>
		<date year="2011" />
		<area>Transport</area>
		<workgroup>SIPREC</workgroup>
		<abstract>
			<t>
				Session recording is a critical requirement in many communications environments such as call centers and financial trading. In some of these environments, all calls must be recorded for regulatory, compliance, and consumer protection reasons.  Recording of a session is typically performed by sending a copy of a media stream to a recording device.  This document describes the metadata model as viewed by Session Recording Server(SRS) and the Recording metadata format.
			</t>
		</abstract>
	</front>
	<middle>

 <section title="Introduction">
			<t>
				Session recording is a critical requirement in many communications environments such as call centers and financial trading.  In some of these environments, all calls must be recorded for regulatory, compliance, and consumer protection reasons.  Recording of a session is typically performed by sending a copy of a media stream to a recording device. This document focuses on the Recording metadata which describes the communication session. The document describes a metadata model as viewed by Session Recording Server and the Recording metadata format, the requirements for which are described in <xref target="RFC6341"/> and the architecture for which is described in <xref target="I-D.ietf-siprec-architecture"/>.
			</t>
		</section>

		<section title="Terminology" anchor="sec-term">
			<t>
				The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
				"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
				document are to be interpreted as described in <xref target="RFC2119"/>.  This
				document only uses these key words when referencing normative
				statements in existing RFCs."

			</t>
		</section>
		<section title="Definitions">
			<t>
				Metadata Model: The Metadata model is a class diagram in Unified Modelling Language(UML). The model is a structure diagram that describes the structure of a recording's Metadata by showing the classes, their attributes, and the relationships among the classes. Each block in the model above represents a class. The linkages between the classes represents the relationships between the classes. Object diagrams represents instance diagrams of the class diagram and conveys snapshot of metadata.
			</t>
			<t>Metadata classes: Each block in the model represents a class. In the metadata model each class is represented as a block having the block name. The description of each class also has representation of its attributes in a second compartment below the class name. Each instance of a class(namely the object) contributes some information to the recording's Metadata. </t>
			<t>Attributes: Attributes represents the attributes listed in each of the classes. The attributes of a class are listed in the second compartment below the class name. Each instance of class conveys values for these attributes which adds to the recording's Metadata.</t>
			<t>Linkages: Linkages represents the relationship between the classes in the model. It represents the logical connections betweens classes(or objects) in  class diagrams/ object diagrams. The linkages can be associations or composition in the Metadata model of this document. An association represents a family of links. Binary associations (with two ends) are normally represented as a line, with each end connected to a class/object box. An association can be named, and the ends of an association can be adorned with role names, ownership indicators, multiplicity, visibility, and other properties. For instance, in the metadata model we have "sends" association between participant and media stream classes.The relation composition represents owns/holds relationship to show classes contained in another class. For instance, extension data class is contained in one of the other class(like stream or participant or any of the other in the model).The UML graphical representation of a composition relationship is a filled diamond shape on the containing class end of the tree of lines that connect contained class(es) to the containing class. </t>
			<t>XML element: An XML element represent one XML schema complexType element (xs:complexType) of XML schema </t>
			<t>XML attributes: An XML attribute represent one XML schema element (xs:element) of XML schema</t>
		</section>
		<section title ="Metadata Model">
			<t>
				Metadata is the information that describes recorded media and the CS to which they relate. Below diagram shows a model for Metadata as viewed by Session Recording Server (SRS).
			</t>
			<artwork>
				<![CDATA[


+-------------------------------+       1        
| Recording Session (RS)        |---------------+               
+-------------------------------+               |
      |1..*           | 1..*                    |
      |               |                         |
      |               | 0..*                    |
      |        +-----------------+              |
      |        | Communication   |              |
      |        |  Session (CS)   |      1       |
      |        |    Group        |--------------|
      |        +-----------------+              |         
      |              | 0..1                     |
      |              |                          |
      |0..*          | 1..*                     |
+-------------------------------+               |
|   Communication Session (CS)  |       1       |
|                               |---------------|
+-------------------------------+               |       +------------+
      | 1..*                 |1..*              |       |            |
      |                      |                  |  0..* |Extension   |
      | 2..*                 |0..*              |/\_____| Data       |
+-------------+ receives +----------------+     |\/     |            |
| Participant |----------|  Media Streams |     |       +------------+
|             |0..*  0..*|                |     |
|             |          |                |     |
|             |          |                |     |
|             |  sends   |                |     |
|             |----------|                |     |
|             |1.*   0..*|                |     |
+-------------+          +----------------+     |
       |                         |              |
       |1                        |1             |
       |                         |              |
       +----------------------------------------+           
      
      
				 ]]>
</artwork>
<t>
	The Metadata model is a class diagram in Unified Modelling Language(UML). The model is a structure diagram that describes the structure of a recording's Metadata by showing the classes, their attributes, and the relationships among the classes. Each block in the model above represents a class. The linkages between the classes represents the relationships which can be associations or Composition. Session Recording Client (SRC) MAY initiate the Recording Session.
	Here, Recording Session is a completely independent from the Communication Session that is being recorded at both the SIP dialog level and at the session level. The metadata MUST be conveyed from SRC to SRS.
</t>

<t>	The model allows the capture of a snapshot of a recording's Metadata at a given instant in time. Metadata changes to reflect changes in what is being recorded. For example, if the call is transferred from one participant to another, then the SRC conveys the changes in the model ( In this instance change of participant and the properties of the new media stream) to the SRS.</t>
<t> Some of the metadata is not required to be conveyed explicitly from the SRC to the SRS, if it can be obtained contextually by the SRS. For instance, the timing of RS object changes(like Start / Stop time) may not be explicitly conveyed from the SRC to the SRS (The Date header in RS dialog SIP message provides the timing, but it is optional). In such cases the time a change occurred may be assumed to be the same as the time when notification of the change is received by the SRS. This is not true in cases where SRS requests a snapshot of metadata from SRC.</t>
		</section>
		<section title ="Recording Metadata Format">
                 <t>
					 This section gives an overview of Recording Metadata Format. Some data from the metadata model is assumed to be made available to the SRS through Session Description Protocol (SDP)<xref target="RFC4566"/>, and therefore this data is not represented in the XML document format specified in this document. SDP attributes describes about different media formats like audio, video. The other metadata attributes like participant details are represented in a new Recording specific XML document namely application/rs-metadata+xml. The SDP label attribute <xref target="RFC4574"/> provides an identifier by which a metadata XML document can refer to a specific media description in the SDP sent from the SRC to the SRS.
                 </t>
                 <t>
					 The XML document format can be used to represent either the complete metadata or a partial update to the metadata. The latter includes only elements that have changed compared to the previously reported metadata.
				 </t>
                 <section title="XML data format">
       			<t>
Recording Metadata document is an XML document. recording element MUST present in all recording metadata XML document. recording acts as container for all other elements in this XML document. 
				</t> 
<t>
Recording object is a XML document. It MUST have the XML declaration and it SHOULD contain an encoding declaration in the XML declaration, e.g., <![CDATA[ "<?xml version='1.0' encoding='UTF-8'?>". ]]> If the charset parameter of the MIME content type declaration is present and it is different from the encoding declaration, the charset parameter takes precedence.
				</t>
                         <t>
Every application conforming to this specification MUST accept the UTF-8 character encoding to ensure the minimal interoperability.
				</t>
                        <t>
Syntax and semantics error in recording XML document has to be informed to the originator using application specific mechanism.
                        </t>
 <section title="Namespace">
				<t>
  The namespace URI for elements defined by this specification is a Uniform Resource Namespace (URN) <xref target="RFC2141"/>, using the namespace    identifier 'ietf' defined by <xref target="RFC2648"/> and extended by <xref target="RFC3688"/>.
				</t>
                        <t>
The URN is as follows: urn:ietf:params:xml:ns:recording
				</t>
                    </section>
                       <section title="recording">
				<t>
recording element MUST contain an xmlns namespace attribute with value as urn:ietf:params:xml:ns:recording. One recording element MUST present in the all recording metadata XML document.
				</t>
	                 <t>
dataMode element shows whether the XML document is complete document or partial update. The default value is complete.
                       </t>
                       </section>
		</section>
            </section>
		<section title="Recording Metadata classes">
			<t>
				This section describes each class of the metadata model, and the attributes of each class. This section also describes how different classes are linked and the XML element for each of them.</t>
			<section title="Recording Session">
				<artwork>
					<![CDATA[
+-------------------------------+               
| Recording Session (RS)        |               
+-------------------------------+               
|                               |            +-----------------+
|     Start/End Time            |    1  0..* |                 |
|                               |/\__________|Extension Data   |
|                               |\/          |                 |
|                               |            +-----------------+
+-------------------------------+ 
      |1..*            | 1..* 
      |                |      
      |0..*            | 0..* 
 Communication    Communication 
 Session          Session Group(CS Group)
					]]>
				</artwork>
				<t>Each instance of a Recording Session class (namely the Recording Session Object) represents a SIP session created between an SRC and SRS for the purpose of recording a Communication Session. </t>
				
			<section title="Attributes">
				<t> A Recording Session class has the following attributes:</t>
				<list style='symbols'>
					<t> Start/End Time - Represents the Start/End time of a Recording Session object. </t>
				</list> 
								
				</section>
				<section title="Linkages">
					<t>Each instance of Recording Session has:</t>
					<t>
						<list style='symbols'>
							<t>Zero or more instances of  Communication Session Group. CSG may be zero because it is optional metadata object. Also the allowance of zero instances is to accommodate persistent recording, where there may be none.</t>
							<t>Zero or more instances of Communication Session objects.</t>
						</list>
					</t>
				</section>
				<section title="XML element">
					<t>Recording Session object is represented by recording XML element. That in turn relies on the SIP/SDP session with which the XML document is associated to provide some of the attributes of the Recording Session element. </t>
					<t>Start and End time value are derivable from Date header(if present in SIP message) in RS. In cases where Date header is not present, Start/End time are derivable from the time at which SRS receives the notification of SIP message to setup RS / disconnect RS. </t>
				</section>
			</section>
			<section title="Communication Session Group">
				<artwork>
					<![CDATA[
 Recording Session (RS)
           | 1..*
           | 
           | 0..* 
+-------------------------------+               
| Communication Session         |
|     Group                     |               
+-------------------------------+               
|  Unique-ID                    |           +----------------+
|  associate-time               |   1  0..* |                |
|  disassociate-time            |/\_________|Extension Data  |
|                               |\/         |                |
+-------------------------------+           +----------------+
           | 0..1                               
           |                                    
           | 1..*                               
 Communication Session (CS)
					]]>
				</artwork>
			
				<t>
					One instance of a Communication Session Group class (namely the Communication Session Group object) provides  association or linking of Communication Sessions.
				</t>
				<section title="Attributes">
					<t> A CS Group has the following attributes: </t>
					<list style='symbols'>
						<t>Unique-ID - This Unique-ID is to group different CSs that are related. SRC (or SRS) is responsible for ensuring the uniqueness of Unique-ID in case multiple SRC interacts with the same SRS. The mechanism by which SRC groups the CS is outside the scope of SIPREC. </t>
						<t>Associate-time - Associate-time for CS-Group shall be calculated by SRC  as the time when a grouping is formed. The rules that determine how a grouping of different Communication Session objects is done by SRC is outside the scope of SIPREC.</t>
						<t>Disassociate-time - Disassociate-time for CS-Group shall be calculated by SRC as the time when the grouping ends</t>
					</list>
				</section>
				<section title="Linkages">
					<t>The linkages between Communication Session Group class and other classes is association. A communication Session Group is associated with RS and CS in the following manner:</t>
					<t>
						<list style='symbols'>
							<t> There is one or more Recording Session objects per Communication Session Group. </t>
							<t>Each Communication Session Group object has to be associated with one or more RS [Here each RS can be setup by the potentially different SRCs] </t>
							<t> There is one or more Communication Sessions per CS Group [e.g. Consult Transfer]</t>
						</list>
					</t>
				</section>
                  	<section title="XML element">
					 <t>
					 Group element is an optional element provides the information about the communication session group
					 </t>
                               <t>
Each communication session group (CSG)object is represented using one group element. Each group element has unique URN UUID attribute which helps to uniquely identify CSG. 
			        	</t>
                        </section>
			</section>

			<section title="Communication Session">
				<artwork>
					<![CDATA[
 
Recording	       Communication 
Session            Session Group(CS Group)
   |1..*                  | 0..1
   |                      | 
   |0..*                  | 1..* 
+-------------------------------+               +-----------------+
|   Communication Session (CS)  |       1  0..* |                 |
|                               |/\_____________|Extension Data   |
+-------------------------------+\/             |                 |
|   CS Identifier               |               +-----------------+
|   Termination Reason          |
|   Start Time                  |
|   End Time                    |
+-------------------------------+
   |                      |
   | 1..*                 |1..*              
   |                      |                  
   | 2..*                 |0..*              
Participant              Media Stream

					]]>
				</artwork>
				<t>A Communication Session class and its object in the metadata model represents Communication Session and its properties needed as seen by SRC. </t>
				
				<section title="Attributes">
					<t> A communication Session class has the following attributes:</t>
					<t>
						<list style='symbols'>
							<t>Termination Reason - This represents the reason why a CS was terminated. The communication session MAY contain a Call Termination Reason. This MAY be derived from SIP Reason header of CS.</t>
							<t>CS Identifier - This attribute is used to uniquely identify a CS.</t>
							<t>Start Time - This optional attribute represents CS start time</t>
							<t>End Time - This optional attribute represents CS end time</t>
						</list>	
					</t>
					<t>This document does not specify attributes relating to what should happen to a recording of a CS after it has been delivered to the SRS, e.g., how long to retain the recording, what access controls to apply. The SRS is assumed to behave in accordance with policy. The ability for the SRC to influence this policy is outside the scope of this document. However if there are implementations where SRC has enough information, this could be sent as Extension Data attached to CS</t>
					</section>
				<section title="Linkages">
					<t>
						A Communication Session is linked to CS-Group, Participant, Media Stream and Recording Session classes using the association relationship. Association between CS and Participant allows:
					</t>
					<t>
						<list style='symbols'>
							<t>CS to have atleast two or more participants</t>
							<t>Participant is associated with one or more CS’s. This includes participants who are not directly part of any CS. An example of such a case is participants in a premixed media stream. The SRC may have knowledge of such Participants, yet not have any signaling relationship with them. This might arise if one participant in CS is a conf focus. To summarize even if SRC does not have direct signalling relationships with all participants in a CS, it should nevertheless create a Participant object for each participant that it knows about</t>
							<t>The model also allows participants in CS that are not participants in the media. An example is the identity of a 3pcc controller that has initiated a CS to two or more participants of the CS. Another example is the identity of a conference focus. Of course a focus is probably in the media, but since it may only be there as a mixer, it may not report itself as a participant in any of the media streams.</t>
						</list>
					</t>
					<t>Association between CS and Media Stream allows:</t>
					<t>
						<list style='symbols'>
							<t>A CS to have zero or more Streams</t>
							<t>
								A stream can be associated with 1 or more CS. An example is multicast MoH stream which might be associated with many CSs.</t>
						</list>
					</t>
					<t>Association between CS and RS allows:</t>
					<t>
						<list style='symbols'>
							<t>Each instance of RS has Zero or more instances of Communication Session objects.</t>
							<t>Each CS has to be associated with one more RS [ Here each RS can be potentially setup by different SRCs]</t>
						</list>
					</t>
				</section>
                  	<section title="XML element">
					 <t>
					 Session element provides the information about the communication session
					 </t>
                               <t>
Each communication session(CS) object is represented by one session element. Each session element has unique URN UUID attribute which helps to uniquely identify CS. 
				      </t>
                              <t>
								  Reason element MAY be included to represent the Termination Reason attribute. group-ref element MAY exist to indicate the group where the mentioned session belongs.
							  </t>
                        </section>
			</section>

			<section title="Participant">
				<artwork>
					<![CDATA[
 Communication Session (CS)
           | 1..*
           | 
           | 2..* 
+-------------------------------+               
|          Participant          |
|                               |               
+-------------------------------+               
|  AoR list                     |            +-----------------+
|  Name                         |    1  0..* |                 |
|  Associate time               |/\__________|Extension Data   |
|  Disassociate time            |\/          |                 |
|  Capabilities                 |            |                 | 
+-------------------------------+            +-----------------+
        | 0..*       1..*|                            
receives|                |sends                    
        | 0..*       0..*|                        
          Media Stream
		  
]]>
				</artwork>	
				<t>
					A Participant class and its objects has information about a device that is part of a CS and/or contributes/consumes media stream(s) belonging to a CS.</t>
				<section title="Attributes">
					<t> Participant has attributes like:</t>
					<t>
					<list style='symbols'>
						<t>AoR list - Has list of AoRs. An AoR MAY be SIP/SIPS/TEL URI. There are cases where a participant can have more than one AoR [ e.g. P-Asserted-ID which can have both SIP and TEL URIs]</t>
						<t>Name - This attribute represents Participant name(SIP display name) or DN number ( in case it is known)</t>
						<t>Associate-time - associate-time is calculated by SRC as the time it sees a participant is associated to CS</t>
						<t>Disassociate-time- Disassociate-time is calculated by SRC as the time it see a participant disassociate from a CS. It is possible that a given participant can have multiple associate/disassociate times within given communication session. </t>
						<t>Capabilities - A participant capabilities as defined in RFC 3840 <xref target="RFC3840"/> is an optional attribute that includes the capabilities of a participant in a CS. This attribute is an attribute of association of participant to CS. Each participant shall have Zero or more capabilities. A participant may use different capabilities depending on the role it plays at a particular instance. IOW if a participants moves across different CSs ( due to transfer e.t.c) OR is simultaneously present in different CSs its role may be different and hence the capability used.</t>
					</list>
					<t>NOTE: How to represent capabilities attribute in XML is an open item.</t>	
					<t>This document does not specify other attributes relating to participant e.g. Participant Role, Participant type. An SRC which has information of these attributes can indicate the same as part of extension data to Participant from SRC to SRS.</t>
					</t>
				</section>
				<section title="Linkages">
					<t>The participant class is linked to MS and CS class using association relationship. The association between participant and Media Stream allows:</t>
					<t>
					<list style='symbols'>
						<t> Participant to receives zero or more media streams</t>
						<t> Participant to send zero or more media streams. (Same participant provides multiple streams e.g. audio and video)</t>
						<t>	Media stream to be received by zero or more participants. Its possible, though perhaps unlikely, that a stream is generated but sent only to the SRC and SRS, not to any participant. E.g. In conferencing where all participants are on hold and the SRC is collocated with the focus. Also a media stream may be received by multiple participants (e.g. Whisper calls, side conversations).</t>
						<t>	Media stream to be sent by one or more participants (pre-mixed streams).</t>
					</list>
					<t>
						Example of a case where a participant receives Zero or more streams - a Supervisor may have side conversation with Agent, while Agent converses with customer.
					</t>
					</t>
				</section>
      	            <section title="XML element">
					 <t>
						 A participant element represents a Participant object.
					 </t>
                    <t>
						 There MUST be atleast 2 participant for any given session. "send" or "recv" element in each participant is associating SDP m-lines with the participant. send element indicates that participant is sending the stream of media with the mentioned media description. recv element indicates that participant is receiving the stream and by default all participant will receive the stream. recv element has relevance in case whisper call scenario wherein few of the participant in the session receives the stream and not others. 
					</t>
                     <t>
						 Participant MUST have AOR element which contains SIP/SIPS URI to identify the participant. AOR element is SIP/SIPS URI FQDN or IP address which represents the user. name is an optional element to represent display name.
					</t>
                    <t>
						Each participant element has unique URN UUID attribute which helps to uniquely identify participant and session URN UUID to associate participant with specific session element. URN UUID of participant *MUST* used in the scope of CSG and no new URN UUID has to be created for the same element (participant, stream) between different CS in the same CSG. In case URN UUID has to be used permanent, careful usage of URN UUID to original AoR has to be decided by the implementers and it is implementer's choice.
					</t>
                    </section>
			</section>
			
			<section title="Media Stream">
				<artwork>
					<![CDATA[
                              Participant			
                            | 0..*       1..*|                            
                    receives|                |sends                    
                            | 0..*       0..*|                        
                         +-------------------------+               
                         |          Media Stream   |
                         |                         |               
Communication 1..*  0..* +-------------------------+               
  Session    ------------|                         |        +----------+
                         |  Media Stream Reference |1  0..* |          |
                         |  Content-type           |/\______|Extension |
                         |  CSRC                   |\/      | Data     |
                         +-------------------------+        +----------+
					]]>
				</artwork>
				<t>A Media Stream class (and its objects) has the properties of media as seen by SRC and sent to SRS. Different snapshots of media stream object may be sent whenever there is a change in media (e.g. dir change like pause/resume and/or codec change and/or participant change.).</t>
				<section title="Attributes">
					<t>A Media Stream class has the the following attributes:</t>
					<t>
						<list style='symbols'>
							<t>Media Stream Reference - In implementations this can reference to m-line </t>
							<t>Content - The content of an MS element will be described in terms of value from the RFC 4796 <xref target="RFC4796"/> registry.</t>
							<t>CSRC - The linkage between the participants to its contributing media stream in a mixed RS stream is provided by CSRC attribute. Not all SRC may have the capability to determine this and hence this is a optional attribute. Having this info can allow the SRS to  determine which participants are part(contributors) of particular parts of the mixed stream.</t>
						</list>
						<t>
							NOTE: How CSRC can be represented in XML is still an open item. CSRC attribute is an attribute of media stream to participant association. Another open items if there is a need for multiple CSRCs. A participant may have multiple CSRCs - potentially a different one for each stream in which it participates.</t>
					</t>
					<t>The metadata model should include media streams that are not being delivered to the SRS. Examples include cases where SRC offered certain media types but SRS chooses to accept only a subset of them OR an SRC may not even offer a certain media type due it its restrictions to record</t>
				</section>
			<section title="Linkages">
				<t>A Media Stream is linked to participant and CS classes using the association relationship. The details of association with the Participant are described in the Participant class section. The details of association with CS is mentioned in the CS section. </t>
			</section>
	            <section title="XML element">
				 <t>
				    stream element represents a Media Stream object. Stream element indicates SDP media lines associated with the session and participants.
				 </t>
                 <t>
					 This element indicates the SDP m-line properties like label attributes, media mode. Label attribute is used to link m-line SDP body using label attribute in SDP m-line. The media mode helps in understanding whether the media is mixed or not.
 				</t>
				<t>
					Each stream element has unique URN UUID attribute which helps to uniquely identify stream and session URN UUID to associate stream with specific session element.</t>
					<t>The content attribute if an SRC wishes to send is conveyed in RS SDP.</t>
               </section>
			</section>
					
			<section title="Extension Data">
				<t>A recording metadata object contains additional data not specified as part of siprec. This is intended to accommodate future standards track extensions, as well as vendor and user specific extensions. The mechanism MUST provide a means of unambiguously distinguishing such extension data. </t>
				<section title="Linkages">
					<t>Extension data class is linked to other classes using the composition relationship. An extension data class ( and its objects)  is contained/owned by another Metadata class. Each instance of Metadata class(except extension data class itself) has</t>
					<t>
						<list style='symbols'>
							<t>Zero or more instances of Extension data class</t>
							<t>Each Extension data class is contained/owned by a Metadata class other than itself</t>
						</list>
					</t>
				</section>
            	<section title="XML element">
				   <t>
				     Extensiondata element provides the mechanism by which namespace/element MAY be extended with standard or proprietary information.
				   </t>
					<t>
						extensiondata element MUST include any other XML namespace. Multiple namespace MAY exists under extensiondata. extensiondata element exist in each level like recording, session, participant, stream to provide extensiondata specific to each element. extensiondata element MUST be part of parent element for which the additional information is sent and hence no Unique ID is needed.
					</t>
                   </section>
			</section>
 		      <section title="associate-time/disassociate-time">
				<t>
					associate-time/disassociate-time contains a string indicating the date and time of the status change of this tuple.  The value of this element MUST follow the IMPP datetime format <xref target="RFC3339"/>.  Timestamps that contain 'T' or 'Z' MUST use the capitalized forms. At a time, any of the time tuple associate-time or disassociate-time MAY exist in the element namely group, session, participant and not both timestamp at the same time.
				</t>
                <t>
					As a security measure, the timestamp element SHOULD be included in all tuples unless the exact time of the status change cannot be determined.
				</t>
		       </section>
			<section title="Unique ID format">
				<t>UUID encoded more densely than the UUID URN (e.g. radix64 of the binary uuid form defined in RFC 4122 <xref target="RFC4122"/>) SHOULD be used as a format for Unique ID. How to represent this id in XML is still an open item.</t>
			</section>
		</section>
<section title="SIP Recording Metadata Example">
	<section title="Complete SIP Recording Metadata Example">
				<t>
					The following example provides all the tuples involved in Recording Metadata XML body.
				</t>
				<figure title="SIP Recording Metadata Example XML body">
					<artwork>
						<![CDATA[ 
<?xml version="1.0" encoding="UTF-8"?>
    <recording xmlns='urn:ietf:params:xml:ns:recording'>
	   <dataMode>complete</dataMode>
       <group id="urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302">
         <associate-time>2010-12-16T23:41:07Z</associate-time>
             <extensiondata>
         <!-- Standardized extension -->
         <call-center xmlns='urn:ietf:params:xml:ns:callcenter'>
           <supervisor>sip:alice@cisco.com</supervisor>
         </call-center>
         <mydata xmlns='http://example.com/my'>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
         </mydata>
       </extensiondata>
       </group>
       <session id="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
         <group-ref>urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302
         </group-ref>
         <start-time>2010-12-16T23:41:07Z</start-time>
            <extensiondata>
         <structure>FOO!</structure>
         <whatever>bar</whatever>
       </extensiondata>
       </session>
       <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
          <aor>sip:partha@blr.cisco.com</aor>
          <send>urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b</send>
          <send>urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17</send>
          <recv>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</recv>
          <recv>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</recv>
          <associate-time>2010-12-16T23:41:07Z</associate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
       </participant>

       <participant
           id="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <aor>sip:paul@box.cisco.com</aor>
           <send>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</send>
           <send>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</send>
           <recv>urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17</recv>
           <recv>urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b</recv>
           <associate-time>2010-12-16T23:41:07Z</associate-time>
                   <extensiondata>
            <structure>FOO!</structure>
            <whatever>bar</whatever>
          </extensiondata>
       </participant>
       <stream id="urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <csrc>1</csrc>
           <label>96</label>
       </stream>
       <stream id="urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <label>97</label>
       </stream>
       <stream id="urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>98</label>
       </stream>
       <stream id="urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>99</label>
       </stream>
  </recording>
                           ]]>
					</artwork>
				</figure>
			</section>
			<section title="Partial Update of Recording metadata XML body">
				<t>
					The following example provides partial update in Recording Metadata XML body for the above example. The example illustrate the disassociate-time for a participant from a session.
				</t>
				<figure title="Partial update of SIP Recording Example XML body">
					<artwork>
						<![CDATA[ 
  <?xml version="1.0" encoding="UTF-8"?>
     <recording xmlns='urn:ietf:params:xml:ns:recording'>
       <dataMode>partial</dataMode>
       <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
          <aor>sip:partha@blr.cisco.com</aor>
           <disassociate-time>2010-12-16T23:41:07Z</disassociate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
       </participant>
     </recording>
                           ]]>
					</artwork>
				</figure>
			</section>
		</section>

		<section title="XML Schema definition for Recording metadata">
<t>
This section defines XML schema for Recording metadata document
</t>
           <artwork> <![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
   <xs:schema targetNamespace="urn:ietf:params:xml:ns:recording"
    xmlns:tns="urn:ietf:params:xml:ns:recording"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified">
   <!-- This import brings in the XML language attribute xml:lang-->
   <xs:import namespace="http://www.w3.org/XML/1998/namespace"/>
   <xs:element name="recording" type="recording"/>
   <xs:complexType name="recording">
       <xs:sequence>
           <xs:element name="datamode" type="dataMode"
                minOccurs="0"/>
         <xs:element name="group" type="group"
                minOccurs="0" maxOccurs="unbounded"/>
           <xs:element name="session" type="session"
                minOccurs="0" maxOccurs="unbounded"/>
           <xs:element name="participant" type="participant"
                minOccurs="0" maxOccurs="unbounded"/>
           <xs:element name="stream" type="stream"
               minOccurs="0" maxOccurs="unbounded"/>
         <xs:element name="extensiondata" type="extensiondata"
               minOccurs="0" maxOccurs="unbounded"/>
       </xs:sequence>
   </xs:complexType>
   <xs:complexType name="group">
       <xs:sequence>
         <xs:element name="associate-time" type="xs:dateTime"
            minOccurs="0"/>
         <xs:element name="disassociate-time" type="xs:dateTime"
            minOccurs="0"/>
	 <xs:element name="extensiondata" type="extensiondata"
            minOccurs="0"/>
       </xs:sequence>
       <xs:attribute name="id" type="urnuuid"
            use="required"/>
   </xs:complexType>
   <xs:complexType name="session">
       <xs:sequence>
         <xs:element name="associate-time" type="dateTime"
                minOccurs="0"/>
         <xs:element name="disassociate-time" type="dateTime"
                minOccurs="0"/>
         <xs:element name="reason" type="xs:string"
                minOccurs="0"/>
         <xs:element name="group-ref" type="urnuuid"
                minOccurs="0" maxOccurs="1"/>
	<xs:element name="extensiondata" type="extensiondata"
            minOccurs="0"/>
       </xs:sequence>
       <xs:attribute name="id" type="urnuuid"
            use="required"/>
   </xs:complexType>
   <xs:complexType name="participant">
       <xs:sequence>
           <xs:element name="aor" type="xs:anyURI"
             maxOccurs="unbounded"/>
         <xs:element name="name" type="xs:string"
             minOccurs="0" maxOccurs="1"/>
           <xs:element name="send" type="urnuuid"
             minOccurs="0" maxOccurs="unbounded"/>
           <xs:element name="recv" type="urnuuid"
             minOccurs="0" maxOccurs="unbounded"/>
         <xs:element name="associate-time" type="xs:dateTime"
                minOccurs="0"/>
       <xs:element name="disassociate-time" type="xs:dateTime"
                minOccurs="0"/>
	<xs:element name="extensiondata" type="extensiondata"
            minOccurs="0"/>
       </xs:sequence>
       <xs:attribute name="id" type="urnuuid"
            use="required"/>
       <xs:attribute name="session" type="urnuuid"
            use="required"/>
   </xs:complexType>
   <xs:complexType name="stream">
       <xs:sequence>
         <xs:element name="label" type="xs:string"
             minOccurs="0" maxOccurs="1"/>
           <xs:element name="mode" type="streamMode"
             minOccurs="0" maxOccurs="1"/>
     <xs:element name="extensiondata" type="extensiondata"
             minOccurs="0"/>
       </xs:sequence>
       <xs:attribute name="id" type="urnuuid"
            use="required"/>
       <xs:attribute name="session" type="urnuuid"
            use="required"/>
   </xs:complexType>
   <xs:element name='extensiondata'>
     <xs:complexType>
         <xs:any     namespace='##other'
                     minOccurs='0'
                     maxOccurs='unbounded'
                     processContents='lax'/>
     </xs:complexType>
     <xs:attribute name="id" type="urnuuid"
            use="required"/>
     <xs:attribute name="parent" type="urnuuid"
       use="required"/>
   </xs:element>
   <xs:simpleType name="streamMode">
       <xs:restriction base="xs:string">
           <xs:pattern
            value="mixed|separate"/>
       </xs:restriction>
   <xs:simpleType name="urnuuid">
         <xs:restriction base="xs:string">
           <xs:pattern
            value="urn:uuid:[0-9a-zA-Z]{8}-[0-9a-zA-Z]{4}
                 -[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{12}"/>
         </xs:restriction>
   </xs:simpleType>
   </xs:simpleType>
     <xs:simpleType name="dataMode">
         <xs:restriction base="xs:string">
            <xs:enumeration value="complete"/>
                    <xs:enumeration value="partial"/>
         </xs:restriction>
   </xs:simpleType>
            ]]> </artwork>     
                </section>
    <section title="Security Considerations">
       <t>The metadata information sent from SRC to SRS MAY reveal sensitive information about different participants in a session.  For this reason, it is RECOMMENDED that a SRC use a strong means for authentication and metadata information protection and that it apply comprehensive authorization rules when using the metadata format defined in this document.  The following sections will discuss each of these aspects in more detail.</t>
			<section title="Connection Security">
				<t>It is RECOMMENDED that a SRC authenticate SRS using the normal SIP authentication mechanisms, such as Digest as defined in Section 22 of <xref target="RFC3261"/>. The mechanism used for conveying the metadata information MUST ensure integrity and SHOULD ensure confidentially of the information. In order to achieve these, an end-to-end SIP encryption mechanism, such as S/MIME described in <xref target="RFC3261"/>, SHOULD be used.</t>
				<t>If a strong end-to-end security means (such as above) is not available, it is RECOMMENDED that a SRC use mutual hop-by-hop Transport Layer Security (TLS) authentication and encryption mechanisms described in "SIPS URI Scheme" and "Interdomain Requests" of <xref target="RFC3261"/>.</t>
		</section>
        </section>
		<section title="IANA Considerations" anchor="sec.iana-considerations">
	<t>
This specification registers a new XML namespace, and a new XML schema. 
			</t>
           <section title="SIP recording metadata Schema Registration">
                                         <t>
         URI: urn:ietf:params:xml:ns:recording
					</t>
                                         <t>
         Registrant Contact: IETF SIPREC working group, Ram mohan R(rmohanr@cisco.com)
					</t>
                                        <t>
         XML: the XML schema to be registered is contained in Section 6.
					</t>
                                <t>
         Its first line is <![CDATA[ <?xml version="1.0" encoding="UTF-8"?> ]]> and its last line is <![CDATA[ </xs:schema> ]]>
					</t>
		</section>
            </section>
		<section title="Acknowledgement">
			<t>
				We wish to thank John Elwell(Siemens-Enterprise), Henry Lum(Alcatel-Lucent), Leon Portman(Nice), De Villers, Andrew Hutton(Siemens-Enterprise), Deepanshu Gautam(Huawei), Charles Eckel(Cisco), Muthu Arul(Cisco), Michael Benenson(Cisco), Hadriel Kaplan (ACME), Brian Rosen(Neustar), Scott Orton(Broadsoft) for their valuable comments and inputs.
			</t>
             	<t> We wish to thank Joe Hildebrand(Cisco), Peter Saint-Andre(Cisco) for the valuable XML related guidance and Martin Thompson for validating the XML schema and providing comments on the same. </t>
		</section>
		<section title="Appendix A: Metadata Model Object Instances">
			<t>This section describes the metadata model object instances for different use cases of SIPREC. For the sake of simplicity as the media streams sent by each of the participants is received by every other participant in these use cases, it is NOT shown in the object instance diagrams below. Also for the sake of ease not all attributes of each object are shown in these instance diagrams.</t>
			<section title="Use case 1: Basic Call">
				<t> Basic call between two Participants A and B. In this use case each participant sends one Media Stream. For the sake of simplicity "receives" lines are not shown in this instance diagram. Media Streams sent by each participant is received all other participants of that CS. </t>
				<artwork>
					<![CDATA[
+-------------------------------+             
| Recording Session (RS)        |              
+-------------------------------+     
           |                             
           | 
           |     
  +----------------+ 
  | Communication  |
  | Session (CS)   |
  +----------------+-----------------------+
  |  Start Time    |                       |
  +----------------+                       |
           |                               |
           |-------------------+           |
           |                   |           |
+---------------+     +---------------+    |
| ParticipantA  |     | ParticipantB  |    |
|               |     |               |    |
+---------------+     +---------------+    |
           |                  |            |
  sends    |                  |  sends     |
           |                  |            | 
+---------------+       +---------------+  |
|Media Stream A1|       |Media Stream B1|  | 
+---------------+       +---------------+  |
|MediaStream Ref|       |MediaStream Ref|  |
|               |       |               |  |
+---------------+       +---------------+  |
       |                       |           |
       +-----------------------------------+ 
				 ]]>
				</artwork>
			</section>

			<section title="Use case 2: Hold/Resume">
				<t> Basic call between two Participants A and B and with Participant A or B doing a Hold/Resume. In this use case each participant sends one Media Stream. After Hold/Resume the properties of Media can change. For the sake of simplicity "receives" lines are not shown in this instance diagram. Media Streams sent by each participant is received all other participants of that CS.</t>
				<artwork>
					<![CDATA[
+-------------------------------+             
| Recording Session (RS)        |              
+-------------------------------+               
           |                   |                 
           |                   |                 
           |                   |                
           |                 +-------------------------------+
           |                 |   Communication Session (CS)  |
           |     +-----------|      Group(CSG)               |
           |     |           +-------------------------------+
           |     |           |   Unique-id1                  |
           |     |           +-------------------------------+
           |     |                        
           |     |                             
           |     |
  +----------------+ 
  | Communication  |
+-| Session (CS)   |----------------------------------------------+
| +----------------+                                              |
| |                |                                              |
| +----------------+                                              |
|            |                                                    |
|            |-------------------+                                |
|            |                   |                                |
| +---------------+     +---------------+                         |
| | ParticipantA  |     | ParticipantB  |-----------+             |
| |               |--+  |               |           |             |
| +---------------+  |  +---------------+           |sends(After  |
|       |       |    |       |         |            |     Resume) |
|       |       |    |       |         |         +--------------+ |
| sends |       |     +--+   |  sends  |         |MediaStream B3| |
|       |       -----+   |   |          +-----+  +--------------+ |
| +---------------+  |   |  +---------------+ |  |MediaStreamRef|-|
| |Media Stream A1|  |   |  |Media Stream B1| |  |              | |
| +---------------+  |   |  +---------------+ |  |              | |
+-|MediaStreamref |  |   |  |MediaStreamRef | |  +--------------+ |
  |               |  |   |  |               |-|-------------------|
  +---------------+  |   |  +---------------+ |                   |
                     |   |                    |                   |
        +------------+   |sends               |sends (hold)       |
        | sends          |(Resume)            |                   |
        | (hold)         +-------+             +-------+          |
        |                        |                     |          |
  +---------------+       +---------------+   +--------------+    |
  |Media Stream A2|       |Media Stream A3|   |MediaStream B2|    |
  +---------------+       +---------------+   |              |    |
  |MediaStreamref |       |MediaStreamRef |   +--------------+    |
  |               |       |               |   |Codec Params  |    |
  +---------------+       +---------------+   |              |    |
           |                     |            |              |    |
           |                     |            +--------------+    |
           |                     |                  |             |
           +------------------------------------------------------+
				 ]]> 
				</artwork>
			</section>
			<section title="Use case 3: Basic call with Transfer">
				<t> Basic call between two Participants A and B and with Participant A  transfer(consult transfer) to Participant C. In this use case each participant sends one Media Stream. After transfer the properties of Participant A Media can change. For the sake of simplicity "receives" lines are not shown in this instance diagram. Media Streams sent by each participant is received all other participants of that CS.</t>
				<artwork>
					<![CDATA[
+-------------------------------+             
| Recording Session (RS)        |-------+              
+-------------------------------+       |        
           |                            |        
           |                            |        
           |                            |       
+-------------------------------+       |      
|   Communication Session (CS)  |       |   
|      Group(CSG)               |       |
+-------------------------------+       |
|   Unique-id1                  |       |
+-------------------------------+       |     
           |                            | 
           |----------------------------+
           |
           |-----------------+          
           |                 |
+----------------+     +----------------+
| Communication  |     | Communication  | 
| Session (CS)1  |     | Session (CS)2  | 
+----------------+     +----------------+-----------+
|                |     |                |           |
+----------------+     +----------------+           |
           |                                        |
           |-------------------+                    |
           |        |          |                    |
+---------------+   | +---------------+             |
| ParticipantA  |   | | ParticipantB  |             |
|               |   | |               |             |
+---------------+   | +---------------+             |
           |        |         |                     |
  sends    |        |         |  sends              |
           |        |         |                     |
+---------------+   |   +---------------+           |
|Media Stream A1|   |   |Media Stream B1|           |
+---------------+   |   +---------------+           |
|               |   |   |               |           |
|               |   |   | Media Stream  |           |
| Media Stream  |---+---|  Ref          |           |
| Ref           |       |               |           |
+---------------+       +---------------+           |
                                                    |
                                                    |
                       +----------------------------|
                       |                            |
      +--------------------------------+            |
      |                                |            |
+---------------+                +---------------+  |
| Participant A |                | Participant C |  |
|   (same)      |                |               |  |
+---------------+                +---------------+  |
      |                                    |        |
      | sends (After transfer)             | sends  |
+----------------+                +----------------+|
| Media Stream A2|                | Media Stream C1||
+----------------+                +----------------+|
| Media StreamRef|                | Media StreamRef||
|                |                |                ||
|                |                |                ||
+----------------+                +----------------+|
        |                                  |        |
        |                                  |        |
        |                                  |        |
        +-------------------------------------------+
				 ]]>
				</artwork>

			</section>
			<section title="Conference Use Cases">
				<t>Depending on who act as SRC and the information that an SRC has there can be several ways to model conference use cases. This section has instance diagrams for the following cases:</t>
				<t>
					<list style='symbols'>
						<t>A CS where one of the participant (which is also SRC) is a user in a conference</t>
						<t>A CS where one of the participant is focus ( which is also SRC)</t>
						<t>A CS where one of the participant is user and the SRC is a different entity like B2BUA</t>
						<t>A CS where one of the participant is focus and the SRC is a different entity like B2BUA</t>
					</list>
					<t>NOTE: There MAY be other ways to model the same use cases depending on what information the SRC has.</t>
				</t>
				<section title='Case 1:'>
					<t>This is the usecase where there is a CS with one of the participant (who is also SRC) as a user in a conference. For the sake of simplicity the receive lines for each of the participant is not shown.</t>
					<artwork>
						<![CDATA[
+---------------------------------------------------+
|      Communication Session                        |
| +-------------+              +--------------+     |
| |             |              |              |     |
| |Participant B|              | Participant A|     |
| |  (User in   |--------------|              |     |
| |  conf/SRC)  |              |              |     |
| +-------------+              +--------------+     | 
|   |  |  |  |                                      | 
+---------------------------------------------------+
    |  |  |  |
    |  |  |  |
    D   E  F  G (Participants of Conference)


Instance Diagram:

+-------------------------------+             
| Recording Session (RS)        |--+            
+-------------------------------+  |   
           |                       | 
           |                       |
           |                       |
+-------------------------------+  |           
|   Communication Session (CS)  |  |        
|      Group(CSG)               |  |
+-------------------------------+  |
|   Unique-id1                  |  |
+-------------------------------+  |         
           |                       |      
           |-----------------------+ 
           |     
  +----------------+ 
  | Communication  |
  | Session (CS)   |--+----------------+-----+
  +----------------+  |                |     |
  |                |  |                |     |
  +----------------+  |                |     |
           |          |                |     |
           |          |                |     |
           |          |                |     |
+---------------+     |                |     |
| ParticipantA  |     |                |     |
|               |     |                |     |
+---------------+     |                |     |
           |          |                |     |
  sends    |          |                |     |
           |          |                |     |
+---------------+     |                |     |
|Media Stream A1|     |                |     |
+---------------+     |                |     |
|MediaStream Ref|-----|----------------+     |
|               |     |                |     |
+---------------+     |                |     |
                      |                |     |
                      |                |     |
        +-------------+                |     |
        |                              |     |
        |                              |     |
+----------------+                     |     |
| Participant B  |                     |     |
|  (in conf)     |                     |     |
+----------------+                     |     | 
        |                              |     |
 sends  |                              |     |
        |                              |     | 
+----------------+                     |     |
| Media Stream B1|---------------------+     | 
+----------------+        sends              |
| MediaStream Ref|                           |
|                |         +-----------------+
+----------------+         |      
           |               |
           |sends          |
           |               |
     +-----------------+-------------+------------+
     |                 |             |            | 
     |                 |             |            |
+------------+  +------------+ +------------+ +-------------+
|participantD|  |ParticipantE| |ParticipantF| |Participant G|
+------------+  +------------+ +------------+ +-------------+ 

						]]>
					</artwork>
					<t>In this example we have two participants A and B who are part of a Communication Session(CS). One of the participants B is part of a conference and also acts as SRC.There can be two cases here. B can be a participant of the conference or B can be a focus. In this instance diagram Participant B is a user in a conference. The SRC (Participant B) subscribes to conference event package to get the details of other particiants. Participant B(SRC) sends the same through the metadata to SRS. In this instance diagram the Media Stream(mixed stream) sent from Participant B has media streams contributed by conference participants (D,E,F and G). For the sake of simplicity the "receives" line is not shown here. In this example the media stream sent by each participant(A or B) of CS is received by all other participant(A or B).</t>
				</section>
				<section title='Case 2:'>
					<t>This is the usecase where there is a CS where one of the participant is focus ( which is also SRC). </t>
					<artwork>
						<![CDATA[
						
+---------------------------------------------------+
|      Communication Session                        |
| +--------------+              +--------------+    |
| |              |--------------|              |    |
| |Participant C |              | Participant A|    |
| |  (Focus in   |------+       |              |    |
| | conf and SRC)|---+  |       +--------------+    |
| +--------------+   |  |                           |
|   |                |  +---------+                 |
|   |                |            |                 |
| +--------------+   |         +---------------+    |
| | Participant B|   +---+     | Participant D |    |
| |              |       |     |               |    |
| +--------------+       |     +---------------+    |
|                        |                          |
|                   +--------------+                |
|                   |Participant E |                |
|                   |              |                |
|                   +--------------+                |
|                                                   |
+---------------------------------------------------+

Instance Diagram:

+-------------------------------+ 
| Recording Session (RS)        |  
+-------------------------------+     
           |-------------------------+
           |                         |
           |                         |
+-------------------------------+    |
|   Communication Session (CS)  |    |
|      Group(CSG)               |    |
+-------------------------------+    |
|   Unique-id1                  |    |
+-------------------------------+    |       
           |                         |    
           |-------------------------+ 
           |     
  +----------------+ 
  | Communication  |
  | Session (CS)   |----------------------+  
  +----------------+                      | 
  |                |                      |
  +----------------+                      |
           |                              |
           |-------------------+          |
           |        |          |          |
+---------------+   | +---------------+   |
| ParticipantA  |   | | ParticipantB  |   |
|               |   | |               |   |
+---------------+   | +---------------+   |
           |        |         |           |
  sends    |        |         |  sends    |
           |        |         |           |
+---------------+   |   +---------------+ |
|Media Stream A1|   |   |Media Stream B1| |
+---------------+   |   +---------------+ |
|MediaStream Ref|   |   |MediaStream Ref| |
|               |---+---|               | |
+---------------+       +---------------+ |
                                          |
       +----------------------------------+
       |            |         |           |
       |            |         |           |
+---------------+   | +---------------+   |
| ParticipantD  |   | | ParticipantE  |   |
|               |   | |               |   |
+---------------+   | +---------------+   |
           |        |         |           |
  sends    |        |         |  sends    |
           |        |         |           |
+---------------+   |   +---------------+ |
|Media Stream D1|   |   |Media Stream E1| |
+---------------+   |   +---------------+ |
|MediaStream Ref|   |   |MediaStream Ref| |
|               |---+---|               | |
+---------------+       +---------------+ |
                                          |
                                          |
                               +----------+
             +-----------------|
             |                 | 
             |                 |
            +----------------+ |
            | Participant C  | |   
            |  (focus +src)  | |
            +----------------+ |
                    |          |
             Sends  |  +-------+
                    |  |
"sends" OR          |  |   
contributed +----------------+
 by         | Media Stream C1| 
Participants+----------------+  "receives" by participants A,B,D,E
A,B,D,E     | MediaStream Ref|------------------------------------
------------| Codec Params   | 
            +----------------+

						]]>
					</artwork>
					<t>In this example we have two participants A and B who are part of a Communication Session(CS). One of the participants (C) is focus of a conference and also acts as SRC. The SRC (Participant C) being the Focus of the conference has access to the details of other particiants. SRC (Participant C) sends the same through the metadata to SRS. In this instance diagram the Media Stream(mixed stream) sent by C has media streams contributed by conference participants (A, B, D and E). Participants A, B,D and E sends Media Streams A1, B1, D1 and E1 respectively. The media stream sent by Participant C(Focus) is received by all other participants of CS. For the sake of simplicity the "receives" line is not shown linked to all other participants.</t>
					<t>NOTE: SRC ( Participant C) can send mixed stream or seperate streams to SRS</t>
				</section>
				<section title='Case 3:'>
					<t>A CS where one of the participant is user and the SRC is a different entity like B2BUA. In this case the SRC may not know that one of the user is part of conference. Hence the instance diagram will not have information about the conference participants.</t>
					<artwork>
						<![CDATA[
+---------------------------------------------------+
|      Communication Session                        |
| +-------------+  +------+    +--------------+     |
| |             |  | (SRC)|    |              |     |
| |Participant B|--|B2BUA |----| Participant A|     |
| |  (User in   |  +------+    |              |     |
| |  conf)      |              |              |     |
| +-------------+              +--------------+     |
|   |  |  |  |                                      |
+---------------------------------------------------+
    |  |  |  |
    |  |  |  |
    D   E  F  G (Participants of Conference)
						]]>
					</artwork>
				</section>
				<section title='Case 4:'>
					<t>A CS where one of the participant is focus and the SRC is a different entity like B2BUA. In this case the participant which is focus sends "isfocus" in SIP message to SRC. The SRC subscribe to conference event package on seeing this "isfocus". SRC learns the details of other participants of conference from the conference package and send the same in metadata to SRS. The instance diagram for this use case is same as Case 1.</t>
					<artwork>
						<![CDATA[
	   +--------------------------------+
	   |   Conference Event Package     |
	   |                                |
	   +--------------------------------+ 
                      |
                      | subscribes
                      |
+---------------------|-----------------------------+
|      Communication  |Session                      |
| +-------------+  +------+    +--------------+     |
| |             |  | (SRC)|    |              |     |
| |Participant B|--|B2BUA |----| Participant A|     |
| |  (FOCUS in  |  +------+    |              |     |
| |  conf)      |              |              |     |
| +-------------+              +--------------+     |
|   |  |  |  |                                      |
+---------------------------------------------------+
    |  |  |  |
    |  |  |  |
    D   E  F  G (Participants of Conference)
						]]>
					</artwork>
				</section>
			</section>
		</section>
		<section title="Appendix B: Metadata XML schema Instances">
			<t>This section describes the metadata model XML instances for different use cases of SIPREC. For the sake of simplicity the complete SIP messages are NOT shown here. </t>
			<section title="Use case 1: Basic Call">
				<t> Basic call between two Participants A(Ram) and B(Partha) who are part of one session. In this use case each participant sends two Media Streams.  Media Streams sent by each participant is received all other participants of that CS in this use-case. Below is the initial snapshot sent by SRC that has complete metadata. For the sake of completeness even snippets of SDP is shown. For the sake of simplicity these use-cases assume the RS stream is unmixed.</t>
				<artwork>
					<![CDATA[
   Content-Type: application/SDP
   ...
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:96
   a=sendonly
   ...
   m=video 49174 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:97
   a=sendonly
   ...
   m=audio 51372 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:98
   a=sendonly
   ...
   m=video 49176 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:99
   a=sendonly
   ....				
<?xml version="1.0" encoding="UTF-8"?>
    <recording xmlns='urn:ietf:params:xml:ns:recording'>
	   <dataMode>complete</dataMode>
       <group id="urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302">
         <associate-time>2010-12-16T23:41:07Z</associate-time>
             <extensiondata>
         <!-- Standardized extension -->
         <call-center xmlns='urn:ietf:params:xml:ns:callcenter'>
           <supervisor>sip:alice@cisco.com</supervisor>
         </call-center>
         <mydata xmlns='http://example.com/my'>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
         </mydata>
       </extensiondata>
       </group>
      <session id="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
         <group-ref>urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302
         </group-ref>
         <start-time>2010-12-16T23:41:07Z</start-time>
            <extensiondata>
         <structure>FOO!</structure>
         <whatever>bar</whatever>
       </extensiondata>
       </session>
       <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
          <aor>sip:ram@blr.cisco.com</aor>
        <send>urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b</send>
        <send>urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17</send>
        <recv>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</recv>
        <recv>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</recv>
        <associate-time>2010-12-16T23:41:07Z</associate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
       </participant>

       <participant
           id="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <aor>sip:partha@blr.sonus.com</aor>
         <send>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</send>
         <send>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</send>
         <recv>urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17</recv>
         <recv>urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b</recv>
         <associate-time>2010-12-16T23:41:07Z</associate-time>
                   <extensiondata>
            <structure>FOO!</structure>
            <whatever>bar</whatever>
          </extensiondata>
       </participant>
       <stream id="urn:uuid:50000c9b-9191-40a4-8231-5bcbca5e2b17"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <label>96</label>
       </stream>
       <stream id="urn:uuid:8b53f3de-da39-4846-93c7-ee5e5f8f6f0b"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <label>97</label>
       </stream>
       <stream id="urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>98</label>
       </stream>
       <stream id="urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>99</label>
       </stream>
  </recording>
					]]>
				</artwork>
			</section>
			<section title="Use case 2: Hold/resume">
				<t> Basic call between two Participants A and B. This is the continuation of above use-case. One of the participants(say A) goes on hold and then resumes as part of the same session. The metadata snapshot looks as below </t>
				<t>During hold</t>
				<artwork>
					<![CDATA[
   Content-Type: application/SDP
   ...
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:96
   a=inactive
   ...
   m=video 49174 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:97
   a=inactive
   ...
   m=audio 51372 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:98
   a=sendonly
   ...
   m=video 49176 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:99
   a=sendonly
   ....	
   
   <?xml version="1.0" encoding="UTF-8"?>
     <recording xmlns='urn:ietf:params:xml:ns:recording'>
       <dataMode>partial</dataMode>
	    <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
          <aor>sip:ram@blr.cisco.com</aor>
         <recv>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</recv>
         <recv>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</recv>
         </participant>
		 <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <aor>sip:partha@blr.cisco.com</aor>
          <send>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</send>
          <send>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</send>
       </participant>
	</recording>  
					]]>
				</artwork>
				<t>During resume</t>
				<t>The snapshot will look pretty much same as Use-case 1.</t>
			</section>
			<section title="Use case 3: Basic Call with transfer">
				<t> Basic call between two Participants A and B is connected as in Use-case 1. Transfer is initiated by one of the participants of by other entity(3PCC case). SRC sends a snapshot of the participant changes to SRS. In this instance participant A(Ram) drops out during the transfer and Participant C(Paul) joins the session. There can be two cases here, same session continues after transfer or a new session (e.g. REFER based transfer) is created </t>.  
				<t>Transfer with same session retained  - (.e.g. RE-INVITE based transfer). Participant A drops out and C is added to the same session. No change to session/group element. C will be new stream element which maps to RS SDP using the same labels in this instance.</t>
				<artwork>
					<![CDATA[
   Content-Type: application/SDP
   ...
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:96
   a=sendonly
   ...
   m=video 49174 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:97
   a=sendonly
   ...
   m=audio 51372 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:98
   a=sendonly
   ...
   m=video 49176 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:99
   a=sendonly
   ....				
<?xml version="1.0" encoding="UTF-8"?>
    <recording xmlns='urn:ietf:params:xml:ns:recording'>
	   <dataMode>partial</dataMode>
       <participant
           id="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <aor>sip:partha@blr.sonus.com</aor>
          <send>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</send>
          <send>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</send>
          <recv>urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf</recv>
          <recv>urn:uuid:01c47915-4777-11d8-bc70-0090272ff725</recv>
        </participant>

       <participant
          id="urn:uuid:02d9e6d5-9467-382e-8f9b-9300a64ac3cd"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
          <aor>sip:paul@box.mit.com</aor>
         <send>urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf</send>
         <send>urn:uuid:01c47915-4777-11d8-bc70-0090272ff725</send>
         <recv>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</recv>
         <recv>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</recv>
          <associate-time>2010-12-16T23:41:07Z</associate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
       </participant>

       <stream id="urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <label>96</label>
       </stream>
       <stream id="urn:uuid:01c47915-4777-11d8-bc70-0090272ff725"
           session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <label>97</label>
       </stream>
       <stream id="urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>98</label>
       </stream>
       <stream id="urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a"
           session="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103">
           <label>99</label>
       </stream>
  </recording>
					]]>
				</artwork>
				<t>Transfer with new session -  (.e.g. REFER based transfer). In this case new session is part of same grouping (done by SRC).</t>
				<t>SRC may send an optional snapshot indicating stop for the old session.</t>
				<artwork>
					<![CDATA[
	<?xml version="1.0" encoding="UTF-8"?>
    <recording xmlns='urn:ietf:params:xml:ns:recording'>
	   <dataMode>Partial</dataMode>
       <session id="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
         <group-ref>urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302
         </group-ref>
         <stop-time>2010-12-16T23:41:07Z</stop-time>
            <extensiondata>
         <structure>FOO!</structure>
         <whatever>bar</whatever>
       </extensiondata>
       </session>
       <participant
          id="urn:uuid:b2b7c112-5982-469d-9007-6ddbecca64d3"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
        <disassociate-time>2010-12-16T23:41:07Z</disassociate-time>
        </participant>

       <participant
           id="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103"
          session="urn:uuid:855a5ded-8420-456d-a70f-6da1eeaeb425">
           <aor>sip:partha@blr.sonus.com</aor>
         <disasociate-time>2010-12-16T23:41:07Z</disassociate-time>
        </participant>
       
  </recording>
					]]>
				</artwork>
				<t>SRC sends a snapshot to indicate the participant change and new session information after transfer. In this example the same RS is used.</t>
				<artwork>
					<![CDATA[
  Content-Type: application/SDP
   ...
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:96
   a=sendonly
   ...
   m=video 49174 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:97
   a=sendonly
   ...
   m=audio 51372 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=label:98
   a=sendonly
   ...
   m=video 49176 RTP/AVPF 96
   a=rtpmap:96 H.264/90000
   a=label:99
   a=sendonly
   ....				
<?xml version="1.0" encoding="UTF-8"?>
    <recording xmlns='urn:ietf:params:xml:ns:recording'>
	   <dataMode>partial</dataMode>
       <session id="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
         <group-ref>urn:uuid:efe3930b-2a31-4e6a-a6ab-203fd7078302
         </group-ref>
         <start-time>2010-12-16T23:41:07Z</start-time>
            <extensiondata>
         <structure>FOO!</structure>
         <whatever>bar</whatever>
       </extensiondata>
       </session>
       <participant
           id="urn:uuid:cd27cfa1-2bdd-4830-a653-70374d10f103"
           session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
           <aor>sip:partha@blr.sonus.com</aor>
         <send>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</send>
         <send>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</send>
         <recv>urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf</recv>
         <recv>urn:uuid:01c47915-4777-11d8-bc70-0090272ff725</recv>
         <associate-time>2010-12-16T23:32:03Z</associate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
        </participant>

       <participant
          id="urn:uuid:02d9e6d5-9467-382e-8f9b-9300a64ac3cd"
          session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
          <aor>sip:paul@box.mit.com</aor>
        <send>urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf</send>
        <send>urn:uuid:01c47915-4777-11d8-bc70-0090272ff725</send>
        <recv>urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a</recv>
        <recv>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a</recv>
        <associate-time>2010-12-16T23:41:07Z</associate-time>
            <extensiondata>
           <structure>FOO!</structure>
           <whatever>bar</whatever>
          </extensiondata>
       </participant>

       <stream id="urn:uuid:eb424026-6f54-4ef8-a4d0-bb658a1fc6cf"
           session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
           <label>96</label>
       </stream>
       <stream id="urn:uuid:01c47915-4777-11d8-bc70-0090272ff725"
           session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
           <label>97</label>
       </stream>
       <stream id="urn:uuid:f3373a7b-4958-4e55-8820-d03a191fb76a"
           session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
           <label>98</label>
       </stream>
       <stream id="urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a"
           session="urn:uuid:6DF2D9F8-D4C5-11E0-8DC5-04EE4724019B">
           <label>99</label>
       </stream>
  </recording>
					]]>
				</artwork>
			</section>
		</section>	
	</middle>
	<back>
 		<references title="Normative References">
            <?rfc include="reference.RFC.2119"?>
            <?rfc include="reference.RFC.2141"?>
            <?rfc include="reference.RFC.3261"?>
            <?rfc include="reference.RFC.3688"?>
            <?rfc include="reference.RFC.3339"?>
            <?rfc include="reference.RFC.4566"?>
            <?rfc include="reference.RFC.4574"?>
			<?rfc include="reference.RFC.4796"?>
			<?rfc include="reference.RFC.3840"?>
			<?rfc include="reference.RFC.4122"?>
            </references>
            <references title="Informative References">
			  <?rfc include="reference.RFC.6341"?>
			  <?rfc include="reference.I-D.ietf-siprec-architecture"?>
                    <?rfc include="reference.RFC.2648"?>
		</references>
	</back>
</rfc>

