


Network Working Group                                          A. Morton
Internet-Draft                                                 AT&T Labs
Intended status: Standards Track                              E. Stephan
Expires: September 16, 2007                  France Telecom Division R&D
                                                          March 15, 2007


                     Spatial Composition of Metrics
                 draft-ietf-ippm-spatial-composition-03

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on September 16, 2007.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   This memo utilizes IPPM metrics that are applicable to both complete
   paths and sub-paths, and defines relationships to compose a complete
   path metric from the sub-path metrics with some accuracy w.r.t. the
   actual metrics.  This is called Spatial Composition in RFC 2330.  The
   memo refers to the Framework for Metric Composition, and provides
   background and motivation for combining metrics to derive others.
   The descriptions of several composed metrics and statistics follow.



Morton & Stephan       Expires September 16, 2007               [Page 1]

Internet-Draft             Spatial Composition                March 2007


Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

   In this memo, the characters "<=" should be read as "less than or
   equal to" and ">=" as "greater than or equal to".


Table of Contents

   1.  Contributors . . . . . . . . . . . . . . . . . . . . . . . . .  4
   2.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  4
     2.1.  Motivation . . . . . . . . . . . . . . . . . . . . . . . .  5
   3.  Scope and Application  . . . . . . . . . . . . . . . . . . . .  5
     3.1.  Scope of work  . . . . . . . . . . . . . . . . . . . . . .  6
     3.2.  Application  . . . . . . . . . . . . . . . . . . . . . . .  6
     3.3.  Incomplete Information . . . . . . . . . . . . . . . . . .  7
   4.  Common Specifications for Composed Metrics . . . . . . . . . .  7
     4.1.  Name: Type-P . . . . . . . . . . . . . . . . . . . . . . .  7
       4.1.1.  Metric Parameters  . . . . . . . . . . . . . . . . . .  7
       4.1.2.  Definition and Metric Units  . . . . . . . . . . . . .  8
       4.1.3.  Discussion and other details . . . . . . . . . . . . .  8
       4.1.4.  Statistic: . . . . . . . . . . . . . . . . . . . . . .  8
       4.1.5.  Composition Function: Sum of Means . . . . . . . . . .  8
       4.1.6.  Statement of Conjecture  . . . . . . . . . . . . . . .  8
       4.1.7.  Justification of the Composition Function  . . . . . .  8
       4.1.8.  Sources of Deviation from the Ground Truth . . . . . .  9
       4.1.9.  Specific cases where the conjecture might fail . . . .  9
       4.1.10. Application of Measurement Methodology . . . . . . . .  9
   5.  One-way Delay Composed Metrics and Statistics  . . . . . . . .  9
     5.1.  Name:
           Type-P-Finite-One-way-Delay-Poisson/Periodic-Stream  . . . 10
       5.1.1.  Metric Parameters  . . . . . . . . . . . . . . . . . . 10
       5.1.2.  Definition and Metric Units  . . . . . . . . . . . . . 10
       5.1.3.  Discussion and other details . . . . . . . . . . . . . 10
       5.1.4.  Mean Statistic . . . . . . . . . . . . . . . . . . . . 10
       5.1.5.  Composition Function: Sum of Means . . . . . . . . . . 11
       5.1.6.  Statement of Conjecture  . . . . . . . . . . . . . . . 11
       5.1.7.  Justification of the Composition Function  . . . . . . 11
       5.1.8.  Sources of Deviation from the Ground Truth . . . . . . 11
       5.1.9.  Specific cases where the conjecture might fail . . . . 11
       5.1.10. Application of Measurement Methodology . . . . . . . . 12
   6.  Loss Metrics and Statistics  . . . . . . . . . . . . . . . . . 12
     6.1.  Name:
           Type-P-One-way-Packet-Loss-Poisson/Periodic-Stream . . . . 12
       6.1.1.  Metric Parameters: . . . . . . . . . . . . . . . . . . 12



Morton & Stephan       Expires September 16, 2007               [Page 2]

Internet-Draft             Spatial Composition                March 2007


       6.1.2.  Definition and Metric Units  . . . . . . . . . . . . . 12
       6.1.3.  Discussion and other details . . . . . . . . . . . . . 12
       6.1.4.  Statistic:
               Type-P-One-way-Packet-Loss-Empirical-Probability . . . 12
       6.1.5.  Composition Function: Composition of Empirical
               Probabilities  . . . . . . . . . . . . . . . . . . . . 13
       6.1.6.  Statement of Conjecture  . . . . . . . . . . . . . . . 13
       6.1.7.  Justification of the Composition Function  . . . . . . 13
       6.1.8.  Sources of Deviation from the Ground Truth . . . . . . 13
       6.1.9.  Specific cases where the conjecture might fail . . . . 13
       6.1.10. Application of Measurement Methodology . . . . . . . . 14
   7.  Delay Variation Metrics and Statistics . . . . . . . . . . . . 14
     7.1.  Name:
           Type-P-One-way-ipdv-refmin-Poisson/Periodic-Stream . . . . 14
       7.1.1.  Metric Parameters: . . . . . . . . . . . . . . . . . . 14
       7.1.2.  Definition and Metric Units  . . . . . . . . . . . . . 15
       7.1.3.  Discussion and other details . . . . . . . . . . . . . 15
       7.1.4.  Statistics: Mean, Variance, Skewness, Quanitle . . . . 15
       7.1.5.  Composition Functions: . . . . . . . . . . . . . . . . 16
       7.1.6.  Statement of Conjecture  . . . . . . . . . . . . . . . 17
       7.1.7.  Justification of the Composition Function  . . . . . . 17
       7.1.8.  Sources of Deviation from the Ground Truth . . . . . . 17
       7.1.9.  Specific cases where the conjecture might fail . . . . 18
       7.1.10. Application of Measurement Methodology . . . . . . . . 18
   8.  Security Considerations  . . . . . . . . . . . . . . . . . . . 18
     8.1.  Denial of Service Attacks  . . . . . . . . . . . . . . . . 18
     8.2.  User Data Confidentiality  . . . . . . . . . . . . . . . . 18
     8.3.  Interference with the metrics  . . . . . . . . . . . . . . 18
   9.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 19
   10. Issues (Open and Closed) . . . . . . . . . . . . . . . . . . . 19
   11. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 20
   12. References . . . . . . . . . . . . . . . . . . . . . . . . . . 20
     12.1. Normative References . . . . . . . . . . . . . . . . . . . 20
     12.2. Informative References . . . . . . . . . . . . . . . . . . 21
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 21
   Intellectual Property and Copyright Statements . . . . . . . . . . 23















Morton & Stephan       Expires September 16, 2007               [Page 3]

Internet-Draft             Spatial Composition                March 2007


1.  Contributors

   Thus far, the following people have contributed useful ideas,
   suggestions, or the text of sections that have been incorporated into
   this memo:

   - Phil Chimento <vze275m9@verizon.net>

   - Reza Fardid <RFardid@Covad.COM>

   - Roman Krzanowski <roman.krzanowski@verizon.com>

   - Maurizio Molina <maurizio.molina@dante.org.uk>

   - Al Morton <acmorton@att.com>

   - Emile Stephan <emile.stephan@francetelecom.com>

   - Lei Liang <L.Liang@surrey.ac.uk>

   - Dave Hoeflin <dhoeflin@att.com>


2.  Introduction

   The IPPM framework [RFC2330] describes two forms of metric
   composition, spatial and temporal.  The new composition framework
   [I-D.ietf-ippm-framework-compagg] expands and further qualifies these
   original forms into three categories.  This memo describes Spatial
   Composition, one of the categories of metrics under the umbrella of
   the composition framework.

   Spatial composition encompasses the definition of performance metrics
   that are applicable to a complete path, based on metrics collected on
   various sub-paths.

   The main purpose of this memo is to define the deterministic
   functions that yield the complete path metrics using metrics of the
   sub-paths.  The effectiveness of such metrics is dependent on their
   usefulness in analysis and applicability with practical measurement
   methods.

   The relationships may involve conjecture, and [RFC2330] lists four
   points that the metric definitions should include:

   o  the specific conjecture applied to the metric,





Morton & Stephan       Expires September 16, 2007               [Page 4]

Internet-Draft             Spatial Composition                March 2007


   o  a justification of the practical utility of the composition in
      terms of making accurate measurements of the metric on the path,

   o  a justification of the usefulness of the composition in terms of
      making analysis of the path using A-frame concepts more effective,
      and

   o  an analysis of how the conjecture could be incorrect.

   Also, [RFC2330] gives an example where a conjecture that the delay of
   a path is very nearly the sum of the delays of the exchanges and
   clouds of the corresponding path digest.  This example is
   particularly relevant to those who wish to assess the performance of
   an Inter-domain path without direct measurement, and the performance
   estimate of the complete path is related to the measured results for
   various sub-paths instead.

   Approximate functions between the sub-path and complete path metrics
   are useful, with knowledge of the circumstances where the
   relationships are/are not applicable.  For example, we would not
   expect that delay singletons from each sub-path would sum to produce
   an accurate estimate of a delay singleton for the complete path
   (unless all the delays were essentially constant - very unlikely).
   However, other delay statistics (based on a reasonable sample size)
   may have a sufficiently large set of circumstances where they are
   applicable.

2.1.  Motivation

   One-way metrics defined in other IPPM RFCs all assume that the
   measurement can be practically carried out between the source and the
   destination of the interest.  Sometimes there are reasons that the
   measurement can not be executed from the source to the destination.
   For instance, the measurement path may cross several independent
   domains that have conflicting policies, measurement tools and
   methods, and measurement time assignment.  The solution then may be
   the composition of several sub-path measurements.  This means each
   domain performs the One-way measurement on a sub path between two
   nodes that are involved in the complete path following its own
   policy, using its own measurement tools and methods, and using its
   own measurement timing.  Under the appropriate conditions, one can
   combine the sub-path One-way metric results to estimate the complete
   path One-way measurement metric with some degree of accuracy.


3.  Scope and Application





Morton & Stephan       Expires September 16, 2007               [Page 5]

Internet-Draft             Spatial Composition                March 2007


3.1.  Scope of work

   For the primary IPPM metrics of Loss, Delay, and Delay Variation,
   this memo gives a set of metrics for that can be composed from the
   same or similar sub-path metrics.  This means that the composition
   function may utilize:

   o  the same metric for each sub-path;

   o  multiple metrics for each sub-path (possibly one that is the same
      as the complete path metric);

   o  a single sub-path metrics that is different from the complete path
      metric;

   o  different measurement techniques like active and passive
      (recognizing that PSAMP WG will define capabilities to sample
      packets to support measurement).

3.2.  Application

   The new composition framework [I-D.ietf-ippm-framework-compagg]
   requires the specification of the applicable circumstances for each
   metric.  In particular, the application of Spatial Composition
   metrics are addressed as to whether the metric:

   Requires the same test packets to traverse all sub-paths, or may use
   similar packets sent and collected separately in each sub-path.

   Requires homogeneity of measurement methodologies, or can allow a
   degree of flexibility (e.g., active or passive methods produce the
   "same" metric).  Also, the applicable sending streams will be
   specified, such as Poisson, Periodic, or both.

   Needs information or access that will only be available within an
   operator's domain, or is applicable to Inter-domain composition.

   Requires synchronized measurement time intervals in all sub-paths, or
   largely overlapping, or no timing requirements.

   Requires assumption of sub-path independence w.r.t. the metric being
   defined/composed, or other assumptions.

   Has known sources of inaccuracy/error, and identifies the sources.







Morton & Stephan       Expires September 16, 2007               [Page 6]

Internet-Draft             Spatial Composition                March 2007


3.3.  Incomplete Information

   In practice, when measurements cannot be initiated on a sub-path (and
   perhaps the measurement system gives up during the test interval),
   then there will not be a value for the sub-path reported, and the
   result SHOULD be recorded as "undefined".  This case should be
   distinguished from the case where the measurement system continued to
   send packets throughout the test interval, but all were declared
   lost.

   When a composed metric requires measurements from sub paths A, B, and
   C, and one or more of the sub-path results are undefined, then the
   composed metric SHOULD also be recorded as undefined.


4.  Common Specifications for Composed Metrics

   To reduce the redundant information presented in the detailed metrics
   sections that follow, this section presents the specifications that
   are common to two or more metrics.  The section is organized using
   the same subsections as the individual metrics, to simplify
   comparisons.

4.1.  Name: Type-P

   All metrics use the Type-P convention as described in [RFC2330].  The
   rest of the name is unique to each metric.

4.1.1.  Metric Parameters

   o  Src, the IP address of a host

   o  Dst, the IP address of a host

   o  T, a time (start of test interval)

   o  Tf, a time (end of test interval)

   o  lambda, a rate in reciprocal seconds (for Poisson Streams)

   o  incT, the nominal duration of inter-packet interval, first bit to
      first bit (for Periodic Streams)

   o  T0, a time that MUST be selected at random from the interval [T,
      T+dT] to start generating packets and taking measurements (for
      Periodic Streams)





Morton & Stephan       Expires September 16, 2007               [Page 7]

Internet-Draft             Spatial Composition                March 2007


   o  TstampSrc, the wire time of the packet as measured at MP(Src)

   o  TstampDst, the wire time of the packet as measured at MP(Dst),
      assigned to packets that arrive within a "reasonable" time.

   o  Tmax, a maximum waiting time for packets at the destination, set
      sufficiently long to disambiguate packets with long delays from
      packets that are discarded (lost), thus the distribution of delay
      is not truncated.

   o  M, the total number of packets sent between T0 and Tf

   o  N, the total number of packets received at Dst (sent between T0
      and Tf)

   o  S, the number of sub-paths involved in the complete Src-Dst path

4.1.2.  Definition and Metric Units

   This section is unique for every metric.

4.1.3.  Discussion and other details

   This section is unique for every metric.

4.1.4.  Statistic:

   This section is unique for every metric.

4.1.5.  Composition Function: Sum of Means

   This section is unique for every metric.

4.1.6.  Statement of Conjecture

   This section is unique for each metric.

4.1.7.  Justification of the Composition Function

   It is sometimes impractical to conduct active measurements between
   every Src-Dst pair.  For example, it may not be possible to collect
   the desired sample size in each test interval when access link speed
   is limited, because of the potential for measurement traffic to
   degrade the user traffic performance.  The conditions on a low-speed
   access link may be understood well-enough to permit use of a small
   sample size/rate, while a larger sample size/rate may be used on
   other sub-paths.




Morton & Stephan       Expires September 16, 2007               [Page 8]

Internet-Draft             Spatial Composition                March 2007


   Also, since measurement operations have a real monetary cost, there
   is value in re-using measurements where they are applicable, rather
   than launching new measurements for every possible source-destination
   pair.

4.1.8.  Sources of Deviation from the Ground Truth

   The measurement packets, each having source and destination addresses
   intended for collection at edges of the sub-path, may take a
   different specific path through the network equipment and parallel
   exchanges than packets with the source and destination addresses of
   the complete path.  Therefore, the sub-path measurements may differ
   from the performance experienced by packets on the complete path.
   Multiple measurements employing sufficient sub-path address pairs
   might produce bounds on the extent of this error.

   others...

4.1.9.  Specific cases where the conjecture might fail

   This section is unique for each metric.

4.1.10.  Application of Measurement Methodology

   The methodology:

   SHOULD use similar packets sent and collected separately in each sub-
   path.

   Allows a degree of flexibility (e.g., active or passive methods can
   produce the "same" metric, but timing and correlation of passive
   measurements is much more challenging).

   Poisson and/or Periodic streams are RECOMMENDED.

   Applicable to both Inter-domain and Intra-domain composition.

   SHOULD have synchronized measurement time intervals in all sub-paths,
   but largely overlapping intervals MAY suffice.

   REQUIRES assumption of sub-path independence w.r.t. the metric being
   defined/composed.


5.  One-way Delay Composed Metrics and Statistics






Morton & Stephan       Expires September 16, 2007               [Page 9]

Internet-Draft             Spatial Composition                March 2007


5.1.  Name: Type-P-Finite-One-way-Delay-Poisson/Periodic-Stream

   This metric is a necessary element of Delay Composition metrics, and
   its definition does not formally exist elsewhere in IPPM literature.

5.1.1.  Metric Parameters

   See the common parameters section above.

5.1.2.  Definition and Metric Units

   Using the parameters above, we obtain the value of Type-P-One-way-
   Delay singleton as per [RFC2679].

   For each packet [i] that has a finite One-way Delay (in other words,
   excluding packets which have undefined one-way delay):

   Type-P-Finite-One-way-Delay-Poisson/Periodic-Stream[i] =

   FiniteDelay[i] = TstampDst - TstampSrc

5.1.3.  Discussion and other details

   The "Type-P-Finite-One-way-Delay" metric permits calculation of the
   sample mean statistic.  This resolves the problem of including lost
   packets in the sample (whose delay is undefined), and the issue with
   the informal assignment of infinite delay to lost packets (practical
   systems can only assign some very large value).

   The Finite-One-way-Delay approach handles the problem of lost packets
   by reducing the event space.  We consider conditional statistics, and
   estimate the mean one-way delay conditioned on the event that all
   packets in the sample arrive at the destination (within the specified
   waiting time, Tmax).  This offers a way to make some valid statements
   about one-way delay, and at the same time avoiding events with
   undefined outcomes.  This approach is derived from the treatment of
   lost packets in [RFC3393], and is similar to [Y.1540] .

5.1.4.  Mean Statistic

   We define










Morton & Stephan       Expires September 16, 2007              [Page 10]

Internet-Draft             Spatial Composition                March 2007


   Type-P-Finite-One-way-Delay-Mean =
                              N
                             ---
                        1    \
                        - *   >   (FiniteDelay [i])
                        N    /
                             ---
                            i = 1

   where all packets i= 1 through N have finite singleton delays.

5.1.5.  Composition Function: Sum of Means

   The Type-P-Finite--Composite-One-way-Delay-Mean, or CompMeanDelay for
   the complete Source to Destination path can be calculated from sum of
   the Mean Delays of all its S constituent sub-paths.

   Then the

   Type-P-Finite-Composite-One-way-Delay-Mean =
                                     S
                                    ---
                                    \
                   CompMeanDelay =   >   (MeanDelay [i])
                                    /
                                    ---
                                   i = 1

5.1.6.  Statement of Conjecture

   The mean of a sufficiently large stream of packets measured on each
   sub-path during the interval [T, Tf] will be representative of the
   true mean of the delay distribution (and the distributions themselves
   are sufficiently independent), such that the means may be added to
   produce an estimate of the complete path mean delay.

5.1.7.  Justification of the Composition Function

   See the common section.

5.1.8.  Sources of Deviation from the Ground Truth

   See the common section.

5.1.9.  Specific cases where the conjecture might fail

   If any of the sub-path distributions are bimodal, then the measured
   means may not be stable, and in this case the mean will not be a



Morton & Stephan       Expires September 16, 2007              [Page 11]

Internet-Draft             Spatial Composition                March 2007


   particularly useful statistic when describing the delay distribution
   of the complete path.

   The mean may not be sufficiently robust statistic to produce a
   reliable estimate, or to be useful even if it can be measured.

   others...

5.1.10.  Application of Measurement Methodology

   The requirements of the common section apply here as well.


6.  Loss Metrics and Statistics

6.1.  Name: Type-P-One-way-Packet-Loss-Poisson/Periodic-Stream

6.1.1.  Metric Parameters:

   Same as section 4.1.1.

6.1.2.  Definition and Metric Units

   Using the parameters above, we obtain the value of Type-P-One-way-
   Packet-Loss singleton and stream as per [RFC2680].

   We obtain a sequence of pairs with elements as follows:

   o  TstampSrc, as above

   o  L, either zero or one, where L=1 indicates loss and L=0 indicates
      arrival at the destination within TstampSrc + Tmax.

6.1.3.  Discussion and other details

6.1.4.  Statistic: Type-P-One-way-Packet-Loss-Empirical-Probability

   Given the stream parameter M, the number of packets sent, we can
   define the Empirical Probability of Loss Statistic (Ep), consistent
   with Average Loss in [RFC2680], as follows:











Morton & Stephan       Expires September 16, 2007              [Page 12]

Internet-Draft             Spatial Composition                March 2007


   Type-P-One-way-Packet-Loss-Empirical-Probability =
                                       M
                                      ---
                                 1    \
                            Ep = - *   >  (L[i])
                                 M    /
                                      ---
                                     i = 1

   where all packets i= 1 through M have a value for L.

6.1.5.  Composition Function: Composition of Empirical Probabilities

   The Type-P-One-way-Composite-Packet-Loss-Empirical-Probability, or
   CompEp for the complete Source to Destination path can be calculated
   by combining Ep of all its constituent sub-paths (Ep1, Ep2, Ep3, ...
   Epn) as

   Type-P-One-way-Composite-Packet-Loss-Empirical-Probability =
   CompEp = 1 ? {(1 - Ep1) x (1 ? Ep2) x (1 ? Ep3) x ... x (1 ? Epn)}

   If any EpN is undefined in a particular measurement interval,
   possibly because a measurement system failed to report a value, then
   any CompEp that uses sub-path N for that measurement interval is
   undefined.

6.1.6.  Statement of Conjecture

   The empirical probability of loss calculated on a sufficiently large
   stream of packets measured on each sub-path during the interval [T,
   Tf] will be representative of the true loss probability (and the
   probabilities themselves are sufficiently independent), such that the
   sub-path probabilities may be combined to produce an estimate of the
   complete path loss probability.

6.1.7.  Justification of the Composition Function

   See the common section.

6.1.8.  Sources of Deviation from the Ground Truth

   See the common section.

6.1.9.  Specific cases where the conjecture might fail

   A concern for loss measurements combined in this way is that root
   causes may be correlated to some degree.




Morton & Stephan       Expires September 16, 2007              [Page 13]

Internet-Draft             Spatial Composition                March 2007


   For example, if the links of different networks follow the same
   physical route, then a single event like a tunnel fire could cause an
   outage or congestion on remaining paths in multiple networks.  Here
   it is important to ensure that measurements before the event and
   after the event are not combined to estimate the composite
   performance.

   Or, when traffic volumes rise due to the rapid spread of an email-
   born worm, loss due to queue overflow in one network may help another
   network to carry its traffic without loss.

   others...

6.1.10.  Application of Measurement Methodology

   See the common section.


7.  Delay Variation Metrics and Statistics

7.1.  Name: Type-P-One-way-ipdv-refmin-Poisson/Periodic-Stream

   This metric is a necessary element of Composed Delay Variation
   metrics, and its definition does not formally exist elsewhere in IPPM
   literature.

7.1.1.  Metric Parameters:

   In addition to the parameters of section 4.1.1:

   o  TstampSrc[i], the wire time of packet[i] as measured at MP(Src)

   o  TstampDst[i], the wire time of packet[i] as measured at MP(Dst),
      assigned to packets that arrive within a "reasonable" time.

   o  B, a packet length in bits

   o  F, a selection function unambiguously defining the packets from
      the stream that are selected for the packet-pair computation of
      this metric.  F(first packet), the first packet of the pair, MUST
      have a valid Type-P-Finite-One-way-Delay less than Tmax (in other
      words, excluding packets which have undefined, or infinite one-way
      delay) and MUST have been transmitted during the interval T, Tf.
      The second packet in the pair MUST be the packet with the minimum
      valid value of Type-P-Finite-One-way-Delay for the stream, in
      addition to the criteria for F(first packet).  If multiple packets
      have equal minimum Type-P-Finite-One-way-Delay values, then the
      value for the earliest arriving packet SHOULD be used.



Morton & Stephan       Expires September 16, 2007              [Page 14]

Internet-Draft             Spatial Composition                March 2007


   o  MinDelay, the Type-P-Finite-One-way-Delay value for F(second
      packet) given above.

   o  N, the number of packets received at the Destination meeting the
      F(first packet) criteria.

7.1.2.  Definition and Metric Units

   Using the definition above in section 4.1.2, we obtain the value of
   Type-P-Finite-One-way-Delay-Poisson/Periodic-Stream[i], the singleton
   for each packet[i] in the stream (a.k.a.  FiniteDelay[i]).

   For each packet[i] that meets the F(first packet) criteria given
   above: Type-P-One-way-ipdv-refmin-Poisson/Periodic-Stream[i] =

   IPDVRefMin[i] = FiniteDelay[i] - MinDelay

   where IPDVRefMin[i] is in units of time (seconds, milliseconds).

7.1.3.  Discussion and other details

   This metric produces a sample of delay variation normalized to the
   minimum delay of the sample.  The resulting delay variation
   distribution is independent of the sending sequence (although
   specific FiniteDelay values within the distribution may be
   correlated, depending on various stream parameters such as packet
   spacing).  This metric is equivalent to the IP Packet Delay Variation
   parameter defined in [Y.1540].

7.1.4.  Statistics: Mean, Variance, Skewness, Quanitle

   We define the mean IPDVRefMin as follows (where all packets i= 1
   through N have a value for IPDVRefMin):

   Type-P-One-way-ipdv-refmin-Mean = MeanIPDVRefMin =
                               N
                              ---
                         1    \
                         - *   >   (IPDVRefMin [i])
                         N    /
                              ---
                             i = 1

   We define the variance of IPDVRefMin as follows:







Morton & Stephan       Expires September 16, 2007              [Page 15]

Internet-Draft             Spatial Composition                March 2007


   Type-P-One-way-ipdv-refmin-Variance = VarIPDVRefMin =
                        N
                       ---
                 1     \                                     2
              -------   >   (IPDVRefMin [i] - MeanIPDVRefMin)
              (N - 1)  /
                       ---
                      i = 1

   We define the skewness of IPDVRefMin as follows:

   Type-P-One-way-ipdv-refmin-Skewness = SkewIPDVRefMin =
                   N
                  ---                                    3
                  \     /                              \
                   >   |  IPDVRefMin[i]- MeanIPDVRefMin |
                  /     \                              /
                  ---
                 i = 1
                -------------------------------------------
                    /                                \
                   |                         ( 3/2 )  |
                    \ (N - 1) * VarIPDVRefMin        /

   We define the Quantile of the IPDVRefMin sample as the value where
   the specified fraction of points is less than the given value.

7.1.5.  Composition Functions:

   This section gives two alternative composition functions.  The
   objective is to estimate a quantile of the complete path delay
   variation distribution.  The composed quantile will be estimated
   using information from the sub-path delay variation distributions.

7.1.5.1.  Approximate Convolution

   The Type-P-One-way-Delay-Poisson/Periodic-Stream samples from each
   sub-path are summarized as a histogram with 1 ms bins representing
   the one-way delay distribution.

   From [TBP], the distribution of the sum of independent random
   variables can be derived using the relation:









Morton & Stephan       Expires September 16, 2007              [Page 16]

Internet-Draft             Spatial Composition                March 2007


   Type-P-One-way-Composite-ipdv-refmin-quantile-a =
                          /  /
     P(X + Y + Z <= a) = |  | P(X <= a-y-z) * P(Y = y) * P(Z = z) dy dz
                        /  /
                        z  y
   where X, Y, and Z are random variables representing the delay
   variation distributions of the sub-paths of the complete path, and a
   is the quantile of interest.  Note dy and dz indicate partial
   integration here.This relation can be used to compose a quantile of
   interest for the complete path from the sub-path delay distributions.
   The histograms with 1 ms bins are discrete approximations of the
   delay distributions.

7.1.5.2.  new section

   Type-P-One-way-Composite-ipdv-refmin-<something> for the complete
   Source to Destination path can be calculated by combining statistics
   of all the constituent sub-paths in the following process:

   < see [Y.1541] section 8 >

7.1.6.  Statement of Conjecture

   The delay distribution of a sufficiently large stream of packets
   measured on each sub-path during the interval [T, Tf] will be
   sufficiently stationary and the sub-path distributions themselves are
   sufficiently independent, so that summary information describing the
   sub-path distributions can be combined to estimate the delay
   distribution of complete path.

7.1.7.  Justification of the Composition Function

   See the common section.

7.1.8.  Sources of Deviation from the Ground Truth

   In addition to the common deviations, the a few additional sources
   exist here.  For one, very tight distributions with range on the
   order of a few milliseconds are not accurately represented by a
   histogram with 1 ms bins.  This size was chosen assuming an implicit
   requirement on accuracy: errors of a few milliseconds are acceptable
   when assessing a composed distribution quantile.

   Also, summary statistics cannot describe the subtleties of an
   empirical distribution exactly, especially when the distribution is
   very different from a classical form.  Any procedure that uses these
   statistics alone may incur error.




Morton & Stephan       Expires September 16, 2007              [Page 17]

Internet-Draft             Spatial Composition                March 2007


7.1.9.  Specific cases where the conjecture might fail

   If the delay distributions of the sub-paths are somehow correlated,
   then neither of these composition functions will be reliable
   estimators of the complete path distribution.

   In practice, sub-path delay distributions with extreme outliers have
   increased the error of the composed metric estimate.

7.1.10.  Application of Measurement Methodology

   See the common section.


8.  Security Considerations

8.1.  Denial of Service Attacks

   This metric requires a stream of packets sent from one host (source)
   to another host (destination) through intervening networks.  This
   method could be abused for denial of service attacks directed at
   destination and/or the intervening network(s).

   Administrators of source, destination, and the intervening network(s)
   should establish bilateral or multi-lateral agreements regarding the
   timing, size, and frequency of collection of sample metrics.  Use of
   this method in excess of the terms agreed between the participants
   may be cause for immediate rejection or discard of packets or other
   escalation procedures defined between the affected parties.

8.2.  User Data Confidentiality

   Active use of this method generates packets for a sample, rather than
   taking samples based on user data, and does not threaten user data
   confidentiality.  Passive measurement must restrict attention to the
   headers of interest.  Since user payloads may be temporarily stored
   for length analysis, suitable precautions MUST be taken to keep this
   information safe and confidential.  In most cases, a hashing function
   will produce a value suitable for payload comparisons.

8.3.  Interference with the metrics

   It may be possible to identify that a certain packet or stream of
   packets is part of a sample.  With that knowledge at the destination
   and/or the intervening networks, it is possible to change the
   processing of the packets (e.g. increasing or decreasing delay) that
   may distort the measured performance.  It may also be possible to
   generate additional packets that appear to be part of the sample



Morton & Stephan       Expires September 16, 2007              [Page 18]

Internet-Draft             Spatial Composition                March 2007


   metric.  These additional packets are likely to perturb the results
   of the sample measurement.

   To discourage the kind of interference mentioned above, packet
   interference checks, such as cryptographic hash, may be used.


9.  IANA Considerations

   Metrics defined in this memo will be registered in the IANA IPPM
   METRICS REGISTRY as described in initial version of the registry
   [RFC4148].


10.  Issues (Open and Closed)

   >>>>>>>>>>>>Issue:

   What is the relationship between the decomposition and composition
   metrics?  Should we put both kinds in one draft to make up a
   framework?  The motivation of decomposition is as follows:

   The One-way measurement can provide result to show what the network
   performance between two end hosts is and whether it meets operator
   expectations or not.  It cannot provide further information to
   engineers where and how to improve the performance between the source
   and the destination.  For instance, if the network performance is not
   acceptable in terms of the One-way measurement, in which part of the
   network the engineers should put their efforts.  This question can to
   be answered by decompose the One-way measurement to sub-path
   measurement to investigate the performance of different part of the
   network.

   Editor's Questions for clarification: What additional information
   would be provided to the decomposition process, beyond the
   measurement of the complete path?

   Is the decomposition described above intended to estimate a metric
   for some/all disjoint sub-paths involved in the complete path?

   >>>>>>>>>>>>>>>>>>RESOLUTION: treat this topic in a separate memo

   >>>>>>>>>>>>>>>>>>>

   >>>>>>>>>>>>>>>>>>>Issue

   Section 7 defines a new type of metric, a "combination" of metrics
   for one-way delay and packet loss.  The purpose of this metric is to



Morton & Stephan       Expires September 16, 2007              [Page 19]

Internet-Draft             Spatial Composition                March 2007


   link these two primary metrics in a convenient way.

   Readers are asked to comment on the efficiency of the combination
   metric.

   >>>>>>>>>>>>>>>>>RESOLUTION: If a delay singleton is recorded as
   having "undefined" delay when the packet does not arrive within the
   waiting time Tmax, then this information is sufficient to determine
   the fraction of lost packets in the sample, and the additional loss
   indication of this combo is not needed.

   >>>>>>>>>>>>>>>>>>

   >>>>>>>>>>>>>>>>> Issue

   Can we introduce multicast metrics here, without causing too much
   confusion?  Should the multicast version of this draft wait until the
   Unicast concepts are stable (or maybe appear in a separate draft)?

   >>>>>>>>>>>>>>>>RESOLUTION: No and Yes.


11.  Acknowledgements


12.  References

12.1.  Normative References

   [I-D.ietf-ippm-framework-compagg]
              Morton, A. and S. Berghe, "Framework for Metric
              Composition", draft-ietf-ippm-framework-compagg-03 (work
              in progress), March 2007.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2330]  Paxson, V., Almes, G., Mahdavi, J., and M. Mathis,
              "Framework for IP Performance Metrics", RFC 2330,
              May 1998.

   [RFC2679]  Almes, G., Kalidindi, S., and M. Zekauskas, "A One-way
              Delay Metric for IPPM", RFC 2679, September 1999.

   [RFC2680]  Almes, G., Kalidindi, S., and M. Zekauskas, "A One-way
              Packet Loss Metric for IPPM", RFC 2680, September 1999.

   [RFC3393]  Demichelis, C. and P. Chimento, "IP Packet Delay Variation



Morton & Stephan       Expires September 16, 2007              [Page 20]

Internet-Draft             Spatial Composition                March 2007


              Metric for IP Performance Metrics (IPPM)", RFC 3393,
              November 2002.

   [RFC3432]  Raisanen, V., Grotefeld, G., and A. Morton, "Network
              performance measurement with periodic streams", RFC 3432,
              November 2002.

   [RFC4148]  Stephan, E., "IP Performance Metrics (IPPM) Metrics
              Registry", BCP 108, RFC 4148, August 2005.

12.2.  Informative References

   [I-D.stephan-ippm-multimetrics]
              Stephan, E., "IP Performance Metrics (IPPM) for spatial
              and multicast", draft-stephan-ippm-multimetrics-02 (work
              in progress), October 2005.

   [Y.1540]   ITU-T Recommendation Y.1540, "Internet protocol data
              communication service - IP packet transfer and
              availability performance parameters", December  2002.

   [Y.1541]   ITU-T Recommendation Y.1540, "Network Performance
              Objectives for IP-based Services", February  2006.


Authors' Addresses

   Al Morton
   AT&T Labs
   200 Laurel Avenue South
   Middletown,, NJ  07748
   USA

   Phone: +1 732 420 1571
   Fax:   +1 732 368 1192
   Email: acmorton@att.com
   URI:   http://home.comcast.net/~acmacm/














Morton & Stephan       Expires September 16, 2007              [Page 21]

Internet-Draft             Spatial Composition                March 2007


   Emile Stephan
   France Telecom Division R&D
   2 avenue Pierre Marzin
   Lannion,   F-22307
   France

   Phone:
   Fax:   +33 2 96 05 18 52
   Email: emile.stephan@orange-ftgroup.com
   URI:









































Morton & Stephan       Expires September 16, 2007              [Page 22]

Internet-Draft             Spatial Composition                March 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Morton & Stephan       Expires September 16, 2007              [Page 23]


