<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet type="text/xsl" href="../rfc2629.xslt"?><!DOCTYPE rfc SYSTEM 'rfc2629.dtd' [<!ENTITY rfc1939 PUBLIC '' 'bibxml/reference.RFC.1939.xml'><!ENTITY rfc2119 PUBLIC '' 'bibxml/reference.RFC.2119.xml'><!ENTITY rfc2595 PUBLIC '' 'bibxml/reference.RFC.2595.xml'><!ENTITY rfc2782 PUBLIC '' 'bibxml/reference.RFC.2782.xml'><!ENTITY rfc3207 PUBLIC '' 'bibxml/reference.RFC.3207.xml'><!ENTITY rfc3501 PUBLIC '' 'bibxml/reference.RFC.3501.xml'><!ENTITY rfc4366 PUBLIC '' 'bibxml/reference.RFC.4366.xml'><!ENTITY rfc4409 PUBLIC '' 'bibxml/reference.RFC.4409.xml'><!ENTITY rfc5321 PUBLIC '' 'bibxml/reference.RFC.5321.xml'><!ENTITY rfc5322 PUBLIC '' 'bibxml/reference.RFC.5322.xml'>]> <?rfc rfcedstyle="yes" ?><?rfc toc="yes"?><?rfc tocdepth="4"?><!-- default = 3 --><?rfc symrefs="yes"?><?rfc sortrefs="yes"?><?rfc compact="yes"?><?rfc subcompact="no"?><!-- <?rfc strict="yes"?> --><!-- <?rfc comments="yes"?> --><!-- <?rfc inline="yes"?> --><rfc category="std" ipr='trust200902' docName='draft-daboo-srv-email-02'>  <front>    <title abbrev="SRV for Email">Use of SRV records for locating email services</title>    <author initials="C." surname="Daboo" fullname="Cyrus Daboo">      <organization abbrev="Apple Inc.">        Apple Inc.       </organization>      <address>        <postal>          <street>            1 Infinite Loop           </street>          <city>            Cupertino           </city>          <region>            CA           </region>          <code> 95014 </code>           <country>            USA           </country>        </postal>        <email>          cyrus@daboo.name         </email>        <uri>          http://www.apple.com/         </uri>      </address>    </author>    <date />    <area>      Applications     </area>    <abstract>      <t>        This specification describes how SRV records can be used to locate email services.      </t>    </abstract>  </front>  <middle>    <section title='Introduction'>      <t>        <xref target="RFC2782"/> defines a DNS-based service discovery protocol that has been widely adopted as a means of locating particular services within a local area network and beyond, using SRV RR records.      </t>      <t>        Internet Email protocols include <xref target="RFC5321">SMTP</xref>, <xref target="RFC3501">IMAP</xref> and <xref target="RFC1939">POP3</xref>.      </t>      <t>      	<xref target="RFC5321"/> defines the MX RR record type to locate SMTP services for a domain. However, <xref target="RFC4409"/> defines a "profile" of the SMTP service that is specifically used for message submission - which is of direct relevance to email clients which typically don't use MX records.      </t>      <t>      	Both IMAP and POP3 are mail access protocols used by email clients to manipulate email messages after delivery.      </t>      <t>      	Typically email clients have required users to enter host name and port information for the services they need. This is not ideal as the way in which server information is specified can differ from client to client, and can be confusing to users, leading to errors when inputting the details. A better approach would be to require miniml information to be entered by a user which would result in automatic configuration of appropriate services for that user. The minimal information entered would be the user's email address.      </t>      <t>        This specification defines new SRV service types for the message submission, IMAP and POP3 services to enable simple auto configuration of email clients.      </t>    </section>    <section title='Conventions Used in This Document'>      <t>        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target='RFC2119' />.       </t>    </section>    <section title='SRV service types'>		<section title='Email Submission'>			<t>				This specification adds one SRV service type for <xref target="RFC4409">message submission</xref>:				<list style="hanging">					<t hangText="submission:">						Identifies a message submission server as defined by <xref target="RFC4409"/>. Note that this covers connections both with and without transport layer security <xref target='RFC3207'/>.					</t>				</list>				<figure>					<preamble>						Example: service record					</preamble>					<artwork>    _submission._tcp     SRV 0 1 587 mail.example.com.					</artwork>				</figure>			</t>		</section>		<section title='IMAP'>			<t>				This specification adds two SRV service types for <xref target="RFC3501">IMAP</xref>:				<list style="hanging">					<t hangText="imap:">						Identifies an IMAP server that MAY advertise the "LOGINDISABLED" capability and MAY require the client to use the "STARTTLS" command prior to authentication.  Although these two extensions are mandatory-to-implement for both clients and servers, they are not mandatory-to-use by service providers.					</t>					<t hangText="imaps:">						Identifies an IMAP server where transport layer security is initiated directly upon connection to the server.					</t>				</list>				<figure>					<preamble>						Example: service record					</preamble>					<artwork>    _imap._tcp     SRV 0 1 143 imap.example.com.					</artwork>				</figure>				<figure>					<preamble>						Example: service record					</preamble>					<artwork>    _imaps._tcp     SRV 0 1 993 imap.example.com.					</artwork>				</figure>			</t>		</section>		<section title='POP3'>			<t>				This specification adds two SRV service types for <xref target="RFC1939">POP3</xref>:				<list style="hanging">					<t hangText="pop3:">						Identifies a POP3 server that MAY require the client to use the <xref target='RFC2595'>"STLS" extension command</xref> prior to authentication.  					</t>					<t hangText="pop3s:">						Identifies a POP3 server where transport layer security is initiated directly upon connection to the server.					</t>				</list>				<figure>					<preamble>						Example: service record					</preamble>					<artwork>    _pop3._tcp     SRV 0 1 110 pop3.example.com.					</artwork>				</figure>				<figure>					<preamble>						Example: service record					</preamble>					<artwork>    _pop3s._tcp     SRV 0 1 995 pop3.example.com.					</artwork>				</figure>			</t>		</section>    </section>    <section title='Guidance for mail access clients'>      <t>      	By using SRV records as above, clients need initially only prompt the user for their <xref target="RFC5322">email address</xref>. "local-part" and "domain" portions are then extracted from the email address by the client. The client uses the "domain" portion as the service domain to perform SRV lookups for the services it wants to configure. If the SRV lookup is successful the host name and port for the service can be determined and used to complete client configuration. If an SRV record is not found, the client will need to prompt the user to enter host name and port information directly.      </t>      <t>      	Clients that support both POP3 and IMAP SHOULD check for both services using SRV lookups, and for both SSL and non-SSL variants. If both POP3 and IMAP services are returned the choice of which to configure is up to the client - it could prompt the user to make a choice, or pick one based on local policy.      </t>      <t>      	Subsequent to configuration, the client will connect to the service. When using "imaps" or "pop3s" services, a transport layer security negotiation is done immediately upon connection. With "imap" and "pop3" services, the "STARTTLS" or "STLS" commands respectively are used to initiate a protected connection. When using transport layer security in this way, clients SHOULD use the <xref target="RFC4366">TLS Server Name Indication</xref> and include the service domain name used in the SRV record lookup as the name.      </t>      <t>      	Once a suitable connection has been made, and any required protection setup, the client will typically need to authenticate with the server. The details of that are governed by the specific protocols themselves, though often times a "user identifier" is required for some form of user/password authentication (such as the SASL "PLAIN" mechanism). When a user identifier is required, clients MUST first use the full email address provided by the user, and if that results in an authentication failure, SHOULD fall back to using the "local-part" extracted from the email address. This is in line with the guidance outlined in <xref target="service_provider"/>.      </t>    </section>    <section title='Guidance for Service Providers' anchor='service_provider'>    	<t>    		Service providers wanting to offer a POP3 or IMAP service that can be configured by clients using SRV records need to follow certain guidelines to ensure proper operation.    	</t>    	<t>    		<list style='letters'>    			<t>Servers SHOULD be configured to allow authentication with email addresses or email local-parts. In the former case, the email addresses must not conflict with other forms of permitted user login name. In the latter case, the email local-parts need to be unique across the server and not conflict with any login name on the server.</t>    			<t>If the service provider uses transport layer security, the service provider MUST ensure a certificate is installed that matches the email domain name used to configure clients.  If the service provider hosts multiple domains on the same IP address, then the service provider MUST enable support for the <xref target="RFC4366">TLS Server Name Indication</xref>.</t>    			<t>Install the appropriate SRV records for the offered services.</t>    		</list>    	</t>    </section>    <section title='Security Considerations'>      <t>   		If a user has explicitly requested a connection with transport layer security (user interfaces sometimes present this choice as a "use SSL" or "secure connection" checkbox), the client MUST successfully negotiate transport layer security prior to sending an authentication command.  The client MAY do this with "imaps", "pop3s", "imap" with "STARTTLS", or "pop3" with "STLS". Service providers MAY offer any subset of these four options for the mail service.      </t>      <t>        A malicious attacker with access to the DNS server data can potentially cause clients to connect to any server chosen by the attacker. In the absence of a secure DNS option, clients SHOULD check that the host name returned in the SRV record matches the original service domain that was queried. If the host is not in the queried domain, clients SHOULD verify with the user that the SRV host name is suitable for use before executing any connections to the host. Alternatively, if transport layer security is being used, clients MUST use the service domain used in the SRV record lookup as the server name for certificate verification pruposes.      </t>    </section>    <section title='IANA Considerations'>      <t>        This document does not require any actions on the part of IANA.       </t>    </section>    <section title='Acknowledgments'>      <t>        Thanks to Alexey Melnikov, and Chris Newman for feedback and suggestions.      </t>    </section>  </middle>  <back>    <references title='Normative References'>      &rfc1939;       &rfc2119;       &rfc2595;      &rfc2782;      &rfc3207;      &rfc3501;      &rfc4366;      &rfc4409;      &rfc5321;      &rfc5322;    </references><!--    <references title='Informative References'>    </references> --><section title='Change History (to be removed prior to publication as an RFC)'><t>Changes in -02:<list style='numbers'>  <t>Tweaked text for imap to better describe mandatory-to-implement behavior from base spec.</t>  <t>Tweaked text for pop3 along similar lines as imap.</t>  <t>Teaked security considerations to account for use of STARTTLS and STLS.</t>  <t>Added examples for imaps and pop3s.</t>  <t>Re-worked client guidelines.</t>  <t>Added service provider guidelines.</t></list></t><t>Changes in -01:<list style='numbers'>  <t>Tweaked text for pop3 to make it clearer that STLS is an extension.</t>  <t>Added text to explain that the email address, as well as the local-part, may be used as the user identifier.</t>  <t>Teaked security considerations to account for use of STARTTLS and STLS.</t></list></t></section>  </back></rfc>