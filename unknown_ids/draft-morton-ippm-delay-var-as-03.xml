<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="info" docName="draft-morton-ippm-delay-var-as-03"
     ipr="full3978">
  <front>
    <title abbrev="Delay Variation AS">Packet Delay Variation Applicability
    Statement</title>

    <author fullname="Al Morton" initials="A." surname="Morton">
      <organization>AT&amp;T Labs</organization>

      <address>
        <postal>
          <street>200 Laurel Avenue South</street>

          <city>Middletown,</city>

          <region>NJ</region>

          <code>07748</code>

          <country>USA</country>
        </postal>

        <phone>+1 732 420 1571</phone>

        <facsimile>+1 732 368 1192</facsimile>

        <email>acmorton@att.com</email>

        <uri>http://home.comcast.net/~acmacm/</uri>
      </address>
    </author>

    <author fullname="Benoit Claise" initials="B." surname="Claise">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>De Kleetlaan 6a b1</street>

          <city>Diegem</city>

          <region></region>

          <code>1831</code>

          <country>Belgium</country>
        </postal>

        <phone>+32 2 704 5622</phone>

        <facsimile></facsimile>

        <email>bclaise@cisco.com</email>

        <uri></uri>
      </address>
    </author>

    <date day="7" month="July" year="2007" />

    <abstract>
      <t>Packet delay variation metrics appear in many different standards
      documents. The metric definition in RFC 3393 has considerable
      flexibility, and it allows multiple formulations of delay variation
      through the specification of different packet selection functions.</t>

      <t>Although flexibility provides wide coverage and room for new ideas,
      it can make comparisons of independent implementations more difficult.
      Two different formulations of delay variation have come into wide use in
      the context of active measurements. This memo examines a range of
      circumstances for active measurements of delay variation and their uses,
      and recommends which of the two forms is best matched to particular
      conditions and tasks.</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>There are many ways to formulate packet delay variation metrics for
      the Internet and other packet-based networks. The IETF itself has
      several specifications for delay variation <xref
      target="RFC3393"></xref>, sometimes called jitter <xref
      target="RFC3550"></xref> or even interarrival jitter <xref
      target="RFC3550"></xref>, and these have achieved wide adoption. The
      International Telecommunication Union - Telecommunication
      Standardization Sector (ITU-T) has also recommended several delay
      variation metrics (called parameters in their terminology) <xref
      target="Y.1540"></xref> <xref target="G.1020"></xref>, and some of these
      are widely cited and used. Most of the standards above specify more than
      one way to quantify delay variation, so one can conclude that
      standardization efforts have tended to be inclusive rather than
      selective.</t>

      <t>This memo uses the term "delay variation" for metrics that quantify a
      path's ability to transfer packets with consistent delay. <xref
      target="RFC3393"></xref> and <xref target="Y.1540"></xref> both prefer
      this term. Some refer to this phenomenon as "jitter" (and the buffers
      that attempt to smooth the variations as de-jitter buffers).
      Applications of the term "jitter" are much broader than packet transfer
      performance, with "unwanted signal variation" as a general definition.
      "Jitter" has been used to describe frequency or phase variations, such
      as data stream rate variations or carrier signal phase noise. The phrase
      "delay variation" is almost self-defining and more precise, so it is
      preferred in this memo.</t>

      <t>Most (if not all) delay variation metrics are derived metrics, in
      that their definitions rely on another fundamental metric. In this case,
      the fundamental metric is one-way delay, and variation is assessed by
      computing the difference between two individual one-way delay
      measurements, or a pair of singletons. One of the delay singletons is
      taken as a reference, and the result is the variation with respect to
      the reference. The variation is usually summarized for all packets in a
      stream using statistics.</t>

      <t>The industry has predominantly implemented two specific formulations
      of delay variation (for one survey of the situation, see<xref
      target="Krzanowski"></xref>):</t>

      <t><list style="numbers">
          <t>Inter-Packet Delay Variation, IPDV, where the reference is the
          previous packet in the stream (according to sending sequence), and
          the reference changes for each packet in the stream. Properties of
          variation are coupled with packet sequence in this formulation. This
          form was called Instantaneous Packet Delay Variation in early
          contributions.</t>

          <t>Packet Delay Variation, PDV, where a single reference is chosen
          from the stream based on specific criteria, and the reference is
          fixed once selected. The most common criterion for the reference is
          the packet with the minimum delay in the sample. This term derives
          its name from a similar definition for Cell Delay Variation, an ATM
          performance metric.</t>
        </list></t>

      <t>It is important to note that the authors of relevant standards for
      delay variation recognized there are many different users with varying
      needs, and allowed sufficient flexibility to formulate several metrics
      with different properties. Therefore, the comparison is not so much
      between standards bodies or their specifications as it is between
      specific formulations of delay variation. Both Inter-Packet Delay
      Variation and Packet Delay Variation are compliant with <xref
      target="RFC3393"></xref>, because different packet selection functions
      will produce either form.</t>

      <section title="Background Literature in IPPM and Elsewhere">
        <t>With more people joining the measurement community every day, it is
        possible this memo is the first from the IP Performance Metrics (IPPM)
        Working Group that the reader has consulted. This section provides a
        brief roadmap and background on the IPPM literature, and the published
        specifications of other relevant standards organizations.</t>

        <t>The IPPM framework <xref target="RFC2330"></xref> provides a
        background for this memo and other IPPM RFCs. Key terms such as
        singleton, sample, and statistic are defined there, along with methods
        of collecting samples (Poisson streams), time related issues, and the
        "packet of Type-P" convention.</t>

        <t>There are two fundamental and related metrics that can be applied
        to every packet transfer attempt: one-way loss <xref
        target="RFC2680"></xref> and one-way delay <xref
        target="RFC2679"></xref>. Lost and delayed packets are separated by a
        waiting time threshold. Packets that arrive at the measurement
        destination within their waiting time have finite delay and are not
        lost. Otherwise, packets are designated lost and their delay is
        undefined. Guidance on setting the waiting time threshold may be found
        in <xref target="RFC2680"></xref> and <xref
        target="I-D.morton-ippm-reporting-metrics"></xref>.</t>

        <t>Another fundamental metric is packet reordering as specified in
        <xref target="RFC4737"></xref>. The reordering metric was defined to
        be "orthogonal" to packet loss. In other words, the gap in a packet
        sequence caused by loss does not result in reordered packets, but a
        re-arrangement of packet arrivals from their sending order constitutes
        reordering.</t>

        <t>Derived metrics are based on the fundamental metrics. The derived
        metric of primary interest here is delay variation <xref
        target="RFC3393"></xref>, a metric which is derived from one-way delay
        <xref target="RFC2680"></xref>. Another derived metric is the loss
        patterns metric <xref target="RFC3357"></xref>, which is derived from
        loss.</t>

        <t>In the ITU-T, the framework, fundamental metrics and derived
        metrics for IP performance are all specified in Recommendation Y.1540
        <xref target="Y.1540"></xref>.</t>
      </section>

      <section title="Organization of the Memo">
        <t>The Purpose and Scope follows in Section 2. We then give a summary
        of the main tasks for delay variation metrics in section 3. Section 4
        defines the two primary forms of delay variation, and section 5
        presents summaries of four earlier comparisons. Section 6 adds new
        comparisons to the analysis, and section 7 reviews the applicability
        and recommendations for each form of delay variation. Section 8 then
        looks at many important delay variation measurement considerations.
        Following IANA and Security Considerations, there two Appendices. One
        presents guidance on reducing delay variation in networks, and the
        other calculation of the minimum delay for the PDV form.</t>
      </section>
    </section>

    <section title="Purpose and Scope">
      <t>The IPDV and PDV formulations have certain features that make them
      more suitable for one circumstance and less so for another. The purpose
      of this memo is to compare two forms of delay variation, so that it will
      be evident which of the two is better suited for each of many possible
      uses and their related circumstances.</t>

      <t>The scope of this memo is limited to the two forms of delay variation
      briefly described above (Inter-Packet Delay Variation and Packet Delay
      Variation), circumstances related to active measurement, and uses that
      are deemed relevant and worthy of inclusion here through IPPM Working
      Group consensus.</t>

      <t>The scope excludes assessment of delay variation for packets with
      undefined delay. This is accomplished by conditioning the delay
      distribution on arrival within a reasonable waiting time based on an
      understanding of the path under test and packet lifetimes. The waiting
      time is sometimes called the loss threshold <xref
      target="RFC2680"></xref>: if a packet arrives beyond this threshold, it
      may as well have been lost because it is no longer useful. This is
      consistent with <xref target="RFC3393"></xref>, where the
      Type-P-One-way-ipdv is undefined when the destination fails to receive
      one or both packets in the selected pair. Furthermore, it is consistent
      with application performance analysis to consider only arriving packets,
      because a finite waiting time-out is a feature of many protocols.</t>
    </section>

    <section title="Brief Descriptions of Delay Variation Uses">
      <t>This section presents a set of tasks that call for delay variation
      measurements. Here, the memo provides several answers to the question,
      "How will the results be used?" for the delay variation metric.</t>

      <section title="Inferring Queue Occupation on a Path">
        <t>As packets travel along the path from source to destination, they
        pass through many network elements, including a series of router
        queues. Some types of the delay sources along the path are constant,
        such as links between two locations. But the latency encountered in
        each queue varies, depending on the number of packets in the queue
        when a particular packet arrives. If one assumes that at least one of
        the packets in a test stream encounters virtually empty queues all
        along the path (and the path is stable), then the additional delay
        observed on other packets can be attributed to the time spent in one
        or more queues. Otherwise, the delay variation observed is the
        variation in queue time experienced by the test stream.</t>
      </section>

      <section title="Determining De-jitter Buffer Size">
        <t>Note - while this memo and other IPPM literature prefer the term
        delay variation, the terms "jitter buffer" and the more accurate
        "de-jitter buffer" are widely adopted names for a component of packet
        communication systems, and they will be used here to designate that
        system component.</t>

        <t>Most Isochronous applications (a.k.a. real-time applications)
        employ a buffer to smooth out delay variation encountered on the path
        from source to destination. The buffer must be big enough to
        accommodate (most of) the expected variation, or packet loss will
        result. However, if the buffer is too large, then some of the desired
        spontaneity of communication will be lost and conversational dynamics
        will be affected. Therefore, application designers need to know the
        extent of delay variation they must accommodate, whether they are
        designing fixed or adaptive buffer systems.</t>

        <t>Network service providers also attempt to constrain delay variation
        to ensure the quality of real-time applications, and monitor this
        metric (possibly to compare with a numerical objective or Service
        Level Agreement).</t>
      </section>

      <section title="Spatial Composition">
        <t>In Spatial Composition, the tasks are similar to those described
        above, but with the additional complexity of a multiple network path
        where several sub-paths are measured separately, and no source to
        destination measurements are available. In this case, the source to
        destination performance must be estimated, using Composed Metrics as
        described in <xref target="I-D.ietf-ippm-framework-compagg"></xref>
        and <xref target="Y.1541"></xref>. Note that determining the composite
        delay variation is not trivial: simply summing the sub-path variations
        is not accurate.</t>
      </section>

      <section title="Service Level Comparison">
        <t>IP performance measurements are often used as the basis for
        agreements (or contracts) between service providers and their
        customers. The measurement results must compare favorably with the
        performance levels specified in the agreement.</t>

        <t>Packet delay variation is usually one of the metrics specified in
        these agreements. In principle, any formulation could be specified in
        the Service Level Agreement (SLA). However, the SLA is most useful
        when the measured quantities can be related to ways in which the
        communication service will be utilized by the customer, and this can
        usually be derived from one of the tasks described above.</t>
      </section>

      <section title="&lt;your favorite here&gt;">
        <t>Note: At the IETF-68 IPPM session, Alan Clark suggested another
        possible task for DV measurements, that of detecting and somehow
        removing the delay variation associated with a smoothing buffer used
        with a video codec. Further work is needed to define the problem and
        to investigate the applicability of IPDV and PDV.</t>
      </section>
    </section>

    <section title="Formulations of IPDV and PDV">
      <t>This section presents the formulations of IPDV and PDV, and provides
      some illustrative examples. We use the basic singleton definition in
      <xref target="RFC3393"></xref> (which itself is based on <xref
      target="RFC2679"></xref>):</t>

      <t>"Type-P-One-way-ipdv is defined for two packets from Src to Dst
      selected by the selection function F, as the difference between the
      value of the Type-P-One-way-delay from Src to Dst at T2 and the value of
      the Type-P-One-Way-Delay from Src to Dst at T1."</t>

      <section title="IPDV: Inter-Packet Delay Variation">
        <t>If we have packets in a stream consecutively numbered i = 1,2,3,...
        falling within the test interval, then IPDV(i) = D(i)-D(i-1) where
        D(i) denotes the one-way-delay of the ith packet of a stream.</t>

        <t>0ne-way delays are the difference between timestamps applied at the
        ends of the path, or the receiver time minus the transmission time. So
        D(2) = R2-T2. With this timestamp notation, it can be shown that IPDV
        also represents the change in inter-packet spacing between
        transmission and reception:</t>

        <t>IPDV(2) = D(2) - D(1) = (R2-T2) - (R1-T1) = (R2-R1) - (T2-T1)</t>

        <t>An example selection function given in <xref
        target="RFC3393"></xref> is "Consecutive Type-P packets within the
        specified interval." This is exactly the function needed for IPDV. The
        reference packet in the pair is always the previous packet in the
        sending sequence.</t>

        <t>Note that IPDV can take on positive and negative values (and zero),
        although one of the useful ways to analyze the results is to
        concentrate on the positive excursions. This is discussed in more
        detail below.</t>
      </section>

      <section title="PDV: Packet Delay Variation">
        <t>The name Packet Delay Variation is used in <xref
        target="Y.1540"></xref> and its predecessors, and refers to a
        performance parameter equivalent to the metric described below.</t>

        <t>The Selection Function for PDV requires two specific roles for the
        packets in the pair. The first packet is any Type-P packet within the
        specified interval. The second, or reference packet is the Type-P
        packet within the specified interval with the minimum
        one-way-delay.</t>

        <t>Therefore, PDV(i) = D(i)-D(min) (using the nomenclature introduced
        in the IPDV section). D(min) is the delay of the packet with the
        lowest value for delay (minimum) over the current test interval.
        Values of PDV may be zero or positive, and quantiles of the PDV
        distribution are direct indications of delay variation.</t>
      </section>

      <section title="Examples and Initial Comparisons">
        <t>Note: This material originally presented in slides 2 and 3 of</t>

        <t>http://www3.ietf.org/proceedings/06mar/slides/ippm-4.pdf</t>

        <t>The Figure below gives a sample of packet delays and calculates
        IPDV and PDV values and depicts a histogram for each one.</t>

        <t><figure anchor="FigA4.3" title="IPDV and PDV Comparison">
            <preamble></preamble>

            <artwork align="center"><![CDATA[       Packet #     1   2   3   4   5  
       -------------------------------
       Delay, ms   20  10  20  25  20

       IPDV         U -10  10   5  -5

       PDV         10   0  10  15  10

          |                 |
         4|                4|
          |                 |
         3|                3|         H
          |                 |         H
         2|                2|         H
          |                 |         H
  H   H  1|   H   H        1|H        H   H
  H   H   |   H   H         |H        H   H
 ---------+--------         +---------------
-10  -5   0   5  10          0   5   10  15

   IPDV Histogram             PDV Histogram

]]></artwork>

            <postamble></postamble>
          </figure></t>

        <t>The sample of packets contains three packets with "typical" delays
        of 20ms, one packet with a low delay of 10ms (the minimum of the
        sample) and one packet with 25ms delay.</t>

        <t>As noted above, this example illustrates that IPDV may take on
        positive and negative values, while the PDV values are greater than or
        equal to zero. The Histograms of IPDV and PDV are quite different in
        general shape, and the ranges are different, too (IPDV range = 20ms,
        PDV range = 15 ms). Note that the IPDV histogram will change if the
        sequence of delays is modified, but the PDV histogram will stay the
        same. PDV normalizes the one-way delay distribution to the minimum
        delay and emphasizes the variation independent from the sequence of
        delays.</t>
      </section>
    </section>

    <section title="Survey of Earlier Comparisons">
      <t>This section summarizes previous work to compare these two forms of
      delay variation.</t>

      <section title="Demichelis' Comparison ">
        <t>In <xref target="Demichelis"></xref>, Demichelis compared the early
        draft versions of two forms of delay variation. Although the IPDV form
        would eventually see widespread use, the ITU-T work-in-progress he
        cited did not utilize the same reference packets as PDV. Demichelis
        compared IPDV with the alternatives of using the delay of the first
        packet in the stream and the mean delay of the stream as the PDV
        reference packet. Neither of these alternative references were used in
        practice, and they are now deprecated in favor of the minimum delay of
        the stream <xref target="Y.1540"></xref>.</t>

        <t>Active measurements of a transcontinental path (Torino to Tokyo)
        provided the data for the comparison. The Poisson test stream had
        0.764 second average inter-packet interval, with more than 58 thousand
        packets over 13.5 hours. Among Demichelis' observations about IPDV are
        the following:</t>

        <t><list style="numbers">
            <t>IPDV is a measure of the network's ability to preserve the
            spacing between packets.</t>

            <t>The distribution of IPDV is usually symmetrical about the
            origin, having a balance of negative and positive values (for the
            most part). The mean is usually zero, unless some long-term delay
            trend is present.</t>

            <t>IPDV distinguishes quick delay variations (on the order of the
            interval between packets) from longer term variations.</t>

            <t>IPDV places reduced demands on the stability and skew of
            measurement clocks.</t>
          </list>He also notes these features of PDV:</t>

        <t><list style="numbers">
            <t>PDV does not distinguish quick variation from variation over
            the complete test interval.</t>

            <t>The location of the distribution is very sensitive to the delay
            of the first packet, IF this packet is used as the reference. This
            would be a new formulation that differs from the PDV definition in
            this memo (PDV references the packet with minimum delay, so it
            does not have this drawback).</t>

            <t>The shape of the PDV distribution is identical to the delay
            distribution, but shifted by the reference delay.</t>

            <t>Use of a common reference over measurement intervals that are
            longer than a typical session length may indicate more PDV than
            would be experienced by streams that support such sessions.</t>

            <t>PDV characterizes the range of queue occupancies along the
            measurement path (assuming the path is fixed), but the range says
            nothing about how the variation took place.</t>
          </list>The summary metrics used in this comparison were the number
        of values exceeding a +/-50ms range around the mean, the Inverse
        Percentiles, and the Inter-Quartile Range.</t>
      </section>

      <section title="Ciavattone et al.">
        <t>In <xref target="Cia03"></xref>, the authors compared IPDV and PDV
        (referred to as delta) using a periodic packet stream conforming to
        <xref target="RFC3432"></xref> with inter-packet interval of 20
        ms.</t>

        <t>One of the comparisons between IPDV and PDV involves a laboratory
        set-up where a queue was temporarily congested by a competing packet
        burst. The additional queuing delay was 85ms to 95ms, much larger than
        the inter-packet interval. The first packet in the stream that follows
        the competing burst spends the longest time enqueued, and others
        experience less and less queuing time until the queue is drained.</t>

        <t>The authors observed that PDV reflects the additional queuing time
        of the packets affected by the burst, with values of 85, 65, 45, 25,
        and 5ms. Also, it is easy to determine (by looking at the PDV range)
        that a de-jitter buffer of 90 ms would have been sufficient to
        accommodate the delay variation.</t>

        <t>The distribution of IPDV values in the congested queue example are
        very different: 85, -20, -20, -20, -20, -5ms. Only the positive
        excursion of IPDV gives an indication of the de-jitter buffer size
        needed. Although the variation exceeds the inter-packet interval, the
        extent of negative IPDV values is limited by that sending interval.
        This preference for information from the positive IPDV values has
        prompted some to ignore the negative values, or to take the absolute
        value of each IPDV measurement (sacrificing key properties of IPDV in
        the process, such as its ability to distinguish delay trends).</t>

        <t>Elsewhere, the authors considered the range as a summary statistic
        for IPDV, and the 99.9%-ile minus the minimum delay as a summary
        statistic for delay variation, or PDV.</t>
      </section>

      <section title="IPPM List Discussion from 2000">
        <t>Mike Pierce made many comments in the context of the 05 version of
        draft-ietf-ippm-ipdv. One of his main points was that a delay
        histogram is a useful approach to quantifying variation. Another was
        the that the time duration of evaluation is a critical aspect.</t>

        <t>Carlo Demichelis then mailed his comparison paper to the IPPM list,
        <xref target="Demichelis"></xref> as discussed in more detail
        above.</t>

        <t>Ruediger Geib observed that both IPDV and the delay histogram (PDV)
        are useful, and suggested that they might be applied to different
        variation time scales. He pointed out that loss has a significant
        effect on IPDV, and encouraged that the loss information be retained
        in the arrival sequence.</t>

        <t>Several example delay variation scenarios were discussed,
        including:</t>

        <t><figure anchor="Fig0" title="Delay Examples">
            <preamble></preamble>

            <artwork align="center"><![CDATA[Packet #     1   2   3   4   5   6   7   8   9  10  11
-------------------------------------------------------
Ex. A
Lost       

Delay, ms  100 110 120 130 140 150 140 130 120 110 100

IPDV        U   10  10  10  10  10 -10 -10 -10 -10 -10

PDV         0   10  20  30  40  50  40  30  20  10   0

-------------------------------------------------------
Ex. B
Lost                     L

Delay, ms  100 110 150   U 120 100 110 150 130 120 100

IPDV        U   10  40   U   U -10  10  40 -20 -10 -20

PDV         0   10  50   U  20   0  10  50  30  20   0]]></artwork>

            <postamble></postamble>
          </figure></t>

        <t>Clearly, the range of PDV values is 50 ms in both cases above,
        while the IPDV range tends to minimize the smooth variation in Example
        A (20 ms), and responds to the faster variations in Example B (60
        ms).</t>

        <t>IPDV values can be viewed as the adjustments that an adaptive
        de-jitter buffer would make, IF it could make adjustments on a
        packet-by-packet basis. However, adaptive de-jitter buffers don't make
        adjustments this frequently, so the value of this information is
        unknown.</t>
      </section>

      <section title="Y.1540 Appendix II">
        <t>This Appendix compares IPDV, PDV (referred to as 2-point PDV), and
        1-point packet delay variation (which assume a periodic stream and
        assesses variation against an ideal arrival schedule constructed at
        the single measurement point).</t>
      </section>
    </section>

    <section title="Additional Properties and Comparisons">
      <t>This section treats some of the earlier comparison areas in more
      detail, and introduces new areas for comparison.</t>

      <section title="Packet Loss">
        <t>The measurement packet loss is of great influence for the delay
        variation results, as displayed in the figure 2 and 3 (L means Lost
        and U means undefined). Figure 3 shows that in the extreme case of
        every other packet loss, the IPDV doesn't produce any results, while
        the PDV produces results for all arriving packets.</t>

        <t><figure anchor="Fig1" title="Path Loss Every Other Packet">
            <preamble></preamble>

            <artwork align="center"><![CDATA[Packet #   1  2  3  4  5  6  7  8  9 10
Lost          L     L     L     L     L
---------------------------------------
Delay, ms  3  U  5  U  4  U  3  U  4  U

IPDV       U  U  U  U  U  U  U  U  U  U

PDV        0  U  2  U  1  U  0  U  1  U]]></artwork>

            <postamble></postamble>
          </figure></t>

        <t>In case of a burst of packet loss, as displayed in figure 3, both
        the IPDV and PDV produces some results. Note that the PDV.</t>

        <t><figure anchor="Fig2" title="Burst of Packet Loss">
            <preamble></preamble>

            <artwork align="center"><![CDATA[Packet #   1  2  3  4  5  6  7  8  9 10
Lost             L  L  L  L  L
---------------------------------------
Delay, ms  3  4  U  U  U  U  U  5  4  3

IPDV       U  1  U  U  U  U  U  U -1 -1

PDV        0  1  U  U  U  U  U  2  1  0]]></artwork>

            <postamble></postamble>
          </figure></t>

        <t>In conclusion, the PDV results are affected by the packet loss
        ratio. While the IPDV results are affected by the packet loss ratio,
        they are also affected by the packet loss distribution. Indeed, in the
        extreme case of every other packet loss, the IPDV doesn't provide any
        results.</t>
      </section>

      <section title="Path Changes">
        <t>When there is little or no stability in the network under test,
        then the devices that attempt to characterize the network are equally
        stressed, especially if the results displayed are used to make
        inferences which may not be valid.</t>

        <t>Sometimes the path characteristics change during a measurement
        interval. The change may be due to link or router failure,
        administrative changes prior to maintenance (e.g., link cost change),
        or re-optimization of routing using new information. All these causes
        are usually infrequent, and network providers take appropriate
        measures to ensure this. Automatic restoration to a back-up path is
        seen as a desirable feature of IP networks.</t>

        <t>Frequent path changes and prolonged congestion with substantial
        packet loss clearly make delay variation measurements challenging.
        Path changes are usually accompanied by a sudden, persistent increase
        or decrease in one-way-delay. <xref target="Cia03"></xref> gives one
        such example. We assume that a restoration path either accepts a
        stream of packets, or is not used for that particular stream (e.g., no
        multi-path for flows).</t>

        <t>In any case, a change in the TTL (or Hop Limit) of the received
        packets indicates that the path is no longer the same. Transient
        packet reordering may also be observed with path changes, due to use
        of non-optimal routing while updates propagate through the network
        (see <xref target="Casner"></xref> and <xref target="Cia03"></xref>
        )</t>

        <t>Many, if not all, packet streams experience packet loss in
        conjunction with a path change. However, it is certainly possible that
        the active measurement stream does not experience loss. This may be
        due to use of a long inter-packet sending interval with respect to the
        restoration time, and this becomes more likely as "fast restoration"
        techniques see wider deployment (e.g., <xref
        target="RFC4090"></xref>.</t>

        <t>Thus, there are two main cases to consider, path changes
        accompanied by loss, and those that are lossless from the point of
        view of the active measurement stream. The subsections below examine
        each of these cases.</t>

        <section title="Lossless Path Change">
          <t>In the lossless case, a path change will typically affect only
          two IPDV singletons. However, if the change in delay is negative and
          larger than the inter-packet sending interval, then more than two
          IPDV singletons may be affected because packet reordering is also
          likely to occur.</t>

          <t>The use of the new path and its delay variation can be quantified
          by treating the PDV distribution as bi-modal, and characterizing
          each mode separately. This would involve declaring a new path within
          the sample, and using a new local minimum delay as the PDV reference
          delay for the sub-sample (or time interval) where the new path is
          present.</t>

          <t>The process of detecting a bi-modal delay distribution is made
          difficult if the typical delay variation is larger than the delay
          change associated with the new path. However, information on TTL (or
          Hop Limit) change or the presence of transient reordering can assist
          in an automated decision.</t>

          <t>The effect of path changes may also be reduced by making PDV
          measurements over short intervals (minutes, as opposed to hours).
          This way, a path change will affect one sample and its PDV values.
          Assuming that the mean or median one-way-delay changes appreciably
          on the new path, then subsequent measurements can confirm a path
          change, and trigger special processing on the interval containing a
          path change and the affected PDV result.</t>

          <t>Alternatively, if the path change is detected, by monitoring the
          test packets TTL or Hop Limit, or monitoring the change in the IGP
          link-state database, the results of measurement before and after the
          path change could be kept separated, presenting two different
          distributions. This avoids the difficult task of determining the
          different modes of a multi-modal distribution.</t>
        </section>

        <section title="Path Change with Loss">
          <t>If the path change is accompanied by loss, such that the are no
          consecutive packet pairs that span the change, then no IPDV
          singletons will reflect the change. This may or may not be
          desirable, depending on the ultimate use of the delay variation
          measurement. The Figure 3, in which L means Lost and U means
          undefined, illustrates this case.</t>

          <t><figure anchor="Fig3" title="Path Change with Loss">
              <preamble></preamble>

              <artwork align="center"><![CDATA[Packet #   1  2  3  4  5  6  7  8  9
Lost                   L  L
------------------------------------
Delay, ms  3  4  3  3  U  U  8  9  8

IPDV       U  1 -1  0  U  U  U  1 -1

PDV        0  1  0  0  U  U  5  6  5]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>PDV will again produce a bimodal distribution. But here, the
          decision process to define sub-intervals associated with each path
          is further assisted by the presence of loss, in addition to TTL,
          reordering information, and use of short measurement intervals
          consistent with the duration of user sessions. It is reasonable to
          assume that at least loss and delay will be measured simultaneously
          with PDV and/or IPDV.</t>
        </section>

        <t></t>
      </section>

      <section title="Clock Stability and Error">
        <t>Low cost or low complexity measurement systems may be embedded in
        communication devices that do not have access to high stability
        clocks, and time errors will almost certainly be present. However,
        larger time-related errors may offer an acceptable trade-off for
        monitoring performance over a large population (the accuracy needed to
        detect problems may be much less than required for a scientific
        study).</t>

        <t>As mentioned above, <xref target="Demichelis"></xref> observed that
        PDV places greater demands on clock synchronization than for IPDV.
        This observation deserves more discussion. Synchronization errors have
        two components: time of day errors and clock frequency errors
        (resulting in skew).</t>

        <t>Both IPDV and PDV are sensitive to time-of-day errors when
        attempting to align measurement intervals at the source and
        destination. Gross mis-alignment of the measurement intervals can lead
        to lost packets, for example if the receiver is not ready when the
        first test packet arrives. However, both IPDV and PDV assess delay
        differences, so the error present in two one-way-delay singletons will
        cancel as long as it is constant. So, NTP or GPS synchronization is
        not required to correct the time-of-day error in case the delay
        variation measurement, while it is required for the one-way delay
        measurement.</t>

        <t>Skew is a measure of the change in clock time over an interval
        w.r.t. a reference clock. Both IPDV and PDV are affected by skew, but
        the error sensitivity in IPDV singletons is less because the intervals
        between consecutive packets are rather small, especially when compared
        to the overall measurement interval. Since PDV computes the difference
        between a single reference delay (the sample minimum) and all other
        delays in the measurement interval, the constraint on skew error is
        greater to attain the same accuracy as IPDV. Again, use of short PDV
        measurement intervals (on the order of minutes, not hours) provides
        some relief from the effects of skew error.</t>

        <t>If skew is present in a sample of one-way-delays, its symptom is
        typically a linear growth or decline over all the one-way-delay
        values. As a practical matter, if the same slope appears consistently
        in the measurements, then it may be possible to fit the slope and
        compensate for the skew in the one-way-delay measurements, thereby
        avoiding the issue in the PDV calculations that follow. See <xref
        target="RFC3393"></xref> for additional information on compensating
        for skew.</t>

        <t>There is a third factor related to clock error and stability: this
        is the presence of a clock synchronization protocol (e.g., NTP) and
        the time adjustment operations that result. When a small time error is
        detected (typically on the order of a few milliseconds), the host
        clock frequency is continuously adjusted to reduce the time error. If
        these adjustments take place during a measurement interval, they may
        appear as delay variation when none was present, and therefore are a
        source of error.</t>
      </section>

      <section title="Spatial Composition">
        <t>ITU-T Recommendation <xref target="Y.1541"></xref> gives a
        provisional method to compose a PDV metric using PDV measurement
        results from two or more sub-paths.</t>

        <t>PDV has a clear advantage at this time, since there is no known
        method to compose an IPDV metric. In addition, IPDV results depend
        greatly on the exact sequence of packets and may not lend themselves
        easily to the composition problem.</t>
      </section>

      <section title="Reporting a Single Number">
        <t>Despite the risk of over-summarization, measurements must often be
        displayed for easy consumption. If the right summary report is
        prepared, then the "dashboard" view correctly indicates whether there
        is something different and worth investigating further, or that the
        status has not changed. The dashboard model restricts every instrument
        display to a single number. The packet network dashboard could have
        different instruments for loss, delay, delay variation, reordering,
        etc., and each must be summarized as a single number for each
        measurement interval.</t>

        <t>The simplicity of the PDV distribution lends itself to this
        summarization process (including use of the median or mean). <xref
        target="Y.1541"></xref> introduced the notion of a pseudo-range when
        setting an objective for the 99.9%-ile of PDV. The conventional range
        (max-min) was avoided for several reasons, including stability of the
        maximum delay. The 99.9%-ile of PDV is helpful to performance planners
        (seeking to meet some user-to-user objective for delay) and in design
        of de-jitter buffer sizes, even those with adaptive capabilities.</t>

        <t>IPDV does not lend itself to summarization so easily. The mean IPDV
        is typically zero. As the IPDV distribution may have two tails
        (positive and negative) the range or pseudo-range would not match the
        needed de-jitter buffer size. Additional complexity may be introduced
        when the variation exceeds the inter-packet sending interval, as
        discussed above. Should the Inter-Quartile Range be used? Should the
        singletons beyond some threshold be counted (e.g., mean +/- 50ms)? A
        strong rationale for one of these summary statistics has yet to
        emerge.</t>
      </section>

      <section title="Jitter in RTCP Reports">
        <t><xref target="RFC3550"></xref> gives the calculation of the
        inter-arrival Jitter field for the RTCP report, with a sample
        implementation in an Appendix.</t>

        <t>The RTCP Jitter value can be calculated using IPDV singletons. If
        there is packet reordering, as defined in <xref
        target="RFC4737"></xref>, then estimates of Jitter based on IPDV may
        vary slightly, because <xref target="RFC3550"></xref> specifies the
        use of receive packet order.</t>

        <t>Just as there is no simple way to convert PDV singletons to IPDV
        singletons without returning to the original sample of delay
        singletons, there is no clear relationship between PDV and <xref
        target="RFC3550"></xref> Jitter.</t>
      </section>

      <section title="MAPDV2">
        <t>MAPDV2 stands for Mean Absolute Packet Delay Variation (version) 2,
        and is specified in <xref target="G.1020"></xref>. The MAPDV2
        algorithm computes a smoothed running estimate of the mean delay using
        the one-way delays of 16 previous packets. It compares the current
        one-way-delay to the estimated mean, separately computes the means of
        positive and negative deviations, and sums these deviation means to
        produce MAPVDV2. In effect, there is a MAPDV2 singleton for every
        arriving packet, so further summarization is usually warranted.</t>

        <t>Neither IPDV or PDV forms assist in the computation of MAPDV2.</t>
      </section>

      <section title="Load Balancing">
        <t>TO DO: What if there is load-balancing in an ISP network?
        Load-balancing is based on the IGP metrics, while the delay depends on
        the path. So, we could have a multi-modal distribution, if we send
        test packets with different characteristics such as IP
        addresses/ports.</t>

        <t>Should the delay singletons using multiple addresses/ports be
        combined in the same sample?</t>

        <t>The PDV form makes the identification of multiple modes possible.
        Should we characterize each mode separately? This question also
        applies to the Path Change case.</t>
      </section>
    </section>

    <section title="Applicability of the Delay Variation Forms and Recommendations">
      <t>Based on the comparisons of IPDV and PDV presented above, this
      section matches the attributes of each form with the tasks described
      earlier. We discuss the more general circumstances first.</t>

      <t>Note: the conclusions of this section should be regarded as
      preliminary, pending discussion and further development by the IPPM
      WG.</t>

      <section title="Uses">
        <t></t>

        <section title="Inferring Queue Occupancy">
          <t>The PDV distribution is anchored at the minimum delay observed in
          the measurement interval. When the sample minimum coincides with the
          true minimum delay of the path, then the PDV distribution is
          equivalent to the queuing time distribution experienced by the test
          stream. If the minimum delay is not the true minimum, then the PDV
          distribution captures the variation in queuing time and some
          additional amount of queuing time is experienced, but unknown. One
          can summarize the PDV distribution with the mean, median, and other
          statistics.</t>

          <t>IPDV can capture the difference in queuing time from one packet
          to the next, but this is a different distribution from the queue
          occupancy revealed by PDV.</t>
        </section>

        <section title="Determining De-jitter Buffer Size">
          <t>This task is complimentary to the problem of inferring queue
          occupancy through measurement. Again, use of the sample minimum as
          the reference delay for PDV yields a distribution that is very
          relevant to de-jitter buffer size. This is because the minimum delay
          is an alignment point for the smoothing operation of de-jitter
          buffers. A de-jitter buffer that is ideally aligned with the delay
          variation adds zero buffer time to packets with the longest
          accommodated network delay (any packets with longer delays are
          discarded). Thus, a packet experiencing minimum network delay should
          be aligned to wait the maximum length of the de-jitter buffer. With
          this alignment, the stream is smoothed with no unnecessary delay
          added. <xref target="G.1020"></xref> illustrates the ideal
          relationship between network delay variation and buffer time.</t>

          <t>The PDV distribution is also useful for this task, but different
          statistics are preferred. The range (max-min) or the 99.9%-ile of
          PDV (pseudo-range) are closely related to the buffer size needed to
          accommodate the observed network delay variation.</t>

          <t>In some cases, the positive excursions (or series of positive
          excursions) of IPDV may help to approximate the de-jitter buffer
          size, but there is no guarantee that a good buffer estimate will
          emerge, especially when the delay varies as a positive trend over
          several test packets.</t>
        </section>

        <section title="Spatial Composition">
          <t>PDV has a clear advantage at this time, since there is no known
          method to compose an IPDV metric.</t>
        </section>
      </section>

      <section title="Challenging Circumstances">
        <t>Note that measurement of delay variation may not be the primary
        concern under unstable and unreliable circumstances.</t>

        <section title="Clock Issues">
          <t>When appreciable skew is present between measurement system
          clocks, then IPDV has a clear advantage because PDV would require
          processing over the entire sample to remove the skew error. Neither
          form of delay variation is more suited than the other to on-the-fly
          summarization without memory, and this may be one of the reasons
          that <xref target="RFC3550"></xref> RTCP Jitter and MAPDV2 in <xref
          target="G.1020"></xref> have attained deployment in low-cost
          systems.</t>
        </section>

        <section title="Frequent Path Changes">
          <t>If the network under test exhibits frequent path changes, on the
          order of several new routes per minute, then IPDV appears to isolate
          the delay variation on each path from the transient effect of path
          change (especially if there is packet loss at the time of path
          change). It is possible to make meaningful PDV measurements when
          paths are unstable, but great importance would be placed on the
          algorithms that infer path change and attempt to divide the sample
          on path change boundaries.</t>
        </section>

        <section title="Frequent Loss">
          <t>If the network under test exhibits frequent loss, then PDV may
          produce a larger set of singletons for the sample than IPDV. This is
          due to IPDV requiring consecutive packet arrivals to assess delay
          variation, compared to PDV where any packet arrival is useful. The
          worst case is when no consecutive packets arrive, and the entire
          IPDV sample would be undefined. PDV would successfully produce a
          sample based on the arriving packets.</t>
        </section>

        <section title="Load Balancing">
          <t>TO DO: this section will give the brief conclusions of the
          discussion and analysis in section 6.</t>
        </section>
      </section>
    </section>

    <section title="Measurement Considerations for Vendors, Testers, and Users">
      <t>TO DO:</t>

      <section title="Measurement Stream Characteristics">
        <t></t>
      </section>

      <section title="Measurement Units">
        <t>TO DO: Al, you mentioned somewhere above: "These devices may not
        have sufficient memory to store all singletons for later processing."
        And also an important conclusion: "Just as there is no simple way to
        convert PDV singletons to IPDV singletons without returning to the
        original sample of delay singletons" I'm thinking we should develop
        around that:</t>

        <t>- Do we want to get IPDV and DV?</t>

        <t>- Do we want to reconstruct the IPDV and DV later on, with a
        different interval?</t>

        <t>+ a reference to the appendix where we would describe:</t>

        <t>- how is this D(min) calculated? Is it DV(99%) as mentioned by
        Roman in http://www3.ietf.org/proceedings/05nov/slides/ippm-3.pdf?</t>

        <t>- do we need to keep all the values from the interval, then take
        the minimum? Or do we keep the minimum from previous intervals?</t>
      </section>

      <section title="Test Duration">
        <t></t>
      </section>

      <section title="Clock Sync Options">
        <t></t>
      </section>

      <section title="Distinguishing Long Delay from Loss">
        <t>Setting the max waiting time threshold...</t>
      </section>

      <section title="Accounting for Packet Reordering">
        <t></t>
      </section>

      <section title="Results Representation and Reporting">
        <t></t>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document makes no request of IANA.</t>

      <t>Note to RFC Editor: this section may be removed on publication as an
      RFC.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>The security considerations that apply to any active measurement of
      live networks are relevant here as well. See <xref
      target="RFC4656"></xref></t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>The author would like to thank Phil Chimento for his suggestion to
      employ the convention of conditional distributions for Delay to deal
      with packet loss, and his encouragement to "write the memo" after
      hearing the talk on this topic at IETF-65.</t>
    </section>

    <section title="Appendix on Reducing Delay Variation in Networks">
      <t>This text is both preliminary and generic but we want to explain the
      basic troubleshooting.</t>

      <t>If there is a DV problem, it may be because:</t>

      <t>1. there is congestion. Find where the bottleneck is, and increase
      the buffer Alternatively, increase the bandwidth Alternatively, remove
      some applications from that class of service</t>

      <t>2. there is a variability of the traffic Discover that traffic, then
      change/apply QoS (for example, rate-limiting)</t>
    </section>

    <section title="Appendix on Calculating the D(min) in PDV">
      <t>Note: These are the questions this section intends to answer:</t>

      <t>- how is this D(min) calculated? Is it DV(99%) as mentioned by Roman
      in http://www3.ietf.org/proceedings/05nov/slides/ippm-3.pdf?</t>

      <t>- do we need to keep all the values from the interval, then take the
      minimum? Or do we keep the minimum from previous intervals?</t>

      <t>The value of D(min) used as the reference delay for PDV calculations
      is simply the minimum delay of all packets in the current sample. The
      usual single value summary of the PDV distribution is D(99.9%-ile) minus
      D(min).</t>

      <t>It may be appropriate to segregate sub-sets and revise the minimum
      value during a sample. For example, if it can be determined with
      certainty that the path has changed by monitoring the Time to Live or
      Hop Count of arriving packets, this may be sufficient justification to
      reset the minimum for packets on the new path.</t>

      <t>It is not necessary to store all delay values in a sample when
      storage is a major concern. D(min) can be found by comparing each new
      singleton value with the current value and replacing it when required.
      In a sample with 5000 packets, evaluation of the 99.9%-ile can also be
      achieved with limited storage. One method calls for storing the top 50
      delay singletons and revising the top value list each time 50 more
      packets arrive.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>

      <?rfc include='reference.RFC.2330'?>

      <?rfc include='reference.RFC.2679'?>

      <?rfc include='reference.RFC.2680'?>

      <?rfc include='reference.RFC.3393'?>

      <?rfc include='reference.RFC.3432'?>

      <?rfc include='reference.RFC.3550'?>

      <?rfc include='reference.RFC.4090'?>

      <?rfc include='reference.RFC.4656'?>

      <?rfc include='reference.RFC.4737'?>

      <?rfc ?>
    </references>

    <references title="Informative References">
      <?rfc include='reference.I-D.ietf-ippm-framework-compagg'?>

      <?rfc include='reference.I-D.morton-ippm-reporting-metrics'?>

      <?rfc include='reference.RFC.3550'?>

      <?rfc include='reference.RFC.3357'?>

      <reference anchor="Casner">
        <front>
          <title>A Fine-Grained View of High Performance Networking, NANOG 22
          Conf.; http://www.nanog.org/mtg-0105/agenda.html</title>

          <author fullname="S. Casner, C. Alaettinoglu, and C. Kuan,"
                  surname="">
            <organization></organization>
          </author>

          <date month="May 20-22" year="2001" />
        </front>
      </reference>

      <reference anchor="Cia03">
        <front>
          <title>Standardized Active Measurements on a Tier 1 IP Backbone,
          IEEE Communications Mag., pp 90-97.</title>

          <author fullname="L.Ciavattone, A.Morton, and G.Ramachandran">
            <organization></organization>
          </author>

          <date month="June" year="2003" />
        </front>
      </reference>

      <reference anchor="Demichelis">
        <front>
          <title>Packet Delay Variation Comparison between ITU-T and IETF
          Draft Definitions</title>

          <author fullname="C.Demichelis"
                  surname="http://www.advanced.org/ippm/archive.3/att-0075/01-pap02.doc">
            <organization>CSELT</organization>
          </author>

          <date month="November" year="2000" />
        </front>
      </reference>

      <reference anchor="Krzanowski">
        <front>
          <title>Jitter Definitions: What is What?</title>

          <author fullname="R.Krzanowski"
                  surname="Presentation at IPPM, IETF-64">
            <organization></organization>
          </author>

          <date month="November" year="2005" />
        </front>
      </reference>

      <reference anchor="G.1020">
        <front>
          <title>"Performance parameter definitions for the quality of speech
          and other voiceband applications utilizing IP networks"</title>

          <author surname="ITU-T Recommendation G.1020">
            <organization></organization>
          </author>

          <date year="2006" />
        </front>
      </reference>

      <reference anchor="Y.1540">
        <front>
          <title>Internet protocol data communication service - IP packet
          transfer and availability performance parameters</title>

          <author fullname="" surname="ITU-T Recommendation Y.1540">
            <organization></organization>
          </author>

          <date month="December " year="2002" />
        </front>
      </reference>

      <reference anchor="Y.1541">
        <front>
          <title>Network Performance Objectives for IP-Based Services</title>

          <author fullname="" surname="ITU-T Recommendation Y.1540">
            <organization></organization>
          </author>

          <date month="February " year="2006" />
        </front>
      </reference>

      <?rfc ?>
    </references>
  </back>
</rfc>