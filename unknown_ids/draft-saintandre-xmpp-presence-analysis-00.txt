


Network Working Group                                     P. Saint-Andre
Internet-Draft                                                       XSF
Expires: October 13, 2007                                 April 11, 2007


 Interdomain Presence Scaling Analysis for the Extensible Messaging and
                        Presence Protocol (XMPP)
               draft-saintandre-xmpp-presence-analysis-00

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on October 13, 2007.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   This document analyzes the traffic that is generated as a result of
   presence subscriptions between users of federated domains that
   support the Extensible Messaging and Presence Protocol (XMPP).  This
   analysis is provided as a source of comparison with a similar
   analysis being performed regarding domains that support federated
   presence using Session Initiation Protocol (SIP) for Instant
   Messaging and Presence Leveraging Extensions (SIMPLE).




Saint-Andre             Expires October 13, 2007                [Page 1]

Internet-Draft           XMPP Presence Analysis               April 2007


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.  Traffic Load . . . . . . . . . . . . . . . . . . . . . . . . .  3
     2.1.  Assumptions  . . . . . . . . . . . . . . . . . . . . . . .  4
     2.2.  Protocol Flows . . . . . . . . . . . . . . . . . . . . . .  4
     2.3.  Analysis . . . . . . . . . . . . . . . . . . . . . . . . .  6
     2.4.  Scenarios  . . . . . . . . . . . . . . . . . . . . . . . .  6
       2.4.1.  Basic  . . . . . . . . . . . . . . . . . . . . . . . .  7
       2.4.2.  Widely Distributed Inter-Domain Presence . . . . . . .  7
       2.4.3.  Very Large Network Peering . . . . . . . . . . . . . .  8
       2.4.4.  Intra-Domain Peering . . . . . . . . . . . . . . . . .  8
   3.  Security Considerations  . . . . . . . . . . . . . . . . . . .  9
   4.  Informative References . . . . . . . . . . . . . . . . . . . .  9
   Author's Address . . . . . . . . . . . . . . . . . . . . . . . . . 10
   Intellectual Property and Copyright Statements . . . . . . . . . . 11



































Saint-Andre             Expires October 13, 2007                [Page 2]

Internet-Draft           XMPP Presence Analysis               April 2007


1.  Introduction

   Presence is information about the network availability of an
   individual (or, more precisely, of a presence address of the kind
   that is often but not necessarily associated with an individual).  As
   typically designed and deployed, presence is shared only with
   authorized entities, where the authorization takes the form of a
   subscription.  (In this document, we employ the term "user" to
   signify an account that generates presence information and the term
   "contact" to signify an annount that is subscribed to the user's
   presence.)

   The sharing of presence information can result in a large volume of
   traffic as users log on or off throughout the life of a presence
   session, especially for users with large numbers of contacts (e.g.,
   the author of this document has approximately 1,500 contacts in his
   list of presence subscribers).  The volume is increased by
   communication of information beyond boolean network availability,
   such as availability substates (e.g., "away" and "do not disturb").
   The volume is further increased if the presence "transport" is used
   to communicate information such as geolocation, mood, activity, even
   the music to which an individual is listening.  While such traffic
   may not be a concern in a standalone presence domain, interdomain
   communications may introduce a more significant impact on the
   functioning of the Internet as a whole.

   There are several standardized technologies for sharing presence
   information.  One is a set of extensions to the Session Initiation
   Protocol (SIP), where the base protocol is defined in [SIP] and the
   extensions are defined in [SIP-EVENT] and [SIP-PRES].  Another is the
   Extensible Messaging and Presence Protocol (XMPP) as defined in
   [XMPP-CORE] and [XMPP-IM].

   [PROBLEM] analyzes several factors regarding the scalability of
   interdomain communication of presence information using SIP/SIMPLE
   technologies.  For the sake of comparison, this document aims to
   provide a similar analysis regarding XMPP technologies; in its first
   iteration, it discusses traffic load exclusively since bandwidth
   usage has the greatest potential impact on the Internet (whereas
   issues such as state management and server processing of presence
   information are implementation-specific).


2.  Traffic Load







Saint-Andre             Expires October 13, 2007                [Page 3]

Internet-Draft           XMPP Presence Analysis               April 2007


2.1.  Assumptions

   The model for XMPP presence subscriptions is different from that of
   SIP.  In particular, XMPP presence subscriptions are long-lived, and
   once established last until cancelled.  Thus XMPP does not have
   subscription timeouts and refresh periods as SIP presence does.  In
   addition, this document does not include presence subscriptions in
   its protocol flows since in XMPP they are preconditions for the
   exchange of presence notifications (in any case, the number of XML
   stanzas exchanged in the process of establishing a presence
   subscription is negligible compared to the volume of presence
   notifications).

   XMPP presence subscriptions are typically bidirectional (i.e., the
   contact has a subscription to the user's presence and the user has a
   subscription to the contact's presence).  However, because [PROBLEM]
   assumes that subscriptions are uni-directional (i.e., the contact has
   a subscription to the user's presence but not vice-versa), the same
   assumption is made herein.

   Although an XMPP user or contact may have multiple connected
   "resources" (e.g., client or device) at any one time, for the sake of
   simplification this document assumes that each entity has only one
   simultaneous resource.

   Note that, unlike in SIP, XMPP packets are not typically acknowledged
   with the equivalent of a 200/OK message.

   [PROBLEM] assumes that presence notification packets will typically
   be on the order of 4 kilobytes in size (not including TCP or UDP
   overhead).  XMPP presence notification packets tend to be much
   smaller than SIP presence notification packets; in this document we
   assume (based on deployment experience) that they are typically 200
   bytes in size.

2.2.  Protocol Flows

   When a contact (in these examples romeo@example.net) becomes
   available, the contact's server sends an XMPP presence stanza of type
   "probe" to the user (in these examples juliet@example.com) on behalf
   of the contact, as shown in the following example (this can be seen
   as similar to the initial SUBSCRIBE in SIP presence):









Saint-Andre             Expires October 13, 2007                [Page 4]

Internet-Draft           XMPP Presence Analysis               April 2007


   Contact's server sends presence probe to user:

   <presence
       from='romeo@example.net/orchard'
       to='juliet@example.com'
       type='probe'/>

   If the user's server determines that the contact is authorized to see
   the user's presence, the user's server return's the user's current
   presence state to the contact (this is equivalent to the "Initial
   NOTIFY" in SIP presence).

   User's server sends presence to contact:

   <presence
       from='juliet@example.com/balcony'
       to='romeo@example.net/orchard'
       xml:lang='en'>
     <show>away</show>
     <status>be right back</status>
     <priority>0</priority>
   </presence>

   If the user subsequently changes her presence, the user's server
   sends an updated presence notification to the contact.

   User's server sends updated presence to contact:

   <presence
       from='juliet@example.com/balcony'
       to='romeo@example.net/orchard'
       xml:lang='en'>
     <priority>0</priority>
   </presence>

   A presence session can include any number of presence changes.

   When the user goes offline, the user's server sends a presence stanza
   of type "unavailable" to the contact.

   User's server sends unavailable presence to contact:

   <presence
       from='juliet@example.com/balcony'
       to='romeo@example.net/orchard'
       type='unavailable'
       xml:lang='en'/>




Saint-Andre             Expires October 13, 2007                [Page 5]

Internet-Draft           XMPP Presence Analysis               April 2007


   Naturally, similar protocol flows are generated by the contact during
   the life of his presence session.

2.3.  Analysis

   To enable valid comparison between SIMPLE and XMPP with regard to
   interdomain presence scaling, this document adheres as closely as
   possible to the analysis presented in [PROBLEM], witih appropriate
   modifications given differences between the two technologies.  In
   particular, traffic calculations are based on the following inputs
   and formulae, where the numbering follows that in [PROBLEM] and the
   terminology is adjusted to conform to XMPP:

   o  (A01) Presence session lifetime in hours -- assumed to be 8 hours.
   o  (A02) Presence state changes per hour -- assumed to be 3 times per
      hour.
   o  (A03) Subscription refresh interval per hour -- does not apply to
      XMPP.
   o  (A04) Total federated contacts per user -- varies based on the
      scenario under discussion.
   o  (A05) Number of dialogs to maintain per watcher -- does not apply
      to XMPP.
   o  (A06) Number of contacts in a federated presence domain -- varies
      based on the scenario under discussion.
   o  (A07) Initial presence subscription exchange -- deemed out of
      scope here since XMPP presence subscriptions are long-lived.
   o  (A08) Initial presence notification -- on the model of SIP NOTIFY
      plus 200, this is XMPP presence probe plus initial notification,
      thus 2 per contact.
   o  (A09) Total initial messages -- (A08*A06).
   o  (A10) Presence notifications per user = (A02*A01*A04).
   o  (A11) Subscription refreshes -- does not apply to XMPP.
   o  (A12) NOTIFY/200 due to subscribe refresh -- does not apply to
      XMPP.
   o  (A13) Number of steady state messages = (A10*A06).
   o  (A14) SUBSCRIBE termination -- does not apply to XMPP.
   o  (A15) Unavailable presence -- sent when user goes offline
      (equivalent to NOTIFY terminated), 1 per contact.
   o  (A16) Number of sign-out messages = (A15*A06).
   o  (A17) Total number of messages between domains = ((A09+A13+
      A16)*2).
   o  (A18) Total number of messages per second = (A17/A01/3600).
   o  (A19) Total number of kilobytes per second = (A18*.2).

2.4.  Scenarios






Saint-Andre             Expires October 13, 2007                [Page 6]

Internet-Draft           XMPP Presence Analysis               April 2007


2.4.1.  Basic

   This scenario assumes two domains, each with 20,000 users, where each
   user has 4 contacts in the other domain and changes presence 3 times
   per hour.  The calculations are as follows:

   o  (A01) = 8.
   o  (A02) = 3.
   o  (A03) N/A.
   o  (A04) = 4.
   o  (A05) N/A.
   o  (A06) = 20,000.
   o  (A07) N/A.
   o  (A08) = 8.
   o  (A09) = (A08*A06) = 160,000.
   o  (A10) = (A02*A01*A04) = 96.
   o  (A11) N/A.
   o  (A12) N/A.
   o  (A13) = (A10*A06) = 1,920,000.
   o  (A14) N/A.
   o  (A15) = 4.
   o  (A16) = (A15*A06) = 80,000.
   o  (A17) = ((A09+A13+A16)*2) = 4,320,000 total messages.
   o  (A18) = (A17/A01/3600) = 150 messages per second.
   o  (A19) = (A18*.2) = 30 kilobtyes per second.

   For the last three factors, the comparable numbers for SIMPLE (from
   [PROBLEM]) are 14,080,000 total messages, 489 messages per second,
   and 830 kilobytes per second.

2.4.2.  Widely Distributed Inter-Domain Presence

   This scenario assumes two domains, each with 20,000 users, where each
   user has 20 contacts in the other domain and changes presence 3 times
   per hour.  The calculations are as follows:

   o  (A01) = 8.
   o  (A02) = 3.
   o  (A03) N/A.
   o  (A04) = 20.
   o  (A05) N/A.
   o  (A06) = 20,000.
   o  (A07) N/A.
   o  (A08) = 40.
   o  (A09) = (A08*A06) = 800,000.
   o  (A10) = (A02*A01*A04) = 480.





Saint-Andre             Expires October 13, 2007                [Page 7]

Internet-Draft           XMPP Presence Analysis               April 2007


   o  (A11) N/A.
   o  (A12) N/A.
   o  (A13) = (A10*A06) = 9,600,000.
   o  (A14) N/A.
   o  (A15) = 20.
   o  (A16) = (A15*A06) = 400,000.
   o  (A17) = ((A09+A13+A16)*2) = 21,600,000 total messages.
   o  (A18) = (A17/A01/3600) = 750 messages per second.
   o  (A19) = (A18*.2) = 150 kilobtyes per second.

   For the last three factors, the comparable numbers for SIMPLE (from
   [PROBLEM]) are 70,400,000 total messages, 2,444 messages per second,
   and 1,968 kilobytes per second.

2.4.3.  Very Large Network Peering

   This scenario assumes two domains, each with 10,000,000 users, where
   each user has 10 contacts in the other domain and changes presence 6
   times per hour.  The calculations are as follows:

   o  (A01) = 8.
   o  (A02) = 6.
   o  (A03) N/A.
   o  (A04) = 10.
   o  (A05) N/A.
   o  (A06) = 10,000,000.
   o  (A07) N/A.
   o  (A08) = 20.
   o  (A09) = (A08*A06) = 200,000,000.
   o  (A10) = (A02*A01*A04) = 480.
   o  (A11) N/A.
   o  (A12) N/A.
   o  (A13) = (A10*A06) = 4,800,000,000.
   o  (A14) N/A.
   o  (A15) = 10.
   o  (A16) = (A15*A06) = 100,000,000.
   o  (A17) = ((A09+A13+A16)*2) = 10,200,000,000 total messages.
   o  (A18) = (A17/A01/3600) = 354,166 messages per second.
   o  (A19) = (A18*.2) = 70,833 kilobtyes per second.

   For the last three factors, the comparable numbers for SIMPLE (from
   [PROBLEM]) are 27,200,000,000 total messages, 944,444 messages per
   second, and 880,555 kilobytes per second.

2.4.4.  Intra-Domain Peering

   This scenario assumes two domains, each with 60,000 users, where each
   user has 10 contacts in the other domain and changes presence 3 times



Saint-Andre             Expires October 13, 2007                [Page 8]

Internet-Draft           XMPP Presence Analysis               April 2007


   per hour.  The calculations are as follows:

   o  (A01) = 8.
   o  (A02) = 3.
   o  (A03) N/A.
   o  (A04) = 10.
   o  (A05) N/A.
   o  (A06) = 60,000.
   o  (A07) N/A.
   o  (A08) = 20.
   o  (A09) = (A08*A06) = 1,200,000.
   o  (A10) = (A02*A01*A04) = 240.
   o  (A11) N/A.
   o  (A12) N/A.
   o  (A13) = (A10*A06) = 14,400,000.
   o  (A14) N/A.
   o  (A15) = 10.
   o  (A16) = (A15*A06) = 600,000.
   o  (A17) = ((A09+A13+A16)*2) = 32,400,000 total messages.
   o  (A18) = (A17/A01/3600) = 1125 messages per second.
   o  (A19) = (A18*.2) = 225 kilobtyes per second.

   For the last three factors, the comparable numbers for SIMPLE (from
   [PROBLEM]) are 105,600,000 total messages, 3,667 messages per second,
   and 3,683 kilobytes per second.


3.  Security Considerations

   This document introduces and addresses no security concerns above and
   beyond those already defined in [XMPP-CORE] and [XMPP-IM].


4.  Informative References

   [PROBLEM]  Houri, A., "Problem Statement for SIP/SIMPLE",
              draft-ietf-simple-interdomain-scaling-analysis-00 (work in
              progress), February 2007.

   [SIP]      Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", RFC 3261,
              June 2002.

   [SIP-EVENT]
              Roach, A., "Session Initiation Protocol (SIP)-Specific
              Event Notification", RFC 3265, June 2002.




Saint-Andre             Expires October 13, 2007                [Page 9]

Internet-Draft           XMPP Presence Analysis               April 2007


   [SIP-PRES]
              Rosenberg, J., "A Presence Event Package for the Session
              Initiation Protocol (SIP)", RFC 3856, August 2004.

   [XMPP-CORE]
              Saint-Andre, P., "Extensible Messaging and Presence
              Protocol (XMPP): Core", RFC 3920, October 2004.

   [XMPP-IM]  Saint-Andre, P., "Extensible Messaging and Presence
              Protocol (XMPP): Instant Messaging and Presence",
              RFC 3921, October 2004.


Author's Address

   Peter Saint-Andre
   XMPP Standards Foundation
   P.O. Box 1641
   Denver, CO  80201
   USA

   Email: stpeter@jabber.org
   URI:   xmpp:stpeter@jabber.org




























Saint-Andre             Expires October 13, 2007               [Page 10]

Internet-Draft           XMPP Presence Analysis               April 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Saint-Andre             Expires October 13, 2007               [Page 11]

