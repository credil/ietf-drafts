


MMUSIC                                                         R. Gilman
Internet-Draft                                               Avaya, Inc.
Intended status: Standards Track                            R. Even, Ed.
Expires: May 18, 2008                                            Polycom
                                                            F. Andreasen
                                                           Cisco Systems
                                                       November 15, 2007


                   SDP media capabilities Negotiation
            draft-ietf-mmusic-sdp-media-capabilities-02.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on May 18, 2008.

Copyright Notice

   Copyright (C) The IETF Trust (2007).











Gilman, et al.            Expires May 18, 2008                  [Page 1]

Internet-Draft                    CMED                     November 2007


Abstract

   Session Description Protocol (SDP) capability negotiation provides a
   general framework for negotiating capabilities in SDP.  The base
   framework defines only capabilities for negotiating transport
   protocols and attributes.  In this document, we extend the framework
   by defining media capabilities that can be used to negotiate media
   types and their associated parameters.


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  4
   2.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  5
   3.  SDP Media capabilities . . . . . . . . . . . . . . . . . . . .  6
     3.1.  Solution Overview  . . . . . . . . . . . . . . . . . . . .  6
     3.2.  Capability Attributes  . . . . . . . . . . . . . . . . . .  9
       3.2.1.  Media Type and Subtype Capability Attribute  . . . . . 10
       3.2.2.  The Media Encoding Parameter Capability Attribute  . . 11
       3.2.3.  The Media Format Parameter Capability Attribute  . . . 12
       3.2.4.  The Bandwidth Capability Attribute . . . . . . . . . . 13
     3.3.  Extensions to the Potential Configuration Attribute  . . . 15
       3.3.1.  The Media Capability Extension to the Potential
               Configuration Attribute  . . . . . . . . . . . . . . . 15
       3.3.2.  The Payload Type Mapping Extension to the
               Potential Configuration Attribute  . . . . . . . . . . 16
       3.3.3.  The Bandwidth Extension to the Potential
               Configuration Attribute  . . . . . . . . . . . . . . . 17
     3.4.  Extensions to the Actual Configuration Attribute . . . . . 17
     3.5.  The Latent Configuration Attribute . . . . . . . . . . . . 18
       3.5.1.  The crypto: Attribute in Latent Configurations . . . . 18
     3.6.  Offer/Answer Model Extensions  . . . . . . . . . . . . . . 19
       3.6.1.  Generating the Initial Offer . . . . . . . . . . . . . 19
       3.6.2.  Generating the Answer  . . . . . . . . . . . . . . . . 19
       3.6.3.  Offerer Processing of the Answer . . . . . . . . . . . 19
       3.6.4.  Modifying the Session  . . . . . . . . . . . . . . . . 20
   4.  Examples . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
     4.1.  Alternative Codecs . . . . . . . . . . . . . . . . . . . . 21
     4.2.  Latent Media Streams . . . . . . . . . . . . . . . . . . . 21
   5.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 22
   6.  Security Considerations  . . . . . . . . . . . . . . . . . . . 23
   7.  Changes from previous versions . . . . . . . . . . . . . . . . 24
     7.1.  Changes from version 01  . . . . . . . . . . . . . . . . . 24
     7.2.  Changes from version 00  . . . . . . . . . . . . . . . . . 24
   8.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 25
   9.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 26
     9.1.  Normative References . . . . . . . . . . . . . . . . . . . 26
     9.2.  Informative References . . . . . . . . . . . . . . . . . . 26



Gilman, et al.            Expires May 18, 2008                  [Page 2]

Internet-Draft                    CMED                     November 2007


   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 27
   Intellectual Property and Copyright Statements . . . . . . . . . . 28

















































Gilman, et al.            Expires May 18, 2008                  [Page 3]

Internet-Draft                    CMED                     November 2007


1.  Introduction

   Session Description Protocol (SDP) capability negotiation [SDPCapNeg]
   provides a general framework for negotiating capabilities in
   SDP[RFC4566].  The base framework defines only capabilities for
   negotiating transport protocols and attributes.

   SDP Simple Capability Declaration (simcap) is defined in RFC 3407
   [RFC3407].  It defines a set of SDP attributes that enables a limited
   set of capabilities to be described at a session level or on a per
   media stream basis.  RFC 3407 defines capability declaration only.
   Actual negotiation procedures taking advantage of such capabilities
   have not been defined.  The SDP capability negotiation framework adds
   this required functionality.  This document updates RFC3407 and new
   implementation SHOULD use the functionality defined in the current
   draft to negotiate media capabilities.

   The [SDPCapNeg] document lists some of the issues with the current
   SDP capability negotiation process.  An additional real life case is
   to be able to offer one media stream (e.g. audio) but list the
   capability to support another media stream (e.g. video) without
   actually offering it currently.

   In this document, we extend the framework by defining media
   capabilities that can be used to negotiate media types and their
   associated parameters like bandwidth.  This document also adds the
   capability to declare support for media streams that can be offered
   later rather than as a potential configuration for current use.























Gilman, et al.            Expires May 18, 2008                  [Page 4]

Internet-Draft                    CMED                     November 2007


2.  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC2119 [RFC2119] and
   indicate requirement levels for compliant RTP implementations.













































Gilman, et al.            Expires May 18, 2008                  [Page 5]

Internet-Draft                    CMED                     November 2007


3.   SDP Media capabilities

   The SDP media capability negotiation [SDPCapNeg] discusses the use of
   any SDP [RFC4566] attribute (a=) under the acap attribute.  The
   limitations of using acap for fmtp and rtpmap as potential
   configuration are listed, for example they can be used only at the
   media level since they are media level attributes.  The [SDPCapNeg]
   addresses the issue of bandwidth usage but does not offer a way to
   negotiate different bandwidth for different codecs and profiles.
   This section provides an overview of extensions providing SDP media
   Capability negotiation solution offering more robust capabilities
   negotiation.  This is followed by definitions of new SDP attributes
   for the solution and its associated updated offer/answer procedures
   [RFC3264]

3.1.  Solution Overview

   The solution consist of the following new attributes extending the
   base attributes from [SDPCapNeg].

   Four attributes are used to make up media capabilities in a manner
   that can be related to the capabilities specified in a media line,
   its attributes and the bandwidth parameter lines.

   o  A new media attribute ("a=mcap") that lists media formats as
      capabilities in the form a media type (e.g. "audio") and one or
      more subtypes (e.g.  "PCMU"), and associates a handle with each
      subtype

   o  A new attribute ("a=ecap") that lists encoding parameter
      capabilities associated with a one or more media format
      capabilities.

   o  A new attribute ("a=fcap") that lists media format parameter
      capabilities associated with a one or more media format
      capabilities.

   o  A new attribute ("a=bcap") that is used to specify the bandwidth
      parameter(s) for media capabilities.

   o  A new attribute ("a=lcfg") that specifies latent configurations
      when no corresponding media line is offered.  An example is a
      latent configuration for video even though no video is currently
      offered.

   o  A new parameter type ("m=") to the potential configuration
      ("a=pcfg:") attribute and the actual configuration ("a=acfg:")
      attribute defined in [SDPCapNeg], which permits specification of



Gilman, et al.            Expires May 18, 2008                  [Page 6]

Internet-Draft                    CMED                     November 2007


      media capabilities (including their associated parameters) and
      combinations thereof for the configuration.  For example, the
      "a=pcfg:" line might specify PCMU and telephone events or G.729B
      and telephone events as acceptable configurations.  The "a=acfg:"
      line in the answer would specify the accepted choice.

   o  A new parameter type ("pt=") to the potential configuration
      ("a=pcfg:") attribute which associates RTP payload types with the
      referenced media capabilities.

   o  A new parameter type ("b=") used to specify bandwidth parameters
      in a potential configuration.

   The document extends the base protocol extensions to the offer/answer
   model that allow for capabilities and potential configurations to be
   included in an offer.  Media capabilities constitute capabilities
   that can be used in potential and latent configurations.  Whereas
   potential configurations constitute alternative offers that may be
   accepted by the answerer instead of the actual configuration(s)
   included in the "m=" line(s), latent configurations merely inform the
   other side of possible configurations supported by the entity.  Those
   latent configurations may be used to guide subsequent offer/answer
   exchanges.

   The mechanism is illustrated by the offer/answer exchange below,
   where Alice sends an offer to Bob:


                   Alice                               Bob
                  | (1) Offer (SRTP and RTP)         |
                  |--------------------------------->|
                  |                                  |
                  | (2) Answer (RTP)                 |
                  |<---------------------------------|
                  |                                  |

   Alice's offer includes RTP and SRTP as alternatives.  RTP is the
   default, but SRTP is the preferred one:

             v=0
             o=- 25678 753849 IN IP4 192.0.2.1
             s=
             c=IN IP4 192.0.2.1
             t=0 0
             a=creq:med-v0
             a=mcap:1 audio g729 iLBC PCMU g729
             a=ecap:2 8000
             a=fcap:1 annexb:no



Gilman, et al.            Expires May 18, 2008                  [Page 7]

Internet-Draft                    CMED                     November 2007


             a=fcap:2 mode=20
             a=tcap:1 RTP/SAVP
             m=audio 3456 RTP/AVP 0 18
             a=acap:1 crypto:1 AES_CM_128_HMAC_SHA1_32
             inline:NzB4d1BINUAvLEw6UzF3WSJ+PSdFcGdUJShpX1Zj|2^20|1:32
             a=pcfg:1 m=1,3|4,3 t=1 a=1 pt=1:100,4:101,3:102
             a=pcfg:2 m=2 pt=2:103

   The required base and extensions are provided by the "a=creq"
   attribute defined in [SDPCapNeg], with the option tag "med-v0", which
   indicates that the extension framework defined here, must be
   supported.  The Base level support is implied since it is required
   for the extensions.

   The "a=mcap:1" line defines four audio media subtype capabilities ,
   to be numbered consecutively starting with 1.  Note that the media
   subtypes specified in the m-line (PCMU and G729) are explicitly
   specified here.

   The "a=ecap:2" line specifies the clock rate and encoding parmeters
   (see [RFC4566]) for capability 2, iLBC.

   The "a=fcap:1" line specifies media format parameter capabilities for
   codec 1 ( no Annex B for G.729).

   The "a=fcap:2" line specifies a media format parameter for codec 2
   (20ms packets for iLBC.  [RFC3952]

   The "a=tcap:1" line, specified in the base protocol, defines a
   transport protocol capability, in this case Secure RTP.

   The "m=" line indicates that Alice is offering to use plain RTP with
   PCMU or G.729.  The media line implicitly defines the default
   transport protocol (RTP/AVP in this case) and the default actual
   configuration.

   The "a=acap:1" line ,specified in the base protocol provides the
   "crypto" attribute which provides the keying material for SRTP using
   SDP security descriptions.

   The "a=pcfg:" attributes provide the potential configurations
   included in the offer by reference to the media capabilities,
   transport capabilities, and associated payload type mappings.  Two
   explicit alternatives are provided; the first one, numbered 1 is the
   preferred one.  It specifies media capabilities 1 and 3, i.e.  G.729
   and PCMU, or media capability 4 and 3, i.e., G.729B and PCMU.
   Furthermore, it specifies transport protocol capability 1 (i.e. the
   RTP/SAVP profile - secure RTP), and the attribute capability 1, i.e.



Gilman, et al.            Expires May 18, 2008                  [Page 8]

Internet-Draft                    CMED                     November 2007


   the crypto attribute provided.  Lastly, it specifies, a payload type
   mapping for codecs 1, 3, and 4 thereby permitting the offerer to
   distinguish between encrypted media and unencrypted media received
   prior to receipt of the answer.  For SRTP the offerer will still need
   to receive the answer before being able to decrypt the stream.

   The second alternative specifies media capability 2, i.e. iLBC, under
   the default RTP/AVP profile.  The media line, with any qualifying
   attributes such as fmtp or rtpmap, is itself considered a valid
   configuration; it is assumed to be the lowest preference.

   Bob receives the SDP offer from Alice.  Bob supports RTP, but not
   SRTP, and hence he accepts the actual configuration for RTP provided
   by Alice.  Furthermore, Bob wants to use the iLBC codec and hence
   generates the following answer:

             v=0
             o=- 24351 621814 IN IP4 192.0.2.2
             s=
             c=IN IP4 192.0.2.2
             t=0 0
             a=csup:med-v0
             m=audio 4567 RTP/AVP 103
             a=rtpmap:103 iLBC/8000
             a=fmtp:103 mode=20
             a=acfg:2

   Bob includes the "a=csup" and "a=acfg" attribute in the answer to
   inform Alice that he can support the med-v0 level of capability
   negotiations.  Note that in this particular example, the answerer
   supported the capability extensions defined here, however had he not,
   he would simply have processed the offer based on the offered PCMU
   and G.729 codecs under the RTP/AVP profile only.  Consequently, the
   answer would have omitted the "a=csup" attribute line and chosen one
   or both of the PCMU and G.729 codecs instead.  The answer carries the
   accepted configuration in the m line along with corresponding rtpmap:
   and/or fmtp: parameters, as appropriate.

   Note that per the base protocol, after the above, Alice MAY generate
   a new offer with an actual configuration ("m=" line, etc.)
   corresponding to the actual configuration referenced in Bob's answer
   (not shown here).

3.2.  Capability Attributes

   In this section, we present the new attributes associated with
   indicating the media capabilities for use by the SDP Capability
   negotiation.  The approach taken is to keep things similar to the



Gilman, et al.            Expires May 18, 2008                  [Page 9]

Internet-Draft                    CMED                     November 2007


   existing media capabilities defined by the existing media
   descriptions ("m=" lines) and the associated "rtpmap" and "fmtp"
   attributes.  We use media subtypes and "media capability numbers"
   instead of payload types to link the relevant media capability
   parameters.  This permits the capabilities to be defined at the
   session level and used for multiple streams, if desired.  Payload
   types are then specified at the media level (see Section 3.2.2).

   A media capability merely indicates possible support for the media
   type and media format(s) in question.  In order to actually use a
   media capability in an offer/answer exchange, it must be referenced
   in a potential configuration (see Section 2.3.1).

   Media capabilities can be provided at the session-level and/or the
   media-level.  Media capabilities provided at the session level may be
   referenced in an lcfg attribute at the session level, or by any pcfg
   attribute at the media level, whereas media capabilities provided at
   the media level may be referenced by a pcfg attribute within that
   media stream only.  In either case, the scope of the <med-cap-num> is
   the entire session description.  This enables each media capability
   to be uniquely referenced across the entire session description (e.g.
   in a potential configuration)

3.2.1.  Media Type and Subtype Capability Attribute

   Media types and subtypes can be expressed as media format
   capabilities by use of the "a=mcap" attribute, which is defined as
   follows:

   a=mcap:<med-cap-num> <subtype>*[ <subtype>]

   where <med-cap-num> is an integer between 1 and 2^31-1 (both
   included) used to number the media format capabilities and the
   <subtype> is the media subtype e.g.  H263-1998, PCMU.  The <med-cap-
   num> is the media capability number associated with the first subtype
   in the list, the number associated with the second subtype is one
   higher, etc.  Each occurrence of the attribute MUST use a different
   value of <med-cap-num>.  Furthermore, when an "mcap" attribute
   indicates more than one media format, the capability numbers implied
   MUST NOT be used by any other "mcap" attribute in the entire session
   or media description (explicitly or implicitly).

   In ABNF, we have:

         media-capability-line = "a=mcap:" media-cap-num WSP media-type
                                    1*WSP media-cap *(WSP media-cap)
           media-cap-num      = 1*DIGIT
           media-cap          = token ; Subtype name(PCMU, G729, etc.)



Gilman, et al.            Expires May 18, 2008                 [Page 10]

Internet-Draft                    CMED                     November 2007


   The "mcap" attribute can be provided at the session-level and the
   media-level.  There can be more than one mcap attribute at the
   session or media level.  The unique media-cap-num is used to identify
   it in potential configurations.  When used in a potential
   configuration it is a media level attribute regardless if it is
   specified at the session or media level.

   For example:

             v=0
             a=mcap:1 iLBC
             a= mcap:2 H263-1998, H264

3.2.2.  The Media Encoding Parameter Capability Attribute

   Media format capabilities may require additional encoding parameters,
   such as sample rate, to be precisely defined.  The "a=ecap" encoding
   attribute is defined as

         a=ecap:<med-cap-num-list> <clock rate>[/<encoding parameters>]

   where

           med-cap-num-list = <med-cap-num> *[COMMA<med-cap-num>]

   The clock rate and other encoding parameters are as defined for the
   "a=rtpmap:" attribute defined in RFC 4566 [RFC4566].

   The "ecap" attribute can be provided at the session-level and the
   media-level.  There can be more than one ecap attribute at the
   session or media level.  The unique media-cap-num is used to identify
   it in potential configurations.  When used in a potential
   configuration it is a media level attribute regardless if it is
   specified at the session or media level.

   For example, a capability for low-bit-rate encoding at 8000 samples
   per second could be specified by

             a=mcap:1 iLBC
             a=ecap:1 8000

   The encoding becomes part of the media capability.  Thus, if it is
   desirable to specify the same subtype with, e.g., two different
   encoding rates, then the subtype should be listed twice, and each
   should be modified appropriately.  For example:






Gilman, et al.            Expires May 18, 2008                 [Page 11]

Internet-Draft                    CMED                     November 2007


             a=mcap:1 L16 L16
             a=ecap:1 8000
             a=ecap:2 16000/2

   defines two low-data-rate codecs, codec 1 uses 8000 samples per
   second, and codec 2 uses 16000 samples per second and 2 channels.

3.2.3.  The Media Format Parameter Capability Attribute

   This attribute is used to associate media format parameters with a
   media capability.  The form of the attribute is:

           a=fcap:<med-cap-num-list> <list of format parameters>

   where <med-cap-num-list> permits the format parameter(s) to be
   associated with one or more media capabilities, and the format
   parameters are specific to the type of codec(s), as described for the
   fmtp: attribute defined in RFC 4566[RFC4566].  Unlike the fmtp
   attribute, multiple fcap attributes may be associated with a
   specified med-cap-num.  This provides the ability to mix and match
   format parameters when using codecs with multiple format options.

   The fcap attribute adheres to RFC 4566 attribute production rules
   with

        media-format-capability-line = "a=fcap:" <att-value>

        att-value = <med-cap-num-list> WSP <format-specific-parameter-
        list>

        med-cap-num-list = <med-cap-num> *["," <med-cap-num>] ; med-cap-
        num is defined in Section 3.2.1

        format-specific-parameter-list = <format-specfic-parameter>
        *[";"<format-specfic-parameter>] ; format-specific-parameter-
        list are defined per codec/capability.

   The "fcap" attribute can be provided at the session-level and the
   media-level.  There can be more than one fcap attribute at the
   session or media level.  The unique media-cap-num is used to identify
   it in potential configurations.  When used in a potential
   configuration it is a media level attribute regardless if it is
   specified at the session or media level.

   As a simple example, a G.729 capability is, by default, considered to
   support comfort noise as defined by Annex B.  Capabilities for G.729
   with and without comfort noise support may thus be identified by:




Gilman, et al.            Expires May 18, 2008                 [Page 12]

Internet-Draft                    CMED                     November 2007


             a=mcap:1 audio G729 G729
             a=fcap:2 annexb:no

   Example for H.263 video:

             a=mcap:1 video H263-1998 H263-2000
             a=fcap:1 CIF=4;QCIF=2;F=1;K=1
             a=fcap:2 profile=2;level=2.2

   Finally, for six format combinations of the Adaptive MultiRate codec:

             a=mcap:1 audio AMR AMR AMR AMR AMR AMR
             a=ecap:1,3,5 16000/1
             a=ecap:2,4,6 8000/1
             a=fcap:1,2,3,4 mode-change-capability=1
             a=fcap:5,6 mode-change-capability=2
             a=fcap:1,2,3,5 max-red=220
             a=fcap:3,4,5,6 octet-align=1
             a=fcap:1,3,5 mode-set=0,2,4,7
             a=fcap:2,4,6 mode-set=0,3,5,6

   So that AMR codec #1, when specified in a pcfg attribute (and
   assigned payload type 98) as in

             a=pcfg:1 m=1 pt=1:98

   is essentially equivalent to the following

             m=audio 49170 RTP/AVP 98
             a=rtpmap:98 AMR/16000/1
             a=fmtp:98 mode-change-capability=1; max-red=220; mode-
             set=0,2,4,7

   and AMR codec #4 with payload type 99, is essentially equivalent to
   the following:

             m=audio 49170 RTP/AVP 99
             a=rtpmap:99 AMR/8000/1
             a=fmtp:99 mode-change-capability=1; octet-align=1; mode-
             set=0,3,5,6

   and so on for the other four combinations.

3.2.4.  The Bandwidth Capability Attribute

   In some cases it is desirable to specify different bandwidth limits
   for different media configurations.  This may be done by use of the
   "a=bcap" attribute, which is defined as follows:



Gilman, et al.            Expires May 18, 2008                 [Page 13]

Internet-Draft                    CMED                     November 2007


             a=bcap:<bw-cap-num> <bwtype>:<bandwidth>

   where <bw-cap-num> is an integer between 1 and 2^31-1 (both included)
   used to identify the bandwidth capability, <bwtype> is the bandwidth
   type, and <bandwidth> is the bandwidth value, as defined for the b=
   line in RFC4566[RFC4566]

   In ABNF, we have:

             media-bandwidth-cap-line = "a=bcap:" bw-cap-num 1*WSP
             bwtype ":" bandwidth

   where

             bw-cap-num = 1*DIGIT; the bandwidth "handle"
             bwtype = token; as defined in RFC4566
             bandwidth = 1*DIGIT; as defined in RFC4566

   The "bcap" attribute can appear at the session level, where it can be
   referenced by lcfg or pcfg attributes, or at the media level, where
   it can be referenced by pcfg attributes.  When invoked by a pcfg or
   lcfg attribute, the resulting bandwidth line (b=) is to be
   interpreted at the media-level.  There can be more then one bcap
   attribute.  The unique bw-cap-num is used to identify it in potential
   configurations.

   Note: The session level bandwidth gives a maximum total values for
   all the media in the session.  Currently the authors suggest that
   enforcing a potential limit can be done at the media level and by
   using re-INVITE for the session level bandwidth.

   Bandwidth capabilities may be included in a potential configuration
   via the "b=" parameter (see below).  Any bandwidth capability
   included replaces any media-level bandwidth of the same type declared
   in a "b=" SDP line.

   The following example offers a preferred potential configuration for
   H.263 QCIF at 360 Kbit/sec and a second potential configuration for
   H.263 CIF at the offered 500 Kbit/sec

             m=video 49170 RTP/AVP 99
             b=TIAS:500000
             a=rtpmap:99 H263-1998/90000
             a=fmtp:99 CIF=4; QCIF=2
             a=mcap:1 video H263-1998 H263-1998
             a=fcap:1 QCIF=2
             a=fcap:2 CIF=4; QCIF=2;F=1;K=1
             a=bcap:1 TIAS:360000



Gilman, et al.            Expires May 18, 2008                 [Page 14]

Internet-Draft                    CMED                     November 2007


             a=pcfg:1 m=1 b=1 pt:100
             a=pcfg:2 m=2 pt:101

3.3.  Extensions to the Potential Configuration Attribute

   The extension protocol of capabilities negotiation requires three new
   extensions for the pcfg: attribute defined in the base protocol.  The
   first extension permits the specification of media capabilities, or
   combinations thereof; the second permits the assignment of payload
   types to those capabilities when used in the specified configuration;
   the third permits the specification of bandwidth limits for a media
   stream.

3.3.1.  The Media Capability Extension to the Potential Configuration
        Attribute

   The potential configuration attribute ("a=pcfg") as defined in SDP
   capabilities negotiation, permits alternate attributes to be
   associated with the media types defined in a media line.  In this
   document, we define an extension parameter for the specification of
   media configurations in addition to the one specified on the media
   line.

   We define the media capability configuration parameter, pot-media-
   config, in accordance with the following format:

           m=<med-cap-list> *["|"<med-cap-list>]

   where <med-cap-list> is a comma-separated list of media capability
   numbers (media-cap-num) as defined by a=mcap: lines and media lines.

   In ABNF form (adhering to the ABNF for pot-extension-config in
   [SDPCapNeg]:

           pot-media-config = "m=" med-cap-list *(BAR med-cap-list)
           med-cap-list        = med-cap-num *("," med-cap-num)
           med-cap-num      = 1*DIGIT      ; defined in SDP
           BAR                    = *WSP "|" *WSP

   Each potential media configuration is a comma-separated list of media
   capability numbers where med-cap-num refers to media capability
   numbers defined explicitly by a=mcap attributes and hence MUST be
   between 1 and 2^31-1 (both included).  Alternative potential media
   configurations are separated by a vertical bar ("|").  The
   alternatives are ordered by preference.  When media capabilities are
   not included in a potential configuration at the media level, the
   media type and media format from the associated "m=" line will be
   used.



Gilman, et al.            Expires May 18, 2008                 [Page 15]

Internet-Draft                    CMED                     November 2007


   For example:

             v=0
             o=- 25678 753849 IN IP4 192.0.2.1
             s=
             c=IN IP4 192.0.2.1
             t=0 0
             a=creq:med-v0
             m=audio 3456 RTP/AVP 0 18 100
             a=rtpmap:100 telephone-events
             a=fmtp:100 0-15
             a=mcap:1 audio PCMU g729 telephone-event
             a=ecap:1,2,3 8000
             a=fcap:3 0-15
             a=pcfg:1 m=2,3|1,3 pt=1:0, 2:18, 3:100

   In this example, G729 is media capability 2, PCMU is media capability
   1, and events is media capability 3.  The a=pcfg: line specifies that
   the preferred configuration is G.729 with dtmf events, second is
   G.711 mu-law with dtmf events.  Intermixing of G.729, G.711, and dtmf
   events is least preferred (the actual configuration provided by the
   "m=" line, which is always the least preferred configuration).

3.3.2.  The Payload Type Mapping Extension to the Potential
        Configuration Attribute

   When media capabilities defined in mcap: attributes are used in
   potential configuration lines, it is necessary to assign payload
   types to them.  In some cases, it is desirable to assign different
   payload types to media capabilities defined in the media line.  One
   example of the latter is when configurations for AVP and SAVP are
   offered: the offerer would like the answerer to use different payload
   types for encrypted and unencrypted media so that it (the offerer)
   can decide whether or not to render early media which arrives before
   the answer is received.

   We define the media type mapping configuration parameter, pt-media-
   map, in accordance with the following format:

             pt-media-map = "pt=" med-map *("," med-map);
             med-map = <med-cap-num> ":" <'payload-type> ;
             med-cap-num is defined above
             payload-type = 1*DIGIT ; RTP payload type

   The example in the previous section shows how the parameters from the
   mcap line are mapped to payload type in the pcfg "pt" parameter.





Gilman, et al.            Expires May 18, 2008                 [Page 16]

Internet-Draft                    CMED                     November 2007


3.3.3.  The Bandwidth Extension to the Potential Configuration Attribute

   A bandwidth parameter is added to the pcfg attribute in order to
   provide the flexibility to specify different bandwidth limits for
   different configurations.

   The bandwidth parameter, bw-param, is defined in accordance with the
   following format:

             bw-param = "b=" bw-cap-list;
             bw-cap-list = bw-cap-num *("," bw-cap-num);
             bw-cap-num = 1*DIGIT; as defined above

   Note that it is considered an error condition if the same bandwidth
   type is referenced more than once in the bw-cap-list.

3.4.  Extensions to the Actual Configuration Attribute

   The Actual configuration attribute is specified in [SDPCapNeg].  The
   actual configuration MUST list the potential configuration selected
   by the answerer.  This section adds extensions parameters enabling
   the answerer to specify the potential configuration attributes
   defined in this document and used in forming the answer.

   We define actual configuration extensions based on the sel-extension-
   config specified in [SDPCapNeg].  The new parameters are: parameter
   act-media-config, act-med-map and act-bw-param in accordance with the
   following ABNF:

             act-media-config = "m=" med-cap-list ; defined in section
             3.3.1
             act-med-map = "pt=" med-map *("," med-map) ; defined in
             section 3.3.2
             act-bw-param = "b=" bw-cap-list ; defined in section 3.3.3

   A response to the previous offer example in the above section might
   be:

             v=0
             o=- 24351 621814 IN IP4 192.0.2.2
             s=
             c=IN IP4 192.0.2.2
             t=0 0
             a=csup:med-v0
             m=audio 5432 RTP/AVP 18 100
             a=rtpmap:100 events
             a=fmtp:100 0-15
             a=acfg:1 m=2,3 pt=2:18,3:100



Gilman, et al.            Expires May 18, 2008                 [Page 17]

Internet-Draft                    CMED                     November 2007


   Note that the capability numbers expressed in the acfg: attribute are
   based on the offered capability numbering, not on those listed in the
   answer, if any.  The acfg attribute identifies to the offrer which
   potential configuration and media encoding combination was selected
   by the answerer.

3.5.   The Latent Configuration Attribute

   One of the goals of this work is to permit the exchange of media
   configurations in addition to those offered for immediate use.  Such
   configurations are referred to as "latent configurations".  For
   example, a party may offer to establish an audio session, and, at the
   same time, announce its ability to support a video session and supply
   its video capabilities.

   Latent configurations may be announced by use of the latent
   configuration attribute, which is defined in a manner very similar to
   the potential configuration attribute:

     a=lcfg:<preference> ["m="<media-caps-list>] ["t="<transport>]
                ["a="<attributes>]  ["b="<bw-cap-list>]

   The m=, t=, b= and a= parameters are identical in format and meaning
   to those defined for the pcfg: attribute.  Note that the pt=
   parameter is not permitted in the lcfg: attribute because no actual
   media session is being offered or accepted.

   Latent Configurations MUST be specified at the session level when
   they represent an additional media stream to those in the offer or
   answer.  If an acap: attribute is declared at the session level for
   use in a session-level lcfg line, it SHOULD NOT be used in a pcfg
   line at the media level unless it is to become a session-level
   attribute in the answer.

3.5.1.   The crypto: Attribute in Latent Configurations

   If the sdescriptions crypto: attribute is necessary as part of any
   latent configuration which announces sdescriptions capabilities, it
   presents a slight problem in that the rather long key/salt string is
   useless and should be ignored.  This problem is avoided if we exclude
   the a= parameters from the lcfg: attribute.  [Editor's note: Should
   we define a new crypto: key-method, e.g. "latent", in which the key-
   salt portion of key-info is empty?  I think it may be sufficient to
   just include the RTP/SAVP transport to indicate SRTP capability since
   there will be a new offer when the latent configuration will be
   offered.]





Gilman, et al.            Expires May 18, 2008                 [Page 18]

Internet-Draft                    CMED                     November 2007


3.6.  Offer/Answer Model Extensions

   In this section, we define extensions to the offer/answer model
   defined in RFC3264 [RFC3264] to allow for media capabilities to be
   used with the SDP Capability Negotiation framework.

3.6.1.  Generating the Initial Offer

   When an endpoint generates an initial offer and want to use the
   functionality described in the current document, it should identify
   and define the codecs it can support via mcap , ecap , and fcap
   attributes.  The SDP media line(s) should be made up with the default
   (least preferred) configuration.  Typically, the media line
   configuration will contain the minimum acceptable capabilities.  The
   offer MUST include the required extensions needed to support this
   functionality.

   Preferred configurations for each media stream are identified
   following the media line.  The present offer may also include latent
   configuration (lcfg) attributes, at the session level, describing
   media streams and/or configurations the offeror is not now offering,
   but which it is willing to support in a future offer/answer exchange.
   A simple example might be the inclusion of a latent video
   configuration in an offer for an audio stream.

3.6.2.  Generating the Answer

   When the answering party receives the offer and if it supports the
   required extensions, it should select the most-preferred
   configuration for each media stream, and build its answer
   accordingly.  Each selected media configuration is placed into the
   answer as a media line with associated parameters, It must include
   the supported extension attribute and an actual configuration (acfg)
   attribute to indicate just which pcfg attribute was used to build the
   answer.  The answer should may also include any latent configurations
   the answerer can support, especially any configurations compatible
   with latent configurations received in the offer.  The answerer
   should make note of those configurations it might wish to offer in
   the future.

3.6.3.  Offerer Processing of the Answer

   When the offerer receives the answer, it should make note of any
   capabilities and/or latent configurations for future use.  The media
   line(s) must be processed in the normal way to identify the media
   stream(s) accepted by the answer, if any.  The acfg attribute, if
   present, may be used to verify the proposed configuration used to
   form the answer, and to infer the lack of acceptability of higher-



Gilman, et al.            Expires May 18, 2008                 [Page 19]

Internet-Draft                    CMED                     November 2007


   preference configurations that were not chosen.  Note that the base
   specification [SDPCapNeg] requires the answerer to choose the highest
   preference configuration it can support.

3.6.4.  Modifying the Session

   If, at a later time, one of the parties wishes to modify the
   operating parameters of a session, e.g., by adding a new media
   stream, or changing a codec used on an existing stream, it may do so
   via the mechanisms defined for offer/answer[RFC3264].  If the
   initiating party has remembered the codecs, potential configurations,
   and latent configurations announced by the other party in the earlier
   negotiation, it may use this knowledge to maximize the likelihood of
   a successful modification of the session.  Alternatively, it may
   perform a new capabilities exchange as part of the reconfiguration.




































Gilman, et al.            Expires May 18, 2008                 [Page 20]

Internet-Draft                    CMED                     November 2007


4.  Examples

   In this section, we provide examples showing how to use the Media
   Capabilities with the SDP Capability Negotiation.

4.1.  Alternative Codecs

4.2.  Latent Media Streams











































Gilman, et al.            Expires May 18, 2008                 [Page 21]

Internet-Draft                    CMED                     November 2007


5.  IANA Considerations


















































Gilman, et al.            Expires May 18, 2008                 [Page 22]

Internet-Draft                    CMED                     November 2007


6.  Security Considerations


















































Gilman, et al.            Expires May 18, 2008                 [Page 23]

Internet-Draft                    CMED                     November 2007


7.  Changes from previous versions

7.1.  Changes from version 01

   The documents adds a new attribute for specifying bandwidth
   capability and a parametr to list in the potential configuration.
   Other changes are to align the document with the terminolgy and
   attribute names from draft-ietf-mmusic-sdp-capability-negotiation-07.
   The document also clarifies some previous open issues.

7.2.  Changes from version 00

   The major changes include taking out the "mcap" and "cptmap"
   parameter.  The mapping of payload type is now in the "pt" parameter
   of "pcfg".  Media subtype need to explictly definesd in the "cmed"
   attribute if referenced in the "pcfg"



































Gilman, et al.            Expires May 18, 2008                 [Page 24]

Internet-Draft                    CMED                     November 2007


8.  Acknowledgements

   This document is heavily influenced by the discussions and work done
   by the SDP Capability Negotiation Design team.  The following people
   in particular provided useful comments and suggestions to either the
   document itself or the overall direction of the solution defined
   herein: Cullen Jennings, Matt Lepinski, Joerg Ott, Colin Perkins, and
   Thomas Stach.











































Gilman, et al.            Expires May 18, 2008                 [Page 25]

Internet-Draft                    CMED                     November 2007


9.  References

9.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC3264]  Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model
              with Session Description Protocol (SDP)", RFC 3264,
              June 2002.

   [RFC4566]  Handley, M., Jacobson, V., and C. Perkins, "SDP: Session
              Description Protocol", RFC 4566, July 2006.

   [SDPCapNeg]
              Andreasen, F., "SDP Capability Negotiation",
              draft-ietf-mmusic-sdp-capability-negotiation-07 (work in
              progress), October 2007.

9.2.  Informative References

   [RFC3407]  Andreasen, F., "Session Description Protocol (SDP) Simple
              Capability Declaration", RFC 3407, October 2002.

   [RFC3952]  Duric, A. and S. Andersen, "Real-time Transport Protocol
              (RTP) Payload Format for internet Low Bit Rate Codec
              (iLBC) Speech", RFC 3952, December 2004.
























Gilman, et al.            Expires May 18, 2008                 [Page 26]

Internet-Draft                    CMED                     November 2007


Authors' Addresses

   Robert R Gilman
   Avaya, Inc.
   1300 West 120th Avenue
   Westminster, CO 80234
   USA

   Email: rrg@avaya.com


   Roni Even (editor)
   Polycom
   94 Derech Em Hamoshavot
   Petach Tikva  49130
   Israel

   Email: roni.even@polycom.co.il


   Flemming Andreasen
   Cisco Systems
   Edison, NJ
   USA

   Email: fandreas@cisco.com

























Gilman, et al.            Expires May 18, 2008                 [Page 27]

Internet-Draft                    CMED                     November 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Gilman, et al.            Expires May 18, 2008                 [Page 28]

