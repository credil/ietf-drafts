<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
     which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced. 
     An alternate method (rfc include) is described in the references. -->
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3588 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3588.xml">
<!ENTITY RFC4005 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4005.xml">
<!ENTITY RFC4675 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4675.xml">
<!ENTITY RFC5777 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5777.xml">
<!ENTITY RFC5624 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5624.xml">
<!ENTITY I-D.draft-ietf-dime-diameter-qos SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-dime-diameter-qos-14.xml">
<!ENTITY I-D.draft-nishitani-cgn SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-nishitani-cgn-03.xml">
<!ENTITY I-D.narten-iana-considerations-rfc2434bis SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.narten-iana-considerations-rfc2434bis.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs), 
     please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
     (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space 
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="std" docName="draft-ietf-dime-nat-control-05" ipr="trust200902">
  <!-- ipr="full3978"-->

  <!-- category values: std, bcp, info, exp, and historic
     ipr values: full3667, noModification3667, noDerivatives3667
     you can add the attributes updates="NNNN" and obsoletes="NNNN" 
     they will automatically be output with "(if approved)" -->

  <!-- ***** FRONT MATTER ***** -->

  <front>
    <!-- The abbreviated title is used in the page header - it is only necessary if the 
         full title is longer than 39 characters -->

    <title abbrev="Diameter NAT Control Application">Diameter Network Address
    and Port Translation Control Application</title>

    <!-- add 'role="editor"' below for the editors if appropriate -->

    <!-- Another author who claims to be an editor -->

    <author fullname="Frank Brockners" initials="F." surname="Brockners">
      <organization>Cisco</organization>

      <address>
        <postal>
          <street>Hansaallee 249, 3rd Floor</street>

          <!-- Reorder these if your country does things differently -->

          <city>DUESSELDORF</city>

          <region>NORDRHEIN-WESTFALEN</region>

          <code>40549</code>

          <country>Germany</country>
        </postal>

        <email>fbrockne@cisco.com</email>

        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <author fullname="Shwetha Bhandari" initials="S." surname="Bhandari">
      <organization>Cisco</organization>

      <address>
        <postal>
          <street>Cessna Business Park, Sarjapura Marathalli Outer Ring
          Road</street>

          <city>Bangalore, KARNATAKA 560 087</city>

          <country>India</country>
        </postal>

        <email>shwethab@cisco.com</email>
      </address>
    </author>

    <author fullname="Vaneeta Singh" initials="V." surname="Singh">
      <organization>Mavenir Systems</organization>

      <address>
        <postal>
          <street>Sharda Towers, 56/13 Nandidurga Road</street>

          <city>Bangalore 560046</city>

          <country>India</country>
        </postal>

        <email>vaneeta@mavenir.com</email>
      </address>
    </author>

    <author fullname="Victor Fajardo" initials="V." surname="Fajardo">
      <organization>Telcordia Technologies</organization>

      <address>
        <postal>
          <street>1 Telcordia Drive #1S-222</street>

          <city>Piscataway, NJ 08854</city>

          <country>USA</country>
        </postal>

        <email>vf0213@gmail.com</email>
      </address>
    </author>

    <date day="22" month="October" year="2010" />

    <!-- If the month and year are both specified and are the current ones, xml2rfc will fill 
         in the current day for you. If only the current year is specified, xml2rfc will fill 
	 in the current day and month for you. If the year is not the current one, it is 
	 necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the 
	 purpose of calculating the expiry date).  With drafts it is normally sufficient to 
	 specify just the year. -->

    <!-- Meta-data Declarations -->

    <area>General</area>

    <workgroup>Internet Engineering Task Force</workgroup>

    <!-- WG name at the upperleft corner of the doc,
         IETF is fine for individual submissions.  
	 If this element is not present, the default is "Network Working Group",
         which is used by the RFC Editor as a nod to the history of the IETF. -->

    <keyword>ds-lite</keyword>

    <!-- Keywords will be incorporated into HTML output
         files in a meta tag but they have no effect on text or nroff
         output. If you submit your draft to the RFC Editor, the
         keywords will be used for the search engine. -->

    <abstract>
      <t>This document describes the framework, messages, and procedures for
      the Diameter Network address and port translation Control Application.
      This Diameter application allows per endpoint control of Network Address
      Translators and Network Address and Port Translators, which are added to
      cope with IPv4-address space completion. This Diameter application
      allows external devices to configure and manage a Network Address
      Translator device - expanding the existing Diameter-based AAA and policy
      control capabilities with a Network Address Translators and Network
      Address and Port Translators control component. These external devices
      can be network elements in the data plane such as a Network Access
      Server, or can be more centralized control plane devices such as
      AAA-servers. This Diameter application establishes a context to commonly
      identify and manage endpoints on a gateway or server, and a Network
      Address Translator and Network Address and Port Translator device. This
      includes, for example, the control of the total number of Network
      Address Translator bindings allowed or the allocation of a specific
      Network Address Translator binding for a particular endpoint. In
      addition, it allows Network Address Translator devices to provide
      information relevant to accounting purposes.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction" toc="default">
      <t>Internet service providers have started to deploy Network Address
      Translators (NATs) and Network Address and Port Translators (NAPTs) at
      the edge of their networks to deal with the depletion of available
      public IPv4 addresses. This document defines a Diameter application for
      providers deploying such NAT and NAPT devices. The use of a Diameter
      application allows for simple integration into the existing AAA
      environment of a provider.</t>

      <t>The Diameter Network address and port translation Control Application
      (DNCA) offers the following capabilities:</t>

      <t><list style="numbers">
          <t>Limits or defines the number of NAPT/NAT bindings made available
          to an individual subscriber or end point.</t>

          <t>Supports the allocation of specific NAPT/NAT bindings. Two types
          of specific bindings can be distinguished:<list style="symbols">
              <t>Allocation of a pre-defined NAT binding: Both the internal
              and external IP address and port pair are specified within the
              request. In some deployment cases, such as access to a
              web-server within a user&rsquo;s home network with IP address
              and port, benefit from statically configured bindings.</t>

              <t>Allocation of an external IP address for a given internal IP
              address: The allocated external IP address is reported back to
              the requestor. In some deployment scenarios, the application
              requires immediate knowledge of the allocated binding for a
              given internal IP address but does not control the allocation of
              the external IP address; for example, SIP-proxy server
              deployments.</t>
            </list></t>

          <t>Defines the external address pool(s) to be used for allocating an
          external IP address: External address pools can either be
          pre-assigned at the NAPT/NAT, or specified within a request. If
          pre-assigned address pools are used, a request needs to include a
          reference to identify the pool. Otherwise, the request contains a
          description of the IP address pool(s) to be used; for example, list
          of IP-subnets. Such External address pools can be used to select
          external IP address in NAPT/NAT bindings for multiple
          subscribers.</t>

          <t>Generates reports and accounting records: Reports established
          bindings for a particular user. The collected information is used by
          accounting systems for statistical purposes.</t>

          <t>Queries and retrieves details about bindings on demand: This
          feature complements the previously mentioned accounting
          functionality(see item 4). The query functionality complements
          alternative information query mechanisms, such as SNMP-based
          mechanism, if available.</t>

          <t>Identifies a subscriber or endpoint on multiple network devices
          (NAPT or NAT device, the AAA-server, or the Network Access Server
          (NAS)): Endpoint identification is facilitated through a Global
          Endpoint ID. Endpoints are identified through a single or a set of
          classifiers, such as IP address, VLAN identifier, or interface
          identifier which uniquely identify the traffic associated with a
          particular global endpoint</t>
        </list></t>

      <t>This document is structured as follows: Section 2 lists terminology,
      while Section 3 provides an introduction to the DNCA and its overall
      deployment framework. Sections 4 to 8 cover the DNCA specifics, with
      Section 4 describing session management, Section 5 the use of the
      Diameter base protocol, Section 6 new commands, Section 7 AVPs used, and
      Section 8 accounting aspects. Section 9 presents an AVP occurance table.
      IANA and security considerations are addressed in Sections 10 and
      11.</t>
    </section>

    <section anchor="Conventions" title="Conventions">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119"></xref>.</t>

      <t>Abbreviations used in this document:</t>

      <t><list style="empty">
          <t>AAA: Authentication, Authorization, Accounting</t>

          <t>DNCA: Diameter Network address and port translation Control
          Application</t>

          <t>NAPT: Network Address and Port Translation</t>

          <t>NAT: Network Address Translation (NAT and NAPT are used in this
          document interchangeably)</t>

          <t>NAT Binding or Binding: Association of two IP address/port pairs
          (with one IP address typically being private and the other one
          public) to facilitate NAT</t>

          <t>NAS: Network Access Server</t>

          <t>NCR:NAT Control Request</t>

          <t>NCA:NAT Control Answer</t>
        </list></t>
    </section>

    <section anchor="framework" title="Deployment Framework">
      <section title="Deployment Scenario">
        <t><xref target="fig-network-deployment"></xref> shows a typical
        network deployment for Internet access. A user&rsquo;s IPv4 host gains
        access to the Internet though a NAS, which facilitates the
        authentication of the endpoint and configures the user&rsquo;s
        connection according to the authorization and configuration data
        received from the AAA-server upon successful authentication. Public
        IPv4 addresses are used throughout the network.</t>

        <figure anchor="fig-network-deployment"
                title="Typical network deployment for internet access">
          <artwork><![CDATA[                      +---------+
                      |         |
                      |   AAA   |
                      |         |
                      +---------+
                           |
                           |
                           |
                           |
 +---------+          +---------+             +----------+
 |  IPv4   |          |         |             |  IPv4    |
 |  Host   |----------|   NAS   |-------------| Internet |
 |         |          |         |             |          |
 +---------+          +---------+             +----------+

 <-------------------- Public IPv4 ---------------------->
]]></artwork>
        </figure>

        <t><xref target="fig-LSN-deployment"></xref> depicts the deployment
        scenario when a service provider introduces a NAT device to increase
        the efficiency of the global IPv4 address pool utilization. The
        objective is to provide the customer with connectivity to the public
        IPv4 Internet. The NAT device performs network address and port (and
        optionally address family) translation, depending on whether the
        access network uses private IPv4 addresses or public IPv6 addresses,
        to public IPv4 addresses. If the NAT device would be put in place
        without any endpoint awareness, the service offerings of the service
        provider could be hampered. Provisioning static NAT bindings for
        particular endpoints, using different public IP address pools for
        different set of endpoints; for example, residential or business
        customers, and reporting allocated bindings on a per endpoint basis is
        burdensome for a service provider if the NAT device is not aware of
        endpoints and allows per endpoint control and management, which easily
        integrates with the already existing per endpoint management
        infrastructure of the service provider.</t>

        <figure anchor="fig-LSN-deployment"
                title="Access network deployment with LSN">
          <artwork><![CDATA[                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
                     |
  +--------+    +---------+    +---------+    +----------+
  |  IPv4/ |    |         |    |         |    |  IPv4    |
  |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
  |  Host  |    |         |    |         |    |          |
  +--------+    +---------+    +---------+    +----------+
  <-------- Private IPv4 -----------><--- Public IPv4 --->
  <-------- Public  IPv6 -----------><--- Public IPv4 --->
]]></artwork>
        </figure>
      </section>

      <section title="Diameter NAPT Control Application Overview">
        <t>The DNCA runs between a DNCA Agent on the NAT and the DNCA Manager.
        DNCA allows per endpoint control and management of NAT. Based on
        Diameter, DNCA integrates well with the suite of Diameter applications
        deployed for per endpoint authentication, authorization, accounting,
        and policy control in service provider networks.</t>

        <t>DNCA offers:<list style="symbols">
            <t>Request and answer commands to control the allowed number of
            NAT bindings per endpoint , to request the allocation of specific
            bindings for an endpoint, to define the address pool to be used
            for an endpoint.</t>

            <t>Provides per endpoint reporting of the allocated NAT
            bindings.</t>

            <t>Provides unique identification of an endpoint on NAT device,
            AAA-server and NAS, to simplify correlation of accounting data
            streams.</t>
          </list></t>

        <t>DNCA allows controlling the behavior of a NAT device on a per
        endpoint basis during initial session establishment and at later
        stages by providing an update procedure for already established
        sessions. Using DNCA, per endpoint NAT binding information can be
        retrieved either using accounting mechanisms or through an explicit
        session query to the NAT.</t>
      </section>

      <section title="Deployment Scenarios For DNCA">
        <t>The role of the Diameter NAT Control Manager can be fulfilled by
        either the NAS or by an external server, such as AAA-server. The two
        deployment scenarios are outlined in <xref
        target="fig-LSN-integrated-deployment"></xref> (&ldquo;integrated
        deployment&rdquo;) and <xref
        target="fig-LSN-autonomous-deployment"></xref> (&ldquo;autonomous
        deployment&rdquo;).</t>

        <t>Within the figures (M) denotes the network element, which takes on
        the DNCA Manager role. Similarly, (A) identifies the network element,
        which performs the DNCA Agent role.</t>

        <t>The integrated deployment approach hides the existence of the NAT
        device from external servers, such as the AAA-server as much as
        possible. It is suited for environments where minimal changes to the
        existing AAA deployment are desired. As DNCA Manager the NAS,
        initiates and manages session with the NAT device, exchanges NAT
        specific configuration information and handles reporting and
        accounting information. The NAS receives reporting and accounting
        information from NAT device. With this information, the NAS provides a
        single accounting record for the user. This reduces the usage of an
        external accounting system for correlating the information received
        from multiple sources.</t>

        <t>An example network attachment for an integrated NAT deployment can
        be described as follows: An endpoint connects to the network, with the
        NAS being the point of attachment. After successful authentication,
        NAS receives endpoint related authorization data from the AAA-server.
        A portion of the authorization data applies to per endpoint
        configuration on the NAS itself, another portion describes
        authorization and configuration information for NAT control aimed at
        the NAT device. NAS will initiate a DNCA session to the NAT and send
        the relevant authorization and configuration information for the
        particular endpoint to the NAT device. This can comprise NAT bindings,
        which have to be pre-established for the endpoint, or management
        related configuration, such as the maximum number of NAT bindings
        allowed for the endpoint or accounting requirements. The NAT device
        sends its per endpoint accounting information to the NAS, which
        aggregates the accounting information received form the NAT device
        with its local accounting information for the endpoint into a single
        accounting stream towards the AAA-server.</t>

        <figure anchor="fig-LSN-integrated-deployment"
                title="LSN Control deployment: Integrated deployment">
          <artwork><![CDATA[                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
  +--------+    +---------+    +---------+    +----------+
  |  IPv4/ |    |   (M)   |    |   (A)   |    |  IPv4    |
  |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
  |  Host  |    |         |    |         |    |          |
  +--------+    +---------+    +---------+    +----------+
  <-------- Public  IPv6 ----------><--- Public IPv4 ---->
  <-------- Private IPv4 ----------><--- Public IPv4 ---->
]]></artwork>
        </figure>

        <t>The autonomous deployment approach decouples user management on NAS
        and NAT device. The AAA system performing the role of the DNCA Manager
        manages the connection to the NAT device, controls the per endpoint
        configuration, and also receives accounting and reporting information
        from the NAT device. Different from the integrated deployment
        scenario, the autonomous deployment scenario does not
        &ldquo;hide&rdquo; the existence of the NAT device from the AAA
        infrastructure. Here two accounting streams are received by the
        AAA-server for one particular endpoint, one from the NAS, and one from
        the NAT device.</t>

        <figure anchor="fig-LSN-autonomous-deployment"
                title="LSN Control deployment: Autonomous deployment">
          <artwork><![CDATA[                  +---------+
                  |   (M)   |
                  |   AAA   |---------
                  |         |         |
                  +---------+         |
                       |              |
                       |              |
                       |              |
    +--------+    +---------+    +---------+    +----------+
    |  IPv4/ |    |         |    |   (A)   |    |  IPv4    |
    |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
    |  Host  |    |         |    |         |    |          |
    +--------+    +---------+    +---------+    +----------+
    <-------- Public  IPv6 ----------><---- Public IPv4 --->
    <-------- Private IPv4 ----------><---- Public IPv4 --->]]></artwork>
        </figure>
      </section>
    </section>

    <section anchor="sec-dnca"
             title="DNCA Session Establishment and Management">
      <t>Note that this section forward references some of the commands and
      AVPs defined for the DNCA. Please refer to <xref
      target="sec-dnca-commands"></xref> and <xref
      target="sec-dnca-avps"></xref> for details.</t>

      <section title="Parties Involved ">
        <t>Authorization and control models supported by this application
        include the following parties: <list style="symbols">
            <t>DNCA agent: The DNCA agent is part of the NAT device</t>

            <t>DNCA Manager</t>
          </list></t>

        <t>The NAT control requesting entity is always the DNCA Manager. The
        DNCA Manager always initiates, updates, or terminates the sessions.
        This mode of operation is sometimes also referred to as "push
        mode".</t>

        <t>The DNCA Manager can be NAS or AAA-server. The DNCA Manager
        initiates a session with the DNCA agent when it learns about the
        subscriber. The DNCA Manager may learn about a subscriber when it
        receives authentication, authorization, or accounting request for that
        subscriber or by some other means, such as on the box configuration to
        identify a subscriber with respect to his IP packets.</t>
      </section>

      <section title="Session Establishment">
        <t>The DNCA Manager establishes a session with the DNCA agent to
        control the behavior of the NAT device. During session establishment,
        the DNCA Manager passes along configuration information to the DNCA
        agent. The session configuration information comprises the maximum
        number of bindings allowed for the endpoint associated with this
        session, a set of pre-defined NAT bindings to be established for this
        endpoint, or a description of the address pool, external addresses to
        be allocated from.</t>

        <t>The DNCA Manager initiates the Diameter NAT Control session to the
        DNCA Agent. The DNCA Manager generates a NAT-Control Request (NCR)
        message to the DNCA Agent with NC-Request-Type AVP set to
        INITIAL_REQUEST. On receipt of NCR the DNCA Agent sets up a new
        session for the endpoint associated with the endpoint classifier(s)
        contained in the NCR. The DNCA agent notifies the DNCA Manager about
        successful session setup using a NAT-Control Answer (NCA) message with
        Result-Code set to DIAMETER_SUCCESS. <xref
        target="fig-session-establishment"></xref> shows the protocol
        interaction between the DNCA Manager and the DNCA Agent.</t>

        <t>The initial NAT-Control-Request may contain configuration
        information for the session, which specifies the behavior of the NAT
        device for the session. The configuration information, which may be
        included, comprises: <list style="symbols">
            <t>A list of NAT bindings, which should be pre-allocated for the
            session; for example, in case a subscriber requires a fixed
            external IP- address/port pair for one of the applications.</t>

            <t>The maximum number of NAT bindings allowed for an endpoint.</t>

            <t>A description of the external address pool(s) to be used for
            the session.</t>

            <t>A reference to a predefined binding rule on the DNCA Agent,
            which is applied to the session. Such a predefined binding rule on
            the DNCA Agent may contain, for example, the name of the IP
            address pool that external IP addresses should be allocated from,
            maximum number of bindings permitted for the endpoint etc.</t>
          </list></t>

        <t>In certain cases, the DNCA Agent may not be able to perform the
        tasks requested within the NCR. These include the following: <list
            style="symbols">
            <t>If a DNCA Agent receives a NCR from a DNCA Manager with NC-
            Request-Type AVP set to INITIAL_REQUEST that identifies an already
            existing session; that is, DNCA Manager and endpoint identifier
            match an already existing session, the DNCA Agent returns NCA with
            Result-Code set to SESSION_EXISTS, and provides the Session-Id of
            the existing session in Duplicate-Session-Id AVP.</t>

            <t>If a DNCA Agent receives an NCR from a DNCA Manager with NC-
            Request-Type AVP set to INITIAL_REQUEST that matches more than one
            of the already existing sessions; that is, DNCA Manager and
            endpoint identifier match already existing sessions, the DNCA
            Agent returns a NCA with Result-Code set to
            Insufficient-Classifiers. In case a DNCA Manager receives NCA that
            reports Insufficient-Classifiers, it may choose to retry
            establishing a new session using additional or more specific
            classifiers.</t>

            <t>If the NCR contains a binding rule not defined on the NAT
            device, the DNCA Agent returns NCA with Result-Code AVP set to
            UNKNOWN_BINDING_RULE.</t>

            <t>In case the DNCA Agent is unable to establish all of the
            bindings requested in the NCR, it will return a NCA with
            Result-Code set to BINDING_FAILURE. The DNCA Agent, that is NAT
            device, treats a NCR as an atomic operation; hence none of the
            requested bindings will be established by the NAT device. Either
            all requested actions within a NCR are completed successfully, or
            the entire request fails.</t>

            <t>If DNCA Agent does not have sufficient resources to process a
            request, it returns NCA with Result-Code set to
            RESOURCE_FAILURE.</t>

            <t>In case Max-NAT-Binding and NAT-Control-Definition are included
            in the NCR along with a reference to a binding rule; that is, a
            predefined template on NAT device, and the values in
            Max-NAT-Binding and NAT-Control-Definition contradict those
            specified in the pre-defined binding rule, Max-NAT-Binding and
            NAT-Control-Definition override the values specified in the
            binding rule.</t>
          </list></t>

        <figure anchor="fig-session-establishment"
                title="Initial NAT Control request and session establishment  ">
          <artwork><![CDATA[         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
         Trigger                                        |
            |                                           |
            |                   NCR                     |
            |------------------------------------------>|
            | (INITIAL_REQUEST, endpoint classifier,    |
            |     session id, NAT control config data)  |
            |                                           |
            |                                           |
            |                                  Create session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |<------------------------------------------|
            |                 (result code)             |
            |                                           |
            |                                           |]]></artwork>
        </figure>
      </section>

      <section title="Session Re-Authorization">
        <t>Session re-authorization is performed if the DNCA Manager desires
        to change the behavior of the NAT for an existing session.
        Re-authorization could be used, for example, to change the number of
        allowed bindings for a particular session, or establish or remove a
        pre-defined binding.</t>

        <t>The DNCA Manager generates a NC message to the DNCA Agent with
        NC-Request-Type AVP set to UPDATE_REQUEST upon receiving a trigger
        signal. In case the session is updated successfully, the DNCA Agent
        notifies the DNCA Manager about successful session update using a
        NAT-Control Answer (NCA) message with Result-Code set to
        DIAMETER_SUCCESS. <xref target="fig-session-re-auth"></xref> shows the
        protocol interaction between the DNCA Manager and the DNCA Agent.</t>

        <t>In certain cases, the DNCA Agent may not be able to perfborm the
        tasks requested within the NCR. These include the following: <list
            style="symbols">
            <t>If DNCA Agent receives a NCR update or query request for a
            non-existent session, it sets Result-Code in the answer to
            DIAMETER_UNKNOWN_SESSION_ID.</t>

            <t>If the NCR contains a binding rule not defined on the NAT
            device, the DNCA Agent returns NCA with Result-Code AVP set to
            UNKNOWN_BINDING_RULE.</t>

            <t>If the DNCA Agent cannot establish the requested binding
            because the maximum number of allowed bindings has been reached
            for the Endpoint Classifier, it returns NCA with Result-Code AVP
            set to MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT.</t>

            <t>If the DNCA Agent cannot establish some or all of the bindings
            requested in a NCR, but has not yet reached the maximum number of
            allowed bindings for the subscriber, it returns a NCA with
            Result-Code set to BINDING_FAILURE. The DNCA Agent (i.e., NAT
            device) treats a NCR as an atomic operation. Hence none of the
            requested bindings will be established by NAT device. Either all
            requested actions within a NCR are either successful or failed
            completely..</t>

            <t>If DNCA Agent does not have sufficient resources to process a
            request, it returns NCA with Result-Code set to
            RESOURCE_FAILURE.</t>

            <t>If a NCR redefines the maximum number of NAT bindings allowed
            for the endpoint, the new value will override any previously
            defined limit on NAT bindings. It depends on the implementation of
            the NAT device on how the NAT device copes with a case where the
            new value is lower than the actual number of allocated bindings.
            Typically the NAT device refrains from enforcing the new limit
            immediately; that is, actively remove bindings, but rather
            disallow the establishment of new bindings until the current
            number of bindings is lower than the newly established maximum
            number of allowed bindings.</t>

            <t>If a NCR specifies a new binding rule, predefined on the DNCA
            agent, the binding rule overrides any previously defined rules for
            the session.</t>

            <t>If Max-NAT-Binding and NAT-Control-Definition AVPs are included
            in the NCR along with a reference to a binding rule (a predefined
            template on NAT device) and the values in Max-NAT-Binding and
            NAT-Control-Definition AVPs contradict those specified in the
            pre-defined binding rule, Max-NAT-Binding and
            NAT-Control-Definition AVPs override the values specified in the
            binding rule.</t>
          </list></t>

        <figure anchor="fig-session-re-auth"
                title="NAT Control request for session update ">
          <artwork><![CDATA[         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
     Change of session                                  |
        attributes                                      |
            |                                           |
            |                   NCR                     |
            |------------------------------------------>|
            |       (UPDATE_REQUEST session id,         |
            |         NAT control config data)          |
            |                                           |
            |                                           |
            |                                  Update session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |<------------------------------------------|
            |                 (result code)             |
            |                                           |
            |                                           |]]></artwork>
        </figure>
      </section>

      <section title="Session and Binding Query">
        <t>Session query can be used by the DNCA Manager to either retrieve
        information on the current bindings for a particular session at the
        NAT device or discover the session identifier for a particular
        external IP address/port pair.</t>

        <t>The DNCA Manager initiates a session query by sending a NCR message
        to the DNCA Agent with NC-Request-Type AVP set to QUERY_REQUEST. <xref
        target="fig-session-query"></xref> shows the protocol interaction
        between the DNCA Manager and the DNCA Agent.</t>

        <t>Two types of query requests exist. The first type of query request
        uses the session ID as input parameter to the query. It is to allow
        the DNCA Manager retrieve the current set of bindings for a specific
        session. The second type of query request is used to retrieve the
        session identifiers, along with the associated bindings, matching a
        criteria. This enables the DNCA Manager to find the sessions, which
        utilize a specific external IP address.</t>

        <t><list style="numbers">
            <t>Request a list of currently allocated NAT bindings for a
            particular session: The DNCA Agent on receiving NCR, looks up
            session information for the session ID contained in the NCR, and
            reports all currently active NAT bindings for the session using
            NCA message with Result-Code set to DIAMETER_SUCCESS. In this case
            the NCR MUST NOT contain a NAT-Control-Definition AVP. Each NAT
            binding is reported in a NAT-Control-Definition AVP. In case the
            session ID is unknown, the DNCA Agent returns NCA with Result-Code
            set to DIAMETER_UNKNOWN_SESSION_ID.</t>

            <t>Retrieve session IDs and internal IP address/port pairs for one
            or multiple external IP address/port pairs: If the DNCA Manager
            wishes to retrieve the session ID(s) for one or multiple external
            IP address/port pairs, it MUST include the external IP
            address/port pair(s) as part of the NAT-Control-Definition AVP of
            the NCR. The session ID used within the NCR is not meaningful for
            this type of a query. The DNCA Agent reports the NAT bindings and
            associated session IDs corresponding to the external IP
            address/port pairs in a NCA message with Result-Code set to
            DIAMETER_SUCCESS with the same session ID, which is used in NCR.
            In case an external IP address/port pair has no associated
            existing NAT binding, the NAT-Control-Definition AVP contained in
            the reply just contains the NAT-External-Address AVP.</t>
          </list></t>

        <figure anchor="fig-session-query" title="Session Query">
          <artwork><![CDATA[         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
  DNCA Session Established                              |
            |                                           |
            |                   NCR                     |
            |------------------------------------------>|
            |              (QUERY_REQUEST)              |
            |                                           |
            |                                           |
            |                                           |
            |                          Look up corresponding session
            |                            and associated NAT Bindings
            |                                           |
            |                   NCA                     |
            |<------------------------------------------|
            |              (Result-Code)                |
            |                                           |
            |                                           |]]></artwork>
        </figure>
      </section>

      <section title="Session Termination">
        <t>The DNCA Manager generates a Session Terminate Request (STR)
        message to the DNCA Agent upon receiving a trigger signal. The source
        of the trigger signal is outside the scope of this document. The DNCA
        Agent sends accounting stop record reporting all the bindings and
        notifies the DNCA Manager about successful session termination using a
        Session Terminate Answer (STA) message with Result-Code set to
        DIAMETER_SUCCESS. <xref target="fig-session-terminate"></xref> shows
        the protocol interaction between the DNCA Manager and the DNCA
        Agent.</t>

        <t>If a DNCA Agent receives STR from a DNCA Manager and fails to find
        a matching session, the DNCA Agent returns STA with Result-Code set to
        DIAMETER_UNKNOWN_SESSION_ID.</t>

        <figure anchor="fig-session-terminate"
                title="Terminate NAT Control session">
          <artwork><![CDATA[
         DNCA Manager                             DNCA Agent
            |                                            |
            |                                            |
         Trigger                                         |
            |                                            |
            |                   STR                      |
            |------------------------------------------->|
            |               (session id)                 |
            |                                            |
            |                                            |
            |                                  Remove NAT bindings
            |                                       of session
            |                                            |
            |                                            |
            |           Send accounting stop             |
            |<-------------------------------------------|
            |           for all session bindings         |
            |                                            |
            |                                  Terminate Session /
            |                                 Remove session state
            |                                            |
            |                                            |
            |                                            |
            |                  STA                       |
            |<-------------------------------------------|
            |             (Result-Code)                  |
            |                                            |]]></artwork>
        </figure>
      </section>

      <section title="DNCA Manager and Agent Failures">
        <t>This document does not cover details in case DNCA Manager and DNCA
        Agent are out of sync. This happens when the DNCA Manager or DNCA
        Agent restart, (temporary) loss of network connectivity etc. The DNCA
        relies on DNCA Manager and DNCA Agent to have builtin redundancy
        support to recover state in case of failure.</t>

        <t>Example failure cases include the following:</t>

        <t><list style="symbols">
            <t>The DNCA Manager loses session state (e.g. due to a restart).
            In this case, <list style="symbols">
                <t>The DNCA Agent may receive a NCR with NC-Request-Type AVP
                set to INITIAL_REQUEST that matches an existing session of
                DNCA agent. The DNCA Agent returns an error that contains
                Duplicate-Session-Id AVP to report the Session-ID of existing
                session. The DNCA Manager may send an explicit Sesstion
                Terminate Request(STR) for the older session, which was
                lost.</t>

                <t>The DNCA Manager may receive accounting records for a
                session that does not exist. The DNCA Manager sends an
                accounting answer with Result-Code set to
                DIAMETER_UNKNOWN_SESSION_ID. On receiving this, the DNCA Agent
                clears the session and removes the associated session
                state.</t>
              </list></t>

            <t>The DNCA Agent loses session state. In such a case, the DNCA
            Agent may receive a NCR with NC-Request-Type AVP set to
            UPDATE_REQUEST for a non-existent session. The DNCA Agent returns
            NCA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</t>

            <t>The DNCA Manager is unreachable, for example detected by
            Diameter watchdog, or down and accounting request from the DNCA
            Agent fails to get a response. The mechanism to ensure that a DNCA
            Manager no longer has associated state for a session being cleared
            by a DNCA Agent is beyond the scope of this document.</t>

            <t>The DNCA Agent is unreachable or down and NCR requests fail to
            get a response. Handling of this case depends on the actual
            service offering of the service provider. The service provider can
            choose to terminate the access session to the endpoint.</t>
          </list></t>
      </section>
    </section>

    <section anchor="sec-diameter-base-use"
             title="Use Of The Diameter Base Protocol">
      <t>The Diameter Base Protocol defined by <xref target="RFC3588"></xref>
      applies with the clarifications listed in the present specification.</t>

      <section anchor="sec-diameter-messages"
               title="Securing Diameter Messages ">
        <t>For secure transport of Diameter messages, IPsec MAY be used.</t>

        <t>The DNCA Agent MAY verify the identity of the DNCA Manager during
        the Capabilities Exchange Request procedure.</t>

        <t>The DNCA Agent MAY verify if the DNCA Manager that issues a NCR
        command is allowed and it is based on: <list style="symbols">
            <t>The identity of the DNCA Manager</t>

            <t>The type of NCR Command</t>

            <t>The content of the NCR Command</t>

            <t>Any combination of the above</t>
          </list></t>
      </section>

      <section title="Accounting Functionality">
        <t>Accounting functionality (accounting session state machine, related
        command codes and AVPs) is defined in <xref
        target="sec-accounting"></xref> below.</t>
      </section>

      <section title="Use Of Sessions">
        <t>Each DNCA session MUST have a globally unique Session-ID as defined
        in <xref target="RFC3588"></xref>, which MUST NOT be changed during
        the lifetime of a DNCA session. The Diameter Session-ID serves as the
        global endpoint identifier. The DNCA Agent and DNCA Manager maintain
        state associated with the Session-ID. This globally unique Session-ID
        is used for updating, accounting, and terminating the session. The
        DNCA session MUST NOT have more than one outstanding request at any
        given instant. The DNCA Agent sends an Abort-Session-Request as
        defined in <xref target="RFC3588"></xref> if it is unable to maintain
        sessions due to resource limitation.</t>
      </section>

      <section title="Routing Considerations">
        <t>It is assumed that the DNCA Manager knows the DiameterIdentity of
        the DNCA Agent for a given endpoint. Both the Destination-Realm and
        Destination-Host AVPs are present in the request from the DNCA Manager
        to the DNCA Agent.</t>
      </section>

      <section title="Advertising Application Support">
        <t>Diameter applications conforming to this specification MUST
        advertise support by including the value of TBD in:</t>

        <t><list style="symbols">
            <t>Auth-Application-Id and Acct-Application-Id of
            Capabilities-Exchange-Request (CER)</t>

            <t>Auth-Application-Id of NC-request (NCR), NC-Answer (NCA),
            Abort-Session-Request(ASR), Abort-Session-Answer (ASA)
            messages</t>

            <t>Acct-Application-Id in Accounting-Request (ACR) and
            Accounting-Answer (ACA) messages.</t>
          </list></t>
      </section>
    </section>

    <section anchor="sec-dnca-commands" title="DNCA Commands">
      <t>The following commands are used to establish, maintain and query NAT
      bindings.</t>

      <section anchor="sec-dnca-ncr" title="NAT-Control Request (NCR) Command">
        <t>The NAT-Control Request (NCR) command, indicated by the command
        field set to TBD and the "R" bit set in the Command Flags field, is
        sent from the DNCA Manager to the DNCA Agent in order to install NAT
        bindings.</t>

        <t>User-Name, Logical-Access-Id, Physical-Access-ID,
        Framed-IP-Address, Framed-IPv6-Prefix , Framed-Interface-Id,
        EGRESS-VLANID, NAS-Port-ID, Address-Realm, Calling-Station-ID AVPs
        serve as identifiers for the subscriber.</t>

        <t>Message Format:</t>

        <figure>
          <artwork><![CDATA[   < NC-Request > ::= < Diameter Header: TBD, REQ, PXY>

                    < Session-Id >
                    { Auth-Application-Id }
                    { Origin-Host }
                    { Origin-Realm }
                    { Destination-Realm }
                    { Destination-Host }
                    { NC-Request-Type }
                    [ Origin-State-Id ]
                  * [ NAT-Control-Remove ]
                  * [ NAT-Control-Install ]
                    [ User-Name ]
                    [ Logical-Access-Id ]
                    [ Physical-Access-ID ]
                    [ Framed-IP-Address ]
                    [ Framed-IPv6-Prefix ]
                    [ Framed-Interface-Id ]
                    [ EGRESS-VLANID]
                    [ NAS-Port-ID]
                    [ Address-Realm ]
                    [ Calling-Station-ID ]
                  * [ Proxy-Info ]
                  * [ Route-Record ]
                  * [ AVP ]
]]></artwork>
        </figure>
      </section>

      <section anchor="sec-dnca-nca" title="NAT-Control Answer (NCA) Command">
        <t>The NAT-Control-Answer (NCA) command, indicated by the Command-Code
        field set to TBD and the "R" bit cleared in the Command Flags field,
        is sent by the DNCA Agent in response to NAT-Control-Request
        command.</t>

        <t>Message Format:</t>

        <figure>
          <artwork><![CDATA[   <NC-Answer> ::= < Diameter Header: TBD, PXY >
                   < Session-Id >
                   { Origin-Host }
                   { Origin-Realm }
                   { NC-Request-Type }
                   [ Result-Code ]
                 * [ NAT-Control-Definition ]
                   [ Current-NAT-Bindings   ]
                   [ Origin-State-Id ]
                   [ Error-Message ]
                   [ Error-Reporting-Host ]
                 * [ Failed-AVP ]
                 * [ Proxy-Info ]
                   [ Duplicate-Session-ID ]
                 * [ Redirect-Host]
                   [ Redirect-Host-Usage ]
                   [ Redirect-Max-Cache-Time ]
                 * [ Proxy-Info ]
                 * [ Route-Record ]
                 * [ Failed-AVP ]
                 * [ AVP ]
                 * [ AVP ]

]]></artwork>
        </figure>
      </section>
    </section>

    <section title="NAT Control Application Session State Machine">
      <t>This section contains a set of finite state machines, representing
      the life cycle of DNCA session, which MUST be observed by all
      implementations of the DNCA Diameter application. DNCA Agent and Manager
      are stateful and the state machine maintained is similar to the stateful
      Client and Server authorization state machine described in RFC3588. When
      a session is moved to the Idle state, any resources that were allocated
      for the particular session must be released. Any event not listed in the
      state machines MUST be considered as an error condition, and an answer,
      if applicable, MUST be returned to the originator of the message.</t>

      <t>In the state table, the event 'Failure to send NCR' means that the
      DNCA Manager is unable to send command NCR to the desired destination.
      This could be due to the peer being down, or due to the peer sending
      back a transient failure or temporary protocol error notification
      DIAMETER_TOO_BUSY or DIAMETER_LOOP_DETECTED in the Result-Code AVP of
      NCA.</t>

      <t>In the state table "FAILED NCA" means that the DNCA Agent was not
      able to honor corresponding NCR. This can happen due to any of the
      transient and permanent error at DNCA Agent indicated by the following
      error Result-Code values - RESOURCE_FAILURE, UNKNOWN_BINDING_RULE_NAME,
      BINDING_FAILURE, MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT, SESSION_EXISTS,
      INSUFFICIENT_CLASSIFIERS</t>

      <t>The following state machine is observed by a DNCA Manager:</t>

      <figure>
        <artwork><![CDATA[                           MANAGER
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      New Host detected that         Send       Pending
             requires NAT Control           NCR
                                            Initial 
                                            Request

   Idle      ASR Received                   Send ASA   Idle
             for unknown session            with
                                            Result-Code
                                            = UNKNOWN_
                                            SESSION_ID

   Pending   Successful NCA                 Setup      Open
             received                       complete

   Pending   Successful NCA                 Sent STR   Discon
             received
             but Agent unable to provide
             service

   Pending   Error processing successful    Sent STR   Discon
             NCA

   Pending   Failed                         Cleanup    Idle
             NCA received

   Open      NAT control                    Send       Open
             update required                NCR Update
                                            Request

   Open      Successful                                Open
             NCA received  

   Open      Failed                         Cleanup    Idle
             NCA received.                  
             

   Open      Access Session end detected    Send STR   Discon
             

   Open      ASR Received,                  Send ASA   Discon
             client will comply with        with
             request to end the session     Result-Code
                                            = SUCCESS,
                                            Send STR.

   Open      ASR Received,                  Send ASA   Open
             client will not comply with    with
             request to end the session     Result-Code
                                            != SUCCESS
   
   Discon    ASR Received                   Send ASA   Idle

   Discon    STA Received                   Discon.    Idle
                                            user/device]]></artwork>
      </figure>

      <t>The following state machine is observed by a DNCA Agent:</t>

      <figure>
        <artwork><![CDATA[                          AGENT
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      NCR request                    Send       Open
             received, and                  successful
             able to provide requested      NCA
             NAT control service

   Idle      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA
             NAT control service
     
   Open      NCR  request                    Send       Open
             received, and                   successful
             able to provide requested       NCA
             NAT control service       

   Open      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA,
             NAT control service            Cleanup

   Open      Unable to continue             Send ASR   Discon
             providing requested
             NAT control service

   Discon    Failure to send ASR            Wait,      Discon
                                            resend ASR

   Discon    ASR successfully sent and      Cleanup    Idle
             ASA Received with Result-Code

   Not       ASA Received                   None       No Change.
   Discon

   Any       STR Received                   Send STA,  Idle
                                            Cleanup.]]></artwork>
      </figure>
    </section>

    <section anchor="sec-dnca-avps" title="DNCA AVPs">
      <t></t>

      <section title="Reused Base Protocol AVPs">
        <t>AVPs reused from Diameter Base Protocol <xref
        target="RFC3588"></xref> are listed below.</t>

        <figure anchor="tab-avps-from-diameter-base"
                title="DIAMETER AVPs used from Diameter base ">
          <artwork><![CDATA[                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Acct-Interim-Interval      85       Unsigned32 | M   | P |    Y    |
|Auth-Application-Id        258      Unsigned32 | M   | P |    N    |
|Destination-Host           293      DiamIdent  | M   | P |    N    |
|Destination-Realm          283      DiamIdent  | M   | P |    N    |
|Error-Message              281      UTF8String | M   | P |    N    |
|Error-Reporting-Host       294      DiamIdent  | M   | P |    N    |
|Failed-AVP                 279      Grouped    | M   | P |    N    |
|Origin-Host                264      DiamIdent  | M   | P |    N    |
|Origin-Realm               296      DiamIdent  | M   | P |    N    |
|Origin-State-Id            278      Unsigned32 | M   | P |    N    |
|Proxy-Info                 284      Grouped    | M   | P |    N    |
|Result-Code                268      Unsigned32 | M   | P |    N    |
|Route-Record               282      DiamIdent  | M   |   |    N    |
|Session-Id                 263      UTF8String | M   | P |    Y    |
|User-Name                  1        UTF8String | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
+-------------------------------------------------------------------+
]]></artwork>
        </figure>

        <t>The Auth-Application-Id AVP (AVP Code 258) is assigned by IANA to
        Diameter applications. The value of the Auth-Application-Id for the
        Diameter NAT Control Application is TBD.</t>
      </section>

      <section anchor="sec_result-codes"
               title="Additional Result-Code AVP Values">
        <t>This section defines new values for the Result-Code AVP which SHALL
        be supported by all Diameter implementations that conform to the
        present document.</t>

        <section title="Success">
          <t>No new Result-Code AVP value is defined within this category.</t>
        </section>

        <section anchor="sec_result-code-transient" title="Transient Failures">
          <t>Result-Code AVP values that fall within the transient failures
          category are those used to inform a peer that the request could not
          be satisfied at the time that it was received. The request may be
          able to be satisfied in the future.</t>

          <t>The following new values of the Result-Code AVP are defined:</t>

          <t><list style="empty">
              <t>RESOURCE_FAILURE (TBD)<list style="empty">
                  <t>The DNCA Agent indicates that the binding could not be
                  installed or a new session could not be created due to
                  resource shortage.</t>
                </list></t>
            </list></t>
        </section>

        <section anchor="sec_result-code-permanent"
                 title="Permanent Failures ">
          <t>The Result-Code AVP values, which fall within the permanent
          failures category are used to inform the peer that the request
          failed, and should not be attempted again. The request may be able
          to be satisfied in the future.</t>

          <t>The following new values of the Result-Code AVP are defined:</t>

          <t><list style="empty">
              <t>UNKNOWN_BINDING_RULE_NAME (TBD)<list style="empty">
                  <t>The DNCA Agent indicates that the binding could not be
                  installed or a new session could not be created due to
                  resource shortage.</t>
                </list>BINDING_FAILURE (TBD)<list style="empty">
                  <t>The DNCA indicates that the requested binding(s) could
                  not be installed.</t>
                </list></t>

              <t>MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT (TBD)<list
                  style="empty">
                  <t>The DNCA Agent denies the request because the maximum
                  number of allowed bindings has been reached for the
                  specified Endpoint Classifier.</t>
                </list></t>

              <t>SESSION_EXISTS (TBD)<list style="empty">
                  <t>The DNCA Agent denies request to initialize a new
                  session, if it already has a DNCA session that uses the same
                  set of classifiers as indicated by DNCA Manager in the new
                  session initializationrequest.</t>
                </list></t>

              <t>INSUFFICIENT_CLASSIFIERS (TBD)<list style="empty">
                  <t>The DNCA Agent defines request to initialize a new
                  session, if the classifiers in the request match more than
                  one of the existing sessions on DNCA Agent.</t>
                </list></t>
            </list></t>
        </section>
      </section>

      <section title="Reused NASREQ Diameter Application AVPs">
        <t>The following AVPs are reused from Diameter Network Access Server
        Application <xref target="RFC4005"></xref>.</t>

        <figure anchor="tab-avps-from-nasreq"
                title="Reused NASREQ Diameter application AVPs">
          <artwork><![CDATA[                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| NAS-Port         |   5  | Unsigned32 | M  |  P  |    |  V  | Y  |
| NAS-Port-Id      |  87  | UTF8String | M  |  P  |    |  V  | Y  |
| Calling-Station- |  31  | UTF8String | M  |  P  |    |  V  | Y  |
|   Id             |      |            |    |     |    |     |    |
| Framed-IP-Address|   8  | OctetString| M  |  P  |    |  V  | Y  |
| Framed-Interface-|  96  | Unsigned64 | M  |  P  |    |  V  | Y  |
|   ID             |      |            |    |     |    |     |    |
| Framed-IPv6-     |  97  | OctetString| M  |  P  |    |  V  | Y  |
|  Prefix          |      |            |    |     |    |     |    |
+------------------+------+------------|----+-----+----+-----|----+]]></artwork>
        </figure>
      </section>

      <section title="Reused from RFC 4675 ">
        <t>The following AVPs are reused from "RADIUS Attributes for Virtual
        LAN and Priority Support" specification <xref
        target="RFC4675"></xref>.</t>

        <figure anchor="tab-avps-from-rfc4675"
                title="Reused attributes from RFC 4675">
          <artwork><![CDATA[                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| Egress-VLANID    |  56  | OctetString| M  |  P  |    |  V  | Y  |
+------------------+------+------------|----+-----+----+-----|----+]]></artwork>
        </figure>
      </section>

      <section title="Reused from Diameter QoS Application">
        <t>The following AVPs are reused from the Traffic Classification and
        Quality of Service (QoS) Attributes for Diameter <xref
        target="RFC5777"></xref>.</t>

        <figure anchor="tab-avps-from-diameter-qos"
                title="Reused QoS-attributes">
          <artwork><![CDATA[                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Port                       TBD     Integer32   |  M  | P |    Y    |
|IP-Address-Mask            TBD     Grouped     |  M  | P |    Y    |
|Protocol                   TBD     Enumerated  |  M  | P |    Y    |
|Direction                  TBD     Enumerated  |  M  | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
+-------------------------------------------------------------------+]]></artwork>
        </figure>
      </section>

      <section title="Reused from ETSI ES 283 034, e4 Diameter Application">
        <t>The following AVPs are reused from the Diameter e4 Application
        <xref target="ETSIES283034"></xref>.</t>

        <figure anchor="tab-avps-from-diameter-e4"
                title="Reused AVPs from Diameter e4 application  ">
          <artwork><![CDATA[                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Address-Realm              301     OctetString | M,V |   |    Y    |
|Logical-Access-Id          302     OctetString |   V | M |    Y    |
|Physical-Access-ID         313     UTF8String  |   V | M |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
|V - Indicates whether the optional Vendor-ID field is present      |
|    in the AVP header. Vendor-Id header of all AVPs in             |
|    this table will be set to ETSI (13019).                        |
+-------------------------------------------------------------------+]]></artwork>
        </figure>
      </section>

      <section title="DNCA Defined AVPs">
        <t>The following table describes the new Diameter AVPs used in this
        document.</t>

        <figure anchor="tab-new-avps" title="New Diameter AVPs">
          <artwork><![CDATA[                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                       AVP  Section            |     |   |   May   |
| Attribute Name        Code Defined Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|NC-Request-Type        TBD  7.7.1   Enumerated | M   | P |    Y    |
|NAT-Control-Install    TBD  7.7.2   Grouped    | M   | P |    Y    |
|NAT-Control-Remove     TBD  7.7.3   Grouped    | M   | P |    Y    |
|NAT-Control-Definition TBD  7.7.4   Grouped    | M   | P |    Y    |
|NAT-Internal-Address   TBD  7.7.5   Grouped    | M   | P |    Y    |
|NAT-External-Address   TBD  7.7.6   Grouped    | M   | P |    Y    |
|Max-NAT-Bindings       TBD  7.7.7   Unsigned32 | M   | P |    Y    |
|NAT-Control-           TBD  7.7.8   OctetString| M   | P |    Y    |
| Binding-Rule                                  |     |   |         |
|Duplicate-             TBD  7.7.9   UTF8String | M   | P |    Y    |
| Session-ID                                    |     |   |         |
|NAT-Control-Record     TBD  8.2.1   Grouped    | M   | P |    Y    |
|NAT-Control-           TBD  8.2.2   Enumerated | M   | P |    Y    |
| Binding-Status                                |     |   |         |
|Current-NAT-Bindings   TBD  8.2.3   Unsigned32 | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
|V - Vendor specific bit that indicates whether the optional        |
|    Vendor-ID field is present in the AVP header.                  |
+-------------------------------------------------------------------+]]></artwork>
        </figure>

        <section anchor="avp_NC-Request-Type" title="NC-Request-Type AVP">
          <t>The NC-Request-Type AVP (AVP Code TBD) is of type Enumerated and
          contains the reason for sending the NAT-Control-Request command. It
          shall be present in all NAT-Control-Request messages.</t>

          <t>The following values are defined: <list style="empty">
              <t>INITIAL_REQUEST (1)<list style="empty">
                  <t>An Initial Request is used to install binding at the DNCA
                  Agent on a successful access session setup.</t>
                </list>UPDATE_REQUEST (2)<list style="empty">
                  <t>An Update Request is used to update bindings previously
                  installed on a given access session, to add new binding on a
                  given access session, or to remove one or several binding(s)
                  activated on a given access session.</t>
                </list></t>

              <t>QUERY_REQUEST (4)<list style="empty">
                  <t>Query Request is used to query the DNCA Agent about the
                  currently installed bindings for an endpoint classifier.</t>
                </list></t>
            </list></t>
        </section>

        <section anchor="avp_NAT-Control-Install"
                 title="NAT-Control-Install AVP">
          <t>The NAT-Control AVP (AVP code TBD) is of type Grouped, and it is
          used to activate or install NAT bindings. It also contains
          Max-NAT-Bindings that defines maximum number of NAT bindings to be
          allowed for a subscriber and NAT-Control-Binding-Rule that
          references predefined policy template on DNCA Agent that may contain
          static bindings, maximum number of bindings to be allowed, address
          pool from which external binding address should be allocated.</t>

          <t>AVP format:</t>

          <figure>
            <artwork><![CDATA[  NAT-Control-Install ::= < AVP Header: TBD >
                           * [ NAT-Control-Definition ]
                             [ NAT-Control-Binding-Rule ]
                             [ Max-NAT-Bindings]
                           * [ AVP ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_NAT-Control-Remove"
                 title="NAT-Control-Remove AVP">
          <t>The NAT-Control-Remove AVP (AVP code TBD) is of type Grouped, and
          it is used to deactivate or remove NAT bindings.</t>

          <t>AVP format:</t>

          <figure>
            <artwork><![CDATA[  NAT-Control-Remove ::= < AVP Header: TBD >
                          * [ NAT-Control-Definition ]
                            [ NAT-Control-Binding-Rule ]
                          * [ AVP ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_NAT-Control-Definition"
                 title="NAT-Control-Definition AVP">
          <t>The NAT-Control-Definition AVP (AVP code TBD) is of type Grouped,
          and it describes a binding.</t>

          <t>The NAT-Control-Definition AVP uniquely identifies the binding
          between the DNCA Agent and the DNCA Manager.</t>

          <t>If both the NAT-Internal-Address and NAT-External-Address AVP(s)
          are supplied, it is a pre-defined binding.</t>

          <t>The Protocol AVP describes the transport protocol for the
          binding. The NAT-Control-Definition AVP can contain either zero or
          one Protocol AVP. If the Protocol AVP is omitted and if both
          internal and external address are specified then the binding
          reserves the addresses for all transport protocols.</t>

          <t>The Direction AVP is of type Enumerated. It specifies the
          direction for the binding. The values of the enumeration applicable
          in this context are: "IN","OUT". If Direction AVP is OUT or absent,
          NAT-Internal-Address refers to the address of the subscriber device
          that needs to be translated. If Direction AVP is "IN",
          NAT-Internal-Address is the destination address that has to be
          translated.</t>

          <t>AVP format:</t>

          <figure>
            <artwork><![CDATA[  NAT-Control-Definition ::= < AVP Header: TBD >
                              { NAT-Internal-Address }
                              [ Protocol ]
                              [ Direction ]
                              [ NAT-External-Address ]
                              [ Session-Id ]
                            * [ AVP ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_NAT-Internal-Address"
                 title="NAT-Internal-Address AVP">
          <t>The NAT-Internal-Address AVP (AVP code TBD) is of type Grouped.
          It describes the internal IP address and port for a binding.
          Framed-IPV6-Prefix and Framed-IP-Address AVPs are mutually
          exclusive.</t>

          <t>AVP format:</t>

          <figure>
            <artwork><![CDATA[  NAT-Internal-Address ::= < AVP Header: TBD >
                            [ Framed-IP-Address ]
                            [ Framed-IPv6-Prefix ]
                            [ Port]
                          * [ AVP ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_NAT-External-Address"
                 title="NAT-External-Address AVP">
          <t>The NAT-External-Address AVP (AVP code TBD) is of type Grouped,
          and it describes the external IP address and port for a binding.
          IP-Address-Mask AVP can only be specified when Framed-IP-Address AVP
          is present. External IP address specified in this attribute can be
          reused for multiple subscribers by specifying the same address in
          the respective NAT-External-Address AVPs.</t>

          <t>AVP format:</t>

          <figure>
            <artwork><![CDATA[  NAT-External-Address ::= < AVP Header: TBD >
                            [ Framed-IP-Address ]
                            [ IP-Address-Mask ]
                            [ Port ]
                          * [ AVP ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_Max-NAT-Bindings" title="Max-NAT-Bindings">
          <t>The Max-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32. It
          indicates the maximum number of NAT bindings allowed.</t>
        </section>

        <section anchor="avp_NAT-Control-Binding-Rule"
                 title="NAT-Control-Binding-Rule AVP">
          <t>The NAT-Control-Binding-Rule AVP (AVP code TBD) is of type
          OctetString. It defines a name for a policy template that will be
          predefined at NAT. Details on the contents and structure of the
          template and configuration are outside the scope of this document.
          The policy to which this AVP refers to may contain NAT bindings,
          address pool for external address allocation of NAT binding, and
          maximum allowed NAT bindings. Such policy template can be reused by
          specifying same NAT-Control-Binding-Rule AVP in corresponding
          NAT-Control-Install AVPs of multiple subscribers.</t>
        </section>

        <section anchor="avp_Duplicate-Session-Id"
                 title="Duplicate-Session-Id AVP">
          <t>The Duplicate-Session-Id AVP (AVP Code TBD) is of type
          UTF8String. It is used to report error and contains the Session-Id
          of an existing session.</t>
        </section>
      </section>
    </section>

    <section anchor="sec-accounting" title="Accounting Commands">
      <t>The DNCA reuses session based accounting as defined in Diameter Base
      Protocol,<xref target="RFC3588"></xref> to report the bindings per
      endpoint. This reporting is achieved by sending Diameter Accounting
      Requests (ACR) [Start, Interim and Stop] from the DNCA Agent to DNCA
      Manager.</t>

      <t>The DNCA Agent sends an ACR Start on receiving an NCR with
      NC-Request-Type AVP set to INITIAL_REQUEST for a session or on creation
      of the first binding for a session requested in an earlier NCR. The DNCA
      may send ACR Interim updates, if required, either due to a change in
      bindings resulting from a NCR with NC-Request-Type AVP set to
      UPDATE_REQUEST, or periodically as specified in Acct-Interim-Interval by
      the DNCA Manager, or when it creates or tears down bindings. An ACR Stop
      is sent by the DNCA Agent on receiving STR.</t>

      <t>The function of correlating the multiple bindings used by an endpoint
      at any given time is relegated to the post processor.</t>

      <t>The DNCA Agent may trigger an interim accounting record when maximum
      number of bindings, if received in NCR, is reached.</t>

      <section title="NAT Control Accounting Messages">
        <t>The ACR and ACA messages are reused as defined in Diameter Base
        Protocol <xref target="RFC3588"></xref> for exchanging endpoint NAT
        binding details between the DNCA Agent and DNCA Manager. The DNCA
        Application ID is used in the accounting commands. ACR contains one or
        more optional NAT-Control-Record AVP to report the bindings. The DNCA
        Agent indicates the number of allocated NAT bindings to the DNCA
        Manager using the Current-NAT-Bindings AVP. This number needs to match
        the number of bindings identified as active within the
        NAT-Control-Record AVP.</t>
      </section>

      <section title="NAT Control Accounting AVPs">
        <t>In addition to AVPs for ACR specified in <xref
        target="RFC3588"></xref>, the DNCA Agent must add the
        NAT-Control-Record AVP.</t>

        <section anchor="avp_NAT-Control-Record" title="NAT-Control-Record">
          <t>The NAT-Control-Record AVP (AVP code TBD) is of type Grouped. It
          describes a binding and its status. If NAT-Control-Binding-Status is
          set to Created, Event-Timestamp indicates the binding creation time.
          If NAT-Control-Binding-Status is set to Removed, Event-Timestamp
          indicates the binding removal time. If NAT-Control-Binding-Status is
          active, Event-Timestamp need not be present; if a value is present,
          it indicates that binding is active at the given time.</t>

          <figure>
            <artwork><![CDATA[  NAT-Control-Record ::= < AVP Header: TBD >
                         { NAT-Control-Definition }
                         { NAT-Control-Binding-Status } 
                         [ Event-Timestamp ]]]></artwork>
          </figure>
        </section>

        <section anchor="avp_NAT-Control-Binding-Status"
                 title="NAT-Control-Binding-Status">
          <t>The NAT-Control-Binding-Status AVP (AVP code TBD) is of type
          enumerated. It indicates the status of the binding - created,
          removed, or active.</t>

          <t>The following values are defined: <list style="empty">
              <t>Created (1)<list style="empty">
                  <t>NAT binding is created.</t>
                </list></t>

              <t>Active (2)<list style="empty">
                  <t>NAT binding is active.</t>
                </list></t>

              <t>Removed (3)<list style="empty">
                  <t>NAT binding was removed.</t>
                </list></t>
            </list></t>
        </section>

        <section anchor="avp_Current-NAT-Bindings"
                 title="Current-NAT-Bindings">
          <t>The Current-NAT-Bindings AVP (AVP code TBD) is of type
          Unsigned32. It indicates number of NAT bindings active on NAT
          device.</t>
        </section>
      </section>
    </section>

    <section anchor="sec-avp-occurence-table" title="AVP Occurrence Table">
      <t>The following sections presents the AVPs defined in this document and
      specifies the Diameter messages in which, they MAY be present. Note:
      AVPs that can only be present within a Grouped AVP are not represented
      in this table.</t>

      <t>The table uses the following symbols:</t>

      <t><list style="empty">
          <t><list hangIndent="10" style="hanging">
              <t hangText="0">The AVP MUST NOT be present in the message.</t>

              <t hangText="0+">Zero or more instances of the AVP MAY be
              present in the message.</t>

              <t hangText="0-1">Zero or one instance of the AVP MAY be present
              in the message. It is considered an error if there is more than
              one instance of the AVP.</t>

              <t hangText="1">One instance of the AVP MUST be present in the
              message.</t>

              <t hangText="1+">At least one instance of the AVP MUST be
              present in the message.</t>
            </list></t>
        </list></t>

      <section title="DNCA AVP Table for NAT Control Initial and Update Requests">
        <t>The following table lists the DNCA specific AVPs that have to be
        present in NCR and NCA with NC-Request-Type set to INITIAL_REQUEST or
        UPDATE_REQUEST.</t>

        <figure>
          <artwork><![CDATA[                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0-1    0       |
|NAT-Control-Remove                      0-1    0       |
|NAT-Control-Definition                  0      0       |
|NAT-Control-Record                      0      0       |
|Current-NAT-Bindings                    0      0       |
|Duplicate-Session-Id                    0      0-1     |
+-------------------------------------------------------+]]></artwork>
        </figure>
      </section>

      <section title="DNCA AVP Table for Session Query request">
        <t>The following table lists the DNCA specific AVPs that have to be
        present in NCR and NCA with NC-Request-Type set to QUERY_REQUEST.</t>

        <figure>
          <artwork><![CDATA[                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0      0       |
|NAT-Control-Remove                      0      0       |
|NAT-Control-Definition                  0      0+      |
|NAT-Control-Record                      0      0       |
|Current-NAT-Bindings                    0      1       |
|Duplicate-Session-Id                    0      0       |
+-------------------------------------------------------+]]></artwork>
        </figure>
      </section>

      <section title="DNCA AVP Table for Accounting Message">
        <t>The following table lists the DNCA specific AVPs, which may or may
        not be present in ACR and ACA messages.</t>

        <figure>
          <artwork><![CDATA[                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        ACR    ACA      |
+-------------------------------------------------------+
|NC-Request-Type                         0      0       |
|NAT-Control-Install                     0      0       |
|NAT-Control-Remove                      0      0       |
|NAT-Control-Definition                  0      0       |
|NAT-Control-Record                      0+     0       |
|Current-NAT-Bindings                    1      0       |
|Duplicate-Session-Id                    0      0       |
+-------------------------------------------------------+
]]></artwork>
        </figure>
      </section>
    </section>

    <!-- -->

    <!-- Possibly a 'Contributors' section ... 
-->

    <section anchor="IANA" title="IANA Considerations">
      <t>This section contains the namespaces that have either been created in
      this specification or had their values assigned to existing namespaces
      managed by IANA.</t>

      <section title="Command Codes">
        <t>IANA is requested to allocate command code values for the
        following.</t>

        <t>Registry:</t>

        <texttable align="right" anchor="table_command-codes"
                   suppress-title="true" title="Command codes">
          <ttcol align="left">Code Value</ttcol>

          <ttcol align="left">Name</ttcol>

          <ttcol align="left">Reference</ttcol>

          <c>to be assigned</c>

          <c>NAT-Control-Request (NCR)</c>

          <c><xref target="sec-dnca-ncr"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Answer (NCA)</c>

          <c><xref target="sec-dnca-nca"></xref></c>
        </texttable>

        <t></t>
      </section>

      <section title="AVP Codes">
        <t>IANA is requested to allocate AVP codes for the following AVPs that
        are defined in this document.</t>

        <t>Registry:</t>

        <texttable align="right" anchor="table_avp-codes"
                   suppress-title="true" title="AVP codes">
          <ttcol align="left">Code Value</ttcol>

          <ttcol align="left">Name</ttcol>

          <ttcol align="left">Reference</ttcol>

          <c>to be assigned</c>

          <c>NC-Request-Type</c>

          <c><xref target="avp_NC-Request-Type"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Install</c>

          <c><xref target="avp_NAT-Control-Install"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Remove</c>

          <c><xref target="avp_NAT-Control-Remove"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Definition</c>

          <c><xref target="avp_NAT-Control-Definition"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Internal-Address</c>

          <c><xref target="avp_NAT-Internal-Address"></xref></c>

          <c>to be assigned</c>

          <c>NAT-External-Address</c>

          <c><xref target="avp_NAT-External-Address"></xref></c>

          <c>to be assigned</c>

          <c>Max-NAT-Bindings</c>

          <c><xref target="avp_Max-NAT-Bindings"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Binding-Rule</c>

          <c><xref target="avp_NAT-Control-Binding-Rule"></xref></c>

          <c>to be assigned</c>

          <c>Duplicate-Session-Id</c>

          <c><xref target="avp_Duplicate-Session-Id"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Record</c>

          <c><xref target="avp_NAT-Control-Record"></xref></c>

          <c>to be assigned</c>

          <c>NAT-Control-Binding-Status</c>

          <c><xref target="avp_NAT-Control-Binding-Status"></xref></c>

          <c>to be assigned</c>

          <c>Current-NAT-Bindings</c>

          <c><xref target="avp_Current-NAT-Bindings"></xref></c>
        </texttable>
      </section>

      <section title="AVP Values">
        <t></t>

        <section title="Result-Code AVP Values">
          <t><xref target="sec_result-codes"></xref> defines several new
          values for the Result-Code AVP for transient and permanent failures.
          IANA is requested to allocate the corresponding values from the
          ranges for transient (4xxx) and permantent (5xxx) failures.</t>

          <texttable align="right" anchor="table_result-code-avps"
                     suppress-title="true" title="Result Code AVP Values">
            <ttcol align="left">Code Value</ttcol>

            <ttcol align="left">Name</ttcol>

            <ttcol align="left">Reference</ttcol>

            <c>to be assigned (4xxx)</c>

            <c>RESOURCE_FAILURE</c>

            <c><xref target="sec_result-code-transient"></xref></c>

            <c>to be assigned (5xxx)</c>

            <c>UNKNOWN_BINDING_RULE_NAME</c>

            <c><xref target="sec_result-code-permanent"></xref></c>

            <c>to be assigned (5xxx)</c>

            <c>BINDING_FAILURE</c>

            <c><xref target="sec_result-code-permanent"></xref></c>

            <c>to be assigned (5xxx)</c>

            <c>MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT</c>

            <c><xref target="sec_result-code-permanent"></xref></c>

            <c>to be assigned (5xxx)</c>

            <c>SESSION_EXISTS</c>

            <c><xref target="sec_result-code-permanent"></xref></c>

            <c>to be assigned (5xxx)</c>

            <c>INSUFFICIENT_CLASSIFIERS</c>

            <c><xref target="sec_result-code-permanent"></xref></c>
          </texttable>
        </section>
      </section>

      <section title="Application IDs">
        <t>IANA is requested to allocate the following application ID using
        the next value from the 7-16777215 range.</t>

        <t>Registry:</t>

        <texttable align="right" anchor="table_id-codes" suppress-title="true"
                   title=" Diameter Application ID values">
          <ttcol align="left">ID Value</ttcol>

          <ttcol align="left">Name</ttcol>

          <ttcol align="left">Reference</ttcol>

          <c>to be assigned</c>

          <c>Diameter NAT Control Application</c>

          <c><xref target="sec-dnca"></xref></c>
        </texttable>
      </section>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>Similar to the impact of Diameter QoS application (see <xref
      target="I-D.ietf-dime-diameter-qos"></xref>) on authorization of QoS
      reservations, this document describes procedures for authorizing NAT
      related attributes and parameters by an entity, which is non-local to
      the device performing NAT. The security considerations for the Diameter
      QoS application (see <xref target="I-D.ietf-dime-diameter-qos"></xref>
      section 11) apply in a similar way to the DNCA. Securing the information
      exchange between the authorizing entity (the DNCA Manager) and the NAT
      device requires bilateral authentication of the involved parties,
      authorization of the involved parties to perform the required procedures
      and functions, and procedures to ensure integrity and confidentiality of
      the information exchange. The DNCA makes use of the capabilities offered
      by Diameter and the underlying transport protocols to deliver these
      requirements (see <xref target="sec-diameter-messages"></xref> ).</t>

      <t>It is assumed that the DNCA Agent and DNCA Manager are in the same
      domain and have a mutual trust set up. Authorization between the DNCA
      Agent and DNCA Manager is beyond the scope of this document.</t>
    </section>

    <section title="Acknowledgements">
      <t>The authors would like to thank Jouni Korhonen, Avi Lior, Chris Metz,
      Hannes Tschofenig, Greg Weber, and Glen Zorn for their input on this
      document.</t>
    </section>

    <section title="Change History (to be removed prior to publication as an RFC) ">
      <t>Changes from -00 to -01</t>

      <t><list style="letters">
          <t>new values for Result-Code AVP used - instead of
          Experimental-Result AVP</t>

          <t>added support for transport specific binding (UDP/TCP)</t>

          <t>added support for twice-NAT</t>

          <t>clarified the use of the two different types of
          query-requests</t>
        </list></t>

      <t>Changes from -01 to -02</t>

      <t><list style="letters">
          <t>Reference to pull mode removed, session initiation event
          clarified in section 4.1</t>

          <t>added Redirect-* AVPs in NCA command</t>

          <t>Removed reference to Called-Station-Id AVP in NCR command</t>

          <t>Editorial changes</t>

          <t>added support for bindings providing AFT (NAT64)</t>
        </list>Changes from -02 to -03<list style="letters">
          <t>Editorial changes</t>
        </list>Changes from -03 to -04<list style="letters">
          <t>Editorial changes suggested in WG Lastcall review</t>

          <t>Removed NCR Request type terminate and replaced with STR</t>

          <t>All references to Auth-Session-State are removed and a new
          section to describe FSM for Manager and Agent has been added</t>

          <t>Clarified reuse of External address and address pools among
          multiple subscribers</t>
        </list>Changes from -04 to -05<list style="letters">
          <t>Removed references to Large Scale NAT as per review comments</t>
        </list></t>
    </section>
  </middle>

  <!--  *****BACK MATTER ***** -->

  <back>
    <!-- References split into informative and normative -->

    <!-- There are 2 ways to insert reference entries from the citation libraries:
     1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
     2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
        (for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

     Both are cited textually in the same manner: by using xref elements.
     If you use the PI option, xml2rfc will, by default, try to find included files in the same
     directory as the including file. You can also define the XML_LIBRARY environment variable
     with a value containing a set of directories to search.  These can be either in the local
     filing system or remote ones accessed by http (http://domain/dir/... ).-->

    <references title="Normative References">
      <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->

      &RFC2119;

      &RFC3588;

      &RFC4675;

      &RFC5777;

      <reference anchor="ETSIES283034">
        <front>
          <title>Telecommunications and Internet Converged Services and
          Protocols for Advanced Networks (TISPAN),Network Attachment
          Sub-System (NASS),e4 interface based on the Diameter
          protocol.</title>

          <author fullname="ETSI" surname="ETSI">
            <organization></organization>
          </author>

          <date month="September" year="2008" />
        </front>
      </reference>
    </references>

    <references title="Informative References">
      &RFC4005;

      &I-D.draft-ietf-dime-diameter-qos;

      <reference anchor="TS32299">
        <front>
          <title>3rd Generation Partnership Project; Technical Specification
          Group Service and System Aspects; Telecommunication management;
          Charging management; "Diameter charging applications", 3GPP TS
          32.299 Version 6.3.0.2</title>

          <author fullname="3GPP TS 32.299">
            <organization></organization>
          </author>

          <date year="2008" />
        </front>
      </reference>
    </references>
  </back>
</rfc>
