<?xml version='1.0'?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'>
<?rfc toc='yes'?>
<?rfc tocdepth='2'?>
<?rfc symrefs='yes'?>
<?rfc compact='yes'?>
<?rfc strict='yes'?>
<rfc category='std' docName='draft-ietf-sieve-notify-xmpp-05' ipr='full3978'>

  <front>
    <title abbrev='SIEVE-XMPP'>Sieve Notification Mechanism: xmpp</title>
    <author initials='P.' surname='Saint-Andre' fullname='Peter Saint-Andre'>
      <organization>XMPP Standards Foundation</organization>
      <address>
        <email>stpeter@jabber.org</email>
        <uri>https://stpeter.im/</uri>
      </address>
    </author>
    <author initials='A.' surname='Melnikov' fullname='Alexey Melnikov'>
      <organization>Isode Limited</organization>
      <address>
        <email>Alexey.Melnikov@isode.com</email>
      </address>
    </author>
    <date year='2007' month='October' day='1'/>
    <area>Applications</area>
    <workgroup>Sieve Working Group</workgroup>
    <keyword>Sieve</keyword>
    <keyword>notification</keyword>
    <keyword>Extensible Messaging and Presence Protocol</keyword>
    <keyword>XMPP</keyword>
    <abstract>
      <t>This document describes a profile of the Sieve extension for notifications, to allow notifications to be sent over the Extensible Messaging and Presence Protocol (XMPP), also known as Jabber.</t>
    </abstract>
  </front>

  <middle>

    <section title='Introduction' anchor='intro'>

      <section title='Overview' anchor='intro-overview'>
        <t>The <xref target="NOTIFY"/> extension to the <xref target="SIEVE"/> mail filtering language is a framework for providing notifications by employing URIs to specify the notification mechanism.  This document defines how xmpp URIs (see <xref target="XMPP-URI"/>) are used to generate notifications via the Extensible Messaging and Presence Protocol (see <xref target='XMPP'/>), which is widely implemented in Jabber instant messaging technologies.</t>
      </section>

      <section title='Terminology' anchor='intro-terms'>
        <t>This document inherits terminology from <xref target='NOTIFY'/>, <xref target='SIEVE'/>, and <xref target='XMPP'/>.</t>
        <t>The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target='TERMS'/>.</t>
      </section>

    </section>

    <section title='Definition' anchor='def'>
      <t>The xmpp mechanism results in the sending of an XMPP message to notify a recipient about an email message.  The general XMPP syntax is as follows:</t>
      <t><list style='symbols'>
        <t>The notification MUST be an XMPP &lt;message/&gt; stanza.</t>
        <t>The value of the XMPP 'type' attribute MUST be 'headline' or 'normal'.</t>
        <t>The value of the XMPP 'from' attribute MUST be the XMPP address of the notification service.</t>
        <t>The XMPP &lt;message/&gt; stanza MAY include a &lt;subject/&gt; child element whose value is some configurable text indicating that the message is a Sieve notification.</t>
        <t>The notification SHOULD include a URL for the recipient to use as a hint in locating the message, encapsulated as the XML character data of a &lt;url/&gt; child element of an &lt;x/&gt; element qualified by the 'jabber:x:oob' namespace as specified in <xref target='OOB'/>.</t>
      </list></t>
      <t>The recommended mapping of the Sieve notify action into XMPP syntax is described in the following sections.</t>

      <section title='Notify parameter "method"' anchor='def-method'>
        <t>The "method" parameter MUST be a URI that conforms to the xmpp URI scheme (as specified in <xref target='XMPP-URI'/>) and that identifies an XMPP account associated with the email inbox.  The URI MAY include the resource identifier portion of an XMPP address but SHOULD NOT include an authority component, query component, or fragment identifier component.  The processing application MUST extract an XMPP address from the URI in accordance with the processing rules specified in <xref target='XMPP-URI'/>.  The resulting XMPP address MUST be encapsulated in XMPP syntax as the value of the XMPP 'to' attribute.</t>
      </section>

      <section title='Notify tag ":from"' anchor='def-from'>
        <t>The ":from" tag has no special meaning for this notification mechanism, and this specification puts no restriction on its use.  As noted, the value of the XMPP 'from' attribute specified in the XMPP notification message MUST be the XMPP address of the notification service itself.  The value of the ":from" tag MAY be transformed into XMPP syntax; if so, it SHOULD be encapsulated as the value of an XMPP <xref target='SHIM'/> header named "Reply-To".</t>
      </section>

      <section title='Notify tag ":options"' anchor='def-options'>
        <t>The ":options" tag has no special meaning for this notification mechanism.  Any handling of this tag is the responsibility of an implementation.</t>
      </section>

      <section title='Notify tag ":importance"' anchor='def-importance'>
        <t>The ":importance" tag has no special meaning for this notification mechanism, and this specification puts no restriction on its use.  The value of the ":importance" tag MAY be transformed into XMPP syntax (in addition to or instead of including in the default message); if so, it MUST be encapsulated as the value of an XMPP <xref target='SHIM'/> header named "Urgency", and the XML character of that header MUST be "high" if the value of the ":importance" tag is "1", "medium" if the value of the ":importance" tag is "2", or "low" if the value of the ":importance" tag is "3".</t>
      </section>

      <section title='Notify tag ":message"' anchor='def-message'>
        <t>If included, the ":message" tag MUST be transformed into the XML character data of an XMPP &lt;body/&gt; element.  If not included, the rule specified in <xref target='NOTIFY'/> SHOULD be followed, as shown in the examples below.</t>
      </section>

    </section>

    <section title='Examples' anchor='examples'>
      <t>In the following examples, the sender of the email has an address of &lt;mailto:juliet@example.org&gt;, the entity to be notified has an XMPP address of romeo@example.com (resulting in an XMPP URI of &lt;xmpp:romeo@example.com&gt;), and the notification service has an XMPP address of notify.example.com (resulting in an XMPP URI of &lt;xmpp:notify.example.com&gt;).</t>
      <t>The following is a basic Sieve notify action with only a method:</t>
      <figure>
        <artwork><![CDATA[
  notify "xmpp:romeo@example.com"
        ]]></artwork>
      </figure>
      <t>The resulting XMPP &lt;message/&gt; stanza might be as follows:</t>
      <figure>
        <artwork><![CDATA[
  <message from='notify.example.com' 
           to='romeo@example.com' 
           xml:lang='en'>
    <subject>A Sieve instant notification!</subject>
    <body>&lt;juliet@example.org&gt; Wherefore art thou?</body>
  </message>
        ]]></artwork>
      </figure>
      <t>The following is a more advanced Sieve notify action with a method, importance, subject, and message, as well as a URL pointing to the message:</t>
      <figure>
        <artwork><![CDATA[
  notify :importance "1"
         :message "Contact Juliet immediately!"
         "xmpp:romeo@example.com?message;subject=SIEVE"
        ]]></artwork>
      </figure>
      <t>The resulting XMPP &lt;message/&gt; stanza might be as follows:</t>
      <figure>
        <artwork><![CDATA[
  <message from='notify.example.com' 
           to='romeo@example.com' 
           xml:lang='en'>
    <subject>SIEVE</subject>
    <body>Contact Juliet immediately!</body>
    <headers xmlns='http://jabber.org/protocol/shim'>
      <header name='Urgency'>high</header>
    </headers>
    <x xmlns='jabber:x:oob'>
      <url>
        imap://romeo@example.com/INBOX;UIDVALIDITY=385759045/;UID=20
      </url>
    </x>
  </message>
        ]]></artwork>
      </figure>
    </section>

    <section title='Requirements Conformance' anchor='conformance'>
      <t>Section 3.8 of <xref target='NOTIFY'/> specifies a set of requirements for Sieve notification methods.  The conformance of the xmpp notification mechanism is provided here.</t>
      <t>
        <list style='numbers'>
          <t>An implementation of the xmpp notification method SHOULD NOT modify the final notification text (e.g., to limit the length); however, a given deployment MAY do so (e.g., if recipients pay per character or byte for XMPP messages).  Modification of characters themselves should not be necessary, since XMPP character data is encoded in <xref target='UTF-8'/>.</t>
          <t>An implementation MAY ignore parameters specified in the ":from", ":importance", and ":options" tags.</t>
          <t>There is no recommended default message for an implementation to include if the ":message" argument is not specified.</t>
          <t>A notification sent via the xmpp notification method MAY include a timestamp in the textual message.</t>
          <t>The value of the XMPP 'from' attribute MUST be the XMPP address of the xmpp notification service.  The value of the Sieve ":from" tag MAY be transformed into the value of an XMPP <xref target='SHIM'/> header named "Reply-To".</t>
          <t>An implementation MUST NOT include any other extraneous information not specified in parameters to the notify action.</t>
          <t>In accordance with <xref target='XMPP-URI'/>, an implementation MUST ignore any URI action or parameter it does not understand (i.e., the URI MUST be processed as if the action or parameter were not present).  It is RECOMMENDED to support the XMPP "message" query type (see <xref target='QUERIES'/>) and the associated "body" and "subject" parameters, which parameters SHOULD be mapped to the XMPP &lt;body/&gt; and &lt;subject/&gt; child elements of the XMPP &lt;message/&gt; stanza type, respectively.  However, if included then the Sieve notify ":message" parameter MUST be mapped to the XMPP &lt;body/&gt; element, overriding the "body" parameter (if any) included in the XMPP URI.</t>
          <t>In response to a notify_method_capability test for the "online" notification-capability, an implementation SHOULD return a value of "yes" if it has knowledge of an active presence session for the specified notification-uri and a value of "no" if it does not have such knowledge.</t>
          <t>An implementation SHOULD NOT attempt to retry delivery of a notification if it receives an XMPP error of type "auth" or "cancel", MAY attempt to retry delivery if it receives an XMPP error of type "wait", and MAY attempt to retry delivery if it receives an XMPP error of "modify" but only if it makes appropriate modifications to the notification (see <xref target='XMPP'/>); in any case the number of retries SHOULD be limited to a configurable number no less than 3 and no more than 10.  An implementation MAY throttle notifications if the number of notifications within a given time period becomes excessive according to local service policy.  Duplicate suppression (if any) is a matter of implementation and is not specified herein.</t>
        </list>
      </t>
    </section>

    <section title='Internationalization Considerations' anchor='i18n'>
      <t>Although an XMPP address may contain nearly any <xref target='UNICODE'/> character, the value of the "method" parameter MUST be a Uniform Resource Identifier (see <xref target='URI'/>) rather than an Internationalized Resource Identifier (see <xref target='IRI'/>).  The rules specified in <xref target='XMPP-URI'/> MUST be followed when generating XMPP URIs.</t>
      <t>In accordance with Section 13 of RFC 3920, all data sent over XMPP MUST be encoded in <xref target='UTF-8'/>.</t>
    </section>

    <section title='Security Considerations' anchor='sec'>
      <t>Depending on the information included, sending a notification can be comparable to forwarding mail to the notification recipient.  Care must be taken when forwarding mail automatically, to ensure that confidential information is not sent into an insecure environment.  In particular, implementations MUST conform to the security considerations given in <xref target='NOTIFY'/>, <xref target='SIEVE'/>, and <xref target='XMPP'/>.</t>
    </section>

    <section title='IANA Considerations' anchor='iana'>
      <t>The following template provides the IANA registration of the Sieve notification mechanism specified in this document:</t>
      <figure>
        <artwork><![CDATA[
  To: iana@iana.org
  Subject: Registration of new Sieve notification mechanism
  Mechanism name: xmpp
  Mechanism URI: RFC4622
  Mechanism-specific tags: none
  Standards Track/IESG-approved experimental RFC number: this RFC
  Person and email address to contact for further information:
       Peter Saint-Andre <stpeter@jabber.org>
        ]]></artwork>
      </figure>
      <t>This information should be added to the list of Sieve notification mechanisms maintained at &lt;http://www.iana.org/assignments/sieve-notification&gt;.</t>
    </section>

  </middle>

  <back>

    <references title='Normative References'>

<reference anchor='NOTIFY'>
<front>
<title>Sieve Extension: Notifications</title>
<author initials='A.' surname='Melnikov' fullname='Alexey Melnikov'>
    <organization>Isode Limited</organization>
</author>
<author initials='B.' surname='Leiba' fullname='Barry Leiba'>
    <organization>IBM T.J. Watson Research Center</organization>
</author>
<author initials='W.' surname='Segmuller' fullname='Wolfgang Segmuller'>
    <organization>IBM T.J. Watson Research Center</organization>
</author>
<author initials='T.' surname='Martin' fullname='Tim Martin'>
    <organization>BeThereBeSquare Inc.</organization>
</author>
<date month='July' day='6' year='2007' />
<abstract><t>Users go to great lengths to be notified as quickly as possible that they have received new mail.  Most of these methods involve polling to check for new messages periodically.  A push method handled by the final delivery agent gives users quicker notifications and saves server resources.  This document does not specify the notification method but it is expected that using existing instant messaging infrastructure such as XMPP, or SMS messages will be popular.  This draft describes an extension to the Sieve mail filtering language that allows users to give specific rules for how and when notifications should be sent.</t></abstract>
</front>
<seriesInfo name='Internet-Draft' value='draft-ietf-sieve-notify-08' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-sieve-notify-08.txt' />
</reference>

<reference anchor="OOB">
  <front>
    <title>Out of Band Data</title>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <date day="16" month="August" year="2006"/>
  </front>
  <seriesInfo name="XSF XEP" value="0066"/>
  <format type="HTML" target="http://www.xmpp.org/extensions/xep-0066.html"/>
</reference>

<reference anchor="QUERIES">
  <front>
    <title>XMPP URI Scheme Query Components</title>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <date day="13" month="September" year="2006"/>
  </front>
  <seriesInfo name="XSF XEP" value="0147"/>
  <format type="HTML" target="http://www.xmpp.org/extensions/xep-0147.html"/>
</reference>

<reference anchor="SHIM">
  <front>
    <title>Stanza Headers and Internet Metadata</title>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <author initials="J." surname="Hildebrand" fullname="Joe Hildebrand">
      <organization/>
      <address>
        <email>jhildebrand@jabber.com</email>
      </address>
    </author>
    <date day="19" month="August" year="2005"/>
  </front>
  <seriesInfo name="XSF XEP" value="0131"/>
  <format type="HTML" target="http://www.xmpp.org/extensions/xep-0131.html"/>
</reference>

<reference anchor='SIEVE'>
<front>
<title>Sieve: An Email Filtering Language</title>
<author initials='T' surname='Showalter' fullname='Tim Showalter'>
    <organization />
</author>
<author initials='P' surname='Guenther' fullname='Philip Guenther'>
    <organization />
</author>
<date month='February' day='15' year='2007' />
<abstract><t>This document describes a language for filtering email messages at time of final delivery. It is designed to be implementable on either a mail client or mail server. It is meant to be extensible, simple, and independent of access protocol, mail architecture, and operating system. It is suitable for running on a mail server where users may not be allowed to execute arbitrary programs, such as on black box Internet Message Access Protocol (IMAP) servers, as the base language has no variables, loops, or ability to shell out to external programs.</t></abstract>
</front>
<seriesInfo name='Internet-Draft' value='draft-ietf-sieve-3028bis-12' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-sieve-3028bis-12.txt' />
</reference>

<reference anchor='TERMS'>
  <front>
    <title abbrev='RFC Key Words'>Key words for use in RFCs to Indicate Requirement Levels</title>
    <author initials='S.' surname='Bradner' fullname='Scott Bradner'>
      <organization>Harvard University</organization>
      <address>
        <postal>
          <street>1350 Mass. Ave.</street>
          <street>Cambridge</street>
          <street>MA 02138</street>
        </postal>
        <phone>- +1 617 495 3864</phone>
        <email>-</email>
      </address>
    </author>
    <date month='March' year='1997'></date>
    <area>General</area>
    <keyword>keyword</keyword>
    <abstract>
      <t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized.  This document defines these words as they should be interpreted in IETF documents.  Authors who follow these guidelines should incorporate this phrase near the beginning of their document:
        <list>
          <t>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,  &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in RFC 2119.</t>
        </list>
      </t>
      <t>Note that the force of these words is modified by the requirement level of the document in which they are used.</t>
    </abstract>
  </front>
  <seriesInfo name='BCP' value='14' />
  <seriesInfo name='RFC' value='2119' />
</reference>

<reference anchor='XMPP-URI'>
<front>
<title>Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP)</title>
<author initials='P' surname='Saint-Andre' fullname='Peter Saint-Andre'>
    <organization />
</author>
<date month='June' day='12' year='2007' />
<abstract><t>This document defines the use of Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) in identifying or interacting with entities that can communicate via the Extensible Messaging and Presence Protocol (XMPP). This document obsoletes RFC 4622.</t></abstract>
</front>
<seriesInfo name='Internet-Draft' value='draft-saintandre-rfc4622bis-01' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-saintandre-rfc4622bis-01.txt' />
</reference>

    </references>

    <references title='Informative References'>

<reference anchor="IRI">
<front>
<title>Internationalized Resource Identifiers (IRIs)</title>
<author initials='M.' surname='Duerst' fullname='M. Duerst'>
<organization /></author>
<author initials='M.' surname='Suignard' fullname='M. Suignard'>
<organization /></author>
<date year='2005' month='January' /></front>
<seriesInfo name='RFC' value='3987' />
<format type='TXT' octets='111190' target='ftp://ftp.isi.edu/in-notes/rfc3987.txt' />
</reference>

<reference anchor="UNICODE">
  <front>
    <title>The Unicode Standard, Version 3.2.0</title>
    <author>
      <organization>The Unicode Consortium</organization>
    </author>
    <date year="2000" />
  </front>
  <annotation>
    The Unicode Standard, Version 3.2.0 is defined by The Unicode Standard, Version 3.0 (Reading, MA, Addison-Wesley, 2000. ISBN 0-201-61633-5), as amended by the Unicode Standard Annex #27: Unicode 3.1 (http://www.unicode.org/reports/tr27/) and by the Unicode Standard Annex #28: Unicode 3.2 (http://www.unicode.org/reports/tr28/).
  </annotation>
</reference>

<reference anchor="URI">
<front>
<title>Uniform Resource Identifier (URI): Generic Syntax</title>
<author initials='T.' surname='Berners-Lee' fullname='T. Berners-Lee'>
<organization /></author>
<author initials='R.' surname='Fielding' fullname='R. Fielding'>
<organization /></author>
<author initials='L.' surname='Masinter' fullname='L. Masinter'>
<organization /></author>
<date year='2005' month='January' /></front>
<seriesInfo name='STD' value='66' />
<seriesInfo name='RFC' value='3986' />
<format type='TXT' octets='141811' target='ftp://ftp.isi.edu/in-notes/rfc3986.txt' />
</reference>

<reference anchor='UTF-8'>
<front>
<title>UTF-8, a transformation format of ISO 10646</title>
<author initials='F.' surname='Yergeau' fullname='F. Yergeau'>
<organization /></author>
<date month='November' year='2003' /></front>
<seriesInfo name='STD' value='63' />
<seriesInfo name='RFC' value='3629' />
<format type='TXT' octets='33856' target='ftp://ftp.isi.edu/in-notes/rfc3629.txt' />
</reference>

<reference anchor="XMPP">
  <front>
    <title>Extensible Messaging and Presence Protocol (XMPP): Core</title>
    <author initials='P.' surname='Saint-Andre' fullname='P. Saint-Andre'>
      <organization>Jabber Software Foundation</organization>
    </author>
    <date year='2004' month='October' />
  </front>
  <seriesInfo name='RFC' value='3920' />
  <format type='TXT' octets='194313' target='ftp://ftp.isi.edu/in-notes/rfc3920.txt' />
</reference>

    </references>

  </back>

</rfc>
