





Internet Draft                                           R. Atkinson
draft-rja-ilnp-nonce-00.txt                         Extreme Networks
Expires:  10 December 2008                              10 June 2008
Category: Experimental

                        Nonce Destination Option
                      draft-rja-ilnp-nonce-00.txt


Status of this Memo

 Distribution of this memo is unlimited.

  By submitting this Internet-Draft, each author represents
  that any applicable patent or other IPR claims of which he
  or she is aware have been or will be disclosed, and any of
  which he or she becomes aware will be disclosed, in
  accordance with Section 6 of BCP 79.

  Internet-Drafts are working documents of the Internet
  Engineering Task Force (IETF), its areas, and its working
  groups. Note that other groups may also distribute working
  documents as Internet-Drafts.

  Internet-Drafts are draft documents valid for a maximum of
  six months and may be updated, replaced, or obsoleted by
  other documents at any time.  It is inappropriate to use
  Internet-Drafts as reference material or to cite them other
  than as "work in progress."

  The list of current Internet-Drafts can be accessed at
  http://www.ietf.org/1id-abstracts.html

  The list of Internet-Draft Shadow Directories can be
  accessed at http://www.ietf.org/shadow.html.

  This document is a contribution to the IRTF Routing
  Research Group.  It is neither a contribution to the IETF,
  nor to any IETF Working Group, nor to any IETF Area.


Abstract

   This document describes an experimental Nonce Destination
   Option that could be used as part of an Identifier Locator
   Network Protocol (ILNP) that is based upon IPv6.





Atkinson             Exp: 10 DEC 2008                           [Page 1]

Internet Draft     ILNP Nonce            10 JUN 2008


Table of Contents

   1. Introduction ...............................................2
   2. Syntax......................................................3
   3. Transport Protocol Effects..................................4
   4. Backwards Compatibility.....................................4
   5. Security Considerations ....................................5
   6. IANA Considerations ........................................5
   7. References .................................................6


1. Introduction

   At present, the IRTF Routing Research Group is studying
   different approaches to evolving the Internet Architecture.

   Several different classes of evolution are being considered.
   One class is often called "Map and Encapsulate", where
   traffic would be mapped and then tunnelled through the
   inter-domain core of the Internet.  Another class being
   considered is sometimes known as "Identifier/Locator
   Split".[GSE][8+8] This document relates to a proposal that
   is in the latter class of evoluationary approaches.  This
   particular approach, the Identifier Locator Network Protocol
   (ILNP), described in this document and in related
   Internet-Drafts, is a possible evolutionary direction for
   IPv6.[ILNP-Intro] [ILNP-DNS][ILNP-ICMP][RFC-2460]

   The Nonce Destination Option described in this document
   provides two functions.  First, it provides protection
   against off-path attacks for packets when an Identifier/
   Locator split is in use.  Second, it provides a signal
   during initial IP session creation that the Identifier/
   Locator Split operating mode is proposed for use with this
   session.  This last function is particularly important for
   ensuring that the new Identifier/Locator Split operating
   mode is both incrementally deployable and backwards
   compatible with classical IPv6.

   Before reading this draft, readers should read the related
   Internet-Draft titled "ILNP Concept of Operations", as that
   document will help the reader understand the overall context
   for this option.

2. Syntax

   The Nonce Option is an IPv6 Destination Option.




Atkinson             Exp: 10 DEC 2008                           [Page 2]

Internet Draft     ILNP Nonce            10 JUN 2008


   In the diagram below, we show not only the Nonce Option,
   but also the 2-byte header for the IPv6 Destination Option.
   More than one option type might be inside the IPv6
   Destination Option, however at most 1 Nonce Option exists
   in a given IPv6 packet..

   However, it is expected that normally the Nonce Option would
   be the only type of IPv6 Destination Option present in a
   given packet.

   ------------------------------------------------------------
   | Next Header | Hdr Ext Len   | Option Type | Option Length|
   +-------------+---------------+-------------+--------------+
   /                        Nonce Value                       /
   +-------------+---------------+-------------+--------------+


   Next Header:       8-bit selector.  Identifies the type of header
                      immediately following the Destination Options
                      header.  Uses the same values as the IPv4
                      Protocol field [RFC-1700 et seq.].

   Hdr Ext Len:       8-bit unsigned integer.  Length of the
                      Destination Options header in 8-octet units,
                      not including the first 8 octets.

   Option Type:       This contains the value 0x1e, which is
                      used (for now) to indicate the start of
                      the Nonce Option.

   Option Length:     This indicates the length in 8-bit octets
                      of the Nonce Value field of the Nonce
                      Option.  This value must be selected so
                      that the enveloping IPv6 Destination
                      Option complies with the IPv6 header
                      alignment rules.  Common values are
                      4 (when the Nonce Value is 32-bits) and
                      12 (when the Nonce value is 96-bits).

   Nonce Value:       This contains an unpredictable
                      cryptographically random value used to
                      prevent off-path attacks on an ILNP
                      session.  The value should be created in
                      accordance with RFC-4086. [RFC-4086] The
                      length of this field is variable,
                      indicated by the Nonce Length field
                      preceding it.  However, the overall IPv6
                      Destination Option must comply with IPv6



Atkinson             Exp: 10 DEC 2008                           [Page 3]

Internet Draft     ILNP Nonce            10 JUN 2008


                      header alignment rules.  Common lengths
                      are 32-bits or 96-bits.



3.  Transport Protocol Effects

   When the initial packet(s) of an IPv6 session contain this
   Nonce Destination Option, the Identifier/Locator Split
   operating mode is in use for that IP session.

   When an IPv6 session is in the Identifier/Locator Split
   operating mode, the transport-layer pseudo-header
   calculations zero the high-order 64-bits ("Locator" or
   "Routing Prefix") of each IPv6 address.  This has the effect
   that the transport-layer is no longer cognizant of the
   topological network location of either node in the session.

   The preceding rule applies not only to unicast sessions,
   but also to multicast or anycast sessions when the
   Identifier/Locator Split operating mode is in use.

4.  Implementation Considerations

   Implementers may use any internal implementation they wish,
   provided that the external appearance is the same as this
   implementation approach.

   To support the Identifier/Locator Split operating mode,
   and retain the incremental deployability and backwards
   compatibility needed, the network layer needs a mode bit
   in the Transport Control Block (or equivalent) to track
   which IP sessions are using the classic IPv6 mode, and
   which IP sessions are using the Identifier/Locator Split
   mode.

   Further, when in the Identifier/Locator Split mode, nodes
   will need to retain a per-session/per-flow cache containing
   several variables for that flow.  Conceptually, and
   architecturally, this cache is at the top of the
   network-layer since it contains network-layer information
   (e.g. Locators) that ought not be made visible to the
   transport-layer.

   This per-session/per-flow cache contains at least:
        - Source Identifier(s) in use
        - Source Locator(s) in use
        - Destination Identifier(s) in use



Atkinson             Exp: 10 DEC 2008                           [Page 4]

Internet Draft     ILNP Nonce            10 JUN 2008


        - Destination Locator(s) in use
        - Session Nonce value in use
        - Transport Layer source port and destination port

5.  Backwards Compatibility

   If a node has been enhanced to support the Identifier/
   Locator Split operating mode, that node's fully-qualified
   domain name will normally have one or more I records and one
   or more L records associated with it in the DNS.

   When a host ("initiator') initiates a new IP session with a
   correspondent ("responder"), it normally will perform a DNS
   lookup to determine the address(es) of the responder.  A
   host that has been enhanced to support the Identifier/
   Locator Split operating mode normally will look for
   Identifier ("I") and Locator ("L") records in any received
   DNS replies.  DNS servers that support I and L records
   should include them (when they exist) as additional data in
   all DNS replies to queries for DNS AAAA records.

   If the initiator supports the I/L Split mode and from DNS
   data learns that the responder also supports the I/L Split
   mode, then the initiator will generate an unpredictable
   nonce value, store that value in a local session cache, and
   will include the Nonce Destination Option in its initial
   packet(s) to the responder.  [RFC-4086]

   If the responder supports the I/L Split mode and receives
   initial packet(s) containing the Nonce Destination Option,
   the responder will thereby know that the initiator supports
   the I/L Split mode and the responder will also operate in
   I/L Split mode for this new IP session.

   If the responder supports the I/L Split mode and receives
   initial packet(s) NOT containing the Nonce Destination
   Option, the responder will thereby know that the initiator
   does NOT support the I/L Split mode and the responder will
   operate in classic IPv6 mode for this new IP session.

   If the responder does not support the I/L Split mode and
   receives initial packet(s) containing the Nonce Destination
   Option, the responder will drop the packet and send an ICMP
   Parameter Problem error message back to the initiator.

   If the initiator EITHER does not receive a response from the
   responder in a timely manner (e.g. within the applicable TCP
   timeout for a TCP session) and also does not receive an ICMP



Atkinson             Exp: 10 DEC 2008                           [Page 5]

Internet Draft     ILNP Nonce            10 JUN 2008


   Unreachable error message for that packet, OR if the
   initiator receives an ICMP Parameter Problem error message
   for that packet, then the initiator knows that the responder
   is not able to support the I/L Split Operating mode.  In
   this case, the initiator should try again to create the new
   IP session but this time using classic IPv6 mode and hence
   OMITTING the Nonce Destination Option.












































Atkinson             Exp: 10 DEC 2008                           [Page 6]

Internet Draft     ILNP Nonce            10 JUN 2008


6. Security Considerations

   The Nonce Destination Option is used ONLY for IP sessions
   in the Identifier/Locator Split mode, because this option
   is part of the backwards-compatibility and incremental-
   deployment approach for the Identifier/Locator Network
   Protocol (ILNP).

   The Nonce Destination Option only seeks to provide
   protection against off-path attacks on an IP session.
   Ordinary IPv6 is vulnerable to on-path attacks unless the IP
   Authentication Header or IP Encapsulating Security Payload
   are in use.  This option exists to provide equivalent
   protection for non-IPsec traffic when the Identifier/Locator
   Split mode is in use for an IP session.

   When the Identifier/Locator split mode is in use for an
   existing IP session, the Nonce Destination Option must be
   included in any ICMP control messages (e.g. ICMP
   Unreachable, ICMP Locator Update) sent with regard to that
   IPv6 session, even if IP Security is also in use for that
   session.

   When in the I/L Split operating mode for an existing IPv6
   session, any ICMP control messages received without a Nonce
   Destination Option must be discarded as forgeries.  This
   security event should be logged.

   When in the I/L Split operating mode for an existing IPv6
   session, ICMP control messages received without a correct
   nonce value inside the Nonce Destination Option must be
   discarded as forgeries.  This security event should be
   logged.

   For ID/Locator Split mode sessions operating in higher risk
   environments, the use of the cryptographic authentication
   provided by IP Authentication Header is recommended.  Note
   that the Nonce Option must be present -- even if the IP
   Authentication Header is in use for a given session.  As an
   implementation optimisation, it is suggested that when both
   the Nonce Option and IP Security are present in a packet,
   that the Nonce Option value be checked for validity before
   beginning IP Security processing.

   For environments with data at differing sensitivity levels
   operating over common infrastructure, it is recommended that
   the Nonce Option be protected using ESP Transport-Mode or
   ESP Tunnel-Mode in order to reduce the covert channel



Atkinson             Exp: 10 DEC 2008                           [Page 7]

Internet Draft     ILNP Nonce            10 JUN 2008


   bandwidth potential created by the Nonce Option.

   In all cases, the Nonce Value must be unpredictable and
   cryptographically random.  RFC-4086 provides concrete advice
   on how to generate a suitable nonce value.[RFC-4086]

7. IANA Considerations

   A new option number will need to be assigned by IANA to the
   Nonce Option described in this note.

   Temporarily, for early experimentation, the value 0x1e is
   used to mark the Nonce Option.

8.  References

8.1.  Normative References

   [RFC-2119]  Bradner, S., "Key words for use in RFCs to
               Indicate Requirement Levels", BCP 14, RFC 2119,
               March 1997.

   [RFC-2460]   S. Deering & R. Hinden, "Internet Protocol
                Version 6 Specification", RFC-2460,
                December 1998.

8.2.  Informative References

   [8+8]        M. O'Dell, "8+8 - An Alternate Addressing
                Architecture for IPv6", Internet-Draft,
                October 1996.

   [GSE]        M. O'Dell, "GSE - An Alternate Addressing
                Architecture for IPv6", Internet-Draft,
                February 1997.

   [ILNP-Intro]  Atkinson, R, "Identifier/Locator Concept of
                 Operations", draft-rja-ilnp-intro-01.txt,
                 June 2008.

   [ILNP-DNS]    Atkinson, R, "DNS Resource Records for
                 Identifier/Locator Use",
                 draft-rja-ilnp-dns-00.txt, June 2008.

   [ILNP-ICMP]   Atkinson, R, "ICMP Locator Update message"
                 draft-rja-ilnp-icmp-00.txt, June 2008.

   [RFC-4086]    D. Eastlake 3rd, J. Schiller, & S. Crocker,



Atkinson             Exp: 10 DEC 2008                           [Page 8]

Internet Draft     ILNP Nonce            10 JUN 2008


                 "Randomness Requirements for Security",
                 RFC-4086, June 2005.

   (Additional references to be added later.)


Author's Address

   R. Atkinson
   Extreme Networks
   3585 Monroe Street
   Santa Clara, CA
   95051  USA

   +1 (408)579-2800
   rja@extremenetworks.com



































Atkinson             Exp: 10 DEC 2008                           [Page 9]

Internet Draft     ILNP Nonce            10 JUN 2008


  Full Copyright Statement

  Copyright (C) The IETF Trust (2008).

  This document is subject to the rights, licenses and restrictions
  contained in BCP 78, and except as set forth therein, the authors
  retain all their rights.

  This document and the information contained herein are provided
  on an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE
  REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY,
  THE IETF TRUST AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM
  ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
  ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT
  INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY
  OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

  The IETF takes no position regarding the validity or scope of any
  Intellectual Property Rights or other rights that might be claimed
  to pertain to the implementation or use of the technology
  described in this document or the extent to which any license
  under such rights might or might not be available; nor does it
  represent that it has made any independent effort to identify any
  such rights.  Information on the procedures with respect to
  rights in RFC documents can be found in BCP 78 and BCP 79.

  Copies of IPR disclosures made to the IETF Secretariat and any
  assurances of licenses to be made available, or the result of an
  attempt made to obtain a general license or permission for the use
  of such proprietary rights by implementers or users of this
  specification can be obtained from the IETF on-line IPR repository
  at http://www.ietf.org/ipr.

  The IETF invites any interested party to bring to its attention
  any copyrights, patents or patent applications, or other
  proprietary rights that may cover technology that may be required
  to implement this standard.  Please address the information to the
  IETF at ietf-ipr@ietf.org.

  This document may not be modified, and derivative works of it
  may not be created.

  This document may only be posted in an Internet-Draft.

  Expires: 10 December 2008



Atkinson             Exp: 10 DEC 2008                          [Page 10]

Internet Draft     ILNP Nonce            10 JUN 2008





















































Atkinson             Exp: 10 DEC 2008                          [Page 11]
