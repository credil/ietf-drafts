<?xml version = '1.0'?>
<?rfc rfcedstyle='yes'?>
<?rfc rfcprocack='yes'?>
<?rfc toc='yes'?>
<?rfc symrefs='yes'?>
<!DOCTYPE rfc SYSTEM "../xml2rfc-1.34pre3/rfc2629.dtd" [
      <!ENTITY rfc2119     PUBLIC '' '../rfc-bib/reference.RFC.2119.xml'>
      <!ENTITY rfc4282     PUBLIC '' '../rfc-bib/reference.RFC.4282.xml'>
      <!ENTITY radius-dtls PUBLIC '' '../i-d-bib/reference.I-D.dekok-radext-dtls.xml'>
    ]>
<rfc ipr='pre5378Trust200902' docName='draft-ietf-radext-dynamic-discovery-00' category='exp'>
  <front>
	  <title abbrev="RADIUS Peer Discovery" >NAI-based Dynamic Peer Discovery for RADIUS over TLS and DTLS</title>
    <author fullname="Stefan Winter" initials="S." surname="Winter" >
	<organization abbrev="RESTENA" >
		  Fondation RESTENA
	</organization>
	<address>
		<postal>
			<street>6, rue Richard Coudenhove-Kalergi</street>
			<city>Luxembourg</city>
			<code>1359</code>
			<country>LUXEMBOURG</country>
		</postal>
		<phone>+352 424409 1</phone>
		<facsimile>+352 422473</facsimile>
		<email>stefan.winter@restena.lu</email>
		<uri>http://www.restena.lu.</uri>
	</address>
    </author>
    <author fullname="Mike McCauley" initials="M." surname="McCauley" >
	    <organization abbrev="OSC" >
		    Open Systems Consultants
	    </organization>
	    <address>
		    <postal>
			    <street>9 Bulbul Place</street>
			    <city>Currumbin Waters</city>
			    <code>QLD 4223</code>
			    <country>AUSTRALIA</country>
		    </postal>
		    <phone>+61 7 5598 7474</phone>
		    <facsimile>+61 7 5598 7070</facsimile>
		    <email>mikem@open.com.au</email>
		    <uri>http://www.open.com.au.</uri>
	    </address>
    </author>
    <date day="02" month="July" year="2009" />
    <area>Operations and Management Area</area>
    <workgroup>RADIUS Extensions Working Group</workgroup>
    <keyword>RADIUS</keyword>
    <keyword>AAA</keyword>
    <keyword>Security</keyword>
    <keyword>Reliability</keyword>
    <keyword>DNS</keyword>
    <abstract>
	    <t>This document specifies a means to find authoritative AAA servers for a given NAI realm as defined in <xref target="RFC4282" />. It can be used in conjunction with RADIUS over TLS and RADIUS over DTLS.</t>
    </abstract>
  </front>
  <middle>
    <section title="Introduction" anchor="intro">
	<t>
	</t>
	<section title="Requirements Language" anchor="reqlang">
		<t>In this document, several words are used to signify the requirements of the specification.  The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119. <xref target="RFC2119" /></t>
	</section>
	<section title="Terminology" anchor="terms">
		<t>RadSec node: a RadSec client or server</t>
		<t>RadSec Client: a RadSec instance which initiates a new connection.</t>
		<t>RadSec Server: a RadSec instance which listens on a RadSec port and accepts new connections</t>
	</section>
    </section>
    <section title="DNS-based NAPTR/SRV Peer Discovery" anchor="dns">
	    <section title="DNS RR definition" anchor="rr-def">
	    <t>
		    DNS definitions of RadSec servers can be either NAPTR records or SRV records. When both are defined, the resolution algorithm prefers NAPTR results (see section <xref target="algo" /> below). The NAPTR service field used is "AAAS+RADSECT". The SRV prefix used is "_radsec._tcp". It is expected that in most cases, the label used for the records is the DNS representation (punycode) of the literal realm name for which the server is the AAA server.</t>
	    <t>
		    However, arbitrary other labels may be used if, for example, a roaming consortium uses realm names which are not associated to DNS names or special-purpose consortia where a globally valid discovery is not a use case. Such other labels require a consortium-wide agreement about the transformation from realm name to lookup label.
	    </t>
	    <t>Examples:
		    <list style="letters">
			    <t>A general-purpose AAA server for realm example.com might have DNS entries as follows:
			    <list style="empty">
				    <t>example.com. IN NAPTR 50 50 "s" "AAAS+RADSECT" "" _radsec._tcp.foobar.example.com.</t>
				    <t>_radsec._tcp.example.com. IN SRV 0 10 2083 radsec.example.com.</t>
			    </list>
			    </t>
			    <t>Consortium "foo" provides roaming services for banks. The realms used are of the form enterprise-name.foobankroam. The consortium operates a special purpose DNS server for the (private) TLD "foobankroam" which all AAA servers use to resolve realm names. "Rupt, Inc." is part of the consortium. On the consortium's DNS server, realm bank-rupt.foobankroam might have the following DNS entries:
				    <list style="empty">
					    <t>bank-rupt.foobankroam IN NAPTR 50 50 "a" "AAAS+RADSECT" "" "triple-a.bank-rupt.com"</t>
					    <t>_radsec._tcp.bank-rupt.foobankroam IN SRV 0 10 2083 triple-a-backup.bank-rupt.com"</t>
				    </list>
			    </t>
			    <t>the eduroam consortium uses realms based on DNS, but provides its services to a closed community only. However, a AAA domain participating in eduroam may also want to expose AAA services to other, general-purpose, applications (on the same or other AAA servers). Due to that, the eduroam consortium uses labels prefixed with "eduroam." and eduroam AAA servers use these labels to look up servers. An eduroam participant which also provides general-purpose AAA on a different server might have the following DNS entries:
				    <list style="empty">
					    <t>eduroam.restena.lu. IN NAPTR 50 50 "a" "AAAS+RADSECT" "" aaa-eduroam.restena.lu</t>
					    <t>restena.lu. IN NAPTR 50 50 "a" "AAAS+RADSECT" "" aaa-default.restena.lu</t>
					    <t>_radsec._tcp.eduroam.restena.lu. IN SRV 0 10 2083 aaa-eduroam.restena.lu.</t>
					    <t>_radsec._tcp.restena.lu. IN SRV 0 10 2083 aaa-default.restena.lu.</t>
				    </list>
			    </t>
		    </list>
	    </t>
    </section>
    <section title="Realm to AAA server resolution algorithm" anchor="algo">
	    <t>Input I to the algorithm is a User-Name in the form of a NAI as defined in <xref target="RFC4282" /> as extracted from the User-Name attribute in an Access-Request. Output O of the algorithm is a set of hostname:port and an assoiciated order/preference; the set can be empty. The algorithm to determine the AAA server to contact is as follows:
		    <list style="numbers">
			    <t>Determine P = (position of first "@" character) in I.</t>
			    <t>generate R = (substring from P+1 to end of I)</t>
			    <t>Optional: modify R according to agreed consortium procedures</t>
			    <t>Generate R' = ( DNS library transformation of R to an FQDN in punycode)</t>
			    <t>If generation of R' failed, O = {}; terminate.</t>
			    <t>Perform NAPTR query for service "AAAS+RADSECT" with R as label</t>
			    <t>If no result, continue at step 10.</t>
			    <t>Evaluate NAPTR result, perform subsequent lookup steps until lookup yields one or more hostnames. O = (set of {Order/Preference, hostname:port} for all lookup results).</t>
			    <t>Terminate.</t>
			    <t>Generate R'' = (prefix R' with "_radsec._tcp.")</t>
			    <t>Perform SRV lookup with R'' as label. If no result, O = {}; terminate.</t>
			    <t>Perform subsequent lookup steps until lookup yields one or more hostnames. O = (set of {Order/Preference, hostname} for all hostnames). Terminate.</t>
		    </list>
	    </t>
	    <t>
	    Example: Assume a user from the Technical University of Munich, Germany, has a RADIUS User-Name of "foobar@tu-m[U+00FC]nchen.example". If DNS contains the following records:
	    <list style="empty">
		    <t>xn--tu-mnchen-t9a.example. IN NAPTR 50 50 "s" "AAAS+RADSECT" "" _radsec._tcp.xn--tu-mnchen-t9a.example.</t>
		    <t>_radsec._tcp.xn--tu-mnchen-t9a.example. IN SRV 0 10 2083 radsec.xn--tu-mnchen-t9a.example.</t>
		    <t>_radsec._tcp.xn--tu-mnchen-t9a.example. IN SRV 0 20 2083 backup.xn--tu-mnchen-t9a.example.</t>
		    <t>radsec.xn--tu-mnchen-t9a.example. IN AAAA 2001:0DB8::202:44ff:fe0a:f704</t>
		    <t>radsec.xn--tu-mnchen-t9a.example. IN A    192.0.2.3</t>
		    <t>backup.xn--tu-mnchen-t9a.example. IN A    192.0.2.7</t>
	    </list>
		    Then the algorithm executes as follows, with I = "foobar@tu-m[U+00FC]nchen.example", and no consortium name mangling in use:
		    <list style="numbers">
			    <t>P = 7</t>
			    <t>R = "tu-m[U+00FC]nchen.example"</t>
			    <t>NOOP</t>
			    <t>R' = "xn--tu-mnchen-t9a.example."</t>
			    <t>NOOP</t>
			    <t>Query result: ( 0 10 2083 radsec.xn--tu-mnchen-t9a.example. ; 0 20 2083 backup.xn--tu-mnchen-t9a.example. )</t>
			    <t>NOOP</t>
			    <t>O = {(10,radsec.xn--tu-mnchen-t9a.example.:2083),(20,backup.xn--tu-mnchen-t9a.example.:2083)}</t>
			    <t>Terminate.</t>
			    <t>(not executed)</t>
			    <t>(not executed)</t>
			    <t>(not executed)</t>
		    </list>
		    
		    The implementation will then attempt to connect to two servers, with preference to radsec.xn--tu-mnchen-t9a.example.:2083, using either the AAAA or A addresses depending on the host configuration and its IP stack's capabilities.</t>
    </section>
</section>
    <section title="Security Considerations" anchor="sec">
    <t>
	    When using DNS without security, the replies to NAPTR, SRV and A/AAAA requests as described in section <xref target="dns" /> can not be trusted. RADIUS transports have an out-of-DNS-band means to verify that the discovery attempt led to the intended target (TLS/DTLS: ceritifcate verification or TLS shared secret ciphers; UDP/TCP: the RADIUS shared secret) and are safe from DNS-based redirection attacks. [Note: assuming here that a hypothetical RADIUS/UDP SRV discovery will NOT deliver the shared secret in the DNS response!]
    </t>
    <t>
	    The discovery process is always susceptible to bidding down attacks if a realm has SRV records for RADIUS/UDP and/or RADIUS/TCP as well as for RADIUS/TLS and/or RADIUS/DTLS. While the SRV query will expose both transports, an attacker in the routing path might suppress the subsequent A/AAAA results for the TLS or DTLS peer and trick the initiating peer into using the weakly protected UDP or TCP transports. The use of DNSSEC can not fully mitigate this attack, since it does not provide a means to detect packet suppression. The only way to disable such bidding down attacks is by intiating connections only to the peer(s) which match or exceed a configured minimum security level. All implementations SHOULD provide a means to configure the administratively desired minimum security level.
    </t>
    </section>
    <section title="IANA Considerations" anchor="iana">
	    <t>
		    This document contains no actions for IANA. Maybe. Not sure about the labels "AAAS+RADSECT" and "_radsec._tcp.".
	    </t>
    </section>
</middle>
<back>
	<references title="Normative References">
		&rfc2119;
		&rfc4282;
	</references>
<!--	<references title="Informative References">
	<reference anchor="radiator-manual" target="http://www.open.com.au/radiator/ref.html">
		<front>
			<title>Radiator Radius Server - Installation and Reference Manual</title>
			<author>
				<organization abbrev="OSC">Open System Consultants</organization>
			</author>
			<date year="2006"/>
		</front>
		<format type="TXT" target="http://www.open.com.au/radiator/ref.html"/>
	</reference>
</references> -->
</back>
</rfc>
