<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc2131 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.2131.xml">
<!ENTITY rfc2434 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.2434.xml">
<!ENTITY rfc3046 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.3046.xml">
<!ENTITY rfc3118 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.3118.xml">
<!ENTITY rfc3315 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml">
<!ENTITY rfc3693 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.3693.xml">
<!ENTITY rfc3694 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.3694.xml">
<!ENTITY rfc4119 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.4119.xml">
<!ENTITY rfc4776 PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml/reference.RFC.4776.xml">
<!ENTITY I-D.ietf-geopriv-revised-civic-lo PUBLIC ""
"http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-geopriv-revised-civic-lo.xml">
]>

<?rfc symrefs="yes"?>
<?rfc sortrefs="no"?>
<?rfc iprnotified="yes"?>
<?rfc strict="yes"?>
<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc tocdepth="2"?>
<?rfc docmapping="no"?>

<rfc category="std" ipr="full3978" obsoletes="3825"
     docName="draft-thomson-geopriv-3825bis-01.txt">

  <front>
    <title abbrev="DHCP Geodetic">
      Dynamic Host Configuration Protocol Option for Geodetic Location Information
    </title>

    <author initials="M." surname="Thomson"
            fullname="Martin Thomson">
      <organization>Andrew</organization>

      <address>
        <postal>
          <street>PO Box U40</street>
          <city>Wollongong University Campus</city>
          <region>NSW</region>
          <code>2500</code>
          <country>AU</country>
        </postal>

        <phone>+61 2 4221 2915</phone>
        <email>martin.thomson@andrew.com</email>
        <uri>http://www.andrew.com/</uri>
      </address>
    </author>

    <author initials="J." surname="Winterbottom"
            fullname="James Winterbottom">
      <organization>Andrew</organization>

      <address>
        <postal>
          <street>PO Box U40</street>
          <city>Wollongong University Campus</city>
          <region>NSW</region>
          <code>2500</code>
          <country>AU</country>
        </postal>

        <phone>+61 2 4221 2938</phone>
        <email>james.winterbottom@andrew.com</email>
        <uri>http://www.andrew.com/</uri>
      </address>
    </author>

    <date month="September" year="2007"/>
    <area>Application</area>
    <workgroup>GEOPRIV WG</workgroup>
    <keyword>Internet-Draft</keyword>
    <keyword>Location</keyword>
    <keyword>Civic PIDF-LO</keyword>

    <abstract>

      <t>This document specifies a Dynamic Host Configuration Protocol (DHCPv4 and DHCPv6) Option for the coordinate-based geographic location of the client.  The Location Configuration Information (LCI) includes latitude, longitude, and altitude, with an indication of uncertainty for each.  Separate parameters indicate the reference datum for each of these values.
      </t>

    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>The physical location of a network device has a range of applications.  In particular, emergency telephony applications rely on knowing the location of a caller in order to determine the correct emergency center.
      </t>

      <t>There are two primary means for representing the location of a device; either through geospatial (or geodetic) coordinates, or through civic addresses.  A related document <xref target="RFC4776"/> describes a DHCP encoding for civic addresses; this document defines an encoding for geodetic location information.  Different applications may be more suited to one form of location information; therefore, both the geodetic and civic forms may be used simultaneously.
      </t>

      <t>This document specifies a Dynamic Host Configuration Protocol (<xref target="RFC2131">DHCPv4</xref>, <xref target="RFC3315">DHCPv6</xref>) option for the coordinate-based geographic location of the client, to be provided by the server.
      </t>

      <t>The goal of this document is to enable a wired Ethernet host to obtain its location.  This location information is derived from a wiremap by the DHCP server, using the Circuit-ID Relay Agent Information Option (RAIO) defined (as Sub-Option 1) in <xref target="RFC3046">RFC 3046</xref>.  The DHCP server is assumed to have access to a service that can correlate a Circuit-ID with the geographic location where the identified circuit terminates.  For instance, this might be an Ethernet wall jack.
      </t>

      <t>This geodetic location information option has limited application to wireless technologies, or other instances where a client is able to move without requiring new addressing information.  DHCP provides static configuration information, which is not dynamically or automatically refreshed.  If a client moves between when the configuration was provided and when the information is used, the information is incorrect.
      </t>

      <t>This document only defines the delivery of location information from the DHCP server to the client, due to security concerns related to using DHCP to update the database.  Within the GEOPRIV architecture as defined by <xref target="RFC3693">RFC 3693</xref>, the defined mechanism in this document for conveying initial location information is known as a "sighting" function.  Sighting functions are not required to have security capabilities and are only intended to be configured in trusted and controlled environments.  (A classic example of the sighting function is a Global Positioning System wired directly to a network node.) Further discussion of the protections that must be provided according to <xref target="RFC3694">RFC 3694</xref> are in the <xref target="security">Security Considerations section of this document</xref>.
      </t>

      <section title="Uncertainty">
        <t>In the context of location technology, uncertainty is a quantification of errors.  Any method for determining location is subject to some sources of error; uncertainty describes the amount of error that is present.  Uncertainty might be the coverage area of a wireless transmitter, the extent of a building or a single room.
        </t>

        <t>Uncertainty is usually represented as an area within which the target is located.  In this document, each of the three axes can be assigned an uncertainty value.  In effect, this describes a rectangular prism.
        </t>

        <t>When representing locations from sources that can quantify uncertainty, the goal is to find the smallest possible rectangular prism that this format can describe.  This is achieved by taking the minimum and maximum values on each axis and ensuring that the final encoding covers these points.  This increases the region of uncertainty, but ensures that the region that is described encompasses the target location.
        </t>
      </section>

      <section title="Major Changes from RFC 3825">
        <t>An option for DHCPv6 is included in this document.
        </t>

        <t>The way in which uncertainty is described is changed from the previous version.  There was some confusion with the way that the word "resolution" was used in the previous version.  Uncertainty is now used in place of resolution and more explanation is included.
        </t>

        <t>The uncertainty components have changed in their meaning.  The previous version was unclear/misleading on how these values should be interpreted.  This is clarified.  This is illustrated with a new set of normative examples, including both encoding and decoding of these values.  <xref target="OGC.GML-3.1.1">Geographic Markup Language (GML)</xref> is used for these examples.
        </t>

        <t>An altitude type of 0 (no altitude) was previously described in text, but not registered in the IANA registry.  This document formally registers this type.  Altitude type 2 is deprecated in favour of <xref target="RFC4776"/>.
        </t>
      </section>

      <section anchor="terminology" title="Terminology">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119"/>.
        </t>
      </section>

    </section>

    <section title="DHCP Option Format">
      <t>This section defines the format for the DHCPv4 and DHCPv6 options.  These options use the same basic format, differing only in the option code.
      </t>

      <section title="DHCPv4 Geodetic Location Option">
        <figure>
          <preamble>The format of the geodetic option for <xref target="RFC2131">DHCPv4</xref> is as follows:
          </preamble>
          <artwork><![CDATA[
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Code (123)  |  OptLen (16)  |  LatUnc   |     Latitude      .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                Latitude (cont'd)              |  LongUnc  |   .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                       Longitude (cont'd)                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | AType |   AltUnc  |                Altitude                   .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .  Alt (cont'd) |     Datum     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
        </figure>
        <t><list style="hanging">
          <t hangText="Code:">GEOCONF_GEODETIC (8 bits).  The code for this DHCPv4 option is 123.
          </t>
          <t hangText="OptLen:">Option Length (8 bits).  This option is fixed size, the value of this octet will always be 16.
          </t>
          <t hangText="LatUnc:">Latitude Uncertainty (6 bits).  See <xref target="latlngunc"/>.
          </t>
          <t hangText="Latitude:">Latitude (34 bits).  See <xref target="latlng"/>.
          </t>
          <t hangText="LongUnc:">Longitude Uncertainty (6 bits).  See <xref target="latlngunc"/>.
          </t>
          <t hangText="Longitude:">Longitude (34 bits).  See <xref target="latlng"/>.
          </t>
          <t hangText="AType:">Altitude Type (4 bits).  See <xref target="alt"/>.
          </t>
          <t hangText="AltUnc:">Altitude Uncertainty (6 bits).  See <xref target="altunc"/>.
          </t>
          <t hangText="Altitude:">Altitude (30 bits).  See <xref target="alt"/>.
          </t>
          <t hangText="Datum:">Datum (8 bits).  See <xref target="datum"/>.
          </t>
        </list></t>
      </section>
      <section title="DHCPv6 Geodetic Location Option">
        <figure>
          <preamble>The format of the geodetic option for <xref target="RFC3315">DHCPv6</xref> is as follows:
          </preamble>
          <artwork><![CDATA[
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Option Code (TBD)       |  OptLen (16)  |  LatUnc   |   .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                     Latitude (cont'd)                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  LongUnc  |               Longitude                           .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    . Long (cont'd) | AType |   AltUnc  |         Altitude          .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .      Altitude (cont'd)        |     Datum     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
        </figure>
        <t><list style="hanging">
          <t hangText="Option Code:">OPTION_GEOCONF_GEODETIC (16 bits).  The code for this DHCPv6 option is TBD.
          </t>
        </list>
        The remaining fields are identical to the DHCPv4 fields.</t>
      </section>

      <section anchor="latlng" title="Latitude and Longitude Fields">
        <t>The Latitude and Longitude values in this format are encoded as 34 bit, twos complement, fixed point values with 9 integer bits and 25 fractional bits.  The exact meaning of these values is determined by the datum; the description in this section applies to the datums defined in this document.
        </t>

        <t>New datums MUST define the way that the 34 bit values and the respective 6 bit uncertainties are interpreted.  This document uses the same definition for all datums it specifies.
        </t>

        <t>Latitude values MUST be constrained to the range from -90 to +90 degrees.  Positive latitudes are north of the equator; negative latitude are south of the equator.
        </t>

        <t>Longitude values SHOULD be normalized to the range from -180 to +180 degrees.  Values outside this range are normalized by adding or subtracting 360 until they fall within this range.  Positive longitudes are east of the Prime Meridian (Greenwich); negative longitudes are west of the Prime Meridian.
        </t>

        <t>When encoding, latitude and longitude values are rounded to the nearest 34-bit binary representation.  This imprecision is considered acceptable for the purposes to which this form is intended to be applied and is ignored when decoding.
        </t>

        <section anchor="latlngunc" title="Latitude and Longitude Uncertainty">
          <t>The latitude and longitude uncertainty fields are encoded as 6 bit, unsigned integer values.  These values quantify the amount of uncertainty in each of the latitude and longitude values respectively.  A value of 0 is reserved to indicate that the uncertainty is unknown; values greater than 34 are reserved.</t>

          <t>The value for uncertainty is taken as the distance from the selected point (which is usually selected as the center of the region of uncertainty) to the furthest extreme of the region of uncertainty on that axis.
          </t>

          <figure>
            <preamble>The following figure shows a two-dimensional figure that is projected to each axis.  In the figure, <spanx style="verb">X</spanx> marks the point that is selected; the ranges marked with <spanx style="verb">U</spanx> is the uncertainty.
            </preamble>
            <artwork><![CDATA[
  ___          ___________
  ^ |         /           |
  | |        /            |
  | |       /             |
  U |      /              |
  | |     (               |
  V |     |               |
  --X     |         X     |
    |     |               `---------.
    |     |                         |
    |     |                         |
    |     |                         |
    -     `-------------------------'

          |---------X---------------|
                    |<------U------>|
]]>
            </artwork>
          </figure>

          <t>Uncertainty applies to each axis independently.  If necessary, decoders MAY assume a normal distribution and that the uncertainty representsone standard deviation (i.e. approximately 68% confidence).
          </t>

          <figure>
            <preamble>The amount of uncertainty can be determined from the encoding by taking 2 to the power of 8, less the encoded value.  As is shown in the following formula, where <spanx style="verb">x</spanx> is the encoded integer value:
            </preamble>
            <artwork><![CDATA[    uncertainty = 2 ^ ( 8 - x ) ]]></artwork>
            <postamble>The result of this formula is expressed in degrees of latitude or longitude.  The uncertainty is added to the base latitude or longitude value to determine the maximum value in the uncertainty range; similarly, the uncertainty is subtracted from the base value to determine the minimum value.  Note that because lines of longitude converge at the poles, the actual distance represented by this uncertainty changes with the distance from the equator.
            </postamble>
          </figure>

          <t>If the maximum or minimum latitude values derived from applying uncertainty are outside the range of -90 to +90, these values are trimmed to within this range.  If the maximum or minimum longitude values derived from applying uncertainty are outside the range of -180 to +180, then these values are normalized to this range by adding or subtracting 360 as necessary.
          </t>
          <figure>
            <preamble>The encoded value is determined by subtracting the next highest whole integer value for the base 2 logarithm of uncertainty from 8.  As is shown by the following formula, where uncertainty is the midpoint of the known range less the lower bound of that range:
            </preamble>
            <artwork><![CDATA[    x = 8 - ceil( log2( uncertainty ) ) ]]></artwork>
            <postamble>Note that the result of encoding this value increases the range of uncertainty to the next available power of two; subsequent repeated encodings and decodings do not change the value.  Only increasing uncertainty means that the associated confidence does not have to decrease.
            </postamble>
          </figure>

        </section>
      </section>

      <section anchor="alt" title="Altitude">
        <t>The altitude is expressed as a 30 bit, fixed point, twos complement integer with 22 integer bits and 8 fractional bits.  How the altitude value is interpreted depends on the type of altitude and the selected datum.
        </t>

        <t>New altitude types and datums MUST define the way that the 30 bit value and the associated 6 bit uncertainty are interpreted.
        </t>

        <t>Three altitude types are defined in this document: unknown (0), meters (1) and floors (2).  Additional altitude types MUST be defined in a Standards Track RFC.
        </t>

        <section title="No Known Altitude (AT = 0)">
          <t>In some cases, the altitude of the location might not be known.  An altitude type of 0 indicates that the altitude is not known.  In this case, the altitude and altitude uncertainty fields can contain any value and are ignored.
          </t>
        </section>

        <section title="Altitude in Meters (AT = 1)">
          <t>If the altitude type has a value of 1, the altitude is measured in meters.  The altitude is measured in relation to the zero set by the vertical datum.
          </t>
        </section>

        <section title="Altitude in Floors (AT = 2)">
          <t>A value of 2 for altitude type indicates that the altitude value is measured in floors.  This value is relevant only in relation to a building; the value is relative to the ground level of the building.  In this definition, numbering starts at ground level, which is floor 0 regardless of local convention.
          </t>

          <t>Non-integer values can be used to represent intermediate or sub-floors, such as mezzanine levels.  For instance, a mezzanine between floors 4 and 5 could be represented as 4.1.
          </t>

          <t>Use of altitude in floors is deprecated in favor of the floors field (CAtype 27) in the <xref target="RFC4776">civic address option</xref>.
          </t>
        </section>

        <section anchor="altunc" title="Altitude Uncertainty">
          <t>Altitude uncertainty uses the same form of expression as latitude and longitude uncertainty.  Like latitude and longitude, a value of 0 is reserved to indicate that uncertainty is not known; values above 30 are also reserved.  Altitude uncertainty only applies to altitude type 1.
          </t>
          <figure>
            <preamble>The amount of altitude uncertainty can be determined by the following formula, where x is the encoded integer value:
            </preamble>
            <artwork><![CDATA[    uncertainty = 2 ^ ( 21 - x ) ]]></artwork>
            <postamble>This value uses the same units as the associated altitude.
            </postamble>
          </figure>
          <figure>
            <preamble>Similarly, a value for the encoded integer value can be derived by the following formula:
            </preamble>
            <artwork><![CDATA[    x = 21 - ceil( log2( x ) ) ]]></artwork>
          </figure>

        </section>
      </section>
      <section anchor="datum" title="Datum">
        <t>The datum field determines how coordinates are organized and related to the real world.  Three datums are defined in this document, based on the definitions in <xref target="OGP.Geodesy"/>:
        <list style="hanging">
          <t hangText="1: WGS84 (Latitude, Longitude, Altitude):"><vspace/>
          The <xref target="WGS84">World Geodesic System 1984</xref> coordinate reference system.
          <vspace blankLines="1"/>
          This datum is identified by the European Petroleum Survey Group (EPSG)/International Association of Oil &amp; Gas Producers (OGP) with the code 4979, or by the URN <spanx style="verb">urn:ogc:def:crs:EPSG::4979</spanx>.  Without altitude, this datum is identified by the EPSG/OGP code 4326 and the URN <spanx style="verb">urn:ogc:def:crs:EPSG::4326</spanx>.
          </t>

          <t hangText="2: NAD83 (Latitude, Longitude) + NAVD88:"><vspace/>
          This datum uses a combination of the North American Datum 1983 (NAD83) for horizontal (latitude and longitude) values, plus the North American Vertical Datum of 1988 (NAVD88) vertical datum.
          <vspace blankLines="1"/>
          This datum is used for referencing location on land (not near tidal water) within North America.
          <vspace blankLines="1"/>
          NAD83 is identified by the EPSG/OGP code of 4269, or the URN <spanx style="verb">urn:ogc:def:crs:EPSG::4269</spanx>.  NAVD88 is identified by the EPSG/OGP code of 5703, or the URN <spanx style="verb">urn:ogc:def:crs:EPSG::5703</spanx>.
          </t>

          <t hangText="3: NAD83 (Latitude, Longitude) + MLLW:"><vspace/>
          This datum uses a combination of the North American Datum 1983 (NAD83) for horizontal (latitude and longitude) values, plus the Mean Lower Low Water (MLLW) vertical datum.
          <vspace blankLines="1"/>
          This datum is used for referencing location on or near tidal water within North America.
          <vspace blankLines="1"/>
          NAD83 is identified by the EPSG/OGP code of 4269, or the URN <spanx style="verb">urn:ogc:def:crs:EPSG::4269</spanx>.  MLLW does not have a specific code or URN.
          </t>
        </list>
        </t>

        <t>All hosts MUST support the WGS84 datum (Datum 1).</t>

        <t>New datum codes can be registered in the <xref target="iana">IANA registry</xref> by a Standards Track RFC.  New geodetic coordinate datums MUST be three dimensional that define both horizontal and vertical components.
        </t>
      </section>
    </section>

    <section anchor="example" title="Encoding and Decoding Example">
      <t>This section describes an example of encoding and decoding the geodetic DHCP option.  The textual results are expressed in <xref target="OGC.GML-3.1.1">GML</xref> form, suitable for inclusion in <xref target="RFC4119">PIDF-LO</xref>.
      </t>

      <t>These examples all assume a datum of WGS84 (datum = 1) and an altitude type of meters (AT = 1).
      </t>


      <!-- Opera House [(-33.856624614236104, 151.21590614318848),(-33.85629941346168, 151.21534287929535),(-33.856326142339164, 151.21473133563995),(-33.85753338791716, 151.21449530124664),(-33.85772048718048, 151.2146133184433),(-33.857368562036044, 151.21537506580353),(-33.856624614236104, 151.21590614318848)] -->

      <section title="Encoding a Location into DHCP Geodetic Form">
        <figure>
          <preamble>This example draws a rough polygon around the Sydney Opera House.  This polygon consists of the following six points:
          </preamble>
          <artwork><![CDATA[
    33.856625 S, 151.215906 E
    33.856299 S, 151.215343 E
    33.856326 S, 151.214731 E
    33.857533 S, 151.214495 E
    33.857720 S, 151.214613 E
    33.857369 S, 151.215375 E
]]></artwork>
          <postamble>The top of the building 67.4 meters above sea level, and a starting altitude of 0 meters above the WGS84 geoid is assumed.
          </postamble>
        </figure>

        <t>The first step is to determine the range of latitude and longitude values.  Latitude ranges from -33.857720 to -33.856299; longitude ranges from 151.214495 to 151.215906.</t>

        <t>For this example, the point that is encoded is chosen by finding the middle of each range, that is (-33.8570095, 151.2152005).  This is encoded as (1110111100010010010011011000001101, 0100101110011011100010111011000011) in binary, or (3BC49360D, 12E6E2EC3) in hexadecimal notation (with an extra 2 bits of leading padding on each).  Altitude is set at 33.7 meters, which is 000000000000000010000110110011 (binary) or 000021B3 (hexadecimal).
        </t>

        <figure>
          <preamble>The latitude uncertainty is given by inserting the difference between the center value and the outer value into the formula from <xref target="latlngunc"/>.  This gives:
          </preamble>
          <artwork><![CDATA[     x = 8 - ceil( log2( -33.8570095 - -33.857720 ) ) ]]></artwork>
          <postamble>The result of this equation is 18, therefore the uncertainty is encoded as 010010 in binary.
          </postamble>
        </figure>

        <figure>
          <preamble>Similarly, longitude uncertainty is given by the formula:
          </preamble>
          <artwork><![CDATA[     x = 8 - ceil( log2( 151.2152005 - 151.214495 ) ) ]]></artwork>
          <postamble>The result of this equation is also 18, or 010010 in binary.
          </postamble>
        </figure>

        <figure>
          <preamble>Altitude uncertainty uses the formula from <xref target="altunc"/>:
          </preamble>
          <artwork><![CDATA[     x = 21 - ceil( log2( 33.7 - 0 ) ) ]]></artwork>
          <postamble>The result of this equation is 15, which is encoded as 001111 in binary.
          </postamble>
        </figure>

        <figure>
          <preamble>Adding an Altitude Type of 1 (meters) and a Datum of 1 (WGS84), this gives the following DHCPv4 form:
          </preamble>
          <artwork><![CDATA[
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Code (123)  |  OptLen (16)  |  LatUnc   |     Latitude      .
    |0 1 1 1 1 0 1 1|0 0 0 1 0 0 0 0|0 1 0 0 1 0|1 1 1 0 1 1 1 1 0 0.
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                Latitude (cont'd)              |  LongUnc  |   .
    .0 1 0 0 1 0 0 1 0 0 1 1 0 1 1 0 0 0 0 0 1 1 0 1|0 1 0 0 1 0|0 1.
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                       Longitude (cont'd)                      |
    .0 0 1 0 1 1 1 0 0 1 1 0 1 1 1 0 0 0 1 0 1 1 1 0 1 1 0 0 0 0 1 1|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | AType |   AltUnc  |                Altitude                   .
    |0 0 0 1|0 0 1 1 1 1|0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1.
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .  Alt (cont'd) |     Datum     |
    .1 0 1 1 0 0 1 1|0 0 0 0 0 0 0 1|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
          <postamble>In hexadecimal, this is 7B104BBC 49360D49 2E6E2EC3 13C00021 B301.  The DHCPv6 form only differs in the code and option length portion.
          </postamble>
        </figure>
      </section>

      <section title="Decoding a Location from DHCP Geodetic Form">
        <t>If receiving the binary form created in the previous section, this section describes how that would be interpreted.  The result is then represented as a GML object, as defined in <xref target="GeoShape"/>.
        </t>

        <t>A latitude value of 1110111100010010010011011000001101 decodes to a value of -33.8570095003 (to 10 decimal places).  The longitude value of 0100101110011011100010111011000011 decodes to 151.2152005136.
        </t>

        <t><list style="hanging">
          <t hangText="Decoding Tip:">If the raw values of latitude and longitude are placed in integer variables, the actual value can be derived by the following process:
          <list style="numbers">
            <t>If the highest order bit is set (i.e. the number is a twos complement negative), then subtract 2 to the power of 34 (the total number of bits).
            </t>
            <t>Divide the result by 2 to the power of 25 (the number of fractional bits) to determine the final value.
            </t>
          </list>
          The same principle can be applied when decoding altitude values, except with different powers of 2 (30 and 8 respectively).
          </t>
        </list></t>

        <t>The latitude and longitude uncertainty are both 18, which gives an uncertainty value using the formula from <xref target="latlngunc"/> of 0.0009765625.  Therefore, the decoded latitudes is -33.8570095003 +/- 0.0009765625 (or the range from -33.8579860628 to -33.8560329378) and the decoded longitude is 151.2152005136 +/- 0.0009765625 (or the range from 151.2142239511 to 151.2161770761).
        </t>

        <t>The encoded altitude of 000000000000000010000110110011 decodes to 33.69921875.  The encoded uncertainty of 15 gives a value of 64, therefore the final uncertainty is 33.69921875 +/- 64 (or the range from -30.30078125 to 97.69921875).
        </t>

        <section title="GML Representation of Decoded Locations">
          <t>The GML representation of a decoded DHCP option depends on what fields are specified.  Uncertainty can be omitted from all of the respective fields, and altitude can also be absent.
          </t>

          <t>In the absence of uncertainty information, the value decoded from the DHCP form can be expressed as a single point.  If the point includes altitude, it uses a three dimensional CRS, otherwise it uses a two dimensional CRS.
          </t>

          <figure>
            <preamble>The following GML shows the value decoded in the previous example as a point in a three dimensional CRS:
            </preamble>
            <artwork><![CDATA[
    <gml:Point srsName="urn:ogc:def:crs:EPSG::4979"
               xmlns:gml="http://www.opengis.net/gml">
      <gml:pos>-33.8570095003 151.2152005136 33.69921875</gml:pos>
    </gml:Point>
]]></artwork>
          </figure>

          <t>If all fields are included along with uncertainty, the shape described is a rectangular prism.  Note that this is necessary given that uncertainty for each axis is provided idependently.
          </t>

          <figure>
            <preamble>The following example uses all of the decoded information from the previous example:
            </preamble>
            <artwork><![CDATA[
  <gs:Prism srsName="urn:ogc:def:crs:EPSG::4979"
      xmlns:gs="http://www.opengis.net/pidflo/1.0"
      xmlns:gml="http://www.opengis.net/gml">
    <gs:base>
      <gml:Polygon>
        <gml:exterior>
          <gml:LinearRing>
            <gml:posList>
              -33.8579860628 151.2142239511 -30.30078125
              -33.8579860628 151.2161770761 -30.30078125
              -33.8560329378 151.2161770761 -30.30078125
              -33.8560329378 151.2142239511 -30.30078125
              -33.8579860628 151.2142239511 -30.30078125
            </gml:posList>
          </gml:LinearRing>
        </gml:exterior>
      </gml:Polygon>
    </gs:base>
    <gs:height uom="urn:ogc:def:uom:EPSG::9001">
      128
    </gs:height>
  </gs:Prism>
]]></artwork>
          </figure>

          <t>Note that this representation is only appropriate if the uncertainty is sufficiently small.  <xref target="GeoShape"/> recommends that distances between polygon vertices be kept short.  A GML representation like this one is only appropriate where uncertainty is less than 1 degree (an encoded value of 9).
          </t>

          <t>If altitude or altitude uncertainty is not specified, the shape is described as a rectangle using the <spanx style="verb">gml:Polygon</spanx> shape.  If altitude is available, a three dimensional CRS is used, otherwise a two dimensional CRS is used.
          </t>

          <t>For Datum values of 2 or 3 (NAD83), there is no available CRS URN that covers three dimensional coordinates.  By necessity, locations described in these datums can be represented by two dimensional shapes only; that is, either a two dimensional point or a polygon.
          </t>

          <t>If the altitude type is 2 (floors), then this value can be represented using a <xref target="I-D.ietf-geopriv-revised-civic-lo">civic address object</xref> that is presented alongside the geodetic object.
          </t>

        </section>

      </section>

    </section>

    <section anchor="security" title="Security Considerations">
      <t>Security considerations related to the privacy of location information as discussed in the GEOPRIV documents <xref target="RFC3693">RFC 3693</xref> and <xref target="RFC3694">RFC 3694</xref> apply.
      </t>

      <t>Where critical decisions might be based on the value of this option, DHCPv4 authentication in <xref target="RFC3118">RFC 3118</xref> SHOULD be used to protect the integrity of the DHCP options.
      </t>

      <t>Since there is no privacy protection for DHCP messages, an eavesdropper who can monitor the link between the DHCP server and requesting client can discover this option.  Thus, usage of the option on networks without access restrictions or network-layer or link-layer privacy protection is NOT RECOMMENDED.
      </t>

      <t>To minimize the unintended exposure of location information, the GEOCONF_GEODETIC option SHOULD be returned by DHCPv4 servers only when the DHCPv4 client has included this option in its 'parameter request list' (<xref target="RFC2131">RFC 2131</xref>, Section 3.5).  Similarly, the OPTION_GEOCONF_GEODETIC option SHOULD be returned by DHCPv6 servers only when the DHCPv6 client has included this option in its OPTION_ORO.
      </t>

      <t>After initial location information has been introduced, it MUST be afforded the protections defined in <xref target="RFC3694">RFC 3694</xref>.  Therefore, location information SHOULD NOT be sent from a DHCP client to a DHCP server.  If a client decides to send location information to the server, it is implicitly granting that server unlimited retention and distribution permissions.
      </t>
    </section>

    <section anchor="iana" title="IANA Considerations">
      <t>The IANA has registered DHCPv4 and DHCPv6 option codes for the Geodetic Location option (GEOCONF_GEODETIC = 123 and OPTION_GEOCONF_GEODETIC = XXX, respectively).
      </t>

      <t>The IANA has established two registries for GeoConf items: the <xref target="alt">altitude type field</xref> and the <xref target="datum">datum field</xref>.  It is requested of IANA that the registry refer to this document for the definition of these items.  New values for both these registries require <xref target="RFC2434">"Standards Action"</xref>.
      </t>
      <t>Values registered in the Altitude Type registry are:
      <list style="hanging">
        <t hangText="AT = 0">denotes that no altitude information is present
        </t>
        <t hangText="AT = 1">denotes an altitude in meters as defined by the associated datum
        </t>
        <t hangText="AT = 2">denotes an altitude in floors within the context of a building (deprecated)
        </t>
      </list>
      </t>
      <t>Values registered in the Datum registry are:
      <list style="hanging">
        <t hangText="Datum = 1">denotes the WGS84 datum as defined by the EPSG/OGP with the code 4326 (with no altitude) or 4979 (with altitude)
        </t>
        <t hangText="Datum = 2">denotes the NAD83 datum for latitude and longitude as defined by the EPSG/OGP with the code of 4269 (no altitude); the corresponding vertical datum is the North American Vertical Datum of 1988 (NAVD88) as defined by the EPSG/OGP with the code of 5703
        </t>
        <t hangText="Datum = 3">denotes the NAD83 datum for latitude and longitude as defined by the EPSG/OGP with the code of 4269 (no altitude); the corresponding vertical datum is the Mean Lower Low Water (MLLW)
        </t>
      </list>
      </t>
    </section>

    <section anchor="ack" title="Acknowledgements">
      <t>Special thanks go to Klaus Darilion and Alexander Mayrhofer for reviewing the document and pointing out a few errors.
      </t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      &rfc2119;
      &rfc2434;
      &rfc2131;
      &rfc3118;
      &rfc3315;
    </references>

    <references title="Informative References">
      &rfc3046;
      &rfc3693;
      &rfc3694;
      &rfc4119;
      &rfc4776;

      &I-D.ietf-geopriv-revised-civic-lo;

      <reference anchor="GeoShape">
         <front>
            <title abbrev="Geo-Shape">GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF)</title>
            <author initials="M." surname="Thomson" fullname="Martin Thomson">
               <organization>Andrew Corporation</organization>
            </author>
            <author initials="C." surname="Reed" fullname="Carl Reed, PhD.">
               <organization>Open Geospatial Consortium Inc.</organization>
            </author>
            <date month="December" day="26" year="2006"/>
         </front>
         <seriesInfo name="Candidate OpenGIS Implementation Specification" value="06-142, Version: 0.0.9"/>
       </reference>


      <reference anchor="OGP.Geodesy" target="http://info.ogp.org.uk/geodesy/">
        <front>
          <title>International Association of Oil &amp; Gas Producers (OGP) Geodesy Resources</title>
          <author>
            <organization>OGP</organization>
          </author>
        </front>
      </reference>

      <reference anchor="WGS84" target="">
        <front>
          <title>
            Department of Defense (DoD) World Geodetic System 1984 (WGS 84), Third Edition
          </title>
          <author fullname="">
            <organization>US National Imagery and Mapping Agency</organization>
          </author>
          <date day="3" month="January" year="2000"/>
        </front>
        <seriesInfo name="NIMA" value="TR8350.2"/>
      </reference>

      <reference anchor="OGC.GML-3.1.1" target="http://portal.opengeospatial.org/files/?artifact_id=4700">
        <front>
          <title>Geographic information - Geography Markup Language (GML)</title>

          <author initials="S" surname="Cox" fullname="Simon Cox">
            <organization />
          </author>
          <author initials="P" surname="Daisey" fullname="Paul Daisey">
            <organization />
          </author>
          <author initials="R" surname="Lake" fullname="Ron Lake">
            <organization />
          </author>
          <author initials="C" surname="Portele" fullname="Clemens Portele">
            <organization />
          </author>
          <author initials="A" surname="Whiteside" fullname="Arliss Whiteside">
            <organization />
          </author>
          <date month="April" day="19" year="2004" />

          <abstract>
            <t>Geography Markup Language is an XML grammar written in XML Schema for the modelling, transport, and storage of geographic information.
            </t>
          </abstract>
        </front>

        <seriesInfo name="OpenGIS" value="03-105r1" />
      </reference>

    </references>

  </back>
</rfc>
