<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs),
please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
(Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
(using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="exp" docName="draft-irtf-iccrg-multfrc-00.txt" ipr="trust200902">
	<!-- category values: std, bcp, info, exp, and historic
	ipr values: full3667, noModification3667, noDerivatives3667
	you can add the attributes updates="NNNN" and obsoletes="NNNN"
	they will automatically be output with "(if approved)" -->

	<!-- ***** FRONT MATTER ***** -->

	<front>
		<!-- The abbreviated title is used in the page header - it is only necessary if the
		full title is longer than 39 characters -->

		<title abbrev="MulTFRC">MulTFRC: TFRC with weighted fairness</title>

		<!-- add 'role="editor"' below for the editors if appropriate -->

		<!-- Another author who claims to be an editor -->


		<author fullname="Michael Welzl" initials="M.W." surname="Welzl">
			<organization>University of Oslo</organization>

			<address>
				<postal>
					<street>PO Box 1080 Blindern</street>

					<!-- Reorder these if your country does things differently -->

					<city>Oslo</city>

					<region></region>

					<code>N-0316</code>

					<country>Norway</country>
				</postal>

				<phone>+47 22 85 24 20</phone>

				<email>michawe@ifi.uio.no</email>

			<!-- uri and facsimile elements may also be added -->
			</address>
		</author>

		<author fullname="Dragana Damjanovic" initials="D.D." surname="Damjanovic">
			<organization>University of Innsbruck</organization>

			<address>
				<postal>
					<street>Technikerstr. 21 A</street>

					<!-- Reorder these if your country does things differently -->

					<city>Innsbruck</city>

					<region></region>

					<code>A-6020</code>

					<country>Austria</country>
				</postal>

				<phone>+43 512 507 96803</phone>

				<email>dragana.damjanovic@uibk.ac.at</email>

			<!-- uri and facsimile elements may also be added -->
			</address>
		</author>
        <author fullname="Stein Gjessing" initials="S.G." surname="Gjessing">
			<organization>University of Oslo</organization>

			<address>
				<postal>
					<street>PO Box 1080 Blindern</street>

					<!-- Reorder these if your country does things differently -->

					<city>Oslo</city>

					<region></region>

					<code>N-0316</code>

					<country>Norway</country>
				</postal>

				<phone>+47 22 85 24 44</phone>

				<email>steing@ifi.uio.no</email>

			<!-- uri and facsimile elements may also be added -->
			</address>
		</author>


		<date month="July" year="2010" />

		<!-- If the month and year are both specified and are the current ones, xml2rfc will fill
		in the current day for you. If only the current year is specified, xml2rfc will fill
		in the current day and month for you. If the year is not the current one, it is
		necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the
		purpose of calculating the expiry date).  With drafts it is normally sufficient to
		specify just the year. -->

		<!-- Meta-data Declarations -->

		<area>Transport</area>

		<workgroup>Internet Engineering Task Force</workgroup>

		<!-- WG name at the upperleft corner of the doc,
		IETF is fine for individual submissions.
		If this element is not present, the default is "Network Working Group",
		which is used by the RFC Editor as a nod to the history of the IETF. -->

		<keyword>template</keyword>

		<!-- Keywords will be incorporated into HTML output
		files in a meta tag but they have no effect on text or nroff
		output. If you submit your draft to the RFC Editor, the
		keywords will be used for the search engine. -->

		<abstract>
			<t>This document specifies the MulTFRC congestion control mechanism.
			MulTFRC is derived from TFRC and can be
			implemented by carrying out a few small and simple changes to
			the original mechanism. Its behavior differs
			from TFRC in that it emulates a number of TFRC flows with more
			flexibility than what would be practical or
			even possible using multiple real TFRC flows. Additionally, MulTFRC better
			preserves the original features of TFRC than multiple real TFRCs do.
			</t>
		</abstract>
	</front>

	<middle>
		<section title="Introduction">
			<t>
				"TCP-friendliness", the requirement for a flow to behave under
				congestion like a flow produced by a conformant TCP (introduced
				by the name of "TCP-compatibility" in <xref target="RFC2309" />),
				has been put into question in recent years (cf. <xref target="Bri07" />).
				As an illustrative example, consider the fact that not all
				data transfers are of equal importance to a user. A user may
				therefore want to assign different priorities to different flows
				between two hosts, but TCP(-friendly) congestion control would
				always let these flows use the same sending rate. Users and
				their applications are now already bypassing TCP-friendliness in
				practice: since multiple TCP flows can better saturate
				a bottleneck than a single one, some applications open multiple
				connections as a simple workaround. The <xref target="All03">"GridFTP"</xref>
			protocol explicitly provides this function as a performance improvement.
			</t>

			<t>
				Some research efforts were therefore carried out to develop
				protocols where a weight can directly be applied to the congestion
				control mechanism,
				allowing a flow to be as aggressive as a number of parallel TCP flows at
				the same time. The first, and best
				known, such protocol is <xref target="Cro+98">MulTCP</xref>, which
				emulates N TCPs in a rather simple fashion. Improved versions were
				later published, e.g. <xref target="Hac+04">Stochastic TCP</xref>
				and <xref target="Kuo+08">Probe-Aided (PA-)MulTCP</xref>. These protocols
			could be called "N-TCP-friendly", i.e. as TCP-friendly as N TCPs.
			</t>

			<t>
			MulTFRC, defined in this document, does with <xref target="RFC5348">TFRC</xref> what MulTCP does
			with TCP. In <xref target="Dam+09" />, it was shown that MulTFRC
			achieves its goal of emulating N flows better than MulTCP (and
			improved versions of it) and has a number of other benefits. For
			instance, MulTFRC with N=2 is more
			reactive than two real TFRC flows are, and it has a smoother sending
			rate than two real MulTFRC flows do. Moreover, since it is only one
			mechanism, a protocol that uses MulTFRC can send a single data stream
			with the congestion control behavior of multiple data streams
			without the need to split the data and spread it over separate
			connections. Depending on the protocol in use, N real TFRC flows can also
			be expected to have N times the overhead for, e.g., connection setup
			and teardown, of a MulTFRC flow with the same value of N.
			</t>

			<t>
				The core idea of TFRC is to achieve TCP-friendliness by explicitly
				calculating an equation which approximates the steady-state throughput
				of TCP and sending as much as the calculation says. The core idea of
				MulTFRC is to replace this equation in TFRC with the algorithm
				from <xref target="Dam+08" />, which approximates the steady-state
				throughput of N TCP flows. MulTFRC can be implemented via
				a few simple changes to the TFRC code. It is therefore defined
				here by specifying how it differs from the <xref target="RFC5348">TFRC
				specification</xref>.
			</t>

		</section>

		<!--  ***** MARKER: I got as far as that ... ***** -->

		<section title="Specification">
			<t>
			This section lists the changes to <xref target="RFC5348" /> that must be
			applied to turn TFRC into MulTFRC. The small number of
			changes ensures that many original properties of a single TFRC flow are
			preserved, which is often the most appropriate choice (e.g. it
			would probably not make sense for a MulTFRC flow to detect a data-limited
			interval differently than a single TFRC flow would). It also makes MulTFRC
			easy to understand and implement. Experiments have shown that these
			changes are enough to attain the desired effect.
			</t>
			<section anchor="algorithm" title="Section 3 of RFC 5348">
				<t>
					While the TCP throughput equation requires
					the loss event rate, round-trip time and segment size
					as input, the algorithm to be used for MulTFRC
					additionally needs the number of packets lost in
					a loss event. The equation, specified in <xref target="RFC5348" /> as
					<figure>
						<artwork>
                             s
X_Bps = ----------------------------------------------------------
        R*sqrt(2*b*p/3) + (t_RTO * (3*sqrt(3*b*p/8)*p*(1+32*p^2)))
						</artwork>
					</figure>
					is replaced with the following algorithm, which returns
					X_Bps, the average transmit rate of N TCPs in bytes per second:
					<figure>
						<artwork>
If (N < 12) {
    af = N * (1-(1-1/N)^j);
} 
Else {
    af = j;
}
af=max(min(af,ceil(N)),1);
a = p*b*af*(24*N^2+p*b*af*(N-2*af)^2);
x= (af*p*b*(2*af-N)+sqrt(a))/(6*N^2*p);
q=min(2*j*b/(x*(1+3*N/j)),N);
z=t_RTO*(1+32*p^2)/(1-p);
q=min(q*z/(x*R),N);
X_Bps = ((1-q/N)/(p*x*R)+q/(z*(1-p)))*s;

						</artwork>
					</figure>
					Where:
					<list style="empty">
						
						<t>s is the segment size in bytes (excluding IP and transport protocol headers).</t>
						<t>R is the round-trip time in seconds.
						</t>
						<t>b is the maximum number of packets acknowledged by a single TCP acknowledgement.
						</t>
						<t>p is the loss event rate, between 0 and 1.0, of the number of loss events as a fraction of the number of packets transmitted.
						</t>
						<t>j is the number of packets lost in a loss event.
						</t>
						<t>t_RTO is the TCP retransmission timeout value in seconds.
						</t>
						<t>N is the number of TFRC flows that MulTFRC should emulate. N is a positive rational number; a discussion of appropriate values for this parameter, and reasons for choosing them, is provided in <xref target="sec_setting_n" />.
						</t>
						<t>ceil(N) gives the smallest integer greater than or equal to N.
						</t>
						<t>x, af, a, z and q are temporary floating point variables.
						</t>						
    					</list>
				</t>
				
                <t> <xref target="AppendixA" /> contains an argument that shows why the calculations in the algorithm will not overflow, underflow or produce significant rounding errors.
                </t>
                
				<t>Section 3.1 of <xref target="RFC5348" /> contains a recommendation for setting a parameter called t_RTO, and a simplification of the equation as a result of setting this parameter in a specific way. This part of the TFRC specification is irrelevant here, as the t_RTO parameter no longer exists. Section 3.1 of <xref target="RFC5348" /> also contains a discussion of the parameter b for delayed acknowledgements and concludes that the use of b=1 is RECOMMENDED. This is also the case for MulTFRC.
				</t>						
				
				<t>Section 3.2.2 of <xref target="RFC5348" /> specifies the contents of feedback packets. In addition to the information listed there, a MulTFRC feedback packet also carries j, the number of packets lost in a loss event.
				</t>						
				
			</section>
			<section title="Section 4 of RFC 5348">
			<t>
				The procedure for updating the allowed sending rate in section 4.3 of <xref target="RFC5348" />  ("action 4") contains the statement:
				<figure>
					<artwork>
Calculate X_Bps using the TCP throughput equation.
					</artwork>
				</figure>
				which is replaced with the statement:
				<figure>
					<artwork>
If (p==1) {
    X_Bps=s/t_mbi;
} Else {    
    Calculate X_Bps using the algorithm defined in section 3.
}
					</artwork>
				</figure>				
			</t>
			</section>
			
			<section title="Section 5 of RFC 5348">
			
				<t>
				Section 5.2 of <xref target="RFC5348" /> explains how a lost packet that 
				starts a new loss event should be distinguished from a lost packet that is 
				a part of the previous loss event interval. Here, additionally the number of 
				packets lost in a loss event is counted, and therefore this section is 
				extended with:
				</t>
				<t>
				If S_new is a part of the current loss interval LP_0 (the number of lost packets in
				the current interval) is increased by 1. On the other hand, if S_new starts a new loss 
				event, LP_0 is set to 1.
				</t>

				<t>
				Section 5.4 of <xref target="RFC5348" /> contains the algorithm for calculating the average 
				loss interval that is needed for calculation of the loss event rate, p.  MulTFRC also requires the number of lost 
				packets in a loss event, j. In <xref target="RFC5348" /> the calculation of the average loss interval is done 
				using a filter that weights the n most recent loss event intervals, and setting n to 8 is RECOMMENDED. 
				The same algorithm is used here for calculating the average loss interval. For the number of lost packets in 
				a loss event interval, j, the weighted average number of lost packets in the n most  recent loss intervals is taken and
				the same filter is used. 
				</t>
				
				<t>
				For calculating the average number of packets lost in a loss event interval we use the same loss intervals
				as for the p calculation. 
				Let LP_0 to LP_k be the number of lost packets in the k most recent loss intervals. The algorithm for calculating 
				I_mean in Section 5.4 of <xref target="RFC5348" /> (page 23) is extended by adding, after the last line ("p = 1 / I_mean;"):
				
				<figure>
					<artwork>
LP_tot = 0;
If (I_tot0 > I_tot1) {
    for (i = 0 to k-1) {
          LP_tot = LP_tot + (LP_i * w_i);
    }
} 
Else {
    for (i = 1 to k) {
          LP_tot = LP_tot + (LP_i * w_i);
    }
}
j = LP_tot/W_tot;
					</artwork>
				</figure> 
				</t> 

				<t>
				In section 5.5 of <xref target="RFC5348" /> (page 25), the algorithm that 
				ends with "p = min(W_tot0/I_tot0, W_tot1/I_tot1);" is extended by adding:
				<figure>
					<artwork>
LP_tot = 0;
If (I_tot0 > I_tot1) {
    for (i = 0 to k-1) {
        LP_tot = Lp_tot + (LP_i * w_i * DF_i * DF);
    }
    j = LP_tot/W_tot0;
} 
Else {
    for (i = 1 to k) {
        LP_tot = LP_tot + (LP_i * w_(i-1) * DF_i);
    }
    j = LP_tot/W_tot1;
}

					</artwork>
				</figure> 
				</t>
			</section>
			<section title="Section 6 of RFC 5348">
				<t>
				The steps to be carried out by the receiver when a packet is received in section 6.1 of <xref target="RFC5348" />  ("action 4") contain the statement:
				<figure>
					<artwork>
3)  Calculate p: Let the previous value of p be p_prev.  Calculate
the new value of p as described in Section 5.
					</artwork>
				</figure>
				which is replaced with the statement:
				<figure>
					<artwork>
3)  Calculate p and j: Let the previous values of p and j be p_prev
and j_prev.  Calculate the new values of p and j as described in
Section 5.
					</artwork>
				</figure>				
				</t>
				<t>
				The steps to be carried out by the receiver upon expiration of feedback timer
				in section 6.2 of <xref target="RFC5348" /> ("action 1") contain the statement:
				<figure>
					<artwork>
1)  Calculate the average loss event rate using the algorithm
       described in Section 5.
					</artwork>
				</figure>				
				which is replaced with:
				<figure>
					<artwork>
1)  Calculate the average loss event rate and average number of 
lost packets in a loss event using the algorithm described in 
Section 5.
					</artwork>
				</figure>				
				</t>
				<t>
				This statement is added at the beginning of the list of initial steps
				to take when the first packet is received, in section 6.3 of
				<xref target="RFC5348" />:
			    <list style="symbols">
			        <t>Set j = 0.</t>
			    </list>
				</t>
				<t>
				Section 6.3.1 of <xref target="RFC5348" /> discusses how the loss history is initialized 
				after the first loss event. TFRC approximates the rate to be the maximum value of X_recv 
				so far, assuming that a higher rate introduces loss. Therefore j for this rate is 
				approximated by 1 and the number of packets lost in the first interval is set to 1. This is accomplished by the following change.
				The first sentence of the fourth paragraph (in section 6.3.1) is:
				<figure>
					<artwork>
TFRC does this by finding some value, p, for which the throughput
equation in Section 3.1 gives a sending rate within 5% of X_target,
given the round-trip time R, and the first loss interval is then set
to 1/p.
					</artwork>
				</figure>
				which is replaced with:
				<figure>
					<artwork>
TFRC does this by finding some value, p, for which the throughput
equation in Section 3.1 gives a sending rate within 5% of X_target,
given the round-trip time R, and j equal to 1. The first loss 
interval is then set to 1/p.
					</artwork>
				</figure> 
				</t>
				<t>
				The second last paragraph in section 6.3.1 ends with:
				<figure>
					<artwork>
Thus, the TFRC receiver calculates the loss interval that would be 
required to produce the target rate X_target of 0.5/R packets per 
second, for the round-trip time R, and uses this synthetic loss 
interval for the first loss interval.  The TFRC receiver uses 0.5/R 
packets per second as the minimum value for X_target when 
initializing the first loss interval.

					</artwork>
				</figure>
				which is replaced with:
				<figure>
					<artwork>
Thus, the TFRC receiver calculates the loss interval that would be 
required to produce the target rate X_target of 0.5/R packets per 
second, for the round-trip time R, and for j equal to 1. This 
synthetic loss interval is used for the first loss interval. The TFRC 
receiver uses 0.5/R packets per second as the minimum value for 
X_target when initializing the first loss interval.

					</artwork>
				</figure>				
				</t>
			</section>

			<section title="Section 8 of RFC 5348">
				<t>
				Section 8.1 explains details about calculating the original TCP
				throughput equation, which was replaced with a new algorithm
				in this document. It is therefore obsolete.
				</t>
			</section>

			<section title="Appendix A of RFC 5348">
				<t>
This section provides a terminology list for TFRC, which
is extended as follows:

<figure>
	<artwork>
N:  number of emulated TFRC flows.

j:  number of packets lost in a loss event.
</artwork>
</figure>
		
				</t>
			</section>

		</section>


		<section title="Usage Considerations">
			<t>
			The "weighted fairness" service provided by a protocol
			using MulTFRC is quite different from the service provided
			by traditional Internet transport protocols. This section
			intends to answer some questions that this new service
			may raise.
			</t>

			<section title="Which applications could use MulTFRC?">
				<t>
					Like TFRC, MulTFRC is suitable for applications
					that require a smoother sending rate than standard TCP.
					Since it is likely that these would be
					multimedia applications, TFRC has largely been associated
					with them (and <xref target='RFC5348' />
					mentions "streaming media" as an example). Since timely
					transmission is often more important for them
					than reliability, multimedia applications usually do not
					keep retransmitting
					packets until their successful delivery is ensured.
					Accordingly, TFRC usage was specified for the Datagram
					Congestion Control Protocol (DCCP) <xref target='RFC4342' />,
				but not for reliable data transfers.
				</t>

				<t>MulTFRC, on the other hand, provides an altogether
				different service. For some applications, a smoother
				sending rate may not be particularly desirable but
				might also not be considered harmful, while the ability
				to emulate the congestion control of N flows may be
				useful for them. This could include reliable transfers
				such as the transmission of files. Possible reasons
				to use MulTFRC for file transfers include the assignment
				of priorities according to user preferences, increased
				efficiency with N > 1, the implementation of low-priority
				"scavenger" services and resource pooling <xref target='Wis+08' />.
				</t>
				
			</section>

			<section title="Setting N" anchor="sec_setting_n" >
				<t>N MUST be set at the beginning of a transfer; it
				MUST NOT be changed while a transfer is ongoing.
				The effects of changing N during the lifetime of
				a MulTFRC session on the dynamics of the mechanism
				are yet to be investigated; in particular, it is
				unclear how often N could safely be changed, and
				how "safely" should be defined in this context.
				Further research is required to answer these questions.
				</t>
				<t>
					N is a positive floating point number which can also
					take values between 0 and 1, making MulTFRC
					applicable as a mechanism for what has been called a
					"Lower-than-Best-Effort" (LBE) service. Since it does
					not reduce its sending rate early as delay increases,
					as some alternative proposals for such a service do
					(e.g. <xref target="Kuz+06">TCP-LP</xref>,
					<xref target="Ven+02">TCP Nice</xref> or
					<xref target="Liu+07">4CP</xref>), it can probably
				be expected to
				be more aggressive than these mechanisms if they share
				a bottleneck at the same time. This, however, also means that
				MulTFRC is less likely to be prone to starvation.
				Values between 0 and 1 could also be useful if MulTFRC
				is used across multiple paths to realize resource pooling <xref target='Wis+08' />. 
				</t>

				<t>Setting N to 1 is also possible. In this case, the
				only difference between TFRC and MulTFRC is that the
				underlying model of TFRC assumes that all remaining
				packets following a dropped packet in a "round"
				(less than one round-trip time apart) are
				also dropped, whereas the underlying model of MulTFRC
				does not have this assumption. Whether it
				is correct or not depends on the specific network
				situation; large windows and other queuing schemes
				than Drop-Tail make it less likely for
				the assumption to match reality. This document does
				not make any recommendation about which mechanism
				to use if only one flow is desired.
				</t>
				
				<t>
				Since TCP has been extensively studied, and the aggression
				of its congestion control mechanism is emulated by TFRC,
				we can look at the behavior of a TCP aggregate in order
				to find a reasonable upper limit for N in MulTFRC.
				From <xref target="Alt+06" />, N TCPs (assuming
				non-sychronized loss events over connections) can saturate
				a bottleneck link by roughly 100-100/(1+3N) percent. This means
				that a single flow can only achieve 75% utilization, whereas
				3 flows already achieve 90%. The theoretical gain that can
				be achieved by adding a flow declines with the total number
				of flows - e.g., while going from 1 to 2 flows is a 14.3%
				performance gain, the gain becomes less than 1% beyond 6 flows
				(which already achieve 95% link utilization). Since the
				link utilization of MulTFRC can be expected to be roughly
				the same as the link utilization of multiple TCPs, the
				approximation above also holds for MulTFRC. Thus,
				setting N to a much larger value than the values mentioned
				above will only yield a marginal benefit in isolation but
				can significantly affect other traffic. Therefore, the
				maximum value that a user can set for MulTFRC SHOULD NOT
				exceed 6.
				</t>
                
                <t>
				Note that the model in <xref target="Alt+06" />, and hence the above discussion,
                considers the long-term steady-state behavior of TCP, which may not always be
                seen when the bandwidth*delay product is very large <xref target="RFC3649" />.
                This is due to TCP's slow congestion window growth in the congestion avoidance phase.
                While a MulTFRC flow with N > 1 can generally be expected to outperform a single standard
                TCP flow if N is large enough, such usage of MulTFRC is not recommended as
                a fix to the problem of saturating very large bandwidth*delay product paths:
                in order to always achieve good bottleneck utilization
                with MulTFRC under such conditions, N would have to be a function of the bandwidth*delay
                product. In other words, the mechanism does not scale with bandwidth and delay;
                very large bandwidth or delay values may require very large values for N,
                leading to a behavior which is overly aggressive but possibly worse in terms of
                performance than mechanisms such as HighSpeed TCP <xref target="RFC3649" />, which
                are specifically designed for such situations. The same argument applies
                for running multiple TCP flows, as in <xref target="All03" />.
				</t>


			</section>


		</section>


		<section anchor="Security" title="Security Considerations">
				<t>
It is well known that a single uncontrolled UDP flow
can cause significant harm to a large number of TCP flows
that share the same bottleneck. This potential danger
is due to the total lack of congestion control in UDP.
Because this problem is well known, and because UDP is easy
to detect, UDP traffic will often be rate limited by
service providers.
</t>

<t>
If MulTFRC is used within a protocol such as DCCP,
which will normally not be considered harmful and
will therefore typically not be rate-limited, its
tunable aggression could theoretically make it
possible to use it for a Denial-of-Service (DoS)
attack. In order to avoid such usage, the maximum
value of N MUST be restricted. If, as recommended
in this document, the maximum value for N is
restricted to 6, the impact of MulTFRC on TCP is
roughly the same as the impact of 6 TCP flows would
be. It is clear that the conjoint congestion control
behavior of 6 TCPs is far from being such an attack.
</t>

<t>
With transport protocols such as TCP, SCTP or DCCP,
users can already be more aggressive than others by
opening multiple connections. If MulTFRC is used
within a transport protocol, this effect becomes
more pronounced - e.g., 2 connections with N set to
6 for each of them roughly exhibit the same congestion
control behavior as 12 TCP flows. The N limit SHOULD
therefore be implemented as a system wide parameter
such that the sum of the N values of all MulTFRC
connections does not exceed it. Alternatively, the
number of connections that can be opened could be
restricted.
</t>
		</section>
	
		
		<section anchor="Acknowledgements" title="Acknowledgements">
			<t>This work was partially funded by the EU IST project EC-GIN under the contract STREP FP6-2006-IST-045256.</t>
			
		</section>
		
		<!-- Possibly a 'Contributors' section ... -->
	
    
    

 	</middle>




	<!--  *****BACK MATTER ***** -->

	<back>
		<!-- References split into informative and normative -->

		<!-- There are 2 ways to insert reference entries from the citation libraries:
		1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
		2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
		(for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

		Both are cited textually in the same manner: by using xref elements.
		If you use the PI option, xml2rfc will, by default, try to find included files in the same
		directory as the including file. You can also define the XML_LIBRARY environment variable
		with a value containing a set of directories to search.  These can be either in the local
		filing system or remote ones accessed by http (http://domain/dir/... ).-->


		<references title="Normative References">
			<!-- Here we use entities that we defined at the beginning. -->

			<reference anchor='RFC5348'>

				<front>
					<title>TCP Friendly Rate Control (TFRC): Protocol Specification</title>
					<author initials='S.' surname='Floyd' fullname='S. Floyd'>
					<organization /></author>
					<author initials='M.' surname='Handley' fullname='M. Handley'>
					<organization /></author>
					<author initials='J.' surname='Padhye' fullname='J. Padhye'>
					<organization /></author>
					<author initials='J.' surname='Widmer' fullname='J. Widmer'>
					<organization /></author>
					<date year='2008' month='September' />
					<abstract>
				<t>This document specifies TCP Friendly Rate Control (TFRC). TFRC is a congestion control mechanism for unicast flows operating in a best-effort Internet environment. It is reasonably fair when competing for bandwidth with TCP flows, but has a much lower variation of throughput over time compared with TCP, making it more suitable for applications such as streaming media where a relatively smooth sending rate is of importance.&lt;/t>&lt;t> This document obsoletes RFC 3448 and updates RFC 4342. [STANDARDS TRACK]</t></abstract></front>

				<seriesInfo name='RFC' value='5348' />
				<format type='TXT' octets='133185' target='ftp://ftp.isi.edu/in-notes/rfc5348.txt' />
			</reference>


		</references>

		<references title="Informative References">
			<!-- Here we use entities that we defined at the beginning. -->

			<reference anchor='Dam+09'>
				<front>
					<title>MulTFRC: Providing Weighted Fairness for Multimedia Applications (and others too!)</title>
					<author initials='D.' surname='Damjanovic' fullname='Dragana Damjanovic'>
					<organization /></author>
					<author initials='M.' surname='Welzl' fullname='Michael Welzl'>
					<organization /></author>
					<date year='2009' />
				</front>

				<seriesInfo name='ACM SIGCOMM Computer Communication Review' value='vol. 39, issue 9 (July 2009)' />
			</reference>

			<reference anchor='Dam+08'>
				<front>
					<title>Extending the TCP Steady-State Throughput Equation for Parallel TCP Flows</title>
					<author initials='D.' surname='Damjanovic' fullname='Dragana Damjanovic'>
					<organization /></author>
					<author initials='M.' surname='Welzl' fullname='Michael Welzl'>
					<organization /></author>
					<author initials='M.' surname='Telek' fullname='Miklos Telek'>
					<organization /></author>
					<author initials='W.' surname='Heiss' fullname='Werner Heiss'>
					<organization /></author>
					<date year='2008' month='August' />
				</front>

				<seriesInfo name='University of Innsbruck, Institute of Computer Science, DPS NSG Technical Report' value='2' />
			</reference>


			<reference anchor='Cro+98'>
				<front>
					<title>Differentiated end-to-end Internet services using a weighted proportional fair sharing TCP</title>
					<author initials='J.' surname='Crowcroft' fullname='Jon Crowcroft'>
					<organization /></author>
					<author initials='P.' surname='Oechslin' fullname='Philippe Oechslin'>
					<organization /></author>
					<date year='1998' />
				</front>

				<seriesInfo name='ACM SIGCOMM Computer Communication Review' value='vol. 28, no. 3 (July 1998), pp. 53-69' />
			</reference>

			<reference anchor='Kuo+08'>
				<front>
					<title>Probe-Aided MulTCP: an aggregate congestion control mechanism</title>
					<author initials='F.-C.' surname='Kuo' fullname='Fang-Chun Kuo'>
					<organization /></author>
					<author initials='X.' surname='Fu' fullname='Xiaoming Fu'>
					<organization /></author>
					<date year='2008' />
				</front>

				<seriesInfo name='ACM SIGCOMM Computer Communication Review' value='vol. 38, no. 1 (January 2008), pp. 17-28' />
			</reference>

			<reference anchor='Bri07'>
				<front>
					<title>Flow rate fairness: dismantling a religion</title>
					<author initials='B.' surname='Briscoe' fullname='Bob Briscoe'>
					<organization /></author>
					<date year='2007' month='April' />
				</front>

				<seriesInfo name='ACM SIGCOMM Computer Communication Review' value='vol. 37, no. 2, (April 2007), pp. 63-74' />
			</reference>

			<reference anchor='RFC2309'>

				<front>
					<title abbrev='Internet Performance Recommendations'>Recommendations on Queue Management and Congestion Avoidance in the Internet</title>
					<author initials='B.' surname='Braden' fullname='Bob Braden'>
						<organization>USC Information Sciences Institute</organization>
						<address>
							<postal>
								<street>4676 Admiralty Way</street>
								<city>Marina del Rey</city>
								<region>CA</region>
							<code>90292</code></postal>
							<phone>310-822-1511</phone>
					<email>Braden@ISI.EDU</email></address></author>
					<author initials='D.D.' surname='Clark' fullname='David D. Clark'>
						<organization>MIT Laboratory for Computer Science</organization>
						<address>
							<postal>
								<street>545 Technology Sq.</street>
								<city>Cambridge</city>
								<region>MA</region>
							<code>02139</code></postal>
							<phone>617-253-6003</phone>
					<email>DDC@lcs.mit.edu</email></address></author>
					<author initials='J.' surname='Crowcroft' fullname='Jon Crowcroft'>
						<organization>University College London</organization>
						<address>
							<postal>
								<street>Department of Computer Science</street>
								<street>Gower Street</street>
								<street>London, WC1E 6BT</street>
							<street>ENGLAND</street></postal>
							<phone>+44 171 380 7296</phone>
					<email>Jon.Crowcroft@cs.ucl.ac.uk</email></address></author>
					<author initials='B.' surname='Davie' fullname='Bruce Davie'>
						<organization>Cisco Systems, Inc.</organization>
						<address>
							<postal>
								<street>250 Apollo Drive</street>
								<city>Chelmsford</city>
								<region>MA</region>
							<code>01824</code></postal>
					<email>bdavie@cisco.com</email></address></author>
					<author initials='S.' surname='Deering' fullname='Steve Deering'>
						<organization>Cisco Systems, Inc.</organization>
						<address>
							<postal>
								<street>170 West Tasman Drive</street>
								<city>San Jose</city>
								<region>CA</region>
							<code>95134-1706</code></postal>
							<phone>408-527-8213</phone>
					<email>deering@cisco.com</email></address></author>
					<author initials='D.' surname='Estrin' fullname='Deborah Estrin'>
						<organization>USC Information Sciences Institute</organization>
						<address>
							<postal>
								<street>4676 Admiralty Way</street>
								<city>Marina del Rey</city>
								<region>CA</region>
							<code>90292</code></postal>
							<phone>310-822-1511</phone>
					<email>Estrin@usc.edu</email></address></author>
					<author initials='S.' surname='Floyd' fullname='Sally Floyd'>
						<organization>Lawrence Berkeley National Laboratory, MS 50B-2239, One Cyclotron Road, Berkeley CA 94720</organization>
						<address>
							<phone>510-486-7518</phone>
					<email>Floyd@ee.lbl.gov</email></address></author>
					<author initials='V.' surname='Jacobson' fullname='Van Jacobson'>
						<organization>Lawrence Berkeley National Laboratory, MS 46A, One Cyclotron Road, Berkeley CA 94720</organization>
						<address>
							<phone>510-486-7519</phone>
					<email>Van@ee.lbl.gov</email></address></author>
					<author initials='G.' surname='Minshall' fullname='Greg Minshall'>
						<organization>Fiberlane Communications</organization>
						<address>
							<postal>
								<street>1399 Charleston Road</street>
								<city>Mountain View</city>
								<region>CA</region>
							<code>94043</code></postal>
							<phone>+1 650 237 3164</phone>
					<email>Minshall@fiberlane.com</email></address></author>
					<author initials='C.' surname='Partridge' fullname='Craig Partridge'>
						<organization>BBN Technologies</organization>
						<address>
							<postal>
								<street>10 Moulton St.</street>
							<street>Cambridge MA 02138</street></postal>
							<phone>510-558-8675</phone>
					<email>craig@bbn.com</email></address></author>
					<author initials='L.' surname='Peterson' fullname='Larry Peterson'>
						<organization>Department of Computer Science</organization>
						<address>
							<postal>
								<street>University of Arizona</street>
								<city>Tucson</city>
								<region>AZ</region>
							<code>85721</code></postal>
							<phone>520-621-4231</phone>
					<email>LLP@cs.arizona.edu</email></address></author>
					<author initials='K.K.' surname='Ramakrishnan' fullname='K.K. Ramakrishnan'>
						<organization>AT&amp;T Labs. Research</organization>
						<address>
							<postal>
								<street>Rm. A155</street>
								<street>180 Park Avenue</street>
							<street>Florham Park, N.J. 07932</street></postal>
							<phone>973-360-8766</phone>
					<email>KKRama@research.att.com</email></address></author>
					<author initials='S.' surname='Shenker' fullname='Scott Shenker'>
						<organization>Xerox PARC</organization>
						<address>
							<postal>
								<street>3333 Coyote Hill Road</street>
								<city>Palo Alto</city>
								<region>CA</region>
							<code>94304</code></postal>
							<phone>415-812-4840</phone>
					<email>Shenker@parc.xerox.com</email></address></author>
					<author initials='J.' surname='Wroclawski' fullname='John Wroclawski'>
						<organization>MIT Laboratory for Computer Science</organization>
						<address>
							<postal>
								<street>545 Technology Sq.</street>
								<city>Cambridge</city>
								<region>MA</region>
							<code>02139</code></postal>
							<phone>617-253-7885</phone>
					<email>JTW@lcs.mit.edu</email></address></author>
					<author initials='L.' surname='Zhang' fullname='Lixia Zhang'>
						<organization>UCLA</organization>
						<address>
							<postal>
								<street>4531G Boelter Hall</street>
								<city>Los Angeles</city>
								<region>CA</region>
							<code>90024</code></postal>
							<phone>310-825-2695</phone>
					<email>Lixia@cs.ucla.edu</email></address></author>
					<date year='1998' month='April' />
					<area>Routing</area>
					<keyword>congestion</keyword>
					<abstract>
						<t>

				This memo presents two recommendations to the Internet community

				concerning measures to improve and preserve Internet performance.

				It presents a strong recommendation for testing, standardization,

				and widespread deployment of active queue management in routers,

				to improve the performance of today's Internet.  It also urges a

				concerted effort of research, measurement, and ultimate deployment

				of router mechanisms to protect the Internet from flows that are

				not sufficiently responsive to congestion notification.
				</t></abstract></front>

				<seriesInfo name='RFC' value='2309' />
				<format type='TXT' octets='38079' target='ftp://ftp.isi.edu/in-notes/rfc2309.txt' />
				<format type='HTML' octets='54015' target='http://xml.resource.org/public/rfc/html/rfc2309.html' />
				<format type='XML' octets='42517' target='http://xml.resource.org/public/rfc/xml/rfc2309.xml' />
			</reference>

			<reference anchor='All03'>
				<front>
					<title>GridFTP: Protocol Extensions to FTP for the Grid</title>
					<author initials='W.' surname='Allcock' fullname='W. Allcock'>
					<organization /></author>
					<date year='2003' />
				</front>

				<seriesInfo name='Open Grid Forum Document' value='GFD.20' />
			</reference>



			<reference anchor='RFC4342'>

				<front>
					<title>Profile for Datagram Congestion Control Protocol (DCCP) Congestion Control ID 3: TCP-Friendly Rate Control (TFRC)</title>
					<author initials='S.' surname='Floyd' fullname='S. Floyd'>
					<organization /></author>
					<author initials='E.' surname='Kohler' fullname='E. Kohler'>
					<organization /></author>
					<author initials='J.' surname='Padhye' fullname='J. Padhye'>
					<organization /></author>
					<date year='2006' month='March' />
					<abstract>
				<t>This document contains the profile for Congestion Control Identifier 3, TCP-Friendly Rate Control (TFRC), in the Datagram Congestion Control Protocol (DCCP).  CCID 3 should be used by senders that want a TCP-friendly sending rate, possibly with Explicit Congestion Notification (ECN), while minimizing abrupt rate changes. [STANDARDS TRACK]</t></abstract></front>

				<seriesInfo name='RFC' value='4342' />
				<format type='TXT' octets='83054' target='ftp://ftp.isi.edu/in-notes/rfc4342.txt' />
			</reference>

			<reference anchor="Wis+08" target="http://www.cs.ucl.ac.uk/staff/d.wischik/Research/respool.html">
				<front>
					<title>The Resource Pooling Principle</title>

					<author initials="D." surname="Wischik">
						<organization></organization>
					</author>
					<author initials="M." surname="Handley">
						<organization></organization>
					</author>
					<author initials="M. B." surname="Braun">
						<organization></organization>
					</author>

					<date year="2008" month="October" />
				</front>
				<seriesInfo name="ACM Computer Communication Review" value=" Volume 38, Issue 5 (October 2008)" />
			</reference>

			<reference anchor="Kuz+06" target="http://www.ece.rice.edu/networks/TCP-LP/">
				<front>
					<title>TCP-LP: low-priority service via end-point congestion control</title>

					<author initials="A." surname="Kuzmanovic">
						<organization></organization>
					</author>
					<author initials="E. W." surname="Knightly">
						<organization></organization>
					</author>

					<date year="2006" month="August" />
				</front>
				<seriesInfo name="IEEE/ACM Transactions on Networking (ToN)" value=" Volume 14, Issue 4, pp. 739-752." />
			</reference>

			<reference anchor="Ven+02" target="">
				<front>
					<title>TCP Nice: a mechanism for background transfers</title>

					<author initials="A." surname="Venkataramani" fullname="Arun Venkataramani">
						<organization></organization>
					</author>
					<author initials="R." surname="Kokku" fullname="Ravi Kokku">
						<organization></organization>
					</author>
					<author initials="M." surname="Dahlin" fullname="Mike Dahlin">
						<organization></organization>
					</author>

					<date year="2002" />
				</front>
				<seriesInfo name="Proceedings of OSDI" value="'02" />
			</reference>

			<reference anchor="Liu+07" target="">
				<front>
					<title>Competitive and Considerate Congestion Control for Bulk Data Transfers</title>

					<author initials="S." surname="Liu" fullname="Shao Liu">
						<organization></organization>
					</author>
					<author initials="M." surname="Vojnovic" fullname="Milan Vojnovic">
						<organization></organization>
					</author>
					<author initials="D." surname="Gunawardena" fullname="Dinan Gunawardena">
						<organization></organization>
					</author>

					<date year="2007" month="June" />
				</front>
				<seriesInfo name="Proceedings of IWQoS" value="2007" />
			</reference>



			<!--  *****END OF TRULY IMPORTANT REFERENCES ***** -->




			<reference anchor="Alt+06" target="">
				<front>
					<title>Parallel TCP Sockets: Simple Model, Throughput and Validation</title>

					<author initials="E. A." surname="Altman" fullname="E. Altman">
						<organization></organization>
					</author>
					<author initials="D. B." surname="Barman" fullname="D. Barman">
						<organization></organization>
					</author>
					<author initials="B. T." surname="Tuffin" fullname="B. Tuffin">
						<organization></organization>
					</author>
					<author initials="M. V." surname="Vojnovic" fullname="M. Vojnovic">
						<organization></organization>
					</author>

					<date year="2006" month="April" />
				</front>
				<seriesInfo name="Proceedings of Infocom" value="2006" />
			</reference>


			<reference anchor="Hac+04" target="">
				<front>
					<title>Improving Throughput and Maintaining Fairness using Parallel TCP</title>

					<author initials="T. J." surname="Hacker" fullname="T. J. Hacker">
						<organization></organization>
					</author>
					<author initials="B. D." surname="Noble" fullname="Brian D. Noble">
						<organization></organization>
					</author>
					<author initials="B. D." surname="Athey" fullname="Brian D. Athey">
						<organization></organization>
					</author>

					<date year="2004" month="March" />
				</front>
				<seriesInfo name="Proceedings of Infocom" value="2004" />
			</reference>
            
            <reference anchor='RFC3649'>

<front>
<title>HighSpeed TCP for Large Congestion Windows</title>
<author initials='S.' surname='Floyd' fullname='S. Floyd'>
<organization /></author>
<date year='2003' month='December' />
<abstract>
<t>The proposals in this document are experimental.  While they may be deployed in the current Internet, they do not represent a consensus that this is the best method for high-speed congestion control.  In particular, we note that alternative experimental proposals are likely to be forthcoming, and it is not well understood how the proposals in this document will interact with such alternative proposals.  This document proposes HighSpeed TCP, a modification to TCP's congestion control mechanism for use with TCP connections with large congestion windows.  The congestion control mechanisms of the current Standard TCP constrains the congestion windows that can be achieved by TCP in realistic environments.  For example, for a Standard TCP connection with 1500-byte packets and a 100 ms round-trip time, achieving a steady-state throughput of 10 Gbps would require an average congestion window of 83,333 segments, and a packet drop rate of at most one congestion event every 5,000,000,000 packets (or equivalently, at most one congestion event every 1 2/3 hours).  This is widely acknowledged as an unrealistic constraint.  To address his limitation of TCP, this document proposes HighSpeed TCP, and solicits experimentation and feedback from the wider community.</t></abstract></front>

<seriesInfo name='RFC' value='3649' />
<format type='TXT' octets='79801' target='http://www.rfc-editor.org/rfc/rfc3649.txt' />
</reference>

            

<!--  			
*** We do not need this now, but maybe we will, in the next update?
***

			<reference anchor='Ott+04'>
				<front>
					<title>Aggregate congestion control for distributed multimedia applications</title>
					<author initials='D. E.' surname='Ott'>
					<organization /></author>
					<author initials='T.' surname='Sparks'>
					<organization /></author>
					<author initials='K.' surname='Mayer-Patel'>
					<organization /></author>
					<date year='2004' month='March' />
				</front>

				<seriesInfo name='Proceedings of Infocom' value='2004' />
			</reference>
-->



		</references>

       
    <section anchor="AppendixA" title="X_Bps implementation considerations" toc="default">
    
    <t>In this appendix we show why the algorithm for calculating X_Bps in <xref target="algorithm" />  contains integer and floating
point arithmetic that will not give underflow, overflow or rounding errors that
will adversely affect the result of the algorithm.
Note that the algorithm is not invoked when p == 1. p is computed in section 5.4 
of <xref target="RFC5348" />.
If p is equal to 1  there is exactly  one packet in each loss interval (and this will be an  ECN-marked packet).</t>


<t>Assuming that the rest of the parameters are not outside their conceivable values,  the calculation of X_Bps in <xref target="algorithm" /> could lead to arithmetic errors or large imprecision only if p is very close to 1. However this will never happen because p is calculated as 1/I_mean in section 5.4 of <xref target="RFC5348" />. The algorithm that calculates I_mean does so by a weighted average of the number of packets in the last n loss events.  If n == 8 and the weights are set as defined in 
<xref target="RFC5348" />,  the smallest possible value of I_mean will be 1.033333.  The reason for this is that  the number of packets in a loss event is a positive integer  and the smallest value (not equal to 1) is found when all recent intervals are of length 1, but the oldest interval  (number 8 in this case) is of length two. All other sizes of loss intervals and smaller values of n will give higher values for I_mean and hence lower values for p.
<!-- Note that very large numbers of n might (however extremely unlikely) lead to values of p that are close to 1 and then could make the calculation of the algorithm in <xref target="algorithm" /> unstable. -->
</t>

<t>Below we analyze the algorithm that calculates X_Bps, and see that it will always execute without any overflow, underflows or large rounding errors.  In this analysis we assume that no parameter has an improper value.  We say that a calculation is "sound" when no overflow, underflow or significant rounding may occur during the calculation. </t>
<!--Even if arithmetic with shorter number representation could have been used, we assume at least 32 bit floating point numbers.  IEEE ??? -->


<t>In the first lines of the algorithm, af is calculated, and it is easy to see that the calculation is sound and that the value of af will end up between 1 and N+1.
In the calculation of a, N may be equal to or close to af/2, and then the expression (p*b*af*(N-2*af)^2) may evaluate to a number very close to 0. However, (24*N^2) is added, and hence the calculation of a is sound, as the values of p, b and N are neither extremely small nor extremely large. Note that a will be a smaller value when p is a smaller value.</t>

<t>When x is calculated there will be no problem to find the root of a, and then add it to (af*p*b*(2*af-N)), which again might be a very small value.  The final calculation of x involves a division by (6*p*N^2). However when p is small, the dividend is not very large (dominated by p and a), hence the calculation of x is sound and the result will neither be a very large nor a very small number.
However, we need to show that x will not be 0 or negative, otherwise the algorithm will try a division by 0, or, if x is negative, the calculation of X_Bps could turn out to be a negative value.</t>

<t>We show that x is a positive rational number (and not 0) by defining W=p*b*af,  Y=2*af-N and D=6*N^2*p.  Then the assignment to x can be written as

x= (W*Y + sqrt(W*24*N^2 + W^2 * (-Y)^2 ))  /  D.

If we subtract  W*24*N^2 from the argument to the sqrt-function, we get an expression that is obviously smaller, hence after the assignment to x, this inequality holds:

x > (W*Y + sqrt(W^2 * (-Y)^2) ) / D.

Simplifying the right hand side gives:

x >  (W*Y - W*Y) / D,

that is:    x > 0.
</t>

<t>From this argument it is also clear that x is not close to 0, so that the divisons by x (or x*R) that we will see later in the algorithm will give a sound result.
Since neither x nor j is 0, or close to 0, when the right hand side in the first assignment to q is executed,
the calculation of the first parameter to the min function is sound.
Then z is found by division by 1-p, witch is sound when p is not close to 1 (which we have argued above it is not).
When q is assigned a value the second time,  again the calculation of the first parameter of the min function is sound because x*R is not a value close to 0.</t>

<t>Finally X_Bps is calculated and since p is not close to one (and hence (1-p) is not close to 0), and since (p*x*R) is not close to 0, this final calculation is also sound.
</t>
    
    
    
    </section>
    
	</back>
</rfc>