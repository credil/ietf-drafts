<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" >
<rfc ipr="full3978" docName="draft-moncaster-pcn-baseline-encoding-00" category="std">
<?xml-stylesheet type='text/xsl' href='http://xml.resource.org/authoring/rfc2629.xslt' ?>

<!-- Alterations to I-D/RFC boilerplate -->
<?rfc private="" ?>    <!-- Default private="" Produce an internal memo 2.5pp shorter than an I-D or RFC -->
<?rfc topblock="yes" ?>    <!-- Default topblock="yes" put the famous header block on the first page -->
<?rfc footer="" ?>    <!-- Default footer="Expires <date>" override the center footer string -->
<?rfc header="" ?>    <!-- Default header="Internet-Draft" override the leftmost header string -->
<?rfc authorship="yes" ?>    <!-- Default authorship="yes" Render authors' addresses section -->
<?rfc rfcprocack="yes" ?>    <!-- Default rfcprocack="no" add a short sentence acknowledging xml2rfc -->
<?rfc strict="no" ?>    <!-- Default strict="no" Don't check I-D nits -->
<?rfc rfcedstyle="no" ?>    <!-- Default rfcedstyle="yes" attempt to closely follow finer details from the latest observable RFC-Editor style -->

<!-- IETF process -->
<?rfc iprnotified="no" ?> <!-- Default iprnotified="no" I haven't disclosed existence of IPR to IETF -->

<!-- ToC format -->
<?rfc toc="yes" ?>      <!-- Default toc="no" No Table of Contents -->
<?rfc tocappendix="yes" ?>    <!-- Default tocappendix="yes" control whether the word `Appendix' appears in the table-of-content -->
<?rfc tocdepth="3" ?>    <!-- Default tocdepth="3" if toc is "yes", then this determines the depth of the table-of-contents -->
<?rfc tocindent="yes" ?>    <!-- Default tocindent="yes" if toc is "yes", indent subsections in the table-of-contents -->
<?rfc tocnarrow="yes" ?>    <!-- Default tocnarrow="yes" affects horizontal spacing in the table-of-content -->
<?rfc tocompact="yes" ?>    <!-- Default tocompact="yes" if toc is "yes", then setting this to "no" will make it a little less compact -->

<!-- Cross referencing, footnotes, comments -->
<?rfc symrefs="yes" ?>  <!-- Default symrefs="no" Don't use anchors, but use numbers for refs -->
<?rfc sortrefs="yes"?>  <!-- Default sortrefs="no" Don't sort references into order -->
<?rfc comments="yes" ?>    <!-- Default comments="no" Don't render comments -->
<?rfc inline="no" ?>    <!-- Default inline="no" if comments is "yes", then render comments inline; otherwise render them in an `Editorial Comments' section -->
<?rfc editing="no" ?>    <!-- Default editing="no" Don't insert editing marks for ease of discussing draft versions -->

<!-- Pagination control -->
<?rfc compact="yes"?>   <!-- Default compact="no" Start sections on new pages -->
<?rfc subcompact="no"?> <!-- Default subcompact="(as compact setting)" yes/no is not quite as compact as yes/yes -->
<?rfc autobreaks="yes" ?>    <!-- Default autobreaks="yes" avoid widows and orphans (not perfect) -->

<!-- HTML formatting control -->
<?rfc emoticonic="yes" ?>    <!-- Default emoticonic="no" Doesn't prettify HTML format -->
<?rfc background="" ?>    <!-- Default background="" when producing a html file, use this image -->
<?rfc useobject="no" ?>    <!-- Default useobject="no" use <object> not <src> when outputting HTML -->
<?rfc linkmailto="yes" ?>    <!-- Default linkmailto="yes" generate mailto: URL, as appropriate -->


    <front>
        <title abbrev="Baseline PCN Encoding">
            Encoding and Transport of (Pre-)Congestion Information from within a DiffServ Domain to the Egress
        </title>
        <author initials="T." surname="Moncaster" fullname="Toby Moncaster">
            <organization>BT</organization>
            <address>
                <postal>
                    <street>B54/70, Adastral Park</street>
                    <street>Martlesham Heath</street>
                    <city>Ipswich</city>
                    <code>IP5 3RE</code>
                    <country>UK</country>
                </postal>
                <phone>+44 1473 648734</phone>
                <email>toby.moncaster@bt.com</email>
                <uri>http://www.cs.ucl.ac.uk/staff/B.Briscoe/</uri>
            </address>
        </author>
        <author initials="B." surname="Briscoe" fullname="Bob Briscoe">
            <organization>BT &amp; UCL</organization>
            <address>
                <postal>
                    <street>B54/77, Adastral Park</street>
                    <street>Martlesham Heath</street>
                    <city>Ipswich</city>
                    <code>IP5 3RE</code>
                    <country>UK</country>
                </postal>
                <phone>+44 1473 645196</phone>
                <email>bob.briscoe@bt.com</email>
            </address>
        </author>
        <author initials="M." surname="Menth" fullname="Michael Menth">
            <organization>University of Wuerzburg</organization>
            <address>
                <postal>
                    <street>room B206, Institute of Computer Science</street>
                    <street>Am Hubland</street>
                    <city> Wuerzburg</city>
                    <code>D-97074</code>
                    <country>Germany</country>
                </postal>
                <phone>+49 931 888 6644</phone>
                <email>menth@informatik.uni-wuerzburg.de</email>
            </address>
        </author>
        <date day="15" month="May" year="2008"></date>
        <area>Transport</area>
        <workgroup>Congestion and Pre Congestion</workgroup>
        <keyword>Quality of Service</keyword>
        <keyword>QoS</keyword>
        <keyword>Congestion Control</keyword>
        <keyword>Differentiated Services</keyword>
        <keyword>Admission Control</keyword>
        <keyword>Signalling</keyword>
        <keyword>Protocol</keyword>
        <keyword>Pre-emption</keyword>
        <abstract>
            <t>Pre-congestion notification (PCN) is a mechanism designed to protect the Quality of Service of inelastic flows. It does this by marking packets when traffic load on a link is approaching or has exceeded a threshold below the physical link rate. This document specifies how such marks are to be encoded into the IP header. The baseline encoding described here provides for two PCN encoding states.
            </t>
        </abstract>

<!-- ================================================================ -->
<note title="Status">
    <t>This memo is posted as an Internet-Draft with an intent to eventually progress to standards track.
    </t>
</note>
    </front>
    
    
<middle>

<!-- ================================================================ -->
<section anchor="pcn_enc_intro" title="Introduction">

    <t>
         Pre-congestion notification is a mechanism designed to help protect the Quality of Service of inelastic flows. It does this by measuring the pre-congestion level on the path used by that flow. The pre-congestion level at each node is indicated by marking packets when traffic load is approaching or has exceeded a threshold below the physical link rate. <xref target="PCN-arch"></xref> describes how PCN marking can be used to assure the quality of service of inelastic flows within a single DiffServ domain. This document specifies how those PCN marks are encoded into the IP header. It also describes how packets are identified as belonging to a PCN flow. The baseline encoding described here provides for two PCN encoding states.

    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_Reqs_notation" title="Requirements notation">

    <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119"></xref>.
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_terminology" title="Terminology">

    <t>  The following terms are used in this document:
   <list style="symbols">
<t>Not PCN - packets that are not PCN capable.</t>
<t>PCN-marked - codepoint indicating packets that have been marked at a PCN interior node using some PCN marking behaviour. Also PM.</t>
<t>Not-Marked - codepoint indicating packets that are PCN capable but are not PCN-marked. Also NM.</t> 
<t>PCN-Capable codepoints - collective term for all the NM and PM codepoints.</t>
<t>PCN enabled Diffserv codepoint - a Diffserv codepoint for which PCN has been enabled on a particular machine.</t>
 </list>
In addition the document uses the terminology described in <xref target="PCN-arch"></xref>.
</t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_IP" title="Encoding Two PCN States in IP">

<t> 
   The PCN encoding states are defined using a combination of the DSCP field and ECN field in the IP header. The baseline PCN encoding closely follows the semantics of ECN [RFC3168]. It allows the encoding of two PCN states: Not Marked and PCN-Marked. It also allows for traffic that is not PCN capable to be marked as such (Not-PCN). The following table defines how to encode these states in IP: 
<texttable anchor="pcn_enc_Tab_Default_coding" title="Encoding PCN in IP">
    <ttcol align="center">DSCP</ttcol>
    <ttcol align="center">Not-ECT (00)</ttcol>
    <ttcol align="center">ECT(0) (10)</ttcol>
    <ttcol align="center">ECT(1) (01)</ttcol>
    <ttcol align="center">CE (11)</ttcol>
    <c>DSCP n</c><c>Not-PCN</c><c>NM</c><c>NM</c><c>PM</c>
     <postamble>Where DSCP n is a PCN-enabled DiffServ codepoint (see <xref target="pcn_enc_DSCPs"></xref>)</postamble>
 </texttable>
 </t>
 <t>
The following rules apply to all PCN traffic:
<list style="symbols">
<t>PCN traffic MUST be marked with a DiffServ codepoint that indicates PCN is enabled. To conserve DSCPs, DiffServ Codepoints SHOULD be chosen that are already defined for use with admission controlled traffic, such as the Voice-Admit codepoint defined in <xref target="voice-admit"></xref>.  </t>
<t>Any packet that is not PCN capable (Not-PCN) but which shares the same DiffServ codepoint as PCN capable traffic MUST have the ECN field set to 00.  </t>
<t>Any packet that is PCN capable and Not Marked (NM) MUST have the ECN field set to one of the two ECT codepoints 10 or 01.</t>
<t>Any packet that is PCN capable and has been PCN-marked by an interior node MUST have the ECN field set to 11. </t>
 </list> 
</t>

<!-- ================================================================ -->
<section anchor="pcn_enc_rationale" title="Rationale for Encoding">

<t> 
 The exact choice of encoding was dictated by the constraints imposed by existing IETF RFCs. Full details are contained in <xref target="pcn-enc-compare"></xref>. One of the tightest constraints was the need for any PCN encoding to survive being tunnelled through either an IP in IP tunnel or an IPSec Tunnel. 
 <xref target="pcn_enc_app_tunnel"></xref> explains this in more detail. The main effect of this constraint was that any PCN marking has to use the ECN field set to 11 (CE codepoint).  An additional constraint was the need to minimise the use of DiffServ codepoints as these are in increasingly short supply. <xref target="pcn_enc_DSCPs"></xref> explains how we have minimised this still further by reusing pre-existing Diffserv codepoint(s) such that non-PCN traffic can still be distinguished from PCN traffic.
<t></t>
The encoding scheme that best addresses the above constraints ends up looking very similar to ECN. This is perhaps not surprising given the similarity in architectural intent between PCN and ECN. 

</t>

</section>
<!-- ================================================================ -->
<section anchor="pcn_enc_DSCPs" title="PCN-Enabled DiffServ Codepoints">

<t> 
  Equipment complying with the baseline PCN encoding MUST allow PCN to be enabled for a certain Diffserv codepoint or codepoints. This document defines the term 'PCN-Enabled Diffserv Codepoint' for such a DSCP. Enabling PCN for a DSCP switches on PCN marking behaviour for packets with that DSCP, but only if those packets also have their ECN field set to a codepoint other than Not-PCN.
 <t> </t>
Enabling PCN marking behaviour disables any other marking behaviour (e.g. enabling PCN also disables the default ECN marking behaviour introduced in <xref target="RFC3168"></xref>). The scheduling behaviour used for a packet does not change whether PCN is enabled for a DSCP or not and whatever the setting of the ECN field.

</t>

</section>
 <!-- ================================================================ -->
<section anchor="pcn_enc_nodes" title="Valid and Invalid Encoding Transitions at a PCN Node">
 <t>
  PCN edge node behaviour compliant with the PCN baseline encoding:
<list style="symbols">
<t>Any packets with the ECN field already marked as CE or ECT arriving at a PCN ingress node SHOULD be dropped or alternatively MAY be tunnelled through the PCN region. They MUST NOT be admitted to the PCN region directly. </t>
<t>On leaving the PCN region the ECN bits MUST be set to 00 (Not ECT).  </t>
 </list>
</t><t>
   PCN interior node behaviour compliant with the PCN baseline encoding:
      <list style="symbols">
<t>	PCN Interior nodes MUST NOT change Not-PCN to another codepoint and they MUST NOT change a PCN-Capable codepoint to Not-PCN.    </t>
<t>PCN interior nodes that are in a pre-congestion state above the configured level MUST set the PM codepoint by changing the ECN bits to 11. </t>
<t>PM MUST NOT be changed to NM.</t>
  </list>
  </t>
</section>
<!-- ================================================================ -->
<!-- ================================================================ -->
</section>      
<section anchor="pcn_enc_compat" title="Backwards Compatability">

<t>  BCP 124 <xref target="RFC4774"></xref> gives guidelines for specifying alternative semantics for the ECN field. It sets out a number of factors that must be taken into consideration. It also suggests various techniques to allow the co-existence of default ECN and alternative ECN semantics. The alternative semantics specified here are compliant with this BCP: 
<list style="symbols">
<t>	they use a DSCP to allow routers to distinguish that traffic uses the alternate ECN semantics; </t>
<t>	these semantics are defined for use within a controlled domain; </t>
<t>	ECN marked traffic is blocked from entering the PCN domain directly (though it might be tunnelled through the domain).</t>
 </list>
</t>

</section>

<!-- ================================================================ -->

<!-- ================================================================ -->
<section title="IANA Considerations">
    <t>This document makes no request to IANA. It does however suggest a change to the default (<xref target="RFC3168"></xref>) behaviour for the ECN field for the Voice-Admit <xref target="voice-admit"></xref> DSCP. 
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_security" title="Security Considerations">

    <t>Packets claim entitlement to be PCN marked by carrying a PCN-enabled DSCP and a PCN-Capable ECN codepoint. This encoding document is intended to stand independently of the architecture used to determine whether specific packets are authorised to be PCN marked, which will be described in a future separate document on PCN edge-node behaviour. 

The PCN working group has initially been chartered to only consider a PCN region to be entirely under the control of one operator, or a set of operators who trust each other <xref target="PCN-charter"></xref>. However there is a requirement to keep inter-domain scenarios in mind when defining the PCN encoding. One way to extend to multiple domains would be to concatenate PCN regions and use PCN edge-nodes back-to back at borders. Then any one domain's security against its neighbours would be described as part of the edge-node behaviour document as above.

There is only one proposal on the table to extend PCN across multiple domains without PCN edge nodes back-to-back at borders 
<xref target="re-PCN"></xref>. it is believed that the encoding described here would not be incompatible with the security framework described there.

    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_Conclusions" title="Conclusions">

    <t>This document defines the baseline PCN encoding utilising a combination of a PCN-enabled DSCP and the ECN field in the IP header. This baseline encoding allows the existence of two PCN encoding states, Not Marked and PCN-Marked. It also allows for the co-existence of non-PCN traffic within the same DSCP. The encoding scheme is conformant with <xref target="RFC4774"></xref>. 
    </t>
</section>

<!-- ================================================================ -->
<section anchor="pcn_enc_Acknowledgements" title="Acknowledgements">

    <t>This document builds extensively on work done in the PCN working group by Kwok Ho Chan, Georgios Karagiannis, Michael Menth, Philip Eardley, Bob Briscoe and others. Full details of the alternative schemes that were considered for adoption can be found in the sister document <xref target="pcn-enc-compare"></xref>.
    </t>

</section>
<!-- ================================================================ -->
<section anchor="pcn_enc_Comments_Solicited" title="Comments Solicited">

    <t>Comments and questions are encouraged and very welcome. They can be addressed to the IETF Transport Area working group mailing list &lt;tsvwg@ietf.org&gt;, and/or to the authors.
    </t>

</section>
    </middle>
    <back>
<!-- ================================================================ -->
<references title="Normative References">


    <?rfc include="refs\reference.RFC.2119" ?>
    <?rfc include="refs\reference.RFC.4774" ?>

</references>

<references title="Informative References">
    <?rfc include="refs\reference.RFC.3168" ?>
    <?rfc include="refs\reference.RFC.4301" ?>
    <?rfc include="refs\localref.I-D.briscoe-re-pcn-border-cheat" ?>
    <?rfc include="refs\localref.PCN-charter"?>
    <?rfc include="refs\reference.I-D.draft-ietf-pcn-architecture-03"    ?>
    <?rfc include="refs\reference.I-D.draft-ietf-tsvwg-admitted-realtime-dscp-04"    ?>
    <?rfc include="refs\reference.I-D.draft-chan-pcn-encoding-comparison-03"    ?>

</references>
<section anchor="pcn_enc_app_tunnel" title="Tunnelling Constraints">
    <t>
    The rules that govern the behaviour of the ECN field for IP-in-IP tunnels were defined in <xref target="RFC3168"></xref>. This allowed for two tunnel modes to exist. The limited functionality mode sets the outer header to Not ECT, regardless of the value of the inner header. The full functionality mode copies the inner ECN field into the outer header if the inner header is Not ECT or either of the 2 ECT codepoints. If the inner header is CE then the outer header is set to ECT(0). On decapsulation, if the CE codepoint is set on the outer header then this is copied into the inner header. Otherwise the inner header is left unchanged. The reason for blocking CE from being copied to the outer header was to prevent this from being used as a covert channel through IPSec tunnels.
    </t><t>
The IPSec protocol <xref target="RFC4301"></xref> changed the ECN tunnelling rule to allow IPSec tunnels to simply copy the inner header into the outer header. This was because the security community had decided the available bandwidth of the covert channel offered by ECN was too low to be a significant threat. On decapsulation the outer header is discarded and the ECN field is only copied down if it is set to CE. Because of the possible existence of tunnels, only CE (11) can be used as a PCN marking as it is the only mark that will survive decapsulation.
   </t><t>
There is a further issue involving tunnelling. In RFC3168, IP in IP tunnels are expected to set the ECN field to ECT(0) if the inner ECN field is set to CE. This leads to the possibility that some packets within the PCN field that have already been marked may have that mark concealed further into the region. This is undesirable for many PCN schemes and thus standard IP in IP tunnels SHOULD NOT be used within a PCN region.

    </t>
</section>
    </back>
</rfc>
