<?xml version="1.0" encoding = "US-ASCII" ?>
<!-- Converted from pure ASCII to XML by A. Petrescu, 4 January 2008. -->
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes"?>
<?rfc toc='yes'?>
<?rfc tocdepth="4"?>
<?rfc tocompact="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc ipr="full3978" category='std'
     docName="draft-ietf-mip4-nemo-v4-base-09.txt">
  <front>
    <title abbrev='Mobile Router'>
      Network Mobility (NEMO) Extensions for Mobile IPv4
    </title>
    <author initials='K.' surname='Leung' fullname='Kent Leung'>
      <organization abbrev='Cisco Systems'>
	Cisco Systems
      </organization>
      <address>
	<postal>
	  <street>
	    170 W. Tasman Drive
	  </street>
	  <city>
	    San Jose
	  </city>
	  <region>
	    CA
	  </region>
	  <code>
	    95134
	  </code>
	  <country>
	    USA
	  </country>
	</postal>
	<phone>
	  +1 408-526-5030
	</phone>
	<email>
	  kleung@cisco.com
	</email>
      </address>
    </author>
    <author initials='G.' surname='Dommety' fullname='Gopal Dommety'>
      <organization abbrev='Cisco Systems'>
	Cisco Systems
      </organization>
      <address>
	<postal>
	  <street>
	    170 W. Tasman Drive
	  </street>
	  <city>
	    San Jose
	  </city>
	  <region>
	    CA
	  </region>
	  <code>
	    95134
	  </code>
	  <country>
	    USA
	  </country>
	</postal>
	<phone>
	  +1 408-525-1404
	</phone>
	<email>
	  gdommety@cisco.com
	</email>
      </address>
    </author>
    <author initials='V' surname='Narayanan' fullname='Vidya Narayanan'>
      <organization abbrev='Qualcomm, Inc.'>
	QUALCOMM, Inc.
      </organization>
      <address>
	<postal>
	  <street>
	    5775 Morehouse Dr
	  </street>
	  <city>
	    San Diego
	  </city>
	  <region>
	    CA
	  </region>
	  <code>
	  </code>
	  <country>
	    USA
	  </country>
	</postal>
	<phone>
	  +1 858-845-2483
	</phone>
	<email>
	  vidyan@qualcomm.com
	</email>
      </address>
    </author>
    <author initials='A.' surname='Petrescu' fullname='Alexandru Petrescu'>
      <organization abbrev='Motorola'>
	Motorola
      </organization>
      <address>
	<postal>
	  <street>Parc les Algorithmes Saint Aubin</street>
	  <city>Gif-sur-Yvette</city>
	  <region>Essonne</region>
	  <code>91140</code>
	  <country>France</country>
	</postal>
	<phone> +33 169354827 </phone>
	<email> alexandru.petrescu@motorola.com</email>
      </address>
    </author>
    <date day='17' month='February' year='2008'/>
    <area>Internet Area</area>
    <workgroup>MIP4</workgroup>
    <keyword>I-D</keyword>
    <keyword>XML</keyword>
    <abstract>
      <t>
	This document describes a protocol for supporting Mobile
	Networks between a Mobile Router and a Home Agent by extending
	the Mobile IPv4 protocol.  A Mobile Router is responsible for
	the mobility of one or more network segments or subnets moving
	together.  The Mobile Router hides its mobility from the nodes
	on the mobile network.  The nodes on the Mobile Network may be
	fixed in relationship to the Mobile Router and may not have
	any mobility function.
      </t>
      <t>
	Extensions to Mobile IPv4 are introduced to support Mobile
	Networks.
      </t>
    </abstract>
  </front>
  <middle>
    <section anchor='intro' title='Introduction'>
      <t>
	This document describes network mobility extensions to the
	Mobile IPv4 protocol.  The goal of introducing these
	extensions is to acommodate mobility scenarios where groups of
	hosts and routers move homogeneously (as a whole).  It is
	required that all hosts and routers in a mobile network be
	able to run applications connecting to the Internet, and to be
	reachable from the Internet.
      </t>

      <t>
	For details regarding terminology related to network mobility
	(NEMO), the gentle reader is suggested a quick read of <xref
	target='RFC4885'>RFC&nbsp;4885</xref>.
      </t>

      <section anchor='examplemobnet' title='Examples of Mobile Networks'>
      <t>
	A mobile network links together a set of hosts and routers.
	Connecting this mobile network to the Internet is ensured at
	two levels: first, a Mobile Router is connected on one side to
	the Mobile Network and on another side to a wireless access
	system; second, a Home Agent placed on the home link manages
	traffic between the Correspondent Node and a Local Fixed Node
	(LFN, a node in the mobile network) by means of encapsulating
	traffic.
      </t>

      <t>
	A scenario of applicability for this mobile network is
	described next.  A mobile network is formed by a
	wireless-enabled Personal Digital Assistant (PDA) and a
	portable photographic camera, linked together by Bluetooth
	wireless link-layer technology.  This is sometimes referred to
	as a Personal Area Network (PAN).  In the illustration below
	one can notice the PDA playing the role of a Mobile Router and
	the camera the role of Local Fixed Node:
      </t>

      <figure align="center">
	<artwork align="center">
           <![CDATA[
          ----
         | HA |
          ----        --------
           |        /          \          ----
          -+--------| Internet |---------| CN |
                    \          /          ----
                      --------
                    /          \
                   /            \
                  /              \
                ----            ----
               | AR |          | AR |
                ----            ----
                  |cellular       |cellular



           /      |cellular                         		
           |    ----        ----      		    		
  Mobile   |   | MR |      |LFN |   ---movement-->  		
 Network   <    ----        ----      		    
           |      |           |       		    		
           |     -+-----------+-      		    		
           \       Bluetooth          		                    

            ]]>
        </artwork>
      </figure>

      <t>
	The camera (Local Fixed Node) uploads photographic content to
	a Correspondent Node (CN) server.  When the mobile network
	moves away, the Mobile Router serving the mobile network
	changes its point of attachment from one cellular access
	(Access Router) to another, obtaining a new Care-of Address.
	The Home Agent (HA) encapsulates application traffic for CN
	and LFN.
      </t>

      <t>
	Whereas the illustration above is a very simple instantiation
	of the applicability of Mobile IP-based mobile networks, more
	complex mobile networks are easily acommodated by the Mobile
	IPv4 extensions presented in this document (NEMOv4).  For
	example, laptop computers used by passengers in a bus, train,
	ship or in a plane should all be considered as forming mobile
	networks, as long as they move together (homogeneously).
      </t>
      </section>

      <section anchor='overviewproto' title='Overview of Protocol'>
      <t>
	As introduced previously, this document presents extensions to
	the Mobile IPv4 protocol.  The entities sending and receiving
	these extensions are the Mobile Router and the Home Agent.
	The Local Fixed Node is relieved from running Mobile IP
	software and, although it moves (together with the mobile
	network), its IP stack is not seing any change in addressing.
      </t>
      <t>
	Mobility for the entire Mobile Network is supported by the
	Mobile Router registering its current point of attachment
	(Care-of Address) to its Home Agent: Mobile Router sends an
	extended Registration Request to Home Agent which returns an
	extended Registration Reply.  This signaling sets up the
	tunnel between the two entities, as illustrated in the
	following figure:
      </t>
      <figure align="center">
	<artwork align="center">
           <![CDATA[
       LFN        MR                      HA        CN 
        |         |                       |         |  
        |         | Extended Registration |         |  
        |         |---------------------->|         |  
        |         |        Request        |         |  
        |         |                       |         |  
        |         |                       |         |  
        |         | Extended Registration |         |  
        |         |<----------------------|         |  
        |         |        Reply          |         |  
        |         |                       |         |  
        |<--------o=======================o-------->|  
        |         |     Encapsulated      |         |  
        |         |  Application Traffic  |         |
        |         |                       |         |
	   ]]>
	</artwork>
      </figure>
      <t>
	The prefix(es) used within a Mobile Network (either implicitly
	configured on the Home Agent or explicitly identified by the
	Mobile Router in the Registration Request) is/are advertised
	by the Home Agent for route propagation in the home network.
	Traffic to and from nodes in the Mobile Network are tunelled
	by the Home Agent to the Mobile Router, and vice versa.
	Though packets from a Local Fixed Node placed in the Mobile
	Network can be forwarded by the Mobile Router directly without
	tunneling (if reverse tunneling were not used) these packets
	will be dropped if ingress filtering is turned on at the
	Access Router.
      </t>
      
      <t>
	Extensively relating to Mobile IPv4 <xref
	target='RFC3344'>RFC&nbsp;3344</xref>, this specification
	addresses mainly the co-located Care-of Address mode.  Foreign
	Agent Care-of Address mode (with 'legacy' Foreign Agents,
	<xref target='RFC3344'>RFC&nbsp;3344</xref>) are supported but
	without optimization, double encapsulation being used.  For an
	optimization of this mode, the gentle reader is directed to
	<xref target='I-D.ietf-mip4-nemov4-fa'>an extension
	document</xref>.
      </t>

      <t>
	Compared to Mobile IPv4, this document specifies an additional
	tunnel between a Mobile Router's Home Address and the Home
	Agent.  This tunnel is encapsulated within the normal tunnel
	between the Care-of Address (CoA) and Home Agent.  In Foreign
	Agent CoA mode, the tunnel between the Mobile Router and Home
	Agent is needed to allow the Foreign Agent to direct the
	decapsulated packet to the proper visiting Mobile Router.
	However, in Collocated CoA mode, the additional tunnel is not
	essential and could be eliminated because the Mobile Router is
	the recipient of the encapsulated packets for the Mobile
	Network; a proposal for this feature is in <xref
	target='I-D.ietf-mip4-nemov4-fa'> a further extending
	document</xref>.
      </t>
      <t>
	All traffic between the nodes in the Mobile Network and
	Correspondent Nodes passes through the Home Agent.  This
	document does not touch on aspects related to route
	optimization of this traffic.
      </t>
      <t>
	A similar protocol has been documented in <xref
	target='RFC3963'>RFC&nbsp;3963</xref> for supporting IPv6
	mobile networks with Mobile IPv6 extensions.
      </t>
      <t>
	Multihoming for Mobile Routers is outside the scope of this
	document.
      </t>
      </section>
    </section>

    <section anchor='terminology' title='Terminology'>
      <t>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
	NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
	"OPTIONAL" in this document are to be interpreted as described
	in <xref target='RFC2119'>RFC&nbsp;2119</xref>.
      </t>
      <t>
	Terminology for Mobile IPv4 mobility support is defined in
	<xref target='RFC3344'>RFC&nbsp;3344</xref>.  Terminology for
	network mobility support (NEMO), from an IPv6 perspective, is
	described in <xref target='RFC4885'>RFC&nbsp;4885</xref>.  In
	addition, this document defines the following terms for
	NEMOv4.
      </t>

      <t>
	<list hangIndent="8" style="hanging">
	  <t hangText='Mobile Router'>
	    <vspace blankLines='1' />
	    <xref target='RFC3344'>RFC&nbsp;3344</xref> defines a
	    Mobile Router as a mobile node that can be a router that
	    is responsible for the mobility of one or more entire
	    networks moving together, perhaps on an airplane, a ship,
	    a train, an automobile, a bicycle, or a kayak.
	  </t>	  
	  <t hangText="Mobile Network Prefix">
	    <vspace blankLines="1" />
	    The network prefix of the subnet delegated to a Mobile
	    Router as the Mobile Network.
	  <vspace blankLines="1" />
	  </t>
	  <t hangText='Prefix Table'>
	    <vspace blankLines='1' />
	    A list of Mobile Network Prefixes indexed by the Home
	    Address of a Mobile Router.  The Home Agent manages and
	    uses Prefix Table to determine which Mobile Network
	    Prefixes belong to a particular Mobile Router.
	  </t>
	  <t hangText='Local Fixed Node'>
	    <vspace blankLines='1' />
	    <xref target='RFC4885'>RFC&nbsp;4885</xref> defines a
	    Local Fixed Node (LFN) to be a fixed node belonging to the
	    mobile network and unable to change its point of
	    attachment.  This definition should not be confused with
	    "Long, Fat Network, LFN" of <xref target='RFC1323'>
	    RFC&nbsp;1323</xref>, at least because this latter is
	    pronounced "elephan(t)" whereas a NEMO LFN is
	    distinctively pronounced "elefen".
	  </t>
	</list>
      </t>
    </section>

    <section anchor='reqs' title='Requirements'>
      <t>
	Although the original Mobile IPv4 specifications stated that
	Mobile Networks can be supported by the Mobile Router and Home
	Agent using static configuration or running a routing protocol
	(see Section 4.5 of <xref
	target='RFC3344'>RFC&nbsp;3344</xref>), there is no solution
	for explicit registration of the Mobile Networks served by the
	Mobile Router.  A solution needs to provide the Home Agent a
	means to ensure that a Mobile Router claiming a certain Mobile
	Network Prefix is authorized to do so.  A solution would also
	expose the Mobile Network Prefixes (and potentially other
	subnet-relevant information) in the exchanged messages, to aid
	in network debugging.
      </t>
      <t>
	The following requirements for Mobile Network support are
	enumerated:
      </t>
      <t>
	<list style='symbols'>
	  <t>
	    A Mobile Router should be able to operate in explicit or
	    implicit mode.  A Mobile Router may explicitly inform the
	    Home Agent which Mobile Network(s) need to be propagated
	    via a routing protocol.  A Mobile Router may also function
	    in implicit mode, where the Home Agent may learn the
	    mobile networks through other means, such as from the AAA
	    server, via pre-configuration, or via a dynamic routing
	    protocol.
	  </t>

	  <t>
	    The Mobile Network should be supported using Foreign
	    Agents that are compliant to <xref target='RFC3344'>RFC
	    3344</xref> without any changes ('legacy' Foreign Agents).
	  </t>

	  <t>
	    The mobile network should allow Fixed Nodes, Mobile Nodes,
	    or Mobile Routers to be on it.
	  </t>
	  <t>
	    The Local Fixed Nodes on a mobile network should be able
	    to execute their sessions without running themselves
	    Mobile IP stacks.  The Mobile Router managing the LFNs'
	    mobile network is 'hiding' mobility events like the
	    changes of the Care-of Address from the Local Fixed Nodes
	    in that mobile network.
	  </t>
	</list>
      </t>

    </section>

    <section anchor='mobnetext' title='Mobile Network Extensions'>
      <section anchor='expremask'
	       title='Representing a Subnet'>
	<t>
	  Since the protocol extensions presented in this document
	  concentrate on treatment of prefixes, subnets and network
	  masks it is important to choose an all-encompassing wire
	  representation of subnets, as generic as possible.
	</t>

	<t>
	  A subnet can easily be represented as address/prefix length,
	  as in 192.168.1.1/24.  This is interpreted as the subnet
	  being the first leftmost 24 bits of the address 192.168.1.1,
	  i.e. 192.168.1.  This representation corresponds to an
	  underlying forwarding system which uses longest-prefix match
	  rules.  It is typically in widespread deployment in the
	  Internet.
	</t>
	<t>
	  In a Mobile Network Extension, this representation is
	  expressed by the tuple of Prefix and Prefix Length fields.
	</t>
	<t>
	  On another hand, some forwarding systems don't use
	  longest-prefix match rules.  In these cases it is important
	  to provide the more generic way of representing subnets by
	  using non-contiguous sets of 1bits as netmasks.  For
	  example, 255.255.0.255 is a perfectly legal netmask which,
	  when applied to an address like 192.168.1.1 gives the
	  network part 192.168.x.1, the third 'x' byte acting alone as
	  the host part.
	</t>
	<t>
	  In a Mobile Network Extension, this non-contiguous netmask
	  representation is expressed by the tuple of Prefix and
	  Optional Netmask fields (Prefix Length field being ignored).
	</t>
	<t>
	  The two representation methods (address/prefix and
	  address/netmask) are alternative and only one method of
	  representation is used by a Mobile Network Extension.
	</t>
	<t>
	  Representing the subnet as address/prefix has the advantage
	  of a more compact encoding (40bits) whereas the
	  address/netmask requires 64bits.  Hence it is suggested as a
	  default.  However, representing the subnet as
	  address/netmask gives more applicability of NEMOv4
	  extensions to forwarding systems where more complex
	  forwarding schemes are used.
	</t>
      </section>

      <section anchor='mnreqext'
	       title='Mobile Network Request Extension'>
	<t>
	  For Explicit Mode, the Mobile Router informs the Home Agent
	  about the Mobile Network Prefixes during registration.  The
	  Registration Request contains zero, one or several Mobile
	  Network Request extensions in addition to any other
	  extensions defined by or in the context of <xref
	  target='RFC3344'>RFC&nbsp;3344</xref>.  When several Mobile
	  Networks are needed to be registered, each is included in a
	  separate Mobile Network Request extension, with its own
	  Type, Length, Sub-Type, Prefix Length, Prefix and optionally
	  the Optional Netmask fields.  For a discussion of the subnet
	  encoding see <xref target='expremask' />.  A Mobile Network
	  Request extension is encoded in Type-Length-Value (TLV)
	  format and respects the following ordering:
	</t>

      <figure align="center">
	<artwork align="left">
	  <![CDATA[
   0               1               2               3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |     Type      |    Length     |   Sub-Type    | Prefix Length |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                          Prefix                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                     Optional Netmask                          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	  ]]>
	</artwork>
      </figure>

      <t>
	<list hangIndent="8" style="hanging">
	  <t hangText="Type:">
	    <vspace blankLines="1" />
	    Mobile Network Extension (skippable type range to be
	    assigned by IANA).
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Length:'>
	    <vspace blankLines='1' />
	    Decimal 6 or decimal 10, not any other.  If the masking is
	    expressed as Prefix/Prefix Length (e.g. 192.168.1.1/24),
	    the value of this Length field is decimal 6 and the
	    Optional Netmask field is absent.  If the masking is
	    expressed as Prefix and Netmask (e.g. 192.168.1.1
	    255.255.0.255) then the value of this Length field is
	    decimal 10, the Optional Netmask field is present and the
	    value of the Prefix Length field is set to all-zero by
	    sender and ignored by receiver.
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Sub-Type:'>
	    <list style='hanging'>
	      <t hangText='TBA'>
		(Mobile Network Request)
	      </t>
	    </list>
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Prefix Length:'>
	    <vspace blankLines='1' />
	    8-bit unsigned integer indicating the number of leftmost
	    bits covering the network part of the address contained in
	    the Prefix field.  If the Optional Netmask field is
	    present then this field is set to all-zero by sender and
	    ignored by receiver.
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Prefix:'>
	    <vspace blankLines='1' />
	    32-bit unsigned integer in network byte-order containing
	    an IPv4 address.  If the Optional Netmask field is absent
	    then the first Prefix Length bits make up the Mobile
	    Network Prefix.  Otherwise the Mobile Network Prefix is
	    obtained by masking this IPv4 address with the value of
	    the Optional Netmask field.
	  </t>
	  <t hangText='Optional Netmask:'>
	    <vspace blankLines='1' />
	    32-bit unsigned integer in network byte-order containing
	    an IPv4 netmask.  For example '255.255.0.255'.  This field
	    is present when the subnet masking needs to be expressed
	    as a non-contiguous set of 1 bits.  Otherwise it is
	    absent.  If the Optional Netmask is present then the value
	    of the field Prefix Length is set to all-zero by sender
	    and ignored by receiver.
	  </t>
	</list>
      </t>

      </section>

      <section anchor='mnackext'
	       title='Mobile Network Acknowledgement Extension'>
	<t>
	  The Registration Reply contains zero, one or several Mobile
	  Network Acknowledgement extensions in addition to any other
	  extensions defined by or in the context of <xref
	  target='RFC3344'>RFC&nbsp;3344</xref>.  For Implicit Mode,
	  the Mobile Network Acknowledgement informs the Mobile Router
	  the prefixes for which the Home Agent sets up forwarding
	  with respect to this Mobile Router.  Policies such as
	  permitting only traffic from these Mobile Networks to be
	  tunneled to the Home Agent may be applied by the Mobile
	  Router.  For Explicit Mode, when several Mobile Networks are
	  needed to be acknowledged explicitly, each is included in a
	  separate Mobile Network Acknowledgement extension, with its
	  own Type, Sub-Type, Length, Prefix, Prefix Length and
	  optionally the Optional Netmask fields.  For a discussion of
	  the subnet encoding see <xref target='expremask' />.  At
	  least one Mobile Network Acknowledgement extension MUST be
	  in a successful Registration Reply to indicate to the Mobile
	  Router that the Mobile Network Request extension was
	  processed, thereby not skipped by the Home Agent.
	</t>

	<t>
	  A Registration Reply may contain any non-zero number of
	  Explicit Mode and Implicit Mode Acknowledgements sub-types.
	  Both sub-types can be present in a single Registration
	  Reply.  A Mobile Network Acknowledgement extension is
	  encoded in Type-Length-Value (TLV) format.  When the
	  registration is denied with Code HA_MOBNET_ERROR (Code field
	  in the Registration Reply), the Code field in the included
	  Mobile Network Extension provides the reason for the
	  failure.
	</t>

      <figure align="center">
	<artwork align="left">
	  <![CDATA[
    0               1               2               3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     |   Sub-Type    |      Code     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Prefix Length |    Reserved   |            Prefix...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
               ...Prefix           |      Optional Netmask...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ...Optional Netmask        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

	  ]]>
	</artwork>
      </figure>
      <t>
	<list hangIndent="8" style="hanging">
	  <t hangText="Type:">
	    <list hangIndent='8' style='hanging'>
	      <t hangText='TBA'>
		Mobile Network Extension (skippable type range to be
		assigned by IANA).
	      </t>
	    </list>
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Length:'>
	    <vspace blankLines='1' />
	    Decimal 8 or decimal 12, not any other.  If the masking is
	    expressed as Prefix/Prefix Length (e.g. 192.168.1.1/24),
	    the value of this Length field is decimal 8 and the
	    Optional Netmask field is absent.  If the masking is
	    expressed as Prefix and Netmask (e.g. 192.168.1.1
	    255.255.0.255) then the value of this Length field is
	    decimal 12, the Optional Netmask field is present and the
	    value of the Prefix Length field set to all-zero by sender
	    and ignored by receiver.
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Sub-Type:'>
	    <list hangIndent='8' style='hanging'>
	      <t hangText='TBA'>
		(Explicit Mode Acknowledgement)
	      </t>
	      <t hangText='TBA'>
		(Implicit Mode Acknowledgement)
	      </t>
	    </list>
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Code:'>
	    <vspace blankLines='1' />
	    Value indicating success or failure:
	    <list hangIndent='8' style='hanging'>
	      <t hangText='TBA'>
		Success
	      </t>
	      <t hangText='TBA'>
		Invalid prefix (MOBNET_INVALID_PREFIX_LEN)
	      </t>
	      <t hangText='TBA'>
		Mobile Router is not authorized for prefix
		(MOBNET_UNAUTHORIZED)
	      </t>
	      <t hangText='TBA'>
		Forwarding setup failed (MOBNET_FWDING_SETUP_FAILED)
	      </t>
	    </list>
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Prefix Length:'>
	    <vspace blankLines='1' />
	    8-bit unsigned integer indicating the number of leftmost
	    bits covering the network part of the address contained in
	    the Prefix field.  If the Optional Netmask field is
	    present then this field is set to all-zero by sender and
	    ignored by receiver.
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Reserved:'>
	    <vspace blankLines='1' />
	    Sent as zero; ignored on reception.
	    <vspace blankLines="1" />
	  </t>
	  <t hangText='Prefix:'>
	    <vspace blankLines='1' />
	    32-bit unsigned integer in network byte-order containing
	    an IPv4 address.  If the Optional Netmask field is absent
	    then the first Prefix Length bits make up the Mobile
	    Network Prefix.  Otherwise the Mobile Network Prefix is
	    obtained by masking this IPv4 address with the value of
	    the Optional Netmask field.
	    <vspace blankLines="1" />
	  </t>
	  	  <t hangText='Optional Netmask:'>
	    <vspace blankLines='1' />
	    32-bit unsigned integer in network byte-order containing
	    an IPv4 netmask.  For example '255.255.0.255'.  This field
	    is present when the subnet masking needs to be expressed
	    as a non-contiguous set of 1 bits.  Otherwise it is
	    absent.  If the Optional Netmask is present then the value
	    of the field Prefix Length is set to all-zero by sender
	    and ignored by receiver.
	  </t>
	</list>
      </t>

      </section>
    </section>

    <section anchor='mroperation' title='Mobile Router Operation'>
      <t>      
	A Mobile Router's operation is generally derived from the
	behavior of a Mobile Node, as set in <xref
	target='RFC3344'>RFC&nbsp;3344</xref>.  In addition to
	maintaining mobility bindings for its Home Address, the Mobile
	Router, together with the Home Agent, maintains forwarding
	information for the Mobile Network Prefix(es) assigned to the
	Mobile Router.
      </t>

      <t>
	A Mobile Router SHOULD set the 'T' bit to 1 in all
	Registration Request messages it sends to indicate the need
	for reverse tunnels for all traffic.  Without reverse tunnels,
	all the traffic from the mobile network will be subject to
	ingress filtering in the visited networks.  Upon reception of
	a successful Registration Reply, the Mobile Router processes
	the registration in accordance to <xref target='RFC3344'>RFC
	3344</xref>.  In addition, the following steps are taken:
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    Check for Mobile Network Acknowledgement extension(s) in
	    Registration Reply
	  </t>
	  <t>
	    Create tunnel to the Home Agent if registered in reverse
	    tunneling mode
	  </t>
	  <t>
	    Set up default route via this tunnel or egress interface
	    when registered with or without reverse tunneling,
	    respectively
	  </t>
	</list>
      </t>

      <t>
	In accordance with this specification, a Mobile Router may
	operate in one of the following two modes: explicit and
	implicit.  In explicit mode, the Mobile Router includes Mobile
	Network Prefix information in all Registration Requests (as
	Mobile Network Request extensions), while in implicit mode it
	does not include this information in any Registration Request.
	In this latter case, the Home Agent obtains the Mobile Network
	Prefixes by other means than Mobile IP.  One example of
	obtaining the Mobile Network Prefix is through static
	configuration on the Home Agent.
      </t>

      <t>
	A Mobile Router can obtain a Collocated or Foreign Agent
	Care-of Address while operating in explicit or implicit modes.
      </t>

      <t>
	For de-registration, the Mobile Router sends a registration
	request with lifetime set to zero without any Mobile Network
	Request extensions.
      </t>

      <section anchor='errprocessing' title='Error Processing'>
	<t>
	  In a Mobile IP Registration Reply message there may be two
	  Code fields: one proper to the Registration Reply header
	  (the 'proper' Code) and one within the Mobile Network
	  Acknowledgement Extension (simply the 'Code').

          A Mobile Router interprets the values of the Code field in
          the Mobile Network Acknowledgement Extension of the
          Registration Reply in order to identify any error related to
          managing the Mobile Network Prefixes by the Home Agent.  It
          also interprets the values of the Code field in the
          Registration Reply header (the proper Code).
	</t>

	<t>
	  If the value of the Code field in the Registration Reply
	  (the proper) is set to HA_MOBNET_DISALLOWED, then the Mobile
	  Router MUST stop sending Registration Requests with any
	  Mobile Network Prefix extensions to that Home Agent.
	</t>

	<t>
	  If the value of the Code field in the Registration Reply
	  (the proper) is set to HA_MOBNET_ERROR then the Mobile
	  Router MUST stop sending Registration Requests that contain
	  any of the Mobile Network Prefixes that are defined by the
	  values of the fields Prefix and Prefix Length in the Mobile
	  Network Acknowledgement extension.  Note that the
	  registration is denied in this case and no forwarding for
	  any Mobile Network Prefixes would be set up by the Home
	  Agent for the Mobile Router.
	</t>

	<t>
	  It is possible that the Mobile Router receives a
	  Registration Reply with no mobile network extensions if the
	  registration was processed by a Mobile IPv4 home agent that
	  does not support this specification at all.  In that case,
	  the absence of mobile network extensions must be interpreted
	  by the Mobile Router as the case where the Home Agent does
	  not support mobile networks.
	</t>

	<t>
	  All the error code values are TBA (To Be Assigned) subject
	  to IANA allocation.
	</t>

      </section>
      <section anchor='mrmanagement' title='Mobile Router Management'>
	<t>
	  Operating a Mobile Router in a Mobile IPv4 environment has
	  certain requirements on the management of the necessary
	  initial configuration and supervision of the ongoing status
	  information.  Mobile Router maintenance indicators may need
	  to be exposed in a manner consistent with other Mobile IPv4
	  indicators.
	</t>
	<t>
	  The objects for the Management Information Base (MIB) for
	  Mobile IPv4 are defined in <xref
	  target='RFC2006'>RFC&nbsp;2006</xref>.  The structure of the
	  basic model of Mobile IP protocol describes three entities:
	  Mobile Node, Home Agent and Foreign Agent.  In addition to
	  these entities this document proposes a functional entity to
	  be the Mobile Router.
	</t>
	<t>
	  The necessary initial configuration at a NEMOv4-enabled Home
	  Agent includes, but is not limited to, the contents of the
	  Prefix Table.  The Mobile Router MAY need to store the
	  Mobile Network Prefixes as the initial configuration.
	</t>
	<t>
	  The definition of MIB objects related to Mobile Router and
	  of a NEMOv4-enabled Home Agent is outside the scope of this
	  document.
	</t>
      </section>
    </section>

    <section anchor='haoperation' title='Home Agent Operation'>
      <section anchor='haoperation-summary' title='Summary'>
	<t>
	  A Home Agent MUST support all the operations specified in
	  <xref target='RFC3344'>RFC&nbsp;3344</xref> for Mobile Node
	  support.  The Home Agent MUST support both implicit and
	  explicit modes of operation for a Mobile Router.
	</t>

	<t>
	  The Home Agent processes the registration in accordance to
	  <xref target='RFC3344'>RFC&nbsp;3344</xref>, which includes
	  route set up to the Mobile Router's Home Address via the
	  tunnel to the Care-of Address.  In addition, for a Mobile
	  Router registering in explicit mode, the following steps are
	  taken:
	</t>

	<t>
	  <list style='numbers'>
	    <t>
	      Check that the Mobile Network Prefix information is
	      valid
	    </t>
	    <t>
	      Ensure the Mobile Network Prefix(es) is or are
	      authorized to be on the Mobile Router
	    </t>
	    <t>
	      Create tunnel to the Mobile Router if it does not
	      already exist
	    </t>
	    <t>
	      Set up route for the Mobile Network Prefix via this
	      tunnel
	    </t>
	    <t>
	      Propagate Mobile Network Prefix routes via routing
	      protocol if necessary
	    </t>
	    <t>
	      Send the Registration Reply with the Mobile Network
	      Acknowledgement extension(s)
	    </t>
	  </list>
	</t>

	<t>
	  If there are any subnet routes via the tunnel to the Mobile
	  Router that are not specified in the Mobile Network
	  extensions, these routes are removed.
	</t>

	<t>
	  In the case where the Mobile Node is not permitted to act as
	  a Mobile Router, the Home Agent sends a Registration Reply
	  message whose Code field is HA_MOBNET_DISALLOWED (the proper
	  Code field of the Registration Reply).
	</t>

	<t>
	  For a Mobile Router registering in implicit mode, the Home
	  Agent performs steps 3-6 above, once the registration
	  request is processed successfully.
	</t>

	<t>
	  For deregistration, the Home Agent removes the tunnel to the
	  Mobile Router and all routes using this tunnel.  The Mobile
	  Network extensions are ignored.
	</t>

      </section>

      <section anchor='datastruct' title='Data Structures'>
	<section anchor='regtable' title='Registration Table'>
	  <t>
	    The Registration Table in the Home Agent, in accordance
	    with <xref target='RFC3344'>RFC&nbsp;3344</xref>, contains
	    binding information for every Mobile Node registered with
	    it.  <xref target='RFC3344'>RFC 3344</xref> defines the
	    format of a Registration Table.  In addition to all the
	    parameters specified by <xref target='RFC3344'>RFC
	    3344</xref>, the Home Agent MUST store the Mobile Network
	    Prefixes associated with the Mobile Router in the
	    corresponding registration entry, when the corresponding
	    registration was performed in explicit mode.  When the
	    Home Agent is advertising reachability to Mobile Network
	    Prefixes served by a Mobile Router, the information stored
	    in the Registration Table can be used.
	  </t>
	</section>

	<section anchor='prefixtable' title='Prefix Table'>
	  <t>
	    The Home Agent must be able to authorize a Mobile Router
	    for use of Mobile Network Prefixes when the Mobile Router
	    is operating in explicit mode.  Also, when the Mobile
	    Router operates in implicit mode, the Home Agent must be
	    able to locate the Mobile Network Prefixes associated with
	    that Mobile Router.  The Home Agent may store the Home
	    Address of the Mobile Router along with the mobile network
	    prefixes associated with that Mobile Router.  If the
	    Mobile Router does not have a Home Address assigned, this
	    table may store the NAI <xref target='RFC2794'>RFC
	    2794</xref> of the Mobile Router that will be used in
	    dynamic Home Address assignment.
	  </t>
	</section>
      </section>
      
      <section anchor='mnetprefixreg'
	       title='Mobile Network Prefix Registration'>
	<t>
	  The Home Agent must process registration requests coming
	  from Mobile Routers in accordance with this section.  The
	  document <xref target='RFC3344'>RFC&nbsp;3344</xref>
	  specifies that the Home Address of a mobile node registering
	  with a Home Agent must belong to a prefix advertised on the
	  home network.  In accordance with this specification,
	  however, the Home Address must be configured from a prefix
	  that is served by the Home Agent, not necessarily the one on
	  the home network.
	</t>

	<t>
	  If the registration request is valid, the Home Agent checks
	  to see if there are any Mobile Network Prefix extensions
	  included in the Registration Request.
	</t>

	<t>
	  If so, the Mobile Network Prefix information is obtained
	  from the included extensions, and the Home Address from the
	  Home Address field of the Registration Request.  For every
	  Mobile Network Prefix extension included in the registration
	  request, the Home Agent MUST perform a check against the
	  Prefix Table.  If the Prefix Table does not contain at least
	  one entry pairing that Home Address to that Mobile Network
	  Prefix then the check fails, otherwise it succeeds.
	</t>

	<t>
	  Following this check against the Prefix Table, the Home
	  Agent MUST construct a Registration Reply containing Mobile
	  Network Acknowledgement extensions.  For a Mobile Network
	  Prefix for which the check was unsuccessful the Code field
	  in the corresponding Mobile Network Acknowledgement
	  extension should be set to MOBNET_UNAUTHORIZED.
	</t>

	<t>
	  For a Mobile Network Prefix for which the check was
	  successful the Code field in the respective Mobile Network
	  Acknowledgement extensions should be set to 0.
	</t>

	<t>
	  The Home Agent MUST attempt to set up forwarding for each
	  Mobile Network Prefix extension for which the Prefix Table
	  check was successful.  If the forwarding setup fails for a
	  particular Mobile Network Prefix (for reasons when, for
	  example, there is not enough memory available, or not enough
	  devices available, or other reason) the Code field in the
	  respective Mobile Network Acknowledgement extension should
	  be set to MOBNET_FWDING_SETUP_FAILED.
	</t>

	<t>
	  If forwarding and setup was successful for at least one
	  Mobile Network Prefix then the Code field (proper) of the
	  Registration Reply message should be set to 0.  Otherwise,
	  when forwarding and setup was unsuccessful for each and
	  every Mobile Network Prefixes, that Code (proper) should be
	  HA_MOBNET_ERROR.
	</t>

	<t>
	  If the registration request is sent in implicit mode, i.e.,
	  without any Mobile Network Request extension, the Home Agent
	  may use pre- configured mobile network prefix information
	  for the Mobile Router to set up forwarding.
	</t>

	<t>
	  If the Home Agent is updating an existing binding entry for
	  the Mobile Router, it MUST check all the prefixes in the
	  registration table against the prefixes included in the
	  registration request.  If one or more mobile network prefix
	  is missing from the included information in the registration
	  request, it MUST delete those prefixes from the registration
	  table.  Also, the Home Agent MUST disable forwarding for
	  those prefixes.
	</t>

	<t>
	  If all checks are successful, the Home Agent either creates
	  a new entry for the Mobile Router or updates an existing
	  binding entry for it and returns a successful registration
	  reply back to the Mobile Router or the Foreign Agent (if the
	  registration request was received from a Foreign Agent).
	</t>

	<t>
	  In accordance with <xref
	  target='RFC3344'>RFC&nbsp;3344</xref>, the Home Agent does
	  proxy ARP for the Mobile Router Home Address, when the
	  Mobile Router Home Address is derived from the home network.
	</t>

	<t>
	  If the 'T' bit is set, the Home Agent creates a
	  bi-directional tunnel for the corresponding mobile network
	  prefixes or updates the existing bi-directional tunnel.
	  This tunnel is maintained independent of the reverse tunnel
	  for the Mobile Router home address itself.
	</t>
      </section>

      <section anchor='advreach'
	       title='Advertising Mobile Network Reachability'>
	<t>
	  If the mobile network prefixes served by the Home Agent are
	  aggregated with the home network prefix and if the Home
	  Agent is the default router on the home network, the Home
	  Agent does not have to advertise the Mobile Network
	  Prefixes.  The routes for the Mobile Network Prefix are
	  automatically aggregated into the home network prefix (it is
	  assumed that the Mobile Network Prefixes are automatically
	  aggregated into the home network prefix).  If the Mobile
	  Router updates the mobile network prefix routes via a
	  dynamic routing protocol, the Home Agent SHOULD propagate
	  the routes on the appropriate networks.
	</t>
      </section>

      <section anchor='establishment-bidir'
	       title='Establishment of Bi-directional Tunnel'>
	<t>
	  The Home Agent creates and maintains a bi-directional tunnel
	  for the mobile network prefixes of a Mobile Router
	  registered with it.  A home agent supporting IPv4 Mobile
	  Router operation MUST be able to forward packets destined to
	  the mobile network prefixes served by the Mobile Router to
	  its Care-of Address.  Also, the Home Agent MUST be able to
	  accept packets tunneled by the Mobile Router with the source
	  address of the outer header set to the Care-of Address of
	  the Mobile Router and that of the inner header set to the
	  Mobile Router's Home Address or an address from one of the
	  registered mobile network prefixes.
	</t>
      </section>

      <section anchor='sendingregreps'
	       title='Sending Registration Replies'>
	<t>
	  The Home Agent MUST set the status code in the registration
	  reply to 0 to indicate successful processing of the
	  registration request and successful set up of forwarding for
	  at least one mobile network prefixes served by the Mobile
	  Router.  The registration reply MUST contain at least one
	  Mobile Network Acknowledgement extension.
	</t>

	<t>
	  If the Home Agent is unable to set up forwarding for one or
	  more mobile network prefixes served by the Mobile Router, it
	  MUST set the Mobile Network Acknowledgement Extension status
	  Code in the registration reply to
	  MOBNET_FWDING_SETUP_FAILED.  When the prefix length is zero
	  (and the Optional Netmask field is absent) or greater than
	  decimal 32, the status Code MUST be set to
	  MOBNET_INVALID_PREFIX_LEN.
	</t>

	<t>
	  If the Mobile Router is not authorized to forward packets to
	  a mobile network prefixes included in the request, the Home
	  Agent MUST set the Code to MOBNET_UNAUTHORIZED.
	</t>
      </section>

      <section anchor='mnetprefix-deregistration'
	       title='Mobile Network Prefix De-registration'>
	<t>
	  If the received registration request is for de-registration
	  of the Care-of Address, the Home Agent, upon successful
	  processing of it, MUST delete the entry(ies) from its
	  registration table.  The home agent tears down the
	  bi-directional tunnel and stops forwarding any packets
	  to/from the Mobile Router.  The Home Agent MUST ignore any
	  included Mobile Network Request extension in a
	  de-registration request.
	</t>
      </section>
    </section>

    <section anchor='dataforwarding'
	     title='Data Forwarding Operation'>
      <t>
	For traffic to the nodes in the Mobile Network, the Home Agent
	MUST perform double tunneling of the packet, if the Mobile
	Router had registered with a Foreign Agent Care-of Address.
	In this case, the Home Agent MUST encapsulate the packet with
	tunnel header (source IP address set to Home Agent and
	destination IP address set to Mobile Router's Home Address)
	and then encapsulate one more time with tunnel header (source
	IP address set to Home Agent and destination IP address set to
	CoA).
      </t>

      <t>
	For optimization, the Home Agent SHOULD only encapsulate the
	packet with the tunnel header (source IP address set to Home
	Agent and destination IP address set to CoA) for Collocated
	CoA mode.
      </t>

      <t>
	When a Home Agent receives a packet from the mobile network
	prefix in the bi-directional tunnel, it MUST de-encapsulate
	the packet and route it as a normal IP packet.  It MUST verify
	that the incoming packet has the source IP address set to the
	Care-of Address of the Mobile Router.  The packet MUST be
	dropped if the source address is not set to the Care-of
	Address of the Mobile Router.
      </t>

      <t>
	For traffic from the nodes in the Mobile Network, the Mobile
	Router encapsulates the packet with a tunnel header (source IP
	address set to Mobile Router's Home Address and destination IP
	address set to Home Agent) if reverse tunnel is enabled.
	Otherwise, the packet is routed directly to the Foreign Agent
	or access router.
      </t>

      <t>
	In Collocated CoA mode, the Mobile Router MAY encapsulate one
	more times with a tunnel header (source IP address set to the
	CoA and destination IP address set to Home Agent).
      </t>

    </section>

    <section anchor='nested'
	     title='Nested Mobile Networks'>
      <t>
	Nested Network Mobility is a scenario where a Mobile Router
	allows another Mobile Router to attach to its Mobile Network.
	There could be arbitrary levels of nested mobility.  The
	operation of each Mobile Router remains the same whether the
	Mobile Router attaches to another Mobile Router or to a fixed
	Access Router on the Internet.  The solution described here
	does not place any restriction on the number of levels for
	nested mobility.  Two issues should be noted though.  First,
	whenever physical loops occur in a nested aggregation of
	mobile networks this protocol does neither detect nor solve
	them - datagram forwarding may be blocked.  Second, Mobile
	Routers in a deep nested aggregation of mobile networks might
	introduce significant overhead on the data packets as each
	level of nesting introduces another tunnel header
	encapsulation.  Applications that do not support MTU discovery
	are adversely affected by the additional header
	encapsulations, because the usable MTU is reduced with each
	level of nesting.
      </t>
    </section>

    <section anchor='routingprotocol'
	     title='Routing Protocol
		    between Mobile Router and Home Agent'>
      <t>
	There are several benefits of running a dynamic routing
	protocol between the Mobile Router and the Home Agent.  If the
	mobile network is relatively large, including several wireless
	subnets, then the topology changes within the moving network
	can be exposed from the Mobile Router to the Home Agent by
	using a dynamic routing protocol.  The purpose of the NEMOv4
	protocol extensions to Mobile IPv4, as defined in previous
	sections, is not to inform the Home Agent about these topology
	changes, but to manage the mobility of the Mobile Router.
      </t>

      <t>
	Similarly, topology changes in the home network can be exposed
	to the Mobile Router by using a dynamic routing protocol.
	This may be necessary when new fixed networks are added in the
	home network.  Here too, the purpose of NEMOv4 extensions is
	not to inform the Mobile Router about topology changes at
	home.
      </t>

      <t>
	Examples of dynamic routing protocol include but are not
	limited to OSPF Version 2 <xref target='RFC2328'>RFC
	2328</xref>, BGP <xref target='RFC4271'>RFC&nbsp;4271</xref>
	and RIP <xref target='RFC2453'>RFC&nbsp;2453</xref>.
      </t>

      <t>
	The recommendations are related to how the routing protocol
	and the Mobile IPv4 implementation work in tandem on the
	Mobile Router and on the Home Agent (1) without creating
	incoherent states in the forwarding information bases at home
	and on the Mobile Router, (2) without introducing
	topologically incorrect addressing information in the visited
	domain and (3) efficiently avoid duplication of sent data or
	over-provisioning of security.
      </t>

      <t>
	The information exchanged between the Mobile Router and the
	Home Agent is sent over the bi-directional tunnel established
	by the Mobile IPv4 exchange Registration Request -
	Registration Reply (see <xref target='establishment-bidir'
	/>).  If a network address and prefix about a subnet in the
	moving network is sent by the Mobile Router within a routing
	protocol message then they SHOULD NOT be sent in the Mobile
	IPv4 Registration Request too, in order to avoid incoherencies
	in the forwarding information bases.  The Mobile Router SHOULD
	use NEMOv4 implicit mode in this case (see <xref target='reqs'
	/>).
      </t>

      <t>
	The Mobile Router SHOULD NOT send routing protocol information
	updates in the foreign network.  The subnet addresses and
	prefixes valid in the moving network are topologically
	incorrect in the visited network.
      </t>

      <t>
	If the Mobile Router and the Home Agent use a dynamic routing
	protocol over the tunnel interface, and if that protocol
	offers security mechanisms to protect that protocol's
	messages, then the security recommendations in <xref
	target='secrtprotocol' /> apply.
      </t>
    </section>

    <section anchor='seccons' title='Security Considerations'>
      <t>
	The Mobile Network extension is protected by the same rules
	for Mobile IP extensions in registration messages.  See the
	Security Considerations section in <xref target='RFC3344'>RFC
	3344</xref>.
      </t>

      <t>
	The Home Agent MUST be able to verify that the Mobile Router
	is authorized to provide mobility service for the Mobile
	Networks in the registration request, before anchoring these
	Mobile Network Prefixes on behalf of the Mobile Router.
	Forwarding for prefixes MUST NOT be set up without successful
	authorization of the Mobile Router for those prefixes.  A
	registration failure MUST be notified to the mobile router
	when it cannot be successfully authorized for prefixes
	requested by it.
      </t>

      <t>
	All registration requests and replies MUST be authenticated by
	the MN-HA Authentication Extension as specified in <xref
	target='RFC3344'>RFC&nbsp;3344</xref>.  When the registration
	request is sent in explicit mode, i.e., with one or more
	Mobile Network Prefix extensions, all the Mobile Network
	Prefix extensions MUST be included before the MN-HA
	Authentication extension.  Also, these extensions MUST be
	included in the calculation of the MN-HA authenticator value.
      </t>

      <t>
	The Mobile Router should perform ingress filtering on all the
	packets received on the mobile network prior to reverse
	tunneling them to the Home Agent.  The Mobile Router MUST drop
	any packets that do not have a source address belonging to the
	mobile network.
      </t>

      <t>
	The Mobile Router MUST also ensure that the source address of
	packets arriving on the mobile network is not the same as the
	Mobile Router's IP address on any interface.  These checks
	will protect against nodes attempting to launch IP spoofing
	attacks through the bi-directional tunnel.
      </t>

      <t>
	The Home Agent, upon receiving packets through the
	bi-directional tunnel, MUST verify that the source addresses
	of the outer IP header of the packets are set to the Mobile
	Router's care-of-address.  Also, it MUST ensure that the
	source address of the inner IP header is a topologically
	correct address on the mobile network.  This will prevent
	nodes from using the Home Agent to launch attacks inside the
	protected network.
      </t>

      <section anchor='secrtprotocol'
	       title='Security when Dynamic Routing Protocol is Used'>
	<t>
	  If a dynamic routing protocol is used between the Mobile
	  Router and the Home Agent to propagate the mobile network
	  information into the home network, the routing updates
	  SHOULD be protected with IPsec ESP confidentiality between
	  the Mobile Router and Home Agent, to prevent information
	  about home network topology from being visible to
	  eavesdroppers.
	</t>

      </section>
    </section>

    <section anchor='IANA'
	     title='IANA Considerations'>
      <t>
	IANA to assign rules for the existing registry "Mobile IPv4
	numbers - per RFC&nbsp;3344".  The numbering space for
	Extensions that may appear in Mobile IP control messages
	(those sent to and from UDP port number 434) should be
	modified.
      </t>

      <t>
	The new Values and Names for the Type for Extensions appearing
	in Mobile IP control messages are the following:
      </t>

      <texttable anchor="valuesnames-typeext"
		 title="New Values and Names for Extensions
			in Mobile IP Control Messages">
	<preamble>
	</preamble>

	<ttcol align="right">
	  Value
	</ttcol>

	<ttcol align="left">
	  Name
	</ttcol>

	<c>
	  TBA
	</c>

	<c>
	  Mobile Network Extension (To Be Assigned by IANA)
	</c>

	<postamble>
	</postamble>
      </texttable>

      <t>
	A new number space should be created for the Values and Names
	for the Sub-Type for Mobile Network Extensions.  This number
	space is initially defined to hold the following entries,
	allocated by this document:
      </t>
      
      <texttable anchor="valuesnames-subtype"
		 title="New Values and Names for the Sub-Type
			for Mobile Network Extensions">
	<preamble>
	</preamble>
	<ttcol align="right">
	  Value
	</ttcol>

	<ttcol align="left">
	  Name
	</ttcol>

	<c>
	  TBA
	</c>

	<c>
	  Mobile Network Request Extension
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Explicit Mode Acknowledgement Extension
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Implicit Mode Acknowledgement Extension
	</c>

	<postamble>
	</postamble>
      </texttable>

      <t>
	The policy of future assignments to this number space should
	be following Standards Action or IESG Approval (see <xref
	target='RFC2434' />).
      </t>

      <t>
	The new Code Values for Mobile IP Registration Reply messages
	are the following (for a registration denied by the Home
	Agent):
      </t>

      <texttable anchor='codevalues-regrep'
		 title='New Code Values
			for Mobile IP Registration Reply'>
	<preamble>
	</preamble>

	<ttcol align="right">
	  Value
	</ttcol>

	<ttcol align="left">
	  Name
	</ttcol>

	<c>
	  TBA
	</c>

	<c>
	  Mobile Network Prefix operation error (HA_MOBNET_ERROR)
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Mobile Router operation is not permitted
	  (HA_MOBNET_DISALLOWED)
	</c>

	<postamble>
	</postamble>
      </texttable>

      <t>
	A new number space should be created for the Code Values for
	the Mobile Network Acknowledgement Extension.  This number
	space is initially defined to hold the following entries,
	allocated by this document (result of registration, as sent by
	the Home Agent):
      </t>

      <texttable anchor='codevalues-mnack'
		 title='New Code Values
			for Mobile Network Acknowledgement Extension'>
	<preamble>
	</preamble>

	<ttcol align='right'>
	</ttcol>
	<ttcol align='left'>
	</ttcol>

	<c>
	  TBA
	</c>

	<c>
	  Success
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Invalid prefix length (MOBNET_INVALID_PREFIX_LEN)
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Mobile Router is not authorized for prefix
	  (MOBNET_UNAUTHORIZED)
	</c>

	<c>
	  TBA
	</c>

	<c>
	  Forwarding setup failed (MOBNET_FWDING_SETUP_FAILED)
	</c>
	
	<postamble>
	</postamble>
      </texttable>

      <t>
	The policy of future assignments to this number space should
	be following Standards Action or IESG Approval (see <xref
	target='RFC2434' />).
      </t>

      <t>
	The current non-modified numbering spaces could be consulted
	at the URL
	<eref
	    target='http://www.iana.org/assignments/mobileip-numbers'>
	  http://www.iana.org/assignments/mobileip-numbers
	</eref>
	  (contents last updated 2007-12-20 and last browsed
	  2008-01-04).
      </t>

    </section>

    <section anchor='Acknowledgements'
	     title='Acknowledgements'>
      <t>
	The authors would like to thank Christophe Janneteau, George
	Popovich, Ty Bekiares, Ganesh Srinivasan, Alpesh Patel, Ryuji
	Wakikawa, George Tsirtsis, and Henrik Levkowetz for their
	helpful discussions, reviews and comments.  Vijay Devarapalli
	extensively reviewed one of the later versions of the draft.
	Hans Sjostrand (Hans Sj\"ostrand) identified the last
	clarifications with respect to Foreign Agent mode treatment.
	Pete McCann contributed necessary refinements of many
	statements.
      </t>
      <t>
	Mobile IPv4 versions as early as 1996 (RFC 2002) described
	Mobile Networks and Mobile Routers support.  Charles Perkins.
      </t>
      <t>
	Fred Templin indicated the potential confusion for the term
	"LFN".
      </t>
      <t>
	Amanda Baber of IANA agreed on the principles of allocating
	numbers for this specification and suggested improvements on
	the IANA section.
      </t>
      <t>
	Tim Polk of IESG identified a deeply entrenched error on
	managing the Code fields.
      </t>
      <t>
	Lars Eggert of IESG suggested the acommodation of the
	otherwise legal non-contiguous netmask fields, instead of
	simply prefix lengths.
      </t>
      <t>
	Dan Romascanu of IESG indicated the necessity of manageability
	of Mobile Routers and NEMOv4-enabled Home Agents and their
	deployability in MIP4 environments.
      </t>
      <t>
	David Borman of TSV-DIR reviewed this document as part of the
	transport area directorate's ongoing effort to review key IETF
	documents.  The implications of the growth of usable MTU
	adversely affecting applications deep in a mobile network were
	suggested.
      </t>
      <t>
	Gonzalo Camarillo provided a generalist review by an
	additional set of eyes for documents as they are being
	considered for publication (General Area Review Team).
      </t>
      <t>
	Jari Arkko of IESG reviewed, suggested necessary improvements
	to, and diligently shepherded this document through IESG.
      </t>
    </section>

  </middle>

  <back>

    <references title='Normative References'>
	<?rfc include="reference.RFC.2119" ?>
	<?rfc include="reference.RFC.3344" ?>
	<?rfc include="reference.RFC.2794" ?>
	<?rfc include="reference.RFC.2328" ?>
	<?rfc include="reference.RFC.4271" ?>
	<?rfc include="reference.RFC.2453" ?>
	<?rfc include="reference.RFC.2434" ?>
	<?rfc include="reference.RFC.2006" ?>
	<?rfc include="reference.RFC.4885" ?>
	<?rfc include="reference.RFC.1323" ?>
    </references>

    <references title='Informative References'>
      <?rfc include="reference.RFC.3963" ?>
      <?rfc include="reference.I-D.ietf-mip4-nemov4-fa" ?>
    </references>

    <section anchor='changelog'
	     title='ChangeLog'>
      <t>
	[RFC Editor: please remove this section prior to
	publication. (said IESG member Russ Housley on 6th of February
	2008: "Please delete Appendix A before publication as an
	RFC.")]
      </t>
      <t>
	The changes are listed in reverse chronological order, most
	recent changes appearing at the top of the list.
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-08.txt to
	draft-ietf-mip4-nemo-v4-base-09.txt, following IANA and IESG
	comments:
	<list style='symbols'>
	  <t>
	    Introduced an Optional Netmask field in both registrations
	    and replies.  This is used when address/prefixlength is
	    not a sufficient expression of network mask, for example
	    when the subnet mask needs to be expressed as a
	    non-contiguous set of 1bits (e.g. 255.255.0.255).  Also
	    described the reasoning of this in a section of its own.
	  </t>
	  <t>
	    Extended the Introduction section with two subsections:
	    example of mobile network and overall protocol operation.
	    Illustrated two figures.
	  </t>
	  <t>
	    Added Local Fixed Node term definition and some citations
	    to reference rfc4885 "Network Mobility Support
	    Terminology".
	  </t>
	  <t>
	    Clarified text about the Code field.  There are two Code
	    fields: one in Registration Reply header (the Code proper)
	    and one in the Mobile Network Extension header.  Also
	    clarified conditions of proper Code being 0 successful and
	    and relationships of proper Code 0 to Code in the Mobile
	    Network Extension.
	  </t>
	  <t>
	    Added a sub-section 'Mobile Router Management' about the
	    initial configuration, ongoing supervision and management
	    indicators of a Mobile Router and Home Agent.
	  </t>
	  <t>
	    Substituted 'MOBNET_UNAUTHORIZED' for
	    'MOBNET_UNAUTHORIZED_MR'.
	  </t>
	  <t>
	    Substituted 'IANA to assign rules' for 'IANA to modify
	    rules'.
	  </t>
	  <t>
	    Stressed that "applications that do not support MTU
	    discovery are adversely affected by the additional header
	    encapsulations, because the usable MTU is reduced with
	    each level of nesting."
	  </t>
	  <t>
	    Removed citations and reference to rfc3344bis
	    (draft-ietf-mip4-rfc3344bis-05).
	  </t>
	  <t>
	    Removed citations and reference to rfc2434bis
	    (draft-narten-iana-considerations-rfc2434bis-08).
	  </t>
	  <t>
	    Extended the Acknowledgements section.
	  </t>

	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-07.txt to
	draft-ietf-mip4-nemo-v4-base-08.txt, following AD Review (Jari
	Arkko):
      </t>
      <t>
	<list style='symbols'>
	  <t>
	    HA propagates Mobile Network Prefix only if necessary
	    (previously it was always doing it).
	  </t>
	  <t>
	    emphasized that within nested mobile networks looping may
	    occur and this document doesn't do anything to address this.
	  </t>
	  <t>
	    dropped a phrase which said that Mobile-Home auth
	    extension shouldn't be used when ESP protects the routing
	    protocol message, because that extension is only applied
	    to Registration messages (not tunneled data, which usually
	    contains routing protocol exchange).
	  </t>
	  <t>
	    recommending "Standards Action or IESG Review" instead of
	    "Expert Review" for this numbering space, and added
	    reference to a draft for 2434bis.
	  </t>
	  <t>
	    editorial: re-phrased about how Mobile IPv4 claimed mobile
	    networks support.
	  </t>
	  <t>
	    editorial: added a necessary paragraph in the
	    Acknowledgements section.
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-06.txt to
	draft-ietf-mip4-nemo-v4-base-07.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    encoded the draft into xml.  Compiled with xml2rfc version
	    1.33pre4.
	  </t>
	  <t>
	    checked against 'idnits' script version 2.05.03.
	  </t>
	  <t>
	    substituted 'Care-of Address' for 'CoA'.
	  </t>
	</list>
      </t>
      
      <t>
	From draft-ietf-mip4-nemo-v4-base-05.txt to
	draft-ietf-mip4-nemo-v4-base-06.txt
      </t>
      <t>
      <list style='symbols'>
	<t>
	  substituted "TBA" for "1" in Sub-type of Mobile Network
	  Request Extension.
	</t>
	<t>
	  substituted "TBA" for "0" in Code of Mobile Network
	  Acknowledgement Extension and in the IANA Section.
	</t>
	<t>
	  modified the IANA section to request definition two new
	  spaces (instead of just defining new values) for Sub-Type of
	  Mobile Network Extensions and for Code Values for Mobile
	  Network Acknowledgement Extension, and to suggest "Expert
	  Review" as method of new assignments in these two spaces
	  (and not necessarily "IETF Consensus").
	</t>
      </list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-04.txt to
	draft-ietf-mip4-nemo-v4-base-05.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    updated the Acknowledgements section.
	  </t>
	  <t>
	    capitalized all occurences of "Home Address", "Mobile
	    Router" and "Care-of Address".
	  </t>
	  <t>
	    refined many statements.
	  </t>
	  <t>
	    checked against 'idnits' script version 2.04.16.
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-03.txt to
	draft-ietf-mip4-nemo-v4-base-04.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    more changes in Introduction to say that with FA mode only
	    the non-optimized double-encapsulation operation is
	    supported and <xref target='I-D.ietf-mip4-nemov4-fa' />
	    proposes a optimization.
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-02.txt to
	draft-ietf-mip4-nemo-v4-base-03.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    changed a sentence in the Introduction to say that FA mode
	    _is_ supported but unoptimized, and that a <xref
	    target='I-D.ietf-mip4-nemov4-fa'>reference</xref>
	    optimizes that mode.
	  </t>
	  <t>
	    added I-D.ietf-mip4-rfc3344bis reference to the rfc3344bis
	    draft.
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-01.txt to
	draft-ietf-mip4-nemo-v4-base-02.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    changed title from "IPv4 Network Mobility (NEMO) Protocol"
	    to "Network Mobility (NEMO) Extensions for Mobile IPv4".
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-mip4-nemo-v4-base-00.txt to
	draft-ietf-mip4-nemo-v4-base-01.txt
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    added a section on Routing Protocol between Mobile Router
	    and Home Agent.
	  </t>
	  <t>
	    added a security subsection about running simultaneously a
	    secure routing protocol with secure Mobile IPv4.
	  </t>
	  <t>
	    added a date tag on the IANA URL for Mobile IP numbering
	    spaces.
	  </t>
	  <t>
	    substituted 'Mobile Router' for 'MR' everywhere.
	  </t>
	  <t>
	    updated reference to NEMOv4 FA draft.
	  </t>
	</list>
      </t>

      <t>
	From draft-ietf-nemo-v4-base-01.txt to
	draft-ietf-mip4-nemo-v4-base-00.txt:
      </t>

      <t>
	<list style='symbols'>
	  <t>
	    changed draft name, headers and footers.
	  </t>
	  <t>
	    changed title.
	  </t>
	  <t>
	    a more coherent use of terms 'subnet', 'prefix' and
	    'mobile network'.
	  </t>
	  <t>
	    clarified only co-located CoA mode is supported (not FA
	    CoA) for Mobile Routers in this specification.  And added
	    reference to the FA NEMO optimizations draft.
	  </t>
	  <t>
	    changed 'devices' to 'hosts'.
	  </t>
	  <t>
	    changed 'moving networks' to 'mobile networks'.
	  </t>
	  <t>
	    clarified what 'reachability' in a certain context is:
	    packets may be dropped if ingress filtering is turned on.
	  </t>
	  <t>
	    removed the MR-FA-CoA tunnel overhead optimization.  There
	    is still an issue with text at HA doing optimization.
	  </t>
	</list>
      </t>

      <t>
	This document was first presented as an individual
	contribution to the NEMO Working Group, then adopted as a WG
	item to that group.  The 01 version in the NEMO WG has been
	Last Called on the INFORMATIONAL track.  The evolution was:
      </t>

      <t>
	From version draft-ietf-nemo-v4-base-00 to
	draft-ietf-nemo-v4-base-01:
      </t>
      
      <t>
	<list style='symbols'>
	  <t>
	    removed error code HA_MOBNET_UNSUPPORTED.
	  </t>
	  <t>
	    changed all values to be assigned by IANA, from specific
	    numbers to "TBA" (To Be Assigned).
	  </t>
	  <t>
	    substituted "egress interface" for "roaming interface".
	  </t>
	  <t>
	    changed HA behaviour upon reception of MNPs.  In 00 the HA
	    replied positively only if all MNPs in RegReq were valid,
	    in 01 a reply is constructed specifying which MNP was
	    valid and which not.
	  </t>
	  <t>
	    clarified a 3-line paragraph saying that RegRep may
	    contain both implicit and explicit acknowledgements.
	  </t>
	</list>
      </t>

    </section>

<!--
    XML ChangeLog

   17 February 2008 - some more content changes following IESG Review
                      and IANA Comments.
   20 January 2008 - several content changes following AD review
                     towards draft-ietf-mip4-nemo-v4-base-08.txt
    4 January 2008 - converted the exclusively textual
                     draft-ietf-mip4-nemo-v4-base-06.txt into
                     draft-ietf-mip4-nemo-v4-base-07.xml
                   - compiled with xml2rfc 1.33pre4
-->

  </back>

</rfc>
