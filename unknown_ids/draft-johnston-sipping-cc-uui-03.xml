<?xml version="1.0"?><!DOCTYPE rfc SYSTEM "rfc2629.dtd"><?rfc compact="yes"?><?rfc toc="yes"?><rfc ipr="full3978" docName="draft-johnston-sipping-cc-uui-03"><front><title abbrev="SIP UUI for CC">Transporting User to User Call Control Information in SIP for ISDN Interworking</title><author initials="A." surname="Johnston" fullname="Alan Johnston" role="editor"><organization>Avaya</organization> <address>  <postal>   <city>St. Louis</city><region>MO</region><code>63124</code>   </postal>  <email>alan@sipstation.com</email>  </address></author><author initials="J." surname="McMillen" fullname="Joanne McMillen"><organization>Avaya</organization><address><email> joanne@avaya.com</email></address></author><date month="January" year="2008"/><workgroup>SIPPING WG</workgroup><abstract> <t>Several approaches to transporting the ITU-T Q.931 User to User Information  Element (UU IE) data in SIP have been implemented. As networks move to SIP it is important that applications requiring this data can continue to function in SIP networks as well as the ability to interwork the information to/from ISDN for end-to-end transparency.  This document discusses the approaches and recommends a new header field User-to-User be standardized. An example application of an Automatic Call Distributor (ACD) in a contact center is given. </t></abstract></front><middle><section title="Overview"> <t>    This document describes the transport of User to User Information (UUI) in ISDN interworking scenarios using SIP <xref target="RFC3261" />.    Specifically, we discuss the transport of call control related ITU-T Q.931 User to User Information  Element (UU IE) <xref target="q931" /> data in SIP.  An example use case is interworking an Automatic Call Distributed (ACD) in a contact center. </t></section><section title="Roles">   <t>    There are three roles in a typical Call Center scenario:   <figure><artwork>   Originator -      The party generating the call destined for the contact                    center.      ACD -             The automatic call distributor which performs database                    queries and determines proper routing for the call.  Terminator  -     The destination of the call as determined by the ACD.  </artwork></figure>  </t> </section> <section title="Approaches">  <t> Four approaches will be described: MIME body, header field, and URI parameter transport.<section title="Why INFO is Not Used"><t>Since the INFO method was developed for ISUP interworking of user-to-user information, it might seem to be the logical choice here.  For non-call control user-to-user information, INFO can be utilized for end to end transport.  However, for transport of call control user-to-user information, INFO can not be used.  As the call flows in the next section show, the information is related to an attempt to establish a session and must be passed with the session setup request (INVITE), responses to that INVITE, or session termination requests.  As a result, it is not possible to use INFO in these cases.</t></section></t>  <section title="Call Flows">   <t>All three approaches use the same call flows, shown in Figures 1, 2, and 4 below.  Figure 1 shows the ACD redirecting thecall prior to it being answered using a 302 Moved Temporarily response.  User to user information (UUI) is added by theACD which is then included in the INVITE sent to the Terminator.  The URI of the terminator is contained in theContact header field of message F2.</t><figure><artwork><![CDATA[           Originator               ACD             Terminator                |                    |                    |                 |          INVITE F1 |                    |                 |------------------->|                    |                 | 302 Moved (UUI) F2 |                    |                 |<-------------------|                    |                 |            ACK F3  |                    |                 |------------------->|                    |                 |  INVITE (UUI) F4   |                    |                 |---------------------------------------->|                |  200 OK F5                              |                 |<----------------------------------------|                |  ACK F6                                 |                 |---------------------------------------->|     ]]></artwork></figure> <t>  Figure 1. Call flow with redirection prior to answer. </t><t>Figure 2 shows a call flow in which the call is answered by the ACD and then the call is transferred using a REFER.  Ifthe ACD does not care to receive notification of the outcome of the transfer, the BYE could be sent immediately, or theRefer-Sub: false header field added to the REFER.  If the REFER is sent out of dialog, the Target-Dialog header field willneed to be present.</t><figure><artwork><![CDATA[           Originator               ACD             Terminator                |                    |                    |                 |          INVITE F1 |                    |                 |------------------->|                    |                 |       200 OK F2    |                    |                 |<-------------------|                    |                 |         ACK F3     |                    |                 |------------------->|                    |                 |  REFER (UUI) F4    |                    |                 |<-------------------|                    |                 |  202 Accepted F5   |                    |                 |------------------->|                    |                 | NOTIFY (100 Trying) F6                  |                 |------------------->|                    |                 |         200 OK F7  |                    |                 |<-------------------|                    |                 |  INVITE (UUI) F8   |                    |                 |---------------------------------------->|                |  200 OK F9                              |                 |<----------------------------------------|                |  ACK F10                                |                 |---------------------------------------->|                 | NOTIFY (200 OK) F11|                    |                 |------------------->|                    |                 |        200 OK F12  |                    |                 |<-------------------|                    |                 |  BYE F13           |                    |                 |<-------------------|                    |                 |  200 OK F14        |                    |                 |------------------->|                    |      ]]></artwork></figure><t>Figure 2. Call flow with transfer after answer.</t><t>Note that there have been some proposals to use REFER for scenario of Figure 1.  In this case, a REFER is sent by the ACDduring the early dialog.  This NOT RECOMMENDED call flow is shown in Figure 3.  This flow is not recommended due to thenumber of messages exchanged (due to the REFER, CANCEL, and 487 responses) and the sending of the REFER in the early dialog.</t><figure><artwork><![CDATA[           Originator               ACD             Terminator                |                    |                    |                 |          INVITE F1 |                    |                 |------------------->|                    |                 |     180 Ringing F2 |                    |                 |<-------------------|                    |                 |  REFER (UUI) F3    |                    |                 |<-------------------|                    |                 |  202 Accepted F4   |                    |                 |------------------->|                    |                 | NOTIFY (100 Trying) F5                  |                 |------------------->|                    |                 |         200 OK F6  |                    |                 |<-------------------|                    |                 |  INVITE (UUI) F7   |                    |                 |---------------------------------------->|                |  200 OK F8                              |                 |<----------------------------------------|                |  ACK F9                                 |                 |---------------------------------------->|                 | NOTIFY (200 OK) F10|                    |                 |------------------->|                    |                 |        200 OK F11  |                    |                 |<-------------------|                    |                 | CANCEL F12         |                    |                 |------------------->|                    |                 |  200 OK F13        |                    |                 |<-------------------|                    |                 | 487 Request Terminated  F14             |                 |<-------------------|                    |                 | ACK F15            |                    |                 |------------------->|                    |     ]]></artwork></figure><t>Figure 3. NOT RECOMMENDED call flow showing REFER prior to answer. </t><t>In Figure 4, the ACD is shown proxying the INVITE to the terminator instead of redirecting as in Figure 1.</t><figure><artwork><![CDATA[           Originator               ACD             Terminator                |                    |                    |                 |          INVITE F1 |                    |                 |------------------->|   INVITE (UUI) F2  |                 |      100 Trying F3 |------------------->|                 |<-------------------|         200 OK F4  |                 |          200 OK F5 |<-------------------|                 |<-------------------|                    |                 |  ACK F6            |                    |                 |------------------->|            ACK F7  |                 |                    |------------------->|     ]]></artwork></figure> <t>  Figure 4. Call flow with proxying. </t><t>In Figure 5, the ACD is shown proxying the INVITE  and modifying the UUI informationprovided by the Originator.</t><figure><artwork><![CDATA[           Originator               ACD             Terminator                |                    |                    |                 |   INVITE (UUI1) F1 |                    |                 |------------------->|   INVITE (UUI2) F2 |                 |      100 Trying F3 |------------------->|                 |<-------------------|         200 OK F4  |                 |          200 OK F5 |<-------------------|                 |<-------------------|                    |                 |  ACK F6            |                    |                 |------------------->|            ACK F7  |                 |                    |------------------->|     ]]></artwork></figure> <t>  Figure 5. Call flow with proxy modifying the UUI. </t></section><section title="MIME body Approach"><t>One method of transport is to transport the UUI information as a MIME body.  This is in keeping with the SIP-T architecturein which MIME bodies are used to transport ISUP information.  However, in the SIP-T example, the body is added by the originator and used by the terminator.  The insertion of the UUI by an intermediary, the ACD, is difficult.  The body wouldneed to be encoded in the Contact URI of Figure 1 or the Refer-To URI of Figure 2.  For example, if the application/acd MIME typewere defined:</t><figure><artwork><![CDATA[Contact: <sip:+12125551212@gateway.example.com?Content-Type=application/acd&body=ZeGl9i2icVqaNVailT6F5iJ90m6mvuTS4OK05M0vDk0Q4Xs>]]></artwork></figure><t>The resulting INVITE would then have two message bodies, one SDP, the other being the MIME object.  In addition to the body,the escaped Content-Type header field should also be included in the resulting INVITE.</t><t>While the body approach would work with the redirection and REFER call flows, but does not work with the proxy call flow of Figure 4.</t></section><section title="Header Field Approach"><t>Another approach that has been proposed is to use a header field to tranport the UUI information.  The header fieldwould be excaped into the Contact or Refer-To URI.  The header field approach will work with the redirection, REFER, and proxycall flows.  The Call-Info header field is related to the UUI information.  However, there are a number of important differences:</t>  <list> <t>Call-Info is for rendering to the user.  While some of the UUI information may ultimately be rendered to the user,most of the UUI information will be consumed by the end device.</t><t>Call-Info contains a URI pointer the information instead of the actual information itself. </t></list><t>The use of the data URI scheme <xref target="RFC2397" /> could be used to overcome the second issue, i.e.:</t><figure><artwork><![CDATA[Call-Info: <data:applicaton/acd,ZeGl9i2icVqaNVailT6F5iJ90m6mvuTS4OK05M0vDk0Q4Xs>]]></artwork></figure><t>For these reasons, a separate header field needs to be defined, described here as User-to-User:</t><figure><artwork><![CDATA[Contact: <sip:+12125551212@gateway.example.com?User-to-User=ZeGl9i2icVqaNVailT6F5iJ90m6mvuTS4OK05M0vDk0Q4Xs>]]></artwork></figure><t>The resulting INVITE would contain the User-to-User header field.</t></section><section title="URI Parameter"><t>Another proposed approach is to encode the UUI as a URI parameter into the Contact or Refer-To URI.</t><figure><artwork><![CDATA[Contact: <sip:+12125551212@gateway.example.com;uui=ZeGl9i2icVqaNVailT6F5iJ90m6mvuTS4OK05M0vDk0Q4Xs>]]></artwork></figure><t>The resulting INVITE would contain UUI in the Request-URI of the INVITE.  The URI parameter has a drawback in that a URI parameter will not survive retargeting by a proxy.  That is, if the URI is an Address of Record instead of a ContactURI, the URI parameter will not be copied over the Contact URI, resulting in the loss of the information.</t></section></section><section title="Recommendation"><t>The recommendation is to define a new SIP header field User-to-User to transport UUI information in ISDN interworking applications.</t><t>The format of the UUI information is a topic of future standardization.  Currently, UUI isproprietary, requiring coordinated configuration between servers.  Standardizing the formator providing content tags would provide additional benefits.</t><t>Current usage is to interoperate with ISDN User to User Signaling (UUS), a supplementary service in which manufacturer specific information is transported via the codeset 0 User-user Information IE.  Three services are defined: service 1, service 2, and service 3. This draft only addresses the SIP equivalent of service 1 although it could easily be expanded later to address services 2 and 3. UUS Service 1 involves user to user signaling exchanged during call setup and clearing within the following Q.931 call control messages: SETUP, ALERT, CONNECT, DISCONNECT, RELEASE, and RELEASE COMPLETE. UUS Service 2 involves user to user signaling exchanged during call establishment (between ALERT and CONNECT) via the USER INFORMATION message. This service usually has a maximum of 2 USER INFORMATION messages in each direction. UUS Service 3 involves user to user signaling exchanged on an active call via the USER INFORMATION message.</t></section><section title="Appendix - Syntax for UUI Header Field"><t>Editor's Note: Eventually this text will move to a SIP Working Group document to define the new header field.</t><t>   The User-to-User header field can be present in INVITE requests and responses only and in BYE requests and responses.</t><t>   The following syntax specification uses the augmented Backus-Naur   Form (BNF) as described in RFC 2234 and extends RFC 3261.</t><figure><artwork><![CDATA[      UUI             = "User-to-User" HCOLON uui-data *(SEMI uui-param)      uui-data        = token      uui-param       = enc-param | generic-param      enc-param       = "encoding=" ("hex" | token)]]></artwork></figure><t>Only one User-to-User header field may be present in a request or response.</t><t>The only defined parameter for the User-to-User header field is the encoding parameter.  "encoding=hex" is used to indicate that the UUI information is encoded as hex digits per the ISDN specification (including the protocol discriminator).  Other encoding methods of encoding may also be standardized.</t></section><section title="IANA Considerations"><t>TBD.</t></section><section title="Security Considerations"><t>TBD.</t></section></middle><back><references title="Informative References"><?rfc include="reference.RFC.3261" ?><reference anchor='q931'><front><title>ITU-T Q.931 User to User Information  Element (UU IE)</title></front><seriesInfo name='http://www.itu.int/rec/T-REC-Q.931-199805-I/en' value='' /><format type='HTML' target='http://www.itu.int/rec/T-REC-Q.931-199805-I/en' /></reference><?rfc include="reference.RFC.3372" ?><?rfc include="reference.RFC.2976" ?><?rfc include="reference.RFC.3515"?><?rfc include="reference.RFC.4488"?><?rfc include="reference.RFC.2397"?><?rfc include="reference.RFC.4538" ?></references></back></rfc>