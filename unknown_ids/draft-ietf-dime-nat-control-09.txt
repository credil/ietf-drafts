


Internet Engineering Task Force                             F. Brockners
Internet-Draft                                               S. Bhandari
Intended status: Standards Track                                   Cisco
Expires: January 11, 2012                                       V. Singh

                                                              V. Fajardo
                                                  Telcordia Technologies
                                                           July 10, 2011


   Diameter Network Address and Port Translation Control Application
                     draft-ietf-dime-nat-control-09

Abstract

   This document describes the framework, messages, and procedures for
   the Diameter Network address and port translation Control
   Application.  This Diameter application allows per endpoint control
   of Network Address Translators and Network Address and Port
   Translators, which are added to networks to cope with IPv4-address
   space depletion.  This Diameter application allows external devices
   to configure and manage a Network Address Translator device -
   expanding the existing Diameter-based AAA and policy control
   capabilities with a Network Address Translators and Network Address
   and Port Translators control component.  These external devices can
   be network elements in the data plane such as a Network Access
   Server, or can be more centralized control plane devices such as AAA-
   servers.  This Diameter application establishes a context to commonly
   identify and manage endpoints on a gateway or server, and a Network
   Address Translator and Network Address and Port Translator device.
   This includes, for example, the control of the total number of
   Network Address Translator bindings allowed or the allocation of a
   specific Network Address Translator binding for a particular
   endpoint.  In addition, it allows Network Address Translator devices
   to provide information relevant to accounting purposes.

Status of this Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any



Brockners, et al.       Expires January 11, 2012                [Page 1]

Internet-Draft      Diameter NAT Control Application           July 2011


   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 11, 2012.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.
































Brockners, et al.       Expires January 11, 2012                [Page 2]

Internet-Draft      Diameter NAT Control Application           July 2011


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  5
   2.  Conventions  . . . . . . . . . . . . . . . . . . . . . . . . .  6
   3.  Deployment Framework . . . . . . . . . . . . . . . . . . . . .  7
     3.1.  Deployment Scenario  . . . . . . . . . . . . . . . . . . .  7
     3.2.  Diameter NAPT Control Application Overview . . . . . . . .  9
     3.3.  Deployment Scenarios For DNCA  . . . . . . . . . . . . . . 10
   4.  DNCA Session Establishment and Management  . . . . . . . . . . 12
     4.1.  Session Establishment  . . . . . . . . . . . . . . . . . . 12
     4.2.  Session Re-Authorization . . . . . . . . . . . . . . . . . 14
     4.3.  Session and Binding Query  . . . . . . . . . . . . . . . . 17
     4.4.  Session Termination  . . . . . . . . . . . . . . . . . . . 18
     4.5.  Session Abort  . . . . . . . . . . . . . . . . . . . . . . 19
     4.6.  Failure cases of the DNCA Diameter peers . . . . . . . . . 20
   5.  Use Of The Diameter Base Protocol  . . . . . . . . . . . . . . 21
     5.1.  Securing Diameter Messages . . . . . . . . . . . . . . . . 21
     5.2.  Accounting Functionality . . . . . . . . . . . . . . . . . 22
     5.3.  Use Of Sessions  . . . . . . . . . . . . . . . . . . . . . 22
     5.4.  Routing Considerations . . . . . . . . . . . . . . . . . . 22
     5.5.  Advertising Application Support  . . . . . . . . . . . . . 22
   6.  DNCA Commands  . . . . . . . . . . . . . . . . . . . . . . . . 22
     6.1.  NAT-Control Request (NCR) Command  . . . . . . . . . . . . 22
     6.2.  NAT-Control Answer (NCA) Command . . . . . . . . . . . . . 23
   7.  NAT Control Application Session State Machine  . . . . . . . . 24
   8.  DNCA AVPs  . . . . . . . . . . . . . . . . . . . . . . . . . . 27
     8.1.  Reused Base Protocol AVPs  . . . . . . . . . . . . . . . . 27
     8.2.  Additional Result-Code AVP Values  . . . . . . . . . . . . 28
       8.2.1.  Success  . . . . . . . . . . . . . . . . . . . . . . . 28
       8.2.2.  Transient Failures . . . . . . . . . . . . . . . . . . 28
       8.2.3.  Permanent Failures . . . . . . . . . . . . . . . . . . 29
     8.3.  Reused NASREQ Diameter Application AVPs  . . . . . . . . . 30
     8.4.  Reused AVPs from RFC 4675  . . . . . . . . . . . . . . . . 30
     8.5.  Reused AVPs from Diameter QoS Application  . . . . . . . . 31
     8.6.  Reused AVPs from ETSI ES 283 034, e4 Diameter
           Application  . . . . . . . . . . . . . . . . . . . . . . . 31
     8.7.  DNCA Defined AVPs  . . . . . . . . . . . . . . . . . . . . 32
       8.7.1.  NC-Request-Type AVP  . . . . . . . . . . . . . . . . . 32
       8.7.2.  NAT-Control-Install AVP  . . . . . . . . . . . . . . . 33
       8.7.3.  NAT-Control-Remove AVP . . . . . . . . . . . . . . . . 33
       8.7.4.  NAT-Control-Definition AVP . . . . . . . . . . . . . . 33
       8.7.5.  NAT-Internal-Address AVP . . . . . . . . . . . . . . . 34
       8.7.6.  NAT-External-Address AVP . . . . . . . . . . . . . . . 34
       8.7.7.  Max-NAT-Bindings . . . . . . . . . . . . . . . . . . . 35
       8.7.8.  NAT-Control-Binding-Rule AVP . . . . . . . . . . . . . 35
       8.7.9.  Duplicate-Session-Id AVP . . . . . . . . . . . . . . . 35
   9.  Accounting Commands  . . . . . . . . . . . . . . . . . . . . . 35
     9.1.  NAT Control Accounting Messages  . . . . . . . . . . . . . 36



Brockners, et al.       Expires January 11, 2012                [Page 3]

Internet-Draft      Diameter NAT Control Application           July 2011


     9.2.  NAT Control Accounting AVPs  . . . . . . . . . . . . . . . 36
       9.2.1.  NAT-Control-Record . . . . . . . . . . . . . . . . . . 36
       9.2.2.  NAT-Control-Binding-Status . . . . . . . . . . . . . . 36
       9.2.3.  Current-NAT-Bindings . . . . . . . . . . . . . . . . . 37
   10. AVP Occurrence Table . . . . . . . . . . . . . . . . . . . . . 37
     10.1. DNCA AVP Table for NAT Control Initial and Update
           Requests . . . . . . . . . . . . . . . . . . . . . . . . . 37
     10.2. DNCA AVP Table for Session Query request . . . . . . . . . 38
     10.3. DNCA AVP Table for Accounting Message  . . . . . . . . . . 38
   11. IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 38
     11.1. Application Identifier . . . . . . . . . . . . . . . . . . 39
     11.2. Command Codes  . . . . . . . . . . . . . . . . . . . . . . 39
     11.3. AVP Codes  . . . . . . . . . . . . . . . . . . . . . . . . 39
     11.4. Result-Code AVP Values . . . . . . . . . . . . . . . . . . 39
     11.5. NC-Request-Type AVP  . . . . . . . . . . . . . . . . . . . 39
     11.6. NAT-Control-Binding-Status AVP . . . . . . . . . . . . . . 39
   12. Security Considerations  . . . . . . . . . . . . . . . . . . . 40
   13. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 41
   14. Change History (to be removed prior to publication as an
       RFC) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
   15. Normative References . . . . . . . . . . . . . . . . . . . . . 43
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 44





























Brockners, et al.       Expires January 11, 2012                [Page 4]

Internet-Draft      Diameter NAT Control Application           July 2011


1.  Introduction

   Internet service providers have started to deploy Network Address
   Translators (NATs) and Network Address and Port Translators (NAPTs)
   in their networks to deal with the depletion of available public IPv4
   addresses.  This document defines a Diameter application allowing
   providers to control the behavior of these NAT and NAPT devices.  The
   use of a Diameter application allows for simple integration into the
   existing Authentication, Authorization and Accounting (AAA)
   environment of a provider.

   The Diameter Network address and port translation Control Application
   (DNCA) offers the following capabilities:

   1.  Limits or defines the number of NAPT/NAT bindings made available
       to an individual end point or user.  The main motivation for
       restricting the number of bindings on a per end point basis is to
       protect the service of the service provider against denial of
       service attacks.  If multiple end points share a single public IP
       address, these end points can share fate.  If one end point would
       (either intentionally, or due to mis-behavior, mis-configuration,
       mal-ware, etc.) be able to consume all available bindings for a
       given single public IP address, service would be hampered (or
       might even become unavailable) for those other end points sharing
       the same public IP address.  The efficiency of a NAPT deployment
       depends on the maximum number of bindings an end point could use.
       Given that the typical number of bindings an end point uses
       depends on the type of end point (e.g. a personal computer of a
       broadband user is expected to use a higher number of bindings
       than a simple mobile phone) and a NAPT device is often shared by
       different types of end points, it is desirable to actively manage
       the maximum number of bindings.

   2.  Supports the allocation of specific NAPT/NAT bindings.  Two types
       of specific bindings can be distinguished:

       *  Allocation of a pre-defined NAT binding: Both the internal and
          external IP address and port pair are specified within the
          request.  Some deployment cases, such as access to a web-
          server within a user's home network with IP address and port,
          benefit from statically configured bindings.

       *  Allocation of an external IP address for a given internal IP
          address: The allocated external IP address is reported back to
          the requestor.  In some deployment scenarios, the application
          requires immediate knowledge of the allocated binding for a
          given internal IP address but does not control the allocation
          of the external IP address; for example, SIP-proxy server



Brockners, et al.       Expires January 11, 2012                [Page 5]

Internet-Draft      Diameter NAT Control Application           July 2011


          deployments.

   3.  Defines the external address pool(s) to be used for allocating an
       external IP address: External address pools can either be pre-
       assigned at the NAPT/NAT device, or specified within a request.
       If pre-assigned address pools are used, a request needs to
       include a reference to identify the pool.  Otherwise, the request
       contains a description of the IP address pool(s) to be used; for
       example, a list of IP-subnets.  Such external address pools can
       be used to select the external IP address in NAPT/NAT bindings
       for multiple subscribers.

   4.  Generates reports and accounting records: Reports established
       bindings for a particular user.  The collected information is
       used by accounting systems for statistical purposes.

   5.  Queries and retrieves details about bindings on demand: This
       feature complements the previously mentioned accounting
       functionality (see item 4).

   6.  Identifies a subscriber or endpoint on multiple network devices
       (NAT/NAPT device, the AAA-server, or the Network Access Server
       (NAS)): Endpoint identification is facilitated through a Global
       Endpoint ID.  Endpoints are identified through a single or a set
       of classifiers, such as IP address, Virtual Local Area Network
       (VLAN) identifier, or interface identifier which uniquely
       identify the traffic associated with a particular global
       endpoint.

   This document is structured as follows: Section 2 lists terminology,
   while Section 3 provides an introduction to DNCA and its overall
   deployment framework.  Sections 4 to 8 cover DNCA specifics, with
   Section 4 describing session management, Section 5 the use of the
   Diameter base protocol, Section 6 new commands, Section 7 AVPs used,
   and Section 8 accounting aspects.  Section 9 presents an AVP
   occurence table.  IANA and security considerations are addressed in
   Sections 10 and 11.


2.  Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

   Abbreviations used in this document:





Brockners, et al.       Expires January 11, 2012                [Page 6]

Internet-Draft      Diameter NAT Control Application           July 2011


      AAA: Authentication, Authorization, Accounting

      DNCA: Diameter Network address and port translation Control
      Application

      NAPT: Network Address and Port Translation

      NAT: Network Address Translation (NAT and NAPT are used in this
      document interchangeably)

      NAT-binding or binding: Association of two IP address/port pairs
      (with one IP address typically being private and the other one
      public) to facilitate NAT

      NAT-device: Network Address Translator or Network Address and Port
      Translator: An entity performing NAT or NAPT

      NAT-controller: Entity controlling the behavior of a NAT-device

      NAS: Network Access Server

      NCR: NAT Control Request

      NCA: NAT Control Answer


3.  Deployment Framework

3.1.  Deployment Scenario

   Figure 1 shows a typical network deployment for Internet access.  A
   user's IPv4 host gains access to the Internet though a NAS, which
   facilitates the authentication of the endpoint and configures the
   user's connection according to the authorization and configuration
   data received from the AAA-server upon successful authentication.
   Public IPv4 addresses are used throughout the network.















Brockners, et al.       Expires January 11, 2012                [Page 7]

Internet-Draft      Diameter NAT Control Application           July 2011


                         +---------+
                         |         |
                         |   AAA   |
                         |         |
                         +---------+
                              |
                              |
                              |
                              |
    +---------+          +---------+             +----------+
    |  IPv4   |          |         |             |  IPv4    |
    |  Host   |----------|   NAS   |-------------| Internet |
    |         |          |         |             |          |
    +---------+          +---------+             +----------+

    <-------------------- Public IPv4 ---------------------->

         Figure 1: Typical network deployment for internet access

   Figure 2 depicts the deployment scenario when a service provider
   introduces a NAT-device to increase the efficiency of the global IPv4
   address pool utilization.  The objective is to provide the customer
   with connectivity to the public IPv4 Internet.  The NAT-device
   performs network address and port (and optionally address family)
   translation, depending on whether the access network uses private
   IPv4 addresses or public IPv6 addresses, to public IPv4 addresses.
   If the NAT-device would be put in place without any endpoint
   awareness, the service offerings of the service provider could be
   impacted.  This includes cases like:

   o  Provisioning static NAT bindings for particular endpoints

   o  Using different public IP address pools for different set of
      endpoints (for example, residential or business customers)

   o  Reporting allocated bindings on a per endpoint basis

   o  Integrate control of the NAT-device into the already existing per
      endpoint management infrastructure of the service provider












Brockners, et al.       Expires January 11, 2012                [Page 8]

Internet-Draft      Diameter NAT Control Application           July 2011


                   +---------+
                   |         |
                   |   AAA   |
                   |         |
                   +---------+
                        |
                        |
                        |
                        |
     +--------+    +---------+    +--------+    +----------+
     |  IPv4/ |    |         |    |        |    |  IPv4    |
     |  IPv6  |----|   NAS   |----|  NAT-  |----| Internet |
     |  Host  |    |         |    | device |    |          |
     +--------+    +---------+    +--------+    +----------+
     <-------- Private IPv4 ----------><--- Public IPv4 --->
     <-------- Public  IPv6 ----------><--- Public IPv4 --->

               Figure 2: Access network deployment with NAT

3.2.  Diameter NAPT Control Application Overview

   DNCA runs between two DNCA Diameter peers.  One DNCA Diameter peer
   resides within the NAT-device, the other DNCA Diameter peer resides
   within the NAT-Controller.  DNCA allows per endpoint control and
   management of NAT within the NAT-device.  Based on Diameter, DNCA
   integrates well with the suite of Diameter applications deployed for
   per endpoint authentication, authorization, accounting, and policy
   control in service provider networks.

   DNCA offers:

   o  Request and answer commands to control the allowed number of NAT
      bindings per endpoint , to request the allocation of specific
      bindings for an endpoint, to define the address pool to be used
      for an endpoint.

   o  Provides per endpoint reporting of the allocated NAT bindings.

   o  Provides unique identification of an endpoint on NAT-device, AAA-
      server and NAS, to simplify correlation of accounting data
      streams.

   DNCA allows controlling the behavior of a NAT-device on a per
   endpoint basis during initial session establishment and at later
   stages by providing an update procedure for already established
   sessions.  Using DNCA, per endpoint NAT binding information can be
   retrieved either using accounting mechanisms or through an explicit
   session query to the NAT.



Brockners, et al.       Expires January 11, 2012                [Page 9]

Internet-Draft      Diameter NAT Control Application           July 2011


3.3.  Deployment Scenarios For DNCA

   DNCA can be deployed in different ways.  Two common deployment
   scenarios are outlined in Figure 3 ("integrated deployment") and
   Figure 4 ("autonomous deployment").  The two scenarios differ in
   which entity fulfills the role of the NAT-controller.  Within the
   figures (C) denotes the network element performing the role of the
   NAT-controller.

   The integrated deployment approach hides the existence of the NAT-
   device from external servers, such as the AAA-server.  It is suited
   for environments where minimal changes to the existing AAA deployment
   are desired.  The NAS and the NAT-device are Diameter peers
   supporting the DNCA.  The Diameter peer within the NAS, performing
   the role of the NAT-controller, initiates and manages sessions with
   the NAT-device, exchanges NAT specific configuration information and
   handles reporting and accounting information.  The NAS receives
   reporting and accounting information from NAT-device.  With this
   information, the NAS can provide a single accounting record for the
   endpoint.  A system correlating the accounting information received
   from NAS and NAT-device would not be needed.

   An example network attachment for an integrated NAT deployment can be
   described as follows: An endpoint connects to the network, with the
   NAS being the point of attachment.  After successful authentication,
   the NAS receives endpoint related authorization data from the AAA-
   server.  A portion of the authorization data applies to per endpoint
   configuration on the NAS itself, another portion describes
   authorization and configuration information for NAT control aimed at
   the NAT-device.  The NAS initiates a DNCA session to the NAT-device
   and sends relevant authorization and configuration information for
   the particular endpoint to the NAT-device.  This can comprise NAT-
   bindings, which have to be pre-established for the endpoint, or
   management related configuration, such as the maximum number of NAT-
   bindings allowed for the endpoint.  The NAT-device sends its per
   endpoint accounting information to the NAS, which aggregates the
   accounting information received from the NAT-device with its local
   accounting information for the endpoint into a single accounting
   stream towards the AAA-server.












Brockners, et al.       Expires January 11, 2012               [Page 10]

Internet-Draft      Diameter NAT Control Application           July 2011


                   +---------+
                   |         |
                   |   AAA   |
                   |         |
                   +---------+
                        |
                        |
                        |
     +--------+    +---------+    +--------+    +----------+
     |  IPv4/ |    |   (C)   |    |        |    |  IPv4    |
     |  IPv6  |----|   NAS   |----|  NAT-  |----| Internet |
     |  Host  |    |         |    | device |    |          |
     +--------+    +---------+    +--------+    +----------+
     <-------- Public  IPv6 ----------><--- Public IPv4 --->
     <-------- Private IPv4 ----------><--- Public IPv4 --->

          Figure 3: NAT control deployment: Integrated deployment

   The autonomous deployment approach decouples user management on NAS
   and NAT-device.  In the autonomous deployment approach, the AAA-
   system and the NAT-device are the Diameter peers running the DNCA.
   The AAA-system also serves as NAT-controller.  It manages the
   connection to the NAT-device, controls the per endpoint
   configuration, and also receives accounting and reporting information
   from the NAT-device.  Different from the integrated deployment
   scenario, the autonomous deployment scenario does not "hide" the
   existence of the NAT-device from the AAA infrastructure.  Here two
   accounting streams are received by the AAA-server for one particular
   endpoint, one from the NAS, and one from the NAT-device.

                     +---------+
                     |   (C)   |
                     |   AAA   |---------
                     |         |         |
                     +---------+         |
                          |              |
                          |              |
                          |              |
       +--------+    +---------+    +---------+    +----------+
       |  IPv4/ |    |         |    |         |    |  IPv4    |
       |  IPv6  |----|   NAS   |----|  NAT-   |----| Internet |
       |  Host  |    |         |    | device  |    |          |
       +--------+    +---------+    +---------+    +----------+
       <-------- Public  IPv6 ----------><---- Public IPv4 --->
       <-------- Private IPv4 ----------><---- Public IPv4 --->

          Figure 4: NAT control deployment: Autonomous deployment




Brockners, et al.       Expires January 11, 2012               [Page 11]

Internet-Draft      Diameter NAT Control Application           July 2011


4.  DNCA Session Establishment and Management

   Note that this section forward references some of the commands and
   AVPs defined for DNCA.  Please refer to Section 6 and Section 8 for
   details.  DNCA runs between a Diameter peer residing in a NAT-
   controller and a Diameter peer residing in a NAT-device.  The
   Diameter peer within the NAT-controller is always the control
   requesting entity: It initiates, updates, or terminates the sessions.
   Sessions are initiated when the NAT-controller learns about a new
   endpoint (i.e., host) that requires a NAT service.  This could for
   example be due to the entity hosting the NAT-controller receiving
   authentication, authorization, or accounting requests for or from the
   endpoint.  Alternate methods that could trigger session set up
   include local configuration, receipt of a packet from a formerly
   unknown IP-address, etc.

4.1.  Session Establishment

   The DNCA Diameter peer within the NAT-controller establishes a
   session with the DNCA Diameter peer within the NAT-device to control
   the behavior of the NAT function within the NAT-device.  During
   session establishment, the DNCA Diameter peer within the NAT-
   controller passes along configuration information to DNCA Diameter
   peer within the NAT-device.  The session configuration information
   comprises the maximum number of bindings allowed for the endpoint
   associated with this session, a set of pre-defined NAT bindings to be
   established for this endpoint, or a description of the address pool,
   that external addresses are to be allocated from.

   The DNCA Diameter peer within the NAT-controller generates a NAT-
   Control Request (NCR) message to the DNCA Diameter peer within the
   NAT-device with NC-Request-Type AVP set to INITIAL_REQUEST to
   initiate a Diameter NAT control session.  On receipt of a NCR the
   DNCA Diameter peer within the NAT-device sets up a new session for
   the endpoint associated with the endpoint classifier(s) contained in
   the NCR.  The DNCA Diameter peer within the NAT-device notifies its
   DNCA Diameter peer within the NAT-controller about successful session
   setup using a NAT-Control Answer (NCA) message with Result-Code set
   to DIAMETER_SUCCESS.  Figure 5 shows the initial protocol interaction
   between the two DNCA Diameter peers.

   The initial NAT-Control-Request may contain configuration information
   for the session, which specifies the behavior of the NAT-device for
   the session.  The configuration information which may be included,
   comprises:

   o  A list of NAT bindings, which should be pre-allocated for the
      session; for example, in case a user requires a fixed external IP-



Brockners, et al.       Expires January 11, 2012               [Page 12]

Internet-Draft      Diameter NAT Control Application           July 2011


      address/port pair for one of his applications.

   o  The maximum number of NAT-bindings allowed for an endpoint.

   o  A description of the external IP-address pool(s) to be used for
      the session.

   o  A reference to a predefined binding rule on the NAT-device, which
      is applied to the session.  Such a predefined binding rule on the
      NAT-device may contain, for example, the name of the IP-address
      pool that external IP-addresses should be allocated from, the
      maximum number of bindings permitted for the endpoint, etc.

   In certain cases, the NAT-device may not be able to perform the tasks
   requested within the NCR.  These include the following:

   o  If a DNCA Diameter peer within the NAT-device receives a NCR from
      a DNCA Diameter peer within a NAT-controller with NC- Request-Type
      AVP set to INITIAL_REQUEST that identifies an already existing
      session; that is, DNCA Diameter peer and endpoint identifier match
      an already existing session, the DNCA Diameter peer within the
      NAT-device returns NCA with Result-Code set to SESSION_EXISTS, and
      provides the Session-Id of the existing session in the Duplicate-
      Session-Id AVP.

   o  If a DNCA Diameter peer within the NAT-device receives a NCR from
      a DNCA Diameter peer within a NAT-controller with NC- Request-Type
      AVP set to INITIAL_REQUEST that matches more than one of the
      already existing sessions; that is, DNCA Diameter peer and
      endpoint identifier match already existing sessions, the DNCA
      Diameter peer within the NAT-device returns a NCA with Result-Code
      set to INSUFFICIENT-CLASSIFIERS.  In case a DNCA Diameter peer
      receives a NCA that reports Insufficient-Classifiers, it may
      choose to retry establishing a new session using additional or
      more specific classifiers.

   o  If the NCR contains a binding rule not defined on the NAT-device,
      the DNCA Diameter peer within the NAT-device returns NCA with
      Result-Code AVP set to UNKNOWN_BINDING_RULE.

   o  In case the NAT-device is unable to establish all of the bindings
      requested in the NCR, the DNCA Diameter peer will return a NCA
      with Result-Code set to BINDING_FAILURE.  A DNCA Diameter peer
      within a NAT-device treats a NCR as an atomic operation; hence
      none of the requested bindings will be established by the NAT-
      device.  Either all requested actions within a NCR are completed
      successfully, or the entire request fails.




Brockners, et al.       Expires January 11, 2012               [Page 13]

Internet-Draft      Diameter NAT Control Application           July 2011


   o  If a NAT-device does not have sufficient resources to process a
      request, the DNCA Diameter peer returns a NCA with Result-Code set
      to RESOURCE_FAILURE.

   o  In case Max-NAT-Binding and NAT-Control-Definition are included in
      the NCR along with a reference to a binding rule; that is, a
      predefined template on NAT-device, and the values in Max-NAT-
      Binding and NAT-Control-Definition contradict those specified in
      the pre-defined binding rule, Max-NAT-Binding and NAT-Control-
      Definition override the values specified in the binding rule.


   NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
               |                                           |
               |                                           |
               |                                           |
            Trigger                                        |
               |                                           |
               |                   NCR                     |
               |------------------------------------------>|
               | (INITIAL_REQUEST, endpoint classifier,    |
               |     session id, NAT control config data)  |
               |                                           |
               |                                           |
               |                                           |
               |                                           |
               |                                 If Able to comply
               |                                 with Request then
               |                                 Create session state
               |                                           |
               |                                           |
               |                     NCA                   |
               |<------------------------------------------|
               |                 (result code)             |
               |                                           |
               |                                           |

      Figure 5: Initial NAT control request and session establishment

   Note: The DNCA Diameter peer within the NAT-device creates session
   state only if it is able to comply with the NCR.  On success it will
   reply with a NCA with Result-Code set to DIAMETER_SUCCESS.

4.2.  Session Re-Authorization

   Session re-authorization is performed if the NAT-controller desires
   to change the behavior of the NAT-device for an existing session.
   Session re-authorization could be used, for example, to change the



Brockners, et al.       Expires January 11, 2012               [Page 14]

Internet-Draft      Diameter NAT Control Application           July 2011


   number of allowed bindings for a particular session, or establish or
   remove a pre-defined binding.

   The DNCA Diameter peer within the NAT-controller generates a NCR
   message to DNCA Diameter peer within NAT-device with NC-Request-Type
   AVP set to UPDATE_REQUEST upon receiving a trigger signal.  If the
   session is updated successfully, the DNCA Diameter peer within the
   NAT-device notifies the DNCA Diameter peer within the NAT-controller
   about the successful session update using a NAT-Control Answer (NCA)
   message with Result-Code set to DIAMETER_SUCCESS.  Figure 6 shows the
   protocol interaction between the two DNCA Diameter peers.

   In certain cases, the NAT-device may not be able to perform the tasks
   requested within the NCR.  These include the following:

   o  If DNCA Diameter peer within a NAT-device receives a NCR update or
      query request for a non-existent session, it sets Result-Code in
      the answer to DIAMETER_UNKNOWN_SESSION_ID.

   o  If the NCR contains a binding rule not defined on the NAT-device,
      a NCA with Result-Code AVP set to UNKNOWN_BINDING_RULE is
      returned.

   o  If the NAT-device cannot establish the requested binding because
      the maximum number of allowed bindings has been reached for the
      endpoint classifier, a NCA with Result-Code AVP set to
      MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT by the DNCA Diameter peer.

   o  If the NAT-device cannot establish some or all of the bindings
      requested in a NCR, but has not yet reached the maximum number of
      allowed bindings for the endpoint, a NCA with Result-Code set to
      BINDING_FAILURE is returned.  As already noted, the DNCA Diameter
      peer in a NAT-device treats a NCR as an atomic operation.  Hence
      none of the requested bindings will be established by the NAT-
      device in case of failure.  Actions requested within a NCR are
      either all successful or all fail.

   o  If the NAT-device does not have sufficient resources to process a
      request, a NCA with Result-Code set to RESOURCE_FAILURE is
      returned.

   o  If a NCR redefines the maximum number of NAT-bindings allowed for
      the endpoint, the new value will override any previously defined
      limit on NAT bindings.  It depends on the implementation of the
      NAT-device on how the NAT-device copes with a case where the new
      value is lower than the actual number of allocated bindings.
      Typically the NAT-device refrains from enforcing the new limit
      immediately; that is, actively remove bindings, but rather



Brockners, et al.       Expires January 11, 2012               [Page 15]

Internet-Draft      Diameter NAT Control Application           July 2011


      disallow the establishment of new bindings until the current
      number of bindings is lower than the newly established maximum
      number of allowed bindings.

   o  If a NCR specifies a new binding rule, predefined on the NAT-
      device, the binding rule overrides any previously defined rule for
      the session.

   o  If Max-NAT-Binding and NAT-Control-Definition AVPs are included in
      the NCR along with a reference to a binding rule (a predefined
      template on the NAT-device) and the values in Max-NAT-Binding and
      NAT-Control-Definition AVPs contradict those specified in the pre-
      defined binding rule, Max-NAT-Binding and NAT-Control-Definition
      AVPs override the values specified in the binding rule.

   Note: Already established bindings for the session will not be
   affected in case the tasks requested within the NCR cannot be
   completed.

   NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
               |                                           |
               |                                           |
               |                                           |
        Change of session                                  |
           attributes                                      |
               |                                           |
               |                   NCR                     |
               |------------------------------------------>|
               |       (UPDATE_REQUEST session id,         |
               |         NAT control config data)          |
               |                                           |
               |                                           |
               |                                   If able to comply
               |                                   with the request:
               |                                  Update session state
               |                                           |
               |                                           |
               |                     NCA                   |
               |<------------------------------------------|
               |                 (result code)             |
               |                                           |
               |                                           |

             Figure 6: NAT control request for session update







Brockners, et al.       Expires January 11, 2012               [Page 16]

Internet-Draft      Diameter NAT Control Application           July 2011


4.3.  Session and Binding Query

   Session query can be used by the DNCA Diameter peer within the NAT-
   controller to either retrieve information on the current bindings for
   a particular session at the NAT-device or discover the session
   identifier for a particular external IP address/port pair.

   A DNCA Diameter peer within the NAT-controller starts a session query
   by sending a NCR message with NC-Request-Type AVP set to
   QUERY_REQUEST.  Figure 7 shows the protocol interaction between the
   DNCA Diameter peers.

   Two types of query requests exist.  The first type of query request
   uses the session ID as input parameter to the query.  It is to allow
   the DNCA Diameter peer within the NAT-controller to retrieve the
   current set of bindings for a specific session.  The second type of
   query request is used to retrieve the session identifiers, along with
   the associated bindings, matching a criteria.  This enables the DNCA
   Diameter peer within the NAT-controller to find those sessions, which
   utilize a specific external IP-address.

   1.  Request a list of currently allocated NAT bindings for a
       particular session: On receiving a NCR, the NAT-device looks up
       the session information for the session ID contained in the NCR,
       and reports all currently active NAT-bindings for the session
       using a NCA message with Result-Code set to DIAMETER_SUCCESS.  In
       this case the NCR MUST NOT contain a NAT-Control-Definition AVP.
       Each NAT-binding is reported in a NAT-Control-Definition AVP.  In
       case the session ID is unknown, the DNCA Diameter peer within the
       NAT-device returns NCA with Result-Code set to
       DIAMETER_UNKNOWN_SESSION_ID.

   2.  Retrieve session IDs and internal IP address/port pairs for one
       or multiple external IP-address/port pairs: If the DNCA Diameter
       peer within the NAT-controller wishes to retrieve the session
       ID(s) for one or multiple external IP-address/port pairs, it MUST
       include the external IP-address/port pair(s) as part of the NAT-
       Control-Definition AVP of the NCR.  The session ID is not
       included in the NCR or the NCA for this type of a query.  The
       DNCA Diameter peer within the NAT-device reports the NAT-bindings
       and associated session IDs corresponding to the external IP-
       address/port pairs in a NCA message with Result-Code set to
       DIAMETER_SUCCESS with the same session ID, which was used in NCR.
       In case an external IP-address/port pair has no associated
       existing NAT-binding, the NAT-Control-Definition AVP contained in
       the reply just contains the NAT-External-Address AVP.





Brockners, et al.       Expires January 11, 2012               [Page 17]

Internet-Draft      Diameter NAT Control Application           July 2011


   NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
               |                                           |
               |                                           |
               |                                           |
     DNCA Session Established                              |
               |                                           |
               |                   NCR                     |
               |------------------------------------------>|
               |              (QUERY_REQUEST)              |
               |                                           |
               |                                           |
               |                                           |
               |                          Look up corresponding session
               |                            and associated NAT-bindings
               |                                           |
               |                   NCA                     |
               |<------------------------------------------|
               |              (Result-Code)                |
               |                                           |
               |                                           |

                          Figure 7: Session query

4.4.  Session Termination

   Similar to session initiation, session tear down is always initiated
   by the DNCA Diameter peer within the NAT-controller.  The DNCA
   Diameter peer sends a Session Terminate Request (STR) message to its
   peer within the NAT-device upon receiving a trigger signal.  The
   source of the trigger signal is outside the scope of this document.
   In response, the DNCA Diameter peer within the NAT-device sends an
   accounting stop record reporting all bindings and notifies its DNCA
   Diameter peer about successful session termination using a Session
   Terminate Answer (STA) message with Result-Code set to
   DIAMETER_SUCCESS.  Figure 8 shows the protocol interaction between
   the two DNCA Diameter peers.

   If a DNCA Diameter peer within a NAT-device receives a STR and fails
   to find a matching session, the DNCA Diameter peer returns a STA with
   Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.











Brockners, et al.       Expires January 11, 2012               [Page 18]

Internet-Draft      Diameter NAT Control Application           July 2011


   NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
               |                                            |
               |                                            |
            Trigger                                         |
               |                                            |
               |                   STR                      |
               |------------------------------------------->|
               |               (session id)                 |
               |                                            |
               |                                            |
               |                                  Remove NAT-bindings
               |                                       of session
               |                                            |
               |                                            |
               |           Send accounting stop             |
               |<-------------------------------------------|
               |       reporting all session bindings       |
               |                                            |
               |                                  Terminate session /
               |                                 Remove session state
               |                                            |
               |                                            |
               |                                            |
               |                  STA                       |
               |<-------------------------------------------|
               |             (Result-Code)                  |
               |                                            |

                  Figure 8: Terminate NAT control session

4.5.  Session Abort

   An Abort-Session-Request (ASR) message is sent from the DNCA Diameter
   peer within the NAT-device to the DNCA Diameter peer within the NAT-
   controller when it is unable to maintain a session due to resource
   limitations.  The DNCA Diameter peer within the NAT-controller
   acknowledges successful session abort using a Abort Session Answer
   (ASA) message with Result-Code set to DIAMETER_SUCCESS.  Figure 9
   shows the protocol interaction between the DNCA Diameter peers.  The
   DNCA Diameter peers will start a session termination procedure as
   described in Section 4.4 following an ASA with Result-Code set to
   DIAMETER_SUCCESS.

   If the DNCA Diameter peer within a NAT-controller receives an ASR but
   fails to find a matching session, it returns an ASA with Result-Code
   set to DIAMETER_UNKNOWN_SESSION_ID.  If the DNCA Diameter peer within
   the NAT-controller is unable to comply with the ASR for any other
   reason, an ASA with Result-Code set to DIAMETER_UNABLE_TO_COMPLY is



Brockners, et al.       Expires January 11, 2012               [Page 19]

Internet-Draft      Diameter NAT Control Application           July 2011


   returned.

   NAT-controller (DNCA Diameter peer)   NAT-device (DNCA Diameter peer)
               |                                            |
               |                                            |
               |                                         Trigger
               |                                            |
               |                   ASR                      |
               |<-------------------------------------------|
               |               (session id)                 |
               |                                            |
               |                                            |
               |                  ASA                       |
               |------------------------------------------->|
               |             (Result-Code)                  |
               |                                            |
               |                                            |
               |           On successful ASA                |
               |<------Session Termination Procedure------->|

                    Figure 9: Abort NAT control session

4.6.  Failure cases of the DNCA Diameter peers

   This document does not specify the behavior in case NAT-device and
   NAT-controller, or their respective DNCA Diameter peers are out of
   sync.  This could happen for example if one of the entities restarts,
   in case of a (temporary) loss of network connectivity etc.  The
   peering entities MUST have built-in redundancy support to recover
   state in case of failure.

   Example failure cases include the following:

   o  NAT-controller and the DNCA Diameter peer within the NAT-
      controller lose state (e.g. due to a restart).  In this case,

      *  the DNCA Diameter peer within the NAT-device may receive a NCR
         with NC-Request-Type AVP set to INITIAL_REQUEST that matches an
         existing session of the DNCA Diameter peer within the NAT-
         device.  The DNCA Diameter peer within the NAT-device returns a
         Result-Code that contains Duplicate-Session-Id AVP to report
         the Session-ID of the existing session.  The DNCA Diameter peer
         within the NAT-controller may send an explicit Session
         Terminate Request (STR) for the older session, which was lost.

      *  a DNCA Diameter peer may receive accounting records for a
         session that does not exist.  The DNCA Diameter peer sends an
         accounting answer with Result-Code set to



Brockners, et al.       Expires January 11, 2012               [Page 20]

Internet-Draft      Diameter NAT Control Application           July 2011


         DIAMETER_UNKNOWN_SESSION_ID in response.  On receiving the
         response, the DNCA Diameter peer clears the session and removes
         the associated session state.

   o  NAT-device and the DNCA Diameter peer within NAT-device lose
      state.  In such a case, the DNCA Diameter peer may receive a NCR
      with NC-Request-Type AVP set to UPDATE_REQUEST for a non-existent
      session.  The DNCA Diameter peer returns NCA with Result-Code set
      to DIAMETER_UNKNOWN_SESSION_ID.

   o  The DNCA Diameter peer within the NAT-controller is unreachable,
      for example detected by Diameter watchdog, or down and accounting
      requests from the DNCA Diameter peer fail to get a response.  The
      mechanism to ensure that a DNCA Diameter peer within the NAT-
      controller no longer has associated state for a session which was
      cleared or removed by the DNCA Diameter peer within the NAT-device
      is beyond the scope of this document.

   o  The DNCA Diameter peer within the NAT-device is unreachable or
      down and NCR requests fail to get a response.  Handling of this
      case depends on the actual service offering of the service
      provider.  The service provider could for example choose to stop
      offering connectivity service.


5.  Use Of The Diameter Base Protocol

   The Diameter Base Protocol defined by [RFC3588] applies with the
   clarifications listed in the present specification.

5.1.  Securing Diameter Messages

   For secure transport of Diameter messages recommendations in
   [RFC3588] apply.

   DNCA Diameter peers MAY verify their identity during the Capabilities
   Exchange Request procedure.

   A DNCA Diameter peer within the NAT-device MAY verify that a DNCA
   Diameter peer that issues a NCR command is allowed to do so based on:

   o  The identity of the DNCA Diameter peer

   o  The type of NCR Command

   o  The content of the NCR Command





Brockners, et al.       Expires January 11, 2012               [Page 21]

Internet-Draft      Diameter NAT Control Application           July 2011


   o  Any combination of the above

5.2.  Accounting Functionality

   Accounting functionality (accounting session state machine, related
   command codes and AVPs) is defined in Section 9 below.

5.3.  Use Of Sessions

   Each DNCA session MUST have a globally unique Session-ID as defined
   in [RFC3588], which MUST NOT be changed during the lifetime of a DNCA
   session.  The Diameter Session-ID serves as the global endpoint
   identifier.  The DNCA Diameter peers maintain state associated with
   the Session-ID.  This globally unique Session-ID is used for
   updating, accounting, and terminating the session.  DNCA session MUST
   NOT have more than one outstanding request at any given instant.  A
   DNCA Diameter peer sends an Abort-Session-Request as defined in
   [RFC3588] if it is unable to maintain sessions due to resource
   limitation.

5.4.  Routing Considerations

   It is assumed that the DNCA Diameter peer within a NAT-controller
   knows the DiameterIdentity of the Diameter peer within a NAT-device
   for a given endpoint.  Both the Destination-Realm and Destination-
   Host AVPs are present in the request from a DNCA Diameter peer within
   a NAT-controller to a DNCA Diameter peer within a NAT-device.

5.5.  Advertising Application Support

   Diameter nodes conforming to this specification MUST advertise
   support for DNCA by including the value of TBD in the Auth-
   Application-Id of the Capabilities-Exchange-Request and Capabilities-
   Exchange-Answer command[RFC3588].


6.  DNCA Commands

   The following commands are used to establish, maintain and query NAT-
   bindings.

6.1.  NAT-Control Request (NCR) Command

   The NAT-Control Request (NCR) command, indicated by the command field
   set to TBD and the "R" bit set in the Command Flags field, is sent
   from the DNCA Diameter peer within the NAT-controller to the DNCA
   Diameter peer within the NAT-device in order to install NAT-bindings.




Brockners, et al.       Expires January 11, 2012               [Page 22]

Internet-Draft      Diameter NAT Control Application           July 2011


   User-Name, Logical-Access-Id, Physical-Access-ID, Framed-IP-Address,
   Framed-IPv6-Prefix , Framed-Interface-Id, EGRESS-VLANID, NAS-Port-ID,
   Address-Realm, Calling-Station-ID AVPs serve as identifiers for the
   endpoint.

   Message format:
      < NC-Request > ::= < Diameter Header: TBD, REQ, PXY>
                       [ Session-Id ]
                       { Auth-Application-Id }
                       { Origin-Host }
                       { Origin-Realm }
                       { Destination-Realm }
                       { Destination-Host }
                       { NC-Request-Type }
                       [ Origin-State-Id ]
                    *1 [ NAT-Control-Remove ]
                    *1 [ NAT-Control-Install ]
                       [ User-Name ]
                       [ Logical-Access-Id ]
                       [ Physical-Access-ID ]
                       [ Framed-IP-Address ]
                       [ Framed-IPv6-Prefix ]
                       [ Framed-Interface-Id ]
                       [ EGRESS-VLANID]
                       [ NAS-Port-ID]
                       [ Address-Realm ]
                       [ Calling-Station-ID ]
                     * [ Proxy-Info ]
                     * [ Route-Record ]
                     * [ AVP ]

6.2.  NAT-Control Answer (NCA) Command

   The NAT-Control-Answer (NCA) command, indicated by the Command-Code
   field set to TBD and the "R" bit cleared in the Command Flags field,
   is sent by the DNCA Diameter peer within the NAT-device in response
   to NAT-Control-Request command.

   Message format:












Brockners, et al.       Expires January 11, 2012               [Page 23]

Internet-Draft      Diameter NAT Control Application           July 2011


      <NC-Answer> ::= < Diameter Header: TBD, PXY >
                      [ Session-Id ]
                      { Origin-Host }
                      { Origin-Realm }
                      { Result-Code }
                      [ NC-Request-Type ]
                    * [ NAT-Control-Definition ]
                      [ Current-NAT-Bindings   ]
                      [ Origin-State-Id ]
                      [ Error-Message ]
                      [ Error-Reporting-Host ]
                    * [ Failed-AVP ]
                    * [ Proxy-Info ]
                      [ Duplicate-Session-ID ]
                    * [ Redirect-Host]
                      [ Redirect-Host-Usage ]
                      [ Redirect-Max-Cache-Time ]
                    * [ Proxy-Info ]
                    * [ Route-Record ]
                    * [ Failed-AVP ]
                    * [ AVP ]



7.  NAT Control Application Session State Machine

   This section contains a set of finite state machines, representing
   the life cycle of DNCA session, which MUST be observed by all
   implementations of the DNCA Diameter application.  The DNCA Diameter
   peers are stateful and the state machine maintained is similar to the
   stateful Client and Server authorization state machine described in
   [RFC3588].  When a session is moved to the Idle state, any resources
   that were allocated for the particular session must be released.  Any
   event not listed in the state machines MUST be considered as an error
   condition, and an answer, if applicable, MUST be returned to the
   originator of the message.

   In the state table, the event 'Failure to send NCR' means that the
   DNCA Diameter peer within the NAT-controller is unable to send the
   NCR command to the desired destination.  This could be due to the
   peer being down, or due to the peer sending back the transient
   failure or temporary protocol error notification DIAMETER_TOO_BUSY or
   DIAMETER_LOOP_DETECTED in the Result-Code AVP of NCA.

   In the state table "FAILED NCA" means that the DNCA Diameter peer
   within the NAT-device was not able to honor the corresponding NCR.
   This can happen due to any transient and permanent error at the NAT-
   device or its associated DNCA Diameter peer within indicated by the



Brockners, et al.       Expires January 11, 2012               [Page 24]

Internet-Draft      Diameter NAT Control Application           July 2011


   following error Result-Code values: RESOURCE_FAILURE,
   UNKNOWN_BINDING_RULE_NAME, BINDING_FAILURE,
   MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT, SESSION_EXISTS,
   INSUFFICIENT_CLASSIFIERS.

   The following state machine is observed by a DNCA Diameter peer
   within a NAT-controller.  The state machine description uses the term
   "access session" to describe the connectivity service offered to the
   endpoint or host.  "Access session" should not be confused with the
   Diameter session ID.

             DNCA Diameter peer within a NAT-controller
      State     Event                          Action     New State
      -------------------------------------------------------------
      Idle      New endpoint detected that     Send       Pending
                requires NAT Control           NCR
                                               Initial
                                               Request

      Idle      ASR Received                   Send ASA   Idle
                for unknown session            with
                                               Result-Code
                                               = UNKNOWN_
                                               SESSION_ID

      Pending   Successful NCA                 Setup      Open
                received                       complete

      Pending   Successful NCA                 Sent STR   Discon
                received
                but peer unable to provide
                service

      Pending   Error processing successful    Sent STR   Discon
                NCA

      Pending   Failed                         Cleanup    Idle
                NCA received

      Open      NAT control                    Send       Open
                update required                NCR Update
                                               Request

      Open      Successful                                Open
                NCA received

      Open      Failed                         Cleanup    Idle
                NCA received.



Brockners, et al.       Expires January 11, 2012               [Page 25]

Internet-Draft      Diameter NAT Control Application           July 2011


      Open      Access session end detected    Send STR   Discon


      Open      ASR Received,                  Send ASA   Discon
                access session will be         with
                terminated                     Result-Code
                                               = SUCCESS,
                                               Send STR.

      Open      ASR Received,                  Send ASA   Open
                access session will not        with
                be terminated                  Result-Code
                                               != SUCCESS

      Discon    ASR Received                   Send ASA   Idle

      Discon    STA Received                   Discon.    Idle
                                               user/device

   The following state machine is observed by a DNCA Diameter peer
   within a NAT-device.






























Brockners, et al.       Expires January 11, 2012               [Page 26]

Internet-Draft      Diameter NAT Control Application           July 2011


             DNCA Diameter peer within a NAT-device
      State     Event                          Action     New State
      -------------------------------------------------------------
      Idle      NCR request                    Send       Open
                received, and                  successful
                able to provide requested      NCA
                NAT control service

      Idle      NCR request                    Send       Idle
                received, and                  failed
                unable to provide requested    NCA
                NAT control service

      Open      NCR  request                   Send       Open
                received, and                  successful
                able to provide requested      NCA
                NAT control service

      Open      NCR request                    Send       Idle
                received, and                  failed
                unable to provide requested    NCA,
                NAT control service            Cleanup

      Open      Unable to continue             Send ASR   Discon
                providing requested
                NAT control service

      Discon    Failure to send ASR            Wait,      Discon
                                               resend ASR

      Discon    ASR successfully sent and      Cleanup    Idle
                ASA Received with Result-Code

      Not       ASA Received                   None       No change
      Discon

      Any       STR Received                   Send STA,  Idle
                                               Cleanup.


8.  DNCA AVPs

8.1.  Reused Base Protocol AVPs

   AVPs reused from Diameter Base Protocol [RFC3588] are listed below.






Brockners, et al.       Expires January 11, 2012               [Page 27]

Internet-Draft      Diameter NAT Control Application           July 2011


                                                   +-------------------+
                                                   |  AVP Flag rules   |
   +-----------------------------------------------|-----+---+---------+
   |                           AVP                 |     |   |   May   |
   | Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
   +-----------------------------------------------+-----+---+---------+
   |Acct-Interim-Interval      85       Unsigned32 | M   | P |    Y    |
   |Auth-Application-Id        258      Unsigned32 | M   | P |    N    |
   |Destination-Host           293      DiamIdent  | M   | P |    N    |
   |Destination-Realm          283      DiamIdent  | M   | P |    N    |
   |Error-Message              281      UTF8String | M   | P |    N    |
   |Error-Reporting-Host       294      DiamIdent  | M   | P |    N    |
   |Failed-AVP                 279      Grouped    | M   | P |    N    |
   |Origin-Host                264      DiamIdent  | M   | P |    N    |
   |Origin-Realm               296      DiamIdent  | M   | P |    N    |
   |Origin-State-Id            278      Unsigned32 | M   | P |    N    |
   |Proxy-Info                 284      Grouped    | M   | P |    N    |
   |Result-Code                268      Unsigned32 | M   | P |    N    |
   |Route-Record               282      DiamIdent  | M   |   |    N    |
   |Session-Id                 263      UTF8String | M   | P |    Y    |
   |User-Name                  1        UTF8String | M   | P |    Y    |
   +-----------------------------------------------+-----+---+---------+
   |M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
   |    supported and recognized by a Diameter entity in order the     |
   |    message, which carries this AVP, to be accepted.               |
   |P - Indicates the need for encryption for end-to-end security.     |
   +-------------------------------------------------------------------+

             Figure 10: DIAMETER AVPs used from Diameter base

   The Auth-Application-Id AVP (AVP Code 258) is assigned by IANA to
   Diameter applications.  The value of the Auth-Application-Id for the
   Diameter NAT Control Application is TBD.

8.2.  Additional Result-Code AVP Values

   This section defines new values for the Result-Code AVP which SHALL
   be supported by all Diameter implementations that conform to the
   present document.

8.2.1.  Success

   No new Result-Code AVP value is defined within this category.

8.2.2.  Transient Failures

   Result-Code AVP values that fall within the transient failures
   category are those used to inform a peer that the request could not



Brockners, et al.       Expires January 11, 2012               [Page 28]

Internet-Draft      Diameter NAT Control Application           July 2011


   be satisfied at the time that it was received.  The request may be
   able to be satisfied in the future.

   The following new values of the Result-Code AVP are defined:

      RESOURCE_FAILURE (TBD)

         The DNCA Diameter peer within the NAT-device indicates that the
         binding could not be installed or a new session could not be
         created due to resource shortage.

8.2.3.  Permanent Failures

   The Result-Code AVP values, which fall within the permanent failures
   category are used to inform the peer that the request failed, and
   should not be attempted again.  The request may be able to be
   satisfied in the future.

   The following new values of the Result-Code AVP are defined:

      UNKNOWN_BINDING_RULE_NAME (TBD)

         The DNCA Diameter peer within the NAT-device indicates that the
         binding could not be installed or a new session could not be
         created because the specified NAT-Control-Binding-Rule AVP,
         that refers to a predefined policy template in the NAT-device,
         is unknown.

      BINDING_FAILURE (TBD)

         DNCA indicates that the requested binding(s) could not be
         installed.  For example: Requested ports are already in use.

      MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT (TBD)

         The DNCA Diameter peer within the NAT-device denies the request
         because the maximum number of allowed bindings has been reached
         for the specified endpoint classifier.

      SESSION_EXISTS (TBD)

         The DNCA Diameter peer within the NAT-device denies request to
         initialize a new session, if it already has a DNCA session that
         uses the same set of classifiers as indicated by the DNCA
         Diameter peer within the NAT-controller in the new session
         initialization request.





Brockners, et al.       Expires January 11, 2012               [Page 29]

Internet-Draft      Diameter NAT Control Application           July 2011


      INSUFFICIENT_CLASSIFIERS (TBD)

         The DNCA Diameter peer within the NAT-device requests to
         initialize a new session, if the classifiers in the request
         match more than one of the existing sessions on the DNCA
         Diameter peer within the NAT-device.

8.3.  Reused NASREQ Diameter Application AVPs

   The following AVPs are reused from Diameter Network Access Server
   Application [RFC4005].
                                          +---------------------+
                                          |    AVP Flag rules   |
   +------------------+------+------------|----+-----+----+-----|----+
   |                  | AVP  |            |    |     |SHLD| MUST|    |
   | Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
   |------------------|------|------------|----+-----+----+-----|----|
   | NAS-Port         |   5  | Unsigned32 | M  |  P  |    |  V  | Y  |
   | NAS-Port-Id      |  87  | UTF8String | M  |  P  |    |  V  | Y  |
   | Calling-Station- |  31  | UTF8String | M  |  P  |    |  V  | Y  |
   |   Id             |      |            |    |     |    |     |    |
   | Framed-IP-Address|   8  | OctetString| M  |  P  |    |  V  | Y  |
   | Framed-Interface-|  96  | Unsigned64 | M  |  P  |    |  V  | Y  |
   |   Id             |      |            |    |     |    |     |    |
   | Framed-IPv6-     |  97  | OctetString| M  |  P  |    |  V  | Y  |
   |  Prefix          |      |            |    |     |    |     |    |
   +------------------+------+------------|----+-----+----+-----|----+

            Figure 11: Reused NASREQ Diameter application AVPs

8.4.  Reused AVPs from RFC 4675

   The following AVPs are reused from "RADIUS Attributes for Virtual LAN
   and Priority Support" specification [RFC4675].
                                          +---------------------+
                                          |    AVP Flag rules   |
   +------------------+------+------------|----+-----+----+-----|----+
   |                  | AVP  |            |    |     |SHLD| MUST|    |
   | Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
   |------------------|------|------------|----+-----+----+-----|----|
   | Egress-VLANID    |  56  | OctetString| M  |  P  |    |  V  | Y  |
   +------------------+------+------------|----+-----+----+-----|----+

                Figure 12: Reused attributes from RFC 4675







Brockners, et al.       Expires January 11, 2012               [Page 30]

Internet-Draft      Diameter NAT Control Application           July 2011


8.5.  Reused AVPs from Diameter QoS Application

   The following AVPs are reused from the Traffic Classification and
   Quality of Service (QoS) Attributes for Diameter [RFC5777].
                                                   +-------------------+
                                                   |  AVP Flag rules   |
   +-----------------------------------------------|-----+---+---------+
   |                           AVP                 |     |   |   May   |
   | Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
   +-----------------------------------------------+-----+---+---------+
   |Port                       TBD     Integer32   |  M  | P |    Y    |
   |IP-Address-Mask            TBD     Grouped     |  M  | P |    Y    |
   |Protocol                   TBD     Enumerated  |  M  | P |    Y    |
   |Direction                  TBD     Enumerated  |  M  | P |    Y    |
   +-----------------------------------------------+-----+---+---------+
   |M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
   |    supported and recognized by a Diameter entity in order the     |
   |    message, which carries this AVP, to be accepted.               |
   |P - Indicates the need for encryption for end-to-end security.     |
   +-------------------------------------------------------------------+

                     Figure 13: Reused QoS-attributes

8.6.  Reused AVPs from ETSI ES 283 034, e4 Diameter Application

   The following AVPs are reused from the Diameter e4 Application
   [ETSIES283034].
                                                   +-------------------+
                                                   |  AVP Flag rules   |
   +-----------------------------------------------|-----+---+---------+
   |                           AVP                 |     |   |   May   |
   | Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
   +-----------------------------------------------+-----+---+---------+
   |Address-Realm              301     OctetString | M,V |   |    Y    |
   |Logical-Access-Id          302     OctetString |   V | M |    Y    |
   |Physical-Access-ID         313     UTF8String  |   V | M |    Y    |
   +-----------------------------------------------+-----+---+---------+
   |M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
   |    supported and recognized by a Diameter entity in order the     |
   |    message, which carries this AVP, to be accepted.               |
   |P - Indicates the need for encryption for end-to-end security.     |
   |V - Indicates whether the optional Vendor-ID field is present      |
   |    in the AVP header. Vendor-Id header of all AVPs in             |
   |    this table will be set to ETSI (13019).                        |
   +-------------------------------------------------------------------+

            Figure 14: Reused AVPs from Diameter e4 application




Brockners, et al.       Expires January 11, 2012               [Page 31]

Internet-Draft      Diameter NAT Control Application           July 2011


8.7.  DNCA Defined AVPs

   The following table describes the new Diameter AVPs used in this
   document.
                                                   +-------------------+
                                                   |  AVP Flag rules   |
   +-----------------------------------------------|-----+---+---------+
   |                       AVP  Section            |     |   |   May   |
   | Attribute Name        Code Defined Data Type  |MUST |MAY| encrypt |
   +-----------------------------------------------+-----+---+---------+
   |NC-Request-Type        TBD  8.7.1   Enumerated | M   | P |    Y    |
   |NAT-Control-Install    TBD  8.7.2   Grouped    | M   | P |    Y    |
   |NAT-Control-Remove     TBD  8.7.3   Grouped    | M   | P |    Y    |
   |NAT-Control-Definition TBD  8.7.4   Grouped    | M   | P |    Y    |
   |NAT-Internal-Address   TBD  8.7.5   Grouped    | M   | P |    Y    |
   |NAT-External-Address   TBD  8.7.6   Grouped    | M   | P |    Y    |
   |Max-NAT-Bindings       TBD  8.7.7   Unsigned32 | M   | P |    Y    |
   |NAT-Control-           TBD  8.7.8   OctetString| M   | P |    Y    |
   | Binding-Rule                                  |     |   |         |
   |Duplicate-             TBD  8.7.9   UTF8String | M   | P |    Y    |
   | Session-ID                                    |     |   |         |
   |NAT-Control-Record     TBD  9.2.1   Grouped    | M   | P |    Y    |
   |NAT-Control-           TBD  9.2.2   Enumerated | M   | P |    Y    |
   | Binding-Status                                |     |   |         |
   |Current-NAT-Bindings   TBD  9.2.3   Unsigned32 | M   | P |    Y    |
   +-----------------------------------------------+-----+---+---------+
   |M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
   |    supported and recognized by a Diameter entity in order the     |
   |    message, which carries this AVP, to be accepted.               |
   |P - Indicates the need for encryption for end-to-end security.     |
   +-------------------------------------------------------------------+

                       Figure 15: New Diameter AVPs

8.7.1.  NC-Request-Type AVP

   The NC-Request-Type AVP (AVP Code TBD) is of type Enumerated and
   contains the reason for sending the NAT-Control-Request command.  It
   shall be present in all NAT-Control-Request messages.

   The following values are defined:

      INITIAL_REQUEST (1)

         An Initial Request is to initiate a Diameter NAT control
         session between the DNCA Diameter peers.

      UPDATE_REQUEST (2)



Brockners, et al.       Expires January 11, 2012               [Page 32]

Internet-Draft      Diameter NAT Control Application           July 2011


         An Update Request is used to update bindings previously
         installed on a given access session, to add new binding on a
         given access session, or to remove one or several binding(s)
         activated on a given access session.

      QUERY_REQUEST (3)

         Query Request is used to query a NAT-device about the currently
         installed bindings for an endpoint classifier.

8.7.2.  NAT-Control-Install AVP

   The NAT-Control AVP (AVP code TBD) is of type Grouped, and it is used
   to activate or install NAT bindings.  It also contains Max-NAT-
   Bindings that defines the maximum number of NAT bindings to be
   allowed for a subscriber and the NAT-Control-Binding-Rule that
   references a predefined policy template on the NAT-device that may
   contain static binding, a maximum number of bindings allowed, an IP-
   address pool from which external binding addresses should be
   allocated.

   AVP format:
     NAT-Control-Install ::= < AVP Header: TBD >
                              * [ NAT-Control-Definition ]
                                [ NAT-Control-Binding-Rule ]
                                [ Max-NAT-Bindings]
                              * [ AVP ]

8.7.3.  NAT-Control-Remove AVP

   The NAT-Control-Remove AVP (AVP code TBD) is of type Grouped, and it
   is used to deactivate or remove NAT-bindings.

   AVP format:
     NAT-Control-Remove ::= < AVP Header: TBD >
                             * [ NAT-Control-Definition ]
                               [ NAT-Control-Binding-Rule ]
                             * [ AVP ]

8.7.4.  NAT-Control-Definition AVP

   The NAT-Control-Definition AVP (AVP code TBD) is of type Grouped, and
   it describes a binding.

   The NAT-Control-Definition AVP uniquely identifies the binding
   between the DNCA Diameter peers.

   If both the NAT-Internal-Address and NAT-External-Address AVP(s) are



Brockners, et al.       Expires January 11, 2012               [Page 33]

Internet-Draft      Diameter NAT Control Application           July 2011


   supplied, it is a pre-defined binding.

   The Protocol AVP describes the transport protocol for the binding.
   The NAT-Control-Definition AVP can contain either zero or one
   Protocol AVP.  If the Protocol AVP is omitted and if both internal
   and external IP-address are specified then the binding reserves the
   IP-addresses for all transport protocols.

   The Direction AVP is of type Enumerated.  It specifies the direction
   for the binding.  The values of the enumeration applicable in this
   context are: "IN","OUT".  If Direction AVP is OUT or absent, the NAT-
   Internal-Address refers to the IP-address of the endpoint that needs
   to be translated.  If Direction AVP is "IN", NAT-Internal-Address is
   the destination IP-address that has to be translated.

   AVP format:
     NAT-Control-Definition ::= < AVP Header: TBD >
                                 { NAT-Internal-Address }
                                 [ Protocol ]
                                 [ Direction ]
                                 [ NAT-External-Address ]
                                 [ Session-Id ]
                               * [ AVP ]

8.7.5.  NAT-Internal-Address AVP

   The NAT-Internal-Address AVP (AVP code TBD) is of type Grouped.  It
   describes the internal IP-address and port for a binding.  Framed-
   IPV6-Prefix and Framed-IP-Address AVPs are mutually exclusive.

   AVP format:
     NAT-Internal-Address ::= < AVP Header: TBD >
                               [ Framed-IP-Address ]
                               [ Framed-IPv6-Prefix ]
                               [ Port]
                             * [ AVP ]

8.7.6.  NAT-External-Address AVP

   The NAT-External-Address AVP (AVP code TBD) is of type Grouped, and
   it describes the external IP-address and port for a binding.  IP-
   Address-Mask AVP can only be specified when the Framed-IP-Address AVP
   is present.  The external IP-address specified in this attribute can
   be reused for multiple endpoints by specifying the same address in
   the respective NAT-External-Address AVPs.

   AVP format:




Brockners, et al.       Expires January 11, 2012               [Page 34]

Internet-Draft      Diameter NAT Control Application           July 2011


     NAT-External-Address ::= < AVP Header: TBD >
                               [ Framed-IP-Address ]
                               [ IP-Address-Mask ]
                               [ Port ]
                             * [ AVP ]

8.7.7.  Max-NAT-Bindings

   The Max-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32.  It
   indicates the maximum number of NAT-bindings allowed for a particular
   endpoint.

8.7.8.  NAT-Control-Binding-Rule AVP

   The NAT-Control-Binding-Rule AVP (AVP code TBD) is of type
   OctetString.  It defines a name for a policy template that is
   predefined at the NAT-device.  Details on the contents and structure
   of the template and configuration are outside the scope of this
   document.  The policy to which this AVP refers to may contain NAT-
   bindings, IP-address pool for allocating the external IP-address of a
   NAT-binding, and maximum number of allowed NAT-bindings.  Such policy
   template can be reused by specifying the same NAT-Control-Binding-
   Rule AVP in the corresponding NAT-Control-Install AVPs of multiple
   endpoints.

8.7.9.  Duplicate-Session-Id AVP

   The Duplicate-Session-Id AVP (AVP Code TBD) is of type UTF8String.
   It is used to report errors and contains the Session-Id of an
   existing session.


9.  Accounting Commands

   The DNCA reuses session based accounting as defined in the Diameter
   Base Protocol[RFC3588] to report the bindings per endpoint.  This
   reporting is achieved by sending Diameter Accounting Requests (ACR)
   [Start, Interim and Stop] from the DNCA Diameter peer within the NAT-
   device to its associated DNCA Diameter peer within the NAT-
   controller.

   The DNCA Diameter peer within the NAT-device sends an ACR Start on
   receiving a NCR with NC-Request-Type AVP set to INITIAL_REQUEST for a
   session or on creation of the first binding for a session requested
   in an earlier NCR.  DNCA may send ACR Interim updates, if required,
   either due to a change in bindings resulting from a NCR with NC-
   Request-Type AVP set to UPDATE_REQUEST, or periodically as specified
   in Acct-Interim-Interval by the DNCA Diameter peer within the NAT-



Brockners, et al.       Expires January 11, 2012               [Page 35]

Internet-Draft      Diameter NAT Control Application           July 2011


   controller, or when it creates or tears down bindings.  An ACR Stop
   is sent by the DNCA Diameter peer within the NAT-device on receiving
   STR.

   The function of correlating the multiple bindings used by an endpoint
   at any given time is relegated to the post processor.

   The DNCA Diameter peer within the NAT-device may trigger an interim
   accounting record when maximum number of bindings, if received in
   NCR, is reached.

9.1.  NAT Control Accounting Messages

   The ACR and ACA messages are reused as defined in Diameter Base
   Protocol [RFC3588] for exchanging endpoint NAT binding details
   between the DNCA Diameter peers.  DNCA Application ID is used in the
   accounting commands.  ACR contains one or more optional NAT-Control-
   Record AVP to report the bindings.  The NAT-device indicates the
   number of allocated NAT bindings to NAT-controller using the Current-
   NAT-Bindings AVP.  This number needs to match the number of bindings
   identified as active within the NAT-Control-Record AVP.

9.2.  NAT Control Accounting AVPs

   In addition to AVPs for ACR specified in [RFC3588], the DNCA Diameter
   peer within the NAT-device must add the NAT-Control-Record AVP.

9.2.1.  NAT-Control-Record

   The NAT-Control-Record AVP (AVP code TBD) is of type Grouped.  It
   describes a binding and its status.  If NAT-Control-Binding-Status is
   set to Created, Event-Timestamp indicates the binding creation time.
   If NAT-Control-Binding-Status is set to Removed, Event-Timestamp
   indicates the binding removal time.  If NAT-Control-Binding-Status is
   active, Event-Timestamp need not be present; if a value is present,
   it indicates that binding is active at the given time.
     NAT-Control-Record ::= < AVP Header: TBD >
                            { NAT-Control-Definition }
                            { NAT-Control-Binding-Status }
                            [ Event-Timestamp ]

9.2.2.  NAT-Control-Binding-Status

   The NAT-Control-Binding-Status AVP (AVP code TBD) is of type
   enumerated.  It indicates the status of the binding - created,
   removed, or active.

   The following values are defined:



Brockners, et al.       Expires January 11, 2012               [Page 36]

Internet-Draft      Diameter NAT Control Application           July 2011


      Created (1)

         NAT binding is created.

      Active (2)

         NAT binding is active.

      Removed (3)

         NAT binding was removed.

9.2.3.  Current-NAT-Bindings

   The Current-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32.
   It indicates number of NAT bindings active on NAT-device.


10.  AVP Occurrence Table

   The following sections presents the AVPs defined in this document and
   specifies the Diameter messages in which, they MAY be present.  Note:
   AVPs that can only be present within a Grouped AVP are not
   represented in this table.

   The table uses the following symbols:



      0         The AVP MUST NOT be present in the message.

      0+        Zero or more instances of the AVP MAY be present in the
                message.

      0-1       Zero or one instance of the AVP MAY be present in the
                message.  It is considered an error if there is more
                than one instance of the AVP.

      1         One instance of the AVP MUST be present in the message.

      1+        At least one instance of the AVP MUST be present in the
                message.

10.1.  DNCA AVP Table for NAT Control Initial and Update Requests

   The following table lists DNCA specific AVPs that have to be present
   in NCR and NCA with NC-Request-Type set to INITIAL_REQUEST or
   UPDATE_REQUEST.



Brockners, et al.       Expires January 11, 2012               [Page 37]

Internet-Draft      Diameter NAT Control Application           July 2011


                                       +-------------------+
                                       |  Command Code     |
   +-----------------------------------+-------------------+
   | Attribute Name                        NCR    NCA      |
   +-------------------------------------------------------+
   |NC-Request-Type                         1      1       |
   |NAT-Control-Install                     0-1    0       |
   |NAT-Control-Remove                      0-1    0       |
   |NAT-Control-Definition                  0      0       |
   |Current-NAT-Bindings                    0      0       |
   |Duplicate-Session-Id                    0      0-1     |
   +-------------------------------------------------------+

10.2.  DNCA AVP Table for Session Query request

   The following table lists DNCA specific AVPs that have to be present
   in NCR and NCA with NC-Request-Type set to QUERY_REQUEST.
                                       +-------------------+
                                       |  Command Code     |
   +-----------------------------------+-------------------+
   | Attribute Name                        NCR    NCA      |
   +-------------------------------------------------------+
   |NC-Request-Type                         1      1       |
   |NAT-Control-Install                     0      0       |
   |NAT-Control-Remove                      0      0       |
   |NAT-Control-Definition                  0      0+      |
   |Current-NAT-Bindings                    0      1       |
   |Duplicate-Session-Id                    0      0       |
   +-------------------------------------------------------+

10.3.  DNCA AVP Table for Accounting Message

   The following table lists DNCA specific AVPs, which may or may not be
   present in ACR and ACA messages.
                                       +-------------------+
                                       |  Command Code     |
   +-----------------------------------+-------------------+
   | Attribute Name                        ACR    ACA      |
   +-------------------------------------------------------+
   |NAT-Control-Record                      0+     0       |
   |Current-NAT-Bindings                    1      0       |
   +-------------------------------------------------------+


11.  IANA Considerations

   This section contains the namespaces that have either been created in
   this specification, or the values assigned to existing namespaces



Brockners, et al.       Expires January 11, 2012               [Page 38]

Internet-Draft      Diameter NAT Control Application           July 2011


   managed by IANA.

   In the subsections below, when we speak about review by a Designated
   Expert, please note that the designated expert will be assigned by
   the IESG.  Initially, such Expert discussions take place on the AAA
   WG mailing list.

11.1.  Application Identifier

   This specification assigns the value <TBD>, 'Diameter NAT Control
   Application', to the Application Identifier namespace defined in
   [RFC3588].  See Section 4 for more information.

11.2.  Command Codes

   This specification uses the value <TBD> from the Command code
   namespace defined in [RFC3588] for the NAT-Control-Request (NCR),
   NAT-Control-Answer (NCA) commands.  See Section 6.1 and Section 6.2
   for more information on these commands.

11.3.  AVP Codes

   This specification assigns the values <TBD> from the AVP code
   namespace defined in [RFC3588].  See Figure 15for the assignment of
   the namespace in this specification.

11.4.  Result-Code AVP Values

   This specification assigns the values <TBD> (4xxx, 5xxx, 5xxx, 5xxx,
   5xxx,5xxx) from the Result-Code AVP value namespace defined in
   [RFC3588].  See Section 8.2 for the assignment of the namespace in
   this specification.

11.5.  NC-Request-Type AVP

   As defined in Section 8.7.1, the NC-Request-Type AVP includes
   Enumerated type values 1 - 3.  IANA has created and is maintaining a
   namespace for this AVP.  All remaining values are available for
   assignment by a Designated Expert [RFC5226].

11.6.  NAT-Control-Binding-Status AVP

   As defined in Section 8.7.1, the NAT-Control-Binding-Status AVP
   includes Enumerated type values 1 - 3.  IANA has created and is
   maintaining a namespace for this AVP.  All remaining values are
   available for assignment by a Designated Expert [RFC5226].





Brockners, et al.       Expires January 11, 2012               [Page 39]

Internet-Draft      Diameter NAT Control Application           July 2011


12.  Security Considerations

   This document describes procedures for controlling NAT related
   attributes and parameters by an entity, which is non-local to the
   device performing NAT.  This section discusses security
   considerations for DNCA.  This includes the interactions between the
   Diameter peers within a NAT-controller and a NAT-device as well as
   general considerations for NAT-control in a service provider network.

   Security between NAT-controller and NAT-device has a number of
   components: authentication, authorization, integrity, and
   confidentiality.

   Authentication refers to confirming the identity of an originator for
   all datagrams received from the originator.  Lack of authentication
   of Diameter messages between the Diameter peers can jeopardize the
   fundamental service of the peering network elements.  A consequence
   of not authenticating the message sender by the recipient would be
   that an attacker could spoof the identity of a "legitimate"
   authorizing entity in order to change the behavior of the receiver.
   An attacker could for example launch a denial of service attack by
   setting the maximum number of bindings for a session on the NAT-
   device to zero; provision bindings on a NAT-device which include IP-
   addresses already in use in other parts of the network; or request
   session termination of the Diameter session and hamper a user's
   connectivity.  Lack of authentication of a NAT-device to a NAT-
   controller could lead to situations where the NAT-device could
   provide a wrong view of the resources (i.e.  NAT-bindings).  In
   addition, templates on the NAT-device specifying pre-defined binding
   rules could be configured differently than expected by the NAT-
   controller.  Failing of any of the two DNCA Diameter peers to provide
   the required credentials should be subject to logging.

   Authorization refers to whether a particular authorizing entity is
   authorized to signal a network element requests for one or more
   applications, adhering to a certain policy profile.  Failing the
   authorization process might indicate a resource theft attempt or
   failure due to administrative and/or credential deficiencies.  In
   either case, the network element should take the proper measures to
   log such attempts.

   Integrity is required to ensure that a Diameter message exchanged
   between the Diameter peers has not been maliciously altered by
   intermediate devices.  The result of a lack of data integrity
   enforcement in an untrusted environment could be that an impostor
   will alter the messages exchanged between the peers.  This could
   cause a change of behavior of the peers, including the potential of a
   denial of service.



Brockners, et al.       Expires January 11, 2012               [Page 40]

Internet-Draft      Diameter NAT Control Application           July 2011


   Confidentiality protection of Diameter messages ensures that the
   signaling data is accessible only to the authorized entities.  When
   signaling messages between the DNCA Diameter peers traverse untrusted
   networks, lack of confidentiality will allow eavesdropping and
   traffic analysis.

   Diameter offers security mechanisms to deal with the functionality
   demanded above.  DNCA makes use of the capabilities offered by
   Diameter and the underlying transport protocols to deliver these
   requirements (see Section 5.1 ).  If the DNCA communication traverses
   untrusted networks, it is assumed that messages between DNCA Diameter
   peers are secured using either IPsec or TLS.  Please refer to
   [RFC3588], section 13 for details.  DNCA Diameter peers MAY perform
   bilateral authentication, authorization as well as procedures to
   ensure integrity and confidentiality of the information exchange.

   It is assumed that the DNCA Diameter peers are typically in the same
   domain and have a mutual trust set up.  This document does not
   specify a mechanisms for authorization between the DNCA Diameter
   peers.  It is assumed that the DNCA Diameter peers are provided with
   sufficient information to make an authorization decision.  The
   information can come from various sources, for example the peering
   devices could store local authentication policy, listing the
   identities of authorized peers.

   Any mechanism or protocol providing control of a NAT-device, and DNCA
   is an example of such a control mechanism, could allow for misuse of
   the NAT-device given that it enables the definition of per-
   destination or per-source rules.  Misuse could include anti-
   competitive practices among providers, censorship, crime, etc.  NAT-
   control could be used as a tool for preventing or redirecting access
   to particular sites.  For instance, by controlling the NAT bindings,
   one could ensure that end points aren't able to receive particular
   flows, or that those flows are redirected to a relay that snoops or
   tampers with traffic instead of directly forwarding the traffic to
   the intended end point.  In addition one could setup a binding in a
   way that the source IP address used is one of a relay so that traffic
   coming back can be snooped on or interfered with.  The protections on
   DNCA and its Diameter protocol exchanges don't prevent such abuses of
   NAT-control.  A service provider deploying DNCA needs to make sure
   that higher layer processes and procedures are put in place which
   allow them to detect and mitigate misuses.


13.  Acknowledgements

   The authors would like to thank Wesley Eddy, Miguel A. Garcia, Jouni
   Korhonen, Matt Lepinski, Avi Lior, Chris Metz, Pallavi Mishra, Lionel



Brockners, et al.       Expires January 11, 2012               [Page 41]

Internet-Draft      Diameter NAT Control Application           July 2011


   Morand, Hannes Tschofenig, Shashank Vikram, Greg Weber, and Glen Zorn
   for their input on this document.


14.  Change History (to be removed prior to publication as an RFC)

   Changes from -00 to -01

   a.  new values for Result-Code AVP used - instead of Experimental-
       Result AVP

   b.  added support for transport specific binding (UDP/TCP)

   c.  added support for twice-NAT

   d.  clarified the use of the two different types of query-requests

   Changes from -01 to -02

   a.  Reference to pull mode removed, session initiation event
       clarified in section 4.1

   b.  added Redirect-* AVPs in NCA command

   c.  Removed reference to Called-Station-Id AVP in NCR command

   d.  Editorial changes

   e.  added support for bindings providing AFT (NAT64)

   Changes from -02 to -03

   a.  Editorial changes

   Changes from -03 to -04

   a.  Editorial changes suggested in WG last call review

   b.  Removed NCR Request type terminate and replaced with STR

   c.  All references to Auth-Session-State are removed and a new
       section to describe FSM for Manager and Agent has been added

   d.  Clarified reuse of External address and address pools among
       multiple subscribers

   Changes from -04 to -05




Brockners, et al.       Expires January 11, 2012               [Page 42]

Internet-Draft      Diameter NAT Control Application           July 2011


   a.  Removed references to Large Scale NAT as per review comments

   Changes from -05 to -06

   a.  Editorial changes

   Changes from -06 to -07

   a.  Added a note in section 4.3 stating the state of pre-existing
       bindings on update failure

   b.  Security considerations are made consistent between sections 5.1
       and 12

   c.  Editorial changes

   Changes from -07 to -08

   a.  Added section 4.6 to describe session abort

   b.  Editorial changes

   c.  Nomenclature change: From DNCA Agent/Manager to DNCA Diameter
       peers identifying the location where they reside (NAT-controller
       or NAT-device)

   d.  IANA consideration Section format changes

   e.  Updated security section (included considerations directly,
       rather than referring to Diameter QoS similarities).

   Changes from -08 to -09

   a.  expanded on the need for an SP controlling the maximum number of
       bindings of an end point (see introduction section)

   b.  added a paragraph in the security section outlining general mis-
       uses of NAT-control (non specific to DNCA), with DNCA being an
       example of such a NAT-control protocol

   c.  editorial changes


15.  Normative References

   [ETSIES283034]
              ETSI, "Telecommunications and Internet Converged Services
              and Protocols for Advanced Networks (TISPAN),Network



Brockners, et al.       Expires January 11, 2012               [Page 43]

Internet-Draft      Diameter NAT Control Application           July 2011


              Attachment Sub-System (NASS),e4 interface based on the
              Diameter protocol.", September 2008.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC3588]  Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J.
              Arkko, "Diameter Base Protocol", RFC 3588, September 2003.

   [RFC4005]  Calhoun, P., Zorn, G., Spence, D., and D. Mitton,
              "Diameter Network Access Server Application", RFC 4005,
              August 2005.

   [RFC4675]  Congdon, P., Sanchez, M., and B. Aboba, "RADIUS Attributes
              for Virtual LAN and Priority Support", RFC 4675,
              September 2006.

   [RFC5226]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", BCP 26, RFC 5226,
              May 2008.

   [RFC5777]  Korhonen, J., Tschofenig, H., Arumaithurai, M., Jones, M.,
              and A. Lior, "Traffic Classification and Quality of
              Service (QoS) Attributes for Diameter", RFC 5777,
              February 2010.


Authors' Addresses

   Frank Brockners
   Cisco
   Hansaallee 249, 3rd Floor
   DUESSELDORF, NORDRHEIN-WESTFALEN  40549
   Germany

   Email: fbrockne@cisco.com


   Shwetha Bhandari
   Cisco
   Cessna Business Park, Sarjapura Marathalli Outer Ring Road
   Bangalore, KARNATAKA 560 087
   India

   Email: shwethab@cisco.com






Brockners, et al.       Expires January 11, 2012               [Page 44]

Internet-Draft      Diameter NAT Control Application           July 2011


   Vaneeta Singh
   18, Cambridge Road
   Bangalore 560008
   India

   Email: vaneeta.singh@gmail.com


   Victor Fajardo
   Telcordia Technologies
   1 Telcordia Drive #1S-222
   Piscataway, NJ 08854
   USA

   Email: vf0213@gmail.com




































Brockners, et al.       Expires January 11, 2012               [Page 45]
