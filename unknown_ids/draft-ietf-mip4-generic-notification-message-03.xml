<?xml version="1.0"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
  <!ENTITY rfc2119 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
  <!ENTITY rfc3012 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3012.xml'>
  <!ENTITY rfc3344 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3344.xml'>
  <!ENTITY rfc3543 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3543.xml'>
  <!ENTITY rfc4917 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4917.xml'>
]>
<rfc category="std" ipr="full3978" docName="draft-ietf-mip4-generic-notification-message-03.txt">

  <?rfc toc="yes" ?>
  <?rfc tocompact="yes" ?>
  <!--?rfc compact="yes" ?-->
  <?rfc symrefs="yes" ?>
  <?rfc sortrefs="yes"?>
  <?rfc iprnotified="no" ?>
  <?rfc strict="yes" ?>
  <front>
    <title abbrev="MIP4 Generic Notification Message">Generic Notification Message for Mobile IPv4</title>

    <author initials="H.D" surname="Deng" fullname="Hui Deng">
      <organization>China Mobile</organization>
      <address>
        <postal>
          <street>53A,Xibianmennei Ave., </street>
          <street>Xuanwu District,</street>
          <city>Beijing</city>
          <code>100053</code>
          <country>China</country>
        </postal>
        <email>denghui@chinamobile.com</email>
      </address>
    </author>

    <author initials="H.L" surname="Levkowetz" fullname="Henrik Levkowetz">
      <organization>Ericsson Research</organization>
      <address>
        <postal>
          <street>Torshamsgatan 23</street>
          <street>S-164 80, Stockholm</street>
          <country>SWEDEN</country>
        </postal>
        <email>henrik@levkowetz.com</email>
      </address>
    </author>

    <author initials="V.D" surname="Devarapalli" fullname="Vijay Devarapalli">
      <organization>Azaire Networks</organization>
      <address>
        <postal>
          <street>4800 Great America Pkwy</street>
          <city>Santa Clara</city><region>CA</region>
          <code>95054</code>
          <country>USA</country>
        </postal>
        <email>vijay.devarapalli@azairenet.com</email>
      </address>
    </author>

    <author initials="S.G" surname="Gundavelli" fullname="Sri Gundavelli">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street>170 W.Tasman Drive</street>
          <city>San Jose</city><region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <email>sgundave@cisco.com</email>
      </address>
    </author>

    <author initials="B.H" surname="Haley" fullname="Brian Haley">
      <organization>Hewlett-Packard Company</organization>
      <address>
        <postal>
          <street>110 Spitbrook Road</street>
          <city>Nashua</city><region>NH</region>
          <code>03062</code>
          <country>USA</country>
        </postal>
        <email>brian.haley@hp.com</email>
      </address>
    </author>

    <date/>

    <workgroup>MIP4 Working Group</workgroup>

    <abstract>

      <t>This document specifies protocol enhancements that allow Mobile IPv4
      entities to send and receive explicit notification messages using a
      new Mobile IPv4 message type designed for this purpose.
      </t>

    </abstract>

  </front>
  <middle>
    <section anchor="sect.intro" title="Introduction">

      <t>In some situations, there is a need for Mobile IPv4 entities, such as the home agent,
      foreign agent and mobile node to send and receive asynchronous
      notification messages during a mobility session. The base Mobile IP
      Specification <xref target="RFC3344"/> does not have a provision for this.
      </t>

      <t>This document defines a generic message and a notification model that can
      be used by Mobile IPv4 entities to send various notifications.
      However, this specification does not define any specific
      notification message or the actions that the receiving entity is
      required to perform on receiving that message. Specific extensions
      and the corresponding handler actions are outside the scope of this document.
      </t>

    </section>

    <section anchor="sect.term" title="Terminology">

      <t>It is assumed that the reader is familiar with the terminology used
      in <xref target="RFC3543"/>, <xref target="RFC4917"/>, <xref target="RFC3344"/>.  
      In addition, the following terms are defined: </t>

      <t>Notification Message </t>

      <t><list> 
        <t>A message from a mobility agent to a mobile node or other mobility
        agent to asynchronously notify it about an event that is relevant to
        the mobility service it is currently providing.  </t> 
      </list></t>

      <t>The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in RFC 2119, <xref
      target="RFC2119"/>.  </t>

    </section>

    <section anchor="sect.scen" title="Notification message - Usage Scenario's">

      <t>
   There are several scenarios where a mobility agent could 
   initiate notification events.  Some of these are described in the following  
   sections. 
      </t>

      <section anchor="sect.ha2mn" title="Notification message from a Home Agent to a Mobile Node">

        <section anchor="sect.ha2mn.fa" title="Mobile Registered using a Foreign Agent Care-of Address">

          <t>In this case, the home agent cannot directly notify the mobile node, but
          must send the notification via the foreign agent.  </t>

          <figure title="Home Agent notifies Mobile Node through Foreign Agent" anchor="fig1"><artwork><![CDATA[
+----+    notification +----+ notification +----+
| MN |<================| FA |<=============| HA |
+----+                 +----+              +----+
]]>
            </artwork>
          </figure>

        </section>

        <section anchor="sect.ha2mn.co" title="Mobile Registered using a Co-located Care-of Address">

          <t> In this case, the mobile node has registered with the home
          agent directly, so the notification message can go directly to the mobile node.

           </t>

          <t> The notification mechanism as specified here does not support the
          case of Co-located CoA mode with registration through a foreign agent  
          (due to the 'R' bit being set in the foreign agent's advertisement  
          messages). 
           </t>


          <figure title="Home Agent directly notifies Mobile Node" anchor="fig2"><artwork><![CDATA[
+----+               notification         +----+
| MN |<===================================| HA |
+----+                                    +----+
]]>
            </artwork>
          </figure>

        </section>

      </section>


      <section anchor="sect.fa2mn" title="Notification message from a Foreign Agent to a Mobile Node">

        <t>There are two cases where a foreign agent may send notification
        messages to a mobile node, one where it is relaying a message,  the other
        where the notification is triggered by a message from another network entity, for example
        a AAA node(notification messages between a AAA entity and the foreign agent
        could be based on RADIUS or Diameter, but this is out of scope for
        this document). If the notification is initiated by a foreign agent,
        the foreign agent may need to also notify the home agent about the event.
        </t>

          <figure title="Foreign Agent notifies Mobile Node" anchor="fig3"><artwork><![CDATA[
+----+    notification +----+ notification +--------+
| MN |<================| FA |<=============| AAA/HA |
+----+                 +----+              +--------+
                         ||   notification +----+
                          ================>| HA |
                                           +----+
]]>
            </artwork>
          </figure>

      </section>

      <section anchor="sect.ha2fa" title="Notification message from a Home Agent to a Foreign Agent">

        <t>The home agent may also need to send a notification to the foreign
        agent, but not to the mobile node, as illustrated below:    </t>

          <figure title="Home Agent notifies Foreign Agent" anchor="fig4"><artwork><![CDATA[
+----+ notification +----+
| FA |<=============| HA |
+----+              +----+
]]>
            </artwork>
          </figure>

      </section>

    </section>

    <section anchor="sect.message" title="Generic Notification Message and Considerations">

      <t>This section describes in detail the generic notification message,
      generic notification acknowledgement message, and some considerations
      related to the handling of these messages in the mobile node, foreign  
      agent and home agent. 
</t>


      <section title="Generic Notification Message">

        <t>A generic notification message is sent by a mobility agent to
        inform another mobility agent, or a mobile node, of MIP-related information. 
        These messages must use the same IP and UDP headers
        as any previous Registration Request or Reply message to the same entity.
        The generic notification message is defined as follows: </t>

        <t>IP Fields:
          <list style="hanging" hangIndent="25">

            <t hangText="  Source Address"> Sender's address.  </t>

            <t hangText="  Destination Address"> Receiver's address.  </t>

          </list>
        </t>

        <t>UDP Fields:
          <list style="hanging" hangIndent="25">

            <t hangText="  Source Port">variable.</t>

            <t hangText="  Destination Port">Same as the last Registration
            Reply/Request message.</t>

          </list>
        </t>

        <t>The UDP header is followed by the Mobile IP fields shown below:
        </t>

        <figure><artwork><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |   Subtype     |      MD       |A|  Reserved   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Home Address                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Home Agent Address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Care-of Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                       Identification                          +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Extensions...
   +-+-+-+-+-+-+-+-+-+-+-+-+-
]]>
        </artwork></figure>

        <t>Type    (TBD)</t>

        <t>Subtype	

          <list><t>
               This field describes the particular type of notification
               which is carried in the notification message. 
               The following values are reserved in this document.
          </t>
            <t>  0   Reserved   </t>
            <t>  1   Information carried in Vendor specific extensions  </t>
          <t>
               The value 0 is reserved and should not be used. The value 1
      indicates that the actual information is carried in vendor
      specific extensions. Other values are reserved for future
      extensions.

          </t>
          
          </list>


        </t>

        <t>MD: Message Direction        
          <list>  
            <t> This memo defines the semantics of the following MD field value: 
            </t>
 
            <t>  0   --   Message sent by the home agent to the mobile node    </t>
            <t>  1   --   Message sent by the home agent to the foreign agent  </t>
            <t>  2   --   Message sent by the mobile node to the home agent    </t>
            <t>  3   --   Message sent by the mobile node to the foreign agent </t>
            <t>  4   --   Message sent by the foreign agent to the mobile node </t>
            <t>  5   --   Message sent by the foreing agent to the home agent  </t>
          </list>
        </t>


        <t>A        
          <list>
            <t> This bit indicates whether the notification message MUST be acknowledged by 
            the recipient.  </t>

            <t> Set to "1" to indicate that acknowledgement is required.  </t>
 
            <t> Set to "0" to indicate that acknowledgement is optional. </t>
          </list>
        </t>


        <t>Reserved

          <list><t>
               MUST be sent as 0, and ignored when received.
          </t></list>
        </t>

        <t>Home Address

          <list><t>
               The home IP address of the mobile node.
          </t></list>
        </t>

        <t>Home Agent Address

          <list><t>
               The IP address of the mobile node's home agent.
          </t></list>
        </t>

        <t>Care-of Address

          <list><t>
               The mobile node's care-of address, either the Co-located Care-of Address
               or the foreign agent care-of address.
          </t></list>
        </t>

        <t>Identification

          <list><t>
               A 64-bit number, constructed by the sender, used for
               matching Generic Notification with Generic Notification
               Acknowledgement,  and for protecting against replay
               attacks of notification messages.  See Sections 5.4
               and 5.7 of <xref target="RFC3344"/>.
          </t></list>
        </t>

        <t>Extensions

          <list><t>
               The fixed portion of the Generic Notification Message is followed
               by one or more extensions which may be used with this message, and
               by one or more authentication extensions (as defined in Section
               3.5 of [RFC3344]).  See Sections 3.6.1.3 and 3.7.2.2 of <xref target="RFC3344"/> 
               for information on the relative order in which different
               extensions, when present, must be placed in a Generic Notification
               Message.
          </t></list>
        </t>

      </section>

      <section title="Generic Notification Acknowledgment Message">
      
        <t> A generic notification acknowledgement message is sent by mobility
        agents or mobile nodes to indicate the successful receipt of a generic
        notification message.  </t>

        <t>IP Fields:
          <list style="hanging" hangIndent="25">

            <t hangText="  Source Address"> Typically copied from the
            destination address of the Generic Notification to which the agent
            is replying. </t>

            <t hangText="  Destination Address"> Copied from the source address
            of the Generic Notification to which the agent is replying.  </t>

          </list>
        </t>

        <t>UDP Fields:
          <list style="hanging" hangIndent="25">

            <t hangText="  Source Port">variable.</t>

            <t hangText="  Destination Port">Copied from the source port of the
            corresponding Generic Notification. </t>

          </list>
        </t>

        <t> The UDP header is followed by the Mobile IP fields shown below:
        </t>

        <figure><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |   Subtype     |      MD       |    Reserved   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Home Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Home Agent Address                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Care-of Address                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                       Identification                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Extensions...
+-+-+-+-+-+-+-+-+-+-+-+-+-
]]>
        </artwork></figure>

        <t>Type     (TBD) </t>

        <t>Subtype	

          <list><t> This field specifies the particular type of notification
          acknowledgement message.
          The following values are reserved in this document.
          </t>
            <t>  0   Reserved   </t>
            <t>  1   Information carried in Vendor specific extensions  </t>
          <t>
               The value 0 is reserved and should not be used. The value 1
      indicates that the actual information is carried in vendor
      specific extensions. Other values are reserved for future
      extensions.
           </t></list>

        </t>

        <t>MD: Message Direction        
          <list>  
            <t> This memo defines the semantics of the following MD field value: 
            </t>
 
            <t>  0   --   Message sent by the home agent to the mobile node    </t>
            <t>  1   --   Message sent by the home agent to the foreign agent  </t>
            <t>  2   --   Message sent by the mobile node to the home agent    </t>
            <t>  3   --   Message sent by the mobile node to the foreign agent </t>
            <t>  4   --   Message sent by the foreign agent to the mobile node </t>
            <t>  5   --   Message sent by the foreing agent to the home agent  </t>
          </list>
        </t>


        <t>Reserved
          <list><t>
               MUST be sent as 0, and ignored when received.
          </t></list>

        </t>
        
<!--        <t>Status

          <list><t> If the Generic Notification Message was received without
          error, this field is set to zero.  However, if there is an error in
          reception, the field is nonzero with the following allowable codes
          defined in section 3.4 of <xref target="RFC3344"/>.  </t></list>
        </t> -->

        <t>Home Address

          <list><t> The home IP address of the mobile node.  </t></list>
        </t>

        <t>Home Agent Address

          <list><t> The IP address of the sender's home agent.
          </t></list>
        </t>

        <t>Care-of Address

          <list><t>
           The mobile node's care-of address, either the Co-located Care-of Address
           or the foreign agent care-of address.

          </t></list>
        </t>

        <t> Identification

          <list><t> A 64-bit number used for matching Generic Notification with
          Generic Notification Acknowledgement, and for protecting against
          replay attacks of generic notification messages. The value is based
          on the Identification field from the Generic Notification message
          from the sender, and on the style of replay protection used in the
          security context between the receiver and sender (defined by the
          mobility security association between them, and SPI value in the
          authorization-enabling extension).  See Sections 5.4 and 5.7 of <xref
          target="RFC3344"/>.  </t></list>
        </t>

        <t>Extensions

          <list><t> The fixed portion of the generic notification
          acknowledgement message is followed by one or more of the Extensions
          listed in Section 3.5 of <xref target="RFC3344"/>. See Sections 3.6.1.3
          and 3.7.2.2 of <xref target="RFC3344"/> for information on the relative
          order in which different extensions, when present, MUST be placed in a
          Generic Notification message.  </t></list>
        </t>
      </section>

      <section title="Mobile Node Consideration">

        <t>It is possible that the mobile node MAY receive a
        generic notification message from a foreign agent or home agent. Both in
        the case of FA-CoA and Co-located CoA, the mobile node MAY reply with a Generic
        Notification Acknowledgement message based on the "A" flag in the notification
        message.  </t>

        <section title="Receiving Generic Notification Messages">

          <t>  When the mobile node is using FA-CoA and receives a Notification
               message, if the "MD" value is 0, it means that the notification
               message came from the home agent. If the "MD" value is 4, the
               notification came from the foreign agent.
          </t>
   
          <t>If this notification message came from a foreign agent and the mobile node
          accepts the foreign agent's generic notification message, it will
          process the notification extension according to the specific rules for
          that extension.  After that, the mobile node MAY
          reply with a Generic Notification Acknowledgement message back to
          the foreign agent.  If the "A" flag is set in the notification message,
          then the mobile node MUST send the acknowledgement.
          </t>

          <t>If this notification message came from the home agent, relayed by the
          foreign agent, or is a Co-located CoA, the Mobile-Home Authentication
          extension MUST be checked and the mobile node MUST check the
          Authenticator value in the Extension.  If no Mobile-Home
          Authentication Extension is found, or if more than one Mobile-Home
          Authentication Extension is found, or if the Authenticator is
          invalid, the mobile node MUST silently discard the Notification
          message.  If the mobile node accepts the home agent's generic notification
          message, it will process it according to the specific rules for that
          extension.  After
          that, the mobile node MAY reply with a Generic Notification
          Acknowledgement message back to the home agent based on the "A" flag
          in the notification message.  </t>

        </section>

        <section title="Sending Generic Notification Acknowledgement Message">

          <t>Both in the case of a Co-located CoA and FA-CoA, the mobile node MAY
             reply with a Generic Notification Acknowledgement Message based
             on the "A" flag in the notification message as follows: 
          </t>
      
          <t>If the notification message was initiated from the foreign agent to the
             mobile node ("MD" value is set to 4), the ordering
             of the extension is: any non-authentication Extensions used
             only by the foreign agent, followed by The Mobile-Foreign
             Authentication extension defined in section 3.5.3 of <xref
             target="RFC3344"/>. 
          </t>

          <t>In the case of a FA-CoA, the source address is the mobile node's address, the
             destination address is the foreign agent's address. </t>

          <t>If the notification message was initiated from the home agent to the
          mobile node ("MD" value is set to 0) and in the case of Co-located CoA, 
          the ordering of the extension is: any non-authentication Extensions used 
          only by the home agent, followed by the Mobile-Home Authentication extension 
          defined in section 3.5.2 of <xref target="RFC3344"/> </t>

          <t> In the case of a FA-CoA, the source address is the mobile node's CoA address
          and the destination address is the home agent's address ("MD" value is set to 2),
          the ordering of the extension is: any non-authentication
          Extensions used only by the home agent, followed by the Mobile-Home
          Authentication Extension defined in section 3.5.2. of <xref target="RFC3344"/>,
          followed by any non-authentication Extensions used only by
          the foreign agent, followed by The Mobile-Foreign Authentication
          extension defined in section 3.5.3 of <xref target="RFC3344"/>.  </t>

        </section>

      </section>

      <section title="Foreign Agent Consideration">

        <t>    The foreign agent cannot only relay generic notification message from
          the home agent and mobile node, but it can also initiate a generic
          notification message to the mobile node or home agent, but only when there 
          is a binding for the mobile node.  
        </t>
   
        <section title="Receiving Generic Notification Message">

          <t>  If the foreign agent receives a notification message, and the "MD" value is set to 0, 
          it means that the home agent is asking the foreign agent to relay
          the message to the mobile node.  Otherwise, it means that the target of the
          notification is the foreign agent.
          </t>

          <t> If the "MD" value is set to 1, the Foreign-Home
          Authentication extension MUST be checked, and the foreign agent MUST
          check the Authenticator value in the Extension.  If no Foreign-Home
          Authentication Extension is found, or if more than one Foreign-Home
          Authentication Extension is found, or if the Authenticator is
          invalid, the foreign agent MUST silently discard the Notification
          message.  If foreign agent accepts the home agent's generic
          notification message, it will process it based on the specific rules
          for that extension.  The foreign agent MAY then reply with a Generic
          Notification Acknowledgement message back to the home agent based on
          the "A" flag in the notification message.  </t>

          <t> If the "MD" value is set to 0, the Foreign-Home
          Authentication extension MUST be checked, and the foreign agent MUST
          check the Authenticator value in the Extension.  If no Foreign-Home
          Authentication Extension is found, or if more than one Foreign-Home
          Authentication Extension is found, or if the Authenticator is
          invalid, the foreign agent MUST silently discard the Notification
          message. If foreign agent accepts the home agent's generic
          notification message, it MUST relay the Generic Notification to the
          mobile node's home address as specified in the Home Address field of
          the Generic Notification.  The foreign agent MUST NOT modify any of
          the fields beginning with the fixed portion of the Generic
          Notification message through and including the Mobile-Home Authentication
          Extension or other authentication extension supplied by the home
          agent as an authorization-enabling extension for the mobile node.
          Furthermore, the foreign agent MUST process and remove any Extensions following
          the Mobile-Home Authentication Extension and MAY append any of its own
          non-authentication Extensions of relevance to the mobile node, if
          applicable, and MUST append the Mobile-Foreign Authentication
          Extension, if the foreign agent shares a mobility security
          association with the Mobile Node.  </t>

        </section>
        <section title="Sending Generic Notification Acknowledgement Messages">

          <t>    The foreign agent may need to either relay a Generic Notification
           Acknowledgemnt message between the mobile node and the home agent or
           send one as a response to a notification messsage that was sent to
           it.  In both cases, the Generic Notification Acknowledgement Message
           is defined as follows:
                  </t>

          <t> The source address is the foreign agent address, the destination
          address is home agent address. </t>
   
          <t> If the foreign agent is only relaying this message to the home agent, the
          foreign agent it MUST NOT modify any of the fields beginning with the
          fixed portion of the Generic Notification Acknowledgement through and
          including the Mobile-Home Authentication Extension or other
          authentication extension supplied by the home agent as an
          authorization-enabling extension for the mobile node. Furthermore, the foreign
          agent MUST process and remove any Extensions following the
          Mobile-Home Authentication Extension and MAY append any of its own
          non-authentication Extensions of relevance to the home agent, if
          applicable. It MUST also append the Foreign-Home Authentication
          Extension, if the foreign agent shares a mobility security
          association with the home agent.  </t>

          <t> If the notification message is from the home agent to the
          foreign agent then the "MD" value is set to 1 and
          the ordering of the extension is: any non-authentication Extensions
          used only by the home agent, followed by The Foreign-Home
          Authentication extension defined in section 3.5.4 of <xref
          target="RFC3344"/>.  </t>

        </section>
        <section title="Sending Generic Notification Messages">

          <t> If the foreign agent is initiating a notification to the mobile node
          using the generic notification message, it MAY also
          notify the home agent as well.  </t>
   
          <t> In the message to the mobile node, the source address
          is the foreign agent address, the destination address is the mobile node's
          address, the "MD" value is set to 4, and the ordering
          of the extension is: the notification extension, followed by any
          non-authentication Extensions used only by the mobile node, followed
          by The Mobile-Foreign Authentication extension defined in section
          3.5.3 of <xref target="RFC3344"/>. Computing Authentication Extension
          Value is the same as section 3.5.1 of <xref target="RFC3344"/>
          except the payload is the notification other than registration.  </t>

          <t> In the message to the home agent, the source address is
          the foreign agent's address, the destination address is the home agent's address
          (the "MD" value is set to 5), and the ordering of the
          extension is: notification extension, followed by any non-authentication
          Extensions used only by the home agent, followed by The Foreign-Home
          Authentication extension defined in section 3.5.4 of <xref
          target="RFC3344"/>. Computing Authentication Extension Value is the
          same as section 3.5.1 of <xref target="RFC3344"/> except the payload
          is the notification other than registration.  </t>

        </section>

        <section title="Receiving Generic Notification Acknowledgement Messages">

          <t> In the case of a FA-CoA, if the foreign agent receives this message, and
          the "MD" value is set to 3, it means that the 
          notification acknowledgement message came from the
          mobile node, otherwise it came from the home agent.   </t>

          <t> If the "MD" value is set to 1,  and the foreign agent accepted
          this message, the Foreign-Home Authentication extension MUST be checked, 
          and the home agent MUST check the Authenticator value in the Extension.  
          If no Foreign-Home Authentication Extension is found, or if more than 
          one Foreign-Home Authentication Extension is found, or if the Authenticator is
          invalid, the foreign agent MUST silently discard the Notification
          Acknowledgement message. If the foreign agent accepted
          this message, the home agent MAY also process it based on the notification
          event. </t>

          <t> If the "MD" value is set to 3,  and the foreign agent accepted
          this message, the Mobile-Foreign Authentication extension MUST be
          checked, and the foreign agent MUST check the Authenticator value in the
          Extension.  If no Mobile-Foreign Authentication Extension is found, or
          if more than one Mobile-Foreign Authentication Extension is found, or if
          the Authenticator is invalid, the foreign agent MUST silently discard
          the Notification Acknowledgement message.  If the foreign agent accepted
          this message, the foreign agent MAY also process it based on the notification
          event.  </t>

          <t> In the case of a FA-CoA and if the "MD" value is set to 2, if the foreign agent
          received this message, the Mobile-Foreign Authentication extension MUST be checked,
          and the foreign agent MUST check the Authenticator value in the Extension.
          If no Mobile-Foreign Authentication Extension is found, or if more than
          one Mobile-Foreign Authentication Extension is found, or if the
          Authenticator is invalid, the foreign agent MUST silently discard the
          Notification Acknowledgement message. If foreign agent accepted the mobile node's 
          Generic Notification Acknowledgement message, it MUST relay this message to the
          home agent.  The foreign agent MUST NOT modify any of the fields beginning with 
          the fixed portion of the Generic Notification Acknowledgement message through and 
          including the Mobile-Home Authentication Extension or other authentication extension
          supplied by the home agent as an authorization-enabling extension for the mobile node.
          Furthermore, the foreign agent MUST process and remove any Extensions following
          the Mobile-Home Authentication Extension and MAY append any of its own
          non-authentication Extensions of relevance to the home agent, if
          applicable, and MUST append the Foreign-Home Authentication
          Extension, if the foreign agent shares a mobility security
          association with the home agent. </t>

        </section>


      </section>

      <section title="Home Agent Consideration">

        <t>The Home agent MAY initiate a generic notification message to both the mobile
        node and foreign agent, and it also MAY receive a generic notification
        acknowledgement message from both the foreign agent and mobile node.
        The home agent also MAY receive a generic notification message from the foreign
        agent, but only when there is a binding for a mobile node.  
        If the home agent receives a notification message from a foreign
        agent and there is no corresponding mobile node registration,
        the home agent should drop the notification message.

        </t>

        <section title="Sending Generic Notification Messages">

          <t>    In the case of a FA-CoA, the home agent may either send a notification
            message to notify the foreign agent, or have the foreign agent relay
            the notification message to the mobile node if the mobile node needs
            to be notified.
         </t>
   
          <t> If the message is from the home agent to the foreign agent, the
          source address is the home agent's address, and the destination address is
          the foreign agent's address </t>

          <t> If the foreign agent is working only as a relay agent, the "MD"
          value is set to 0, and the ordering of the extension
          is: the notification extension, followed by any non-authentication
          extension expected to be used by mobile node, followed by Mobile-Home
          Authentication Extension defined in section 3.5.2. of <xref
          target="RFC3344"/>,  followed by any non-authentication Extensions
          used only by the foreign agent, followed by The Foreign-Home
          Authentication extension defined in section 3.5.4 of <xref
          target="RFC3344"/>.  Computing Authentication Extension Value is the
          same as section 3.5.1 of <xref target="RFC3344"/>.  </t>

          <t> If the foreign agent is the target of this
          notification message, then the "MD" value is set to 1, 
          and the ordering of the extension is:
          the notification extension, followed by any non-authentication
          Extensions used only by the foreign agent, followed by The
          Foreign-Home Authentication extension defined in section 3.5.4 of
          <xref target="RFC3344"/>. Computing Authentication Extension Value
          is the same as section 3.5.1 of <xref target="RFC3344"/>.  </t>

          <t>In the case of a Co-located CoA, the home agent MAY send a 
          notification message directly to the mobile node if it needs to be
          notified. The "MD" value is set to 0, and the ordering of the extension
          is: the notification extension, followed by any non-authentication
          extension expected to be used by mobile node, followed by Mobile-Home
          Authentication Extension defined in section 3.5.2. of <xref
          target="RFC3344"/>. 
         </t>

        </section>

        <section title="Receiving Generic Notification Acknowledgement Messages">

          <t> In the case of a FA-CoA, if the home agent receives this message, and
          the "MD" value is set to 2, it means that the 
          notification acknowledgement message came from
          mobile node, otherwise it came from the foreign agent.    </t>

          <t> If the "MD" value is set to 5,  and the home agent accepted
          this message, the home agent MAY also process it based on the notification
          event. The Foreign-Home
          Authentication extension MUST be checked, and the home agent MUST check
          the Authenticator value in the Extension.  If no Foreign-Home
          Authentication Extension is found, or if more than one Foreign-Home
          Authentication Extension is found, or if the Authenticator is
          invalid, the home agent MUST silently discard the Notification
          Acknowledgement message. </t>

          <t> If the "MD" value is set to 2,  and the home agent accepted
          this message, the Mobile-Home Authentication extension MUST be
          checked, and the home agent MUST check the Authenticator value in the
          Extension.  If no Mobile-Home Authentication Extension is found, or
          if more than one Mobile-Home Authentication Extension is found, or if
          the Authenticator is invalid, the home agent MUST silently discard
          the Notification Acknowledgement message.  If the home agent accepted
          this message, the home agent MAY also process it based on the notification
          event.  </t>

          <t> In the case of a Co-located CoA, if the home agent received this
          message, the Mobile-Home Authentication extension MUST be checked,
          and the home agent MUST check the Authenticator value in the Extension.
          If no Mobile-Home Authentication Extension is found, or if more than
          one Mobile-Home Authentication Extension is found, or if the
          Authenticator is invalid, the home agent MUST silently discard the
          Notification Acknowledgement message. </t>

        </section>

        <section title="Receiving Generic Notification Messages">

          <t> The home agent MAY receive a generic notification message sent
          from the foreign agent. When the home agent receives this message, the
          Foreign-Home Authentication extension MUST be checked, and the home agent
          MUST check the Authenticator value in the Extension.  If no
          Foreign-Home Authentication Extension is found, or if more than one
          Foreign-Home Authentication Extension is found, or if the
          Authenticator is invalid, the home agent MUST silently discard the
          Notification message. If home agent accepts the foreign agent's
          generic notification message, it will process it based on the
          notification extension. Furthermore, the home agent MAY reply with a Generic
          Notification Acknowledgement message back to the foreign agent based
          on the "A" flag in the notification message.  </t>

        </section>

        <section title="Sending Generic Notification Acknowledgement Messages">

          <t> If the generic notification message came from the foreign
          agent only, the home agent MAY reply with a generic notification
          acknowledgement message to the foreign agent based on the "A" flag in the
          notification message.  If the "A" flag is set in the notification
          message, then the home agent MUST send a Notification Acknowledgement message. 
          The message is as follows: The source address is home agent's address, the destination
          address is the foreign agent's address, the "MD" value is set to 1.
          The ordering of the extension is: any non-authentication
          Extensions used only by the foreign agent, followed by The
          Foreign-Home Authentication extension defined in section 3.5.4 of
          <xref target="RFC3344"/>.  </t>

        </section>
      </section>
    </section>

	<section anchor="sect.usage" title="Usage Example">

      <t>There are several applications that could use this generic notification message.
      for example, during handover between CDMA 2000 1x EV-DO and Wireless LAN,
      the PPP resource of CDMA side have to be removed on the foreign agent (PDSN) to avoid
      over-charging subscribers. Other applications such as registration revocation, 
      home agent switch over, NEMO prefix changes, service or billing related events,
      load balancing where the home agent wants to move some of the registered mobile
      nodes to other home agents, service termination due to end of prepaid time, 
      and service interruption due to system maintenance. 
      </t>

      <t>Here we give a example of using revocation extension and describe
      some possible event which could use the generic string extension <xref target="RFC3344"/>based on
      this notification mechanism also. There is also the possibility that this
      notification message could carry many extensions at once. A new VSE extension
      could be defined to support this notification message. </t>

      <section title="Revocation Extension">

        <t>If one agent wants to notify another agent about registration
        revocation <xref target="RFC3543"/>, it could easily be carried by a generic notification
        message and generic notification acknowledgement by
        specifying the exact "Subtype" in the two messages.  </t>

      </section>

      <section title="Generic String Extension">

        <t>In some case, the home agent or foreign agent needs to notify the mobile
        node about service termination due to the end of prepaid time,  or service
        interruption due to system maintenance. This information could be
        defined based on a string <xref target="RFC4917"/>which is recognized by the mobile node easily.
        An example would be "Maintenance Stopping", "Prepaid Expire". These
        string MUST be strictly defined so they could be easily understood by all
        of the network entities. "Subtype" number would need to be decided by the working
        group.  </t>

      </section>

    </section>

	<section anchor="sect.sec" title="Security Considerations">

      <t>     This specification operates in the security constraints and
  requirements of [RFC3344].  It extends the operations of mobile node,
  home agent and foreign agent defined in [RFC3344] to notify each
  other about some events.  The Generic Notification message defined
  in the specification could carry information that modifies the
  mobility bindings.  Therefore the message MUST be integrity
  protected.  Replay protection MUST also be guaranteed.</t>

 <t>
  RFC 3344 provides replay protection only for registration requests
  sent by the mobile node.  There is no mechanism for replay
  protection for messages initiated by a Foreign Agent. The 64-bit
  Identification field specified in this document for the Generic
  Notification message is used to provide replay protection for the
  notification messages initiated by the Foreign Agent.
 </t>

    </section>

    <section anchor="sect.iana" title="IANA Considerations">
      <t> This document describes two new messages, the Generic
       Notification message, section 4.1 and the Generic Notification
       Acknowledgement message, section 4.2. These two messages 
       should be allocated from the same address space used by the
       Registration Request and Registration Reply messages in [RFC3344].
       The subtype of these two messages indicate what kind of information
       is carried and will be under assigned by IANA namespace.
      </t>
    </section>
  </middle>
    
 <back>
    <references title='Normative References'>
<!--  <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119" ?>
<?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3344" ?>
<?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3543" ?>
<?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4917" ?>
-->	  

	  &rfc2119;
	  &rfc3344;
	  &rfc3543;
	  &rfc4917;
   	  
    </references>
 </back>
</rfc>
    
<!--    <references title='Informative References'>
      <reference anchor="MIP4-STRING"
                 target="draft-ietf-mip4-message-string-ext-01(work in progress)">
        <front>
          <title>Mobile IPv4 Message String Extension</title>
          <author initials="V." surname="Sastry">
            <organization></organization>
          </author>

          <author initials="K." surname="Leung">
            <organization></organization>
          </author>

          <author initials="A." surname="Patel">
            <organization></organization>
          </author>
          <date month="Jan" year="2006" />
        </front>
                
      </reference>  
    </references> 
-->	     
