<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3688 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3688.xml">
<!ENTITY RFC3693 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3693.xml">
<!ENTITY I-D.ietf-geopriv-http-location-delivery PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-geopriv-http-location-delivery.xml">
<!ENTITY I-D.thomson-geopriv-uncertainty PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.thomson-geopriv-uncertainty.xml">
<!ENTITY I-D.ietf-geopriv-revised-civic-lo PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-geopriv-revised-civic-lo.xml">
<!ENTITY I-D.ietf-geopriv-l7-lcp-ps PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-geopriv-l7-lcp-ps.xml">
<!ENTITY I-D.busin-geopriv-location-qos-req PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.busin-geopriv-location-qos-req.xml">
<!ENTITY W3C.REC-xpath-19991116 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml4/reference.W3C.REC-xpath-19991116.xml">

]>

<?rfc symrefs="yes"?>
<?rfc sortrefs="no"?>
<?rfc iprnotified="yes"?>
<?rfc strict="yes"?>
<?rfc toc="yes"?>
<?rfc tocindent="yes"?>

<rfc category="std" ipr="full3978" docName="draft-thomson-geopriv-location-quality-00.txt">
  <front>
    <title abbrev="Location Quality">
      Specifying Location Quality Constraints in Location Protocols
    </title>

    <author initials="M." surname="Thomson"
            fullname="Martin Thomson">
      <organization>Andrew</organization>

      <address>
        <postal>
          <street>PO Box U40</street>
          <city>Wollongong University Campus</city>
          <region>NSW</region>
          <code>2500</code>
          <country>AU</country>
        </postal>

        <phone>+61 2 4221 2915</phone>
        <email>martin.thomson@andrew.com</email>
        <uri>http://www.andrew.com/</uri>
      </address>
    </author>

    <author initials="J." surname="Winterbottom"
            fullname="James Winterbottom">
      <organization>Andrew</organization>

      <address>
        <postal>
          <street>PO Box U40</street>
          <city>Wollongong University Campus</city>
          <region>NSW</region>
          <code>2500</code>
          <country>AU</country>
        </postal>

        <phone>+61 2 4221 2938</phone>
        <email>james.winterbottom@andrew.com</email>
        <uri>http://www.andrew.com/</uri>
      </address>
    </author>

    <date month="December" year="2007"/>
    <area>RAI</area>
    <workgroup>GEOPRIV</workgroup>
    <keyword>Internet-Draft</keyword>
    <keyword>HELD</keyword>
    <keyword>Location</keyword>
    <keyword>Quality</keyword>
    <keyword>Uncertainty</keyword>
    <keyword>Accuracy</keyword>
    <keyword>QOP</keyword>
    <keyword>QOS</keyword>

    <abstract>
      <t>
      </t>
    </abstract>
  </front>

  <middle>

    <section title="Introduction">
      <t>Location determination methods produce results of varying quality.  In general, the quality of location information increases as the effort expended in generating the information increases.  This document provides XML extension objects that can be added to any protocol that provides location information.  These elements provide the ability to communicate location quality constraints to the location server.
      </t>

      <t>This document provides semantics, examples and security considerations for the <xref target="I-D.ietf-geopriv-http-location-delivery">HELD protocol</xref>.  Application of the parameters described in this document are out of scope.
      </t>

      <t>Means for expressing the quality of location information is outlined in <xref target="I-D.thomson-geopriv-uncertainty"/> and <xref target="GeoShape"/>.  An entity requesting location information of an LS is unable to specify the quality of the location that it ultimately receives.  This is inefficient because an LS either provides location information that is inadequate for the intended task; or the LS could waste resources generating location information that is of eccessively high quality.
      </t>

      <t>This document describes an optional HELD parameter that communicates location quality constraints to an LS.  These constraints specify a desired uncertainty at a certain confidence, plus the maximum acceptable age where location information is stored.  Guidelines for deterministically evaluating location information against these rules are provided.
      </t>

      <t><xref target="I-D.busin-geopriv-location-qos-req"/> describes some of the benefits of providing an LS with location quality constraints.  Location quality constraints provide information that an LS can use in deciding how to generate location information.  For example, an LS that is able to provide a location estimate with a sufficiently small uncertainty might be able to provide a response before the time indicated in the <spanx style="verb">responseTime</spanx>.
      </t>

      <t>This document also provides a means by which the LS is able to indicate if the location quality meets the constraints.  These parameters can be used by a Location Recipient to ensure that the location is of adequate quality without requiring specific checking (although the PIDF-LO should include sufficient information to perform this check).   Response parameters are optional, and are also used to indicate that the LS has understood the location quality constraints.
      </t>

      <t>This document provides solutions that address a subset of the requirements in <xref target="I-D.busin-geopriv-location-qos-req"/>.
      </t>

      <section anchor="conventions" title="Conventions used in this document">

        <t>Terms and procedures relating to uncertainty and confidence are taken from <xref target="I-D.thomson-geopriv-uncertainty"/>.  Familiarity with terminology outlined in <xref target="I-D.ietf-geopriv-l7-lcp-ps"/> and <xref target="RFC3693"/> is also assumed.
        </t>

        <t>The term Location Server (LS) is used as a generic label.  From the perspective of this document, the LS could be a Location Information Server (LIS).  Similarly, the term Location Recipient (LR) is used to refer to the requester of location information, which could be a Device or Target for HELD.
        </t>

        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119"/>.
        </t>

      </section>
    </section>

    <section title="Location Quality Operation">
      <t>Location quality parameters are provided by a Device or any other client of an LS in a location request message.  <xref target="ex-locreq"/> shows an example message.
      </t>

      <figure anchor="ex-locreq">
        <artwork><![CDATA[
  <locationRequest xmlns="urn:ietf:params:xml:ns:geopriv:held">
    <locationType exact="true">geodetic</locationType>
    <quality xmlns="urn:ietf:params:xml:ns:geopriv:lq">
      <maxUncertainty confidence="95">
        <horizontal>150</horizontal>
        <vertical>1000</vertical>
      </maxUncertainty>
      <maxAge>PT30S</maxAge>
    </quality>
  </locationRequest>
        ]]></artwork>
      </figure>

      <t>A LS that supports the location quality element uses the information contained in the request to choose how it serves the query.  The response to this message contains a quality indicator element that includes a list of the quality constraints that were met.  <xref target="ex-locresp"/> shows a location response that includes a quality indicator.
      </t>

      <figure anchor="ex-locresp">
        <artwork><![CDATA[
  <locationResponse xmlns="urn:ietf:params:xml:ns:geopriv:held">
    <presence xmlns="urn:ietf:params:xml:ns:pidf"
              entity="pres:user@example.com">
      <!-- Actual location information omitted -->
    </presence>
    <qualityInd xmlns="urn:ietf:params:xml:ns:geopriv:lq">
      maxUncertainty/vertical maxAge
    </qualityInd>
  </locationResponse>
        ]]></artwork>
      </figure>

      <t>A LS doesn't indicate the quality of the location estimate in the quality indicator; quality information is included in the PIDF-LO.  The quality indicator provides notice to its recipient that the requested quality was provided.
      </t>

    </section>

    <section title="Location Quality Parameters">
      <t>This section defines the format and semantics of the location quality parameters for requests and the indication that is included with responses.
      </t>

      <section title="Location Quality Request">
        <t>The <spanx style="verb">quality</spanx> element is included in a HELD request to indicate the constraints set by the Location Recipient (LR) on the quality of returned location information.  This document defines three elements that are included.
        </t>

        <section title="Maximum Uncertainty">
          <t>The <spanx style="verb">maxUncertainty</spanx> element describes an upper limit on uncertainty at a given confidence.  Uncertainty is divided in to horizontal and vertical components.  Horizontal uncertainty is the maximum distance from the centroid of the area to the point in the shape furthest from the centroid on the horizontal plane.  Vertical uncertainty is the difference in altitude from the centroid to the point in the shape with the greatest altitude.
          <list style="empty">
            <t>Note: A LS MAY provide location information using the Point shape and indicate that the requested uncertainty is met providing that the LS has access to uncertainty information.  However, this is NOT RECOMMENDED since the recipient has no way of verifying the uncertainty.
            </t>
          </list>
          </t>

          <t>The <spanx style="verb">horizontal</spanx> and <spanx style="verb">vertical</spanx> elements are numerical values that contain a decimal value in meters.  Maximum uncertainty values MUST be greater than zero.
          </t>

          <t>A location estimate that does not contain uncertainty (i.e. a Point shape), never meets location quality constraints.  Where uncertainty is unknown, it MUST be assumed to be infinite at any non-zero confidence.  In particular, this applies to vertical uncertainty where the location estimate is two-dimensional only; location estimates without a vertical component of uncertainty never meet vertical uncertainty constraints.
          </t>

          <t>The <spanx style="verb">confidence</spanx> attribute of this element includes the confidence level (expressed as a percentage) that the uncertainty is evaluated at.  Confidence is set to a default of 95%.
          </t>

          <t>To evaluate uncertainty, the location estimate is first scaled so that the confidence of the estimate matches (or exceeds) the requested confidence.  The LS MAY convert the shape of the uncertainty to a circle or a sphere prior to scaling to simply the scaling process.  For consistency, and contrary to the rules in <xref target="I-D.thomson-geopriv-uncertainty"/>, it is RECOMMENDED that a normal PDF be used for all except where confidence is reduced for a rectangular PDF.
          </t>

          <t>Horizontal uncertainty is evalulated by removing the altitude and altitude uncertainty components from the location estimate.   While removing altitude components from a location estimate might normally increase confidence, confidence MUST NOT be increased at this step; the confidence value has already been considered.  The shape is then converted to a circle, if it is not already in that shape.  The radius of the resulting circle is compared to the maximum horizontal uncertainty.
          </t>


          <t>Vertical uncertainty is evaluated for shapes that contain altitude uncertainty.  The value used for evaluating vertical uncertainty depends on the shape type: the vertical axis value for the Ellipsoid shape; the radius of the Sphere shape; half the height of the Prism shape.
          </t>

          <t>The LS MAY use location quality parameters to alter the way that it generates location information and to provide location information that more closely matches what is requested.  If maximum value is provided for vertical uncertainty, is is RECOMMENDED that the LS provide a location estimate that includes altitude and altitude uncertainty.  It is RECOMMENDED that the LS provide location information at the requested confidence, if possible.
          </t>

        </section>

        <section anchor="req-civic" title="Required Civic Elements">
          <t>The <spanx style="verb">requiredCivic</spanx> element represents the requirements of an LR for uncertainty in civic address information.  An LR can specify the address elements that need to be present in the civic address in order for the location information to meet their quality requirements.
          </t>

          <t>The <spanx style="verb">requiredCivic</spanx> element contains a whitespace-separated list of element names.  These can be interpreted as <xref target="W3C.REC-xpath-19991116">XPath</xref> expressions that are evaluated in the context of the <xref target="I-D.ietf-geopriv-revised-civic-lo">"civicAddress" element</xref>.  These XPath statements are restricted to use of qualified names only (using the response document namespace context) and the <spanx style="verb">/</spanx> separator.  All child nodes of elements (including attributes and textual content) are treated as belonging to an element.
          </t>

          <t><xref target="ex-reqcivic"/> shows an example request where an LR requires country, state (or equivalent) and post code civic address elements in the location information provided by the LS.
          </t>
      <figure anchor="ex-reqcivic">
        <artwork><![CDATA[
  <quality xmlns="urn:ietf:params:xml:ns:geopriv:lq">
    <requiredCivic
        xmlns:ca="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr">
      ca:country ca:A1 ca:PC
    </requiredCivic>
  </quality>
        ]]></artwork>
      </figure>

        </section>

        <section title="Maximum Age">
          <t>Where location information is stored or cached, an LR can specify how long since the information.  This is particularly important if location information is generated in advance.  The "age" of location information is the taken as the time interval between the location information timestamp (the <spanx style="verb">timestamp</spanx> element in the PIDF tuple) and the time that the request is received by the LS.
          </t>

          <t>Location information that has greater age than requested SHOULD either be determined anew, or checked so that the timestamp can be updated.  If this value is set to zero (i.e. <spanx style="verb">PT0S</spanx>), stored location information cannot be used.
          </t>
        </section>

      </section>
      <section title="Location Quality Indication">
        <t>The <spanx style="verb">qualityInd</spanx> element contains a list of the quality constraints that the resulting location information meets.
        </t>

        <t>The list of constraints is represented as a whitespace-separated list of element names.  These can be interpreted as <xref target="W3C.REC-xpath-19991116">XPath</xref> expressions that are evaluated in the context of the original location quality request.  These statements follow the same constraints as the list of elements in <xref target="req-civic"/>.
        </t>

        <t>Where elements are nested, such as the <spanx style="verb">maxUncertainty</spanx> element, the outer element can be included to indicate an entire constraint is met; or, each individual child element can be identified.  Two equivalent indications are shown in <xref target="ex-uncind"/>.
        </t>

        <figure anchor="ex-uncind">
          <artwork><![CDATA[
    <qualityInd xmlns="urn:ietf:params:xml:ns:geopriv:lq">
      maxUncertainty
    </qualityInd>

    <qualityInd xmlns="urn:ietf:params:xml:ns:geopriv:lq">
      maxUncertainty/horizontal maxUncertainty/vertical
    </qualityInd>
    ]]></artwork>
        </figure>

        <t>A LS that is unable to determine if a constraint MUST either omit the quality indication, or indicate that the constraint was not met.
        </t>

        <t>Two special values are added to the quality indication element for convenience.  The value <spanx style="verb">##all</spanx> indicates that all quality constraints were met (including any extensions).  The value <spanx style="verb">##none</spanx> indicates that none of the constraints were met.
        </t>
      </section>
    </section>

    <section anchor="schema" title="Location Quality Schema">
      <t>Note that the pattern rules in the following schema wrap due to length constraints in RFC documents.  None of the patterns contain whitespace.
      </t>
      <figure>
        <artwork><![CDATA[
<?xml version="1.0"?>
<xs:schema
    xmlns:lq="urn:ietf:params:xml:ns:geopriv:lq"
    xmlns:conf="urn:ietf:params:xml:ns:geopriv:conf"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="urn:ietf:params:xml:ns:geopriv:lq"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified">

  <xs:annotation>
    <xs:appinfo
        source="urn:ietf:params:xml:schema:geopriv:lq">
      HELD Location Quality
    </xs:appinfo>
    <xs:documentation source="http://www.ietf.org/rfc/rfcXXXX.txt">
      <!-- [[NOTE TO RFC-EDITOR: Please replace above URL with URL of
           published RFC and remove this note.]] -->
      This schema defines a framework for location quality requests
      and indications of whether they are met.
    </xs:documentation>
  </xs:annotation>

  <xs:import namespace="urn:ietf:params:xml:ns:geopriv:conf"/>

  <xs:element name="quality">
    <xs:complexType>
      <xs:complexContent>
        <xs:restriction base="xs:anyType">
          <xs:sequence>
            <xs:element ref="lq:maxUncertainty" minOccurs="0"/>
            <xs:element ref="lq:requiredCivic" minOccurs="0"/>
            <xs:element ref="lq:maxAge" minOccurs="0"/>
            <xs:any namespace="##other" processContents="lax"
                    minOccurs="0" maxOccurs="unbounded"/>
          </xs:sequence>
          <xs:anyAttribute namespace="##any" processContents="lax"/>
        </xs:restriction>
      </xs:complexContent>
    </xs:complexType>
  </xs:element>

  <xs:element name="maxUncertainty" type="lq:maxUncertaintyType"/>
  <xs:complexType name="maxUncertaintyType">
    <xs:complexContent>
      <xs:restriction base="xs:anyType">
        <xs:sequence>
          <xs:element name="horizontal" type="lq:limitType"/>
          <xs:element name="vertical" type="lq:limitType"/>
        </xs:sequence>
        <xs:attribute name="confidence" type="conf:confidenceBase"
                      default="95"/>
      </xs:restriction>
    </xs:complexContent>
  </xs:complexType>

  <xs:simpleType name="limitType">
    <xs:restriction base="xs:decimal">
      <xs:minExclusive value="0.0"/>
    </xs:restriction>
  </xs:simpleType>

  <xs:element name="maxAge" type="lq:maxAgeType"/>
  <xs:simpleType name="maxAgeType">
    <xs:restriction base="xs:duration">
      <xs:minInclusive value="PT0S"/>
    </xs:restriction>
  </xs:simpleType>

  <xs:element name="requiredCivic" type="lq:elementListType"/>

  <xs:element name="qualityInd" type="lq:qualityIndType"/>
  <xs:simpleType name="qualityIndType">
    <xs:union memberTypes="lq:elementListType">
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:enumeration value="##all"/>
          <xs:enumeration value="##none"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:union>
  </xs:simpleType>

  <xs:simpleType name="elementListType">
    <xs:list>
      <xs:simpleType>
        <xs:restriction base="xs:token">
          <xs:pattern
              value="(([\i-[:]][\c-[:]]*:)?[\i-[:]][\c-[:]]*/)*
                     ([\i-[:]][\c-[:]]*:)?[\i-[:]][\c-[:]]*"/>
        </xs:restriction>
      </xs:simpleType>
    </xs:list>
  </xs:simpleType>

</xs:schema>
        ]]></artwork>
      </figure>
    </section>

    <section anchor="security" title="Security Considerations">
      <t>This document does not introduce any security considerations.  [[Editor's Note:  Please let us know if you can think of some.]]
      </t>

    </section>

    <section anchor="iana" title="IANA Considerations">

      <section title="URN Sub-Namespace Registration for urn:ietf:params:xml:ns:geopriv:lq">
        <t>This section registers a new XML namespace, <spanx style="verb">urn:ietf:params:xml:ns:geopriv:lq</spanx>, as per the guidelines in <xref target="RFC3688"/>.
        <list style="empty">
          <t>URI: urn:ietf:params:xml:ns:geopriv:lq</t>
          <t>Registrant Contact: IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).</t>

          <t>XML:
          <figure>
            <artwork><![CDATA[
      BEGIN
        <?xml version="1.0"?>
        <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
        <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
          <head>
            <title>HELD Location Quality</title>
          </head>
          <body>
            <h1>Namespace for HELD Location Quality</h1>
            <h2>urn:ietf:params:xml:ns:geopriv:lq</h2>
[[NOTE TO IANA/RFC-EDITOR: Please update RFC URL and replace XXXX
    with the RFC number for this specification.]]
            <p>See <a href="[[RFC URL]]">RFCXXXX</a>.</p>
          </body>
        </html>
      END
      ]]></artwork>
          </figure>
          </t>
        </list>
        </t>
      </section>

      <section title="XML Schema Registration for Measurement Schema">
        <t>This section registers an XML schema as per the guidelines in <xref target="RFC3688"/>.
        <list style="hanging">
          <t hangText="URI:">urn:ietf:params:xml:schema:geopriv:lq</t>
          <t hangText="Registrant Contact:">IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).</t>
          <t hangText="Schema:">The XML for this schema can be found in <xref target="schema"/> of this document.
          </t>
        </list>
        </t>
      </section>
    </section>
<!--
    <appendix title="Change Log">
      <t>[[The RFC Editor is requested to remove this section at publication.]]</t>
      <t>Changes since -0-1:
      <list style="symbols">
        <t>Document created.</t>
      </list>
      </t>
    </appendix>
-->
  </middle>

  <back>

    <references title="Normative References">
      &RFC2119;
      &RFC3688;
      &I-D.ietf-geopriv-http-location-delivery;
      &I-D.thomson-geopriv-uncertainty;
    </references>

    <references title="Informative References">
      &W3C.REC-xpath-19991116;
      &I-D.ietf-geopriv-revised-civic-lo;
      &I-D.busin-geopriv-location-qos-req;
&I-D.ietf-geopriv-l7-lcp-ps;
&RFC3693;
      <reference anchor="GeoShape">
        <front>
          <title abbrev="GeoShape">GML 3.1.1 PIDF-LO Shape Application Schema for use by the
          Internet Engineering Task Force (IETF)</title>
          <author initials="M." surname="Thomson" fullname="Martin Thomson">
            <organization>Andrew Corporation</organization>
          </author>
          <author initials="C." surname="Reed" fullname="Carl Reed, PhD.">
            <organization>Open Geospatial Consortium Inc.</organization>
          </author>
          <date month="April" day="10" year="2007"/>
        </front>
        <seriesInfo name="Candidate OpenGIS Implementation Specification"
                    value="06-142r1, Version: 1.0"/>
      </reference>
    </references>

  </back>
</rfc>
