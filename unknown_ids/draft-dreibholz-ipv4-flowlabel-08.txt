


Network Working Group                                       T. Dreibholz
Internet-Draft                              University of Duisburg-Essen
Intended status: Standards Track                           July 11, 2008
Expires: January 12, 2009


                        An IPv4 Flowlabel Option
                 draft-dreibholz-ipv4-flowlabel-08.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on January 12, 2009.


















Dreibholz               Expires January 12, 2009                [Page 1]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


Abstract

   This draft defines an IPv4 option containing a flowlabel that is
   compatible to IPv6.  It is required for simplified usage of IntServ
   and interoperability with IPv6.














































Dreibholz               Expires January 12, 2009                [Page 2]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


1.  Introduction

1.1.  Terminology

   This document uses the following terms:

   o  IntServ (Integrated Services): Reservation of network resources
      (bandwidth) on a per-flow basis.  See [RFC1633], [RFC2205],
      [RFC2208], [RFC2209], [RFC2210], [RFC2211] and [RFC2212] for
      details.

   o  Flow: An IntServ reservation between two endpoints.

   o  Flow Label: The Flow Label field of the IPv6 header and the IPv4
      option header defined in this draft.  It is used for marking a
      packet to use a specific IntServ reservation.  See [RFC1809] for a
      detailed description.

1.2.  Abbreviations

   o  RSVP: ReSource Reservation Protocol

   o  SCTP: Stream Control Transmission Protocol

   o  TCP: Transmission Control Protocol

   o  QoS: Quality of Service

   o  UDP: User Datagram Protocol

1.3.  Conventions

   The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD.
   SHOULD NOT, RECOMMENDED, NOT RECOMMENDED, MAY, and OPTIONAL, when
   they appear in this document, are to be interpreted as described in
   [RFC2119].















Dreibholz               Expires January 12, 2009                [Page 3]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


2.  A Flow Label Option for IPv4

2.1.  Motivation

   This section describes the motivation to add a flow label option to
   the IPv4 protocol.

2.1.1.  The Flow Label Field of IPv6

   The Flow Label field of the IPv6 header (see [RFC2460] and [RFC1809])
   is a 20-bit pseudo-random number.  All packets from the same source
   address having the same flow label MUST contain the same destination
   address.  Therefore, the flow label combined with the source address
   is a network- unique identification for a specific packet flow.  The
   idea behind the flow label is marking specific flows for IntServ.
   That is, the routers on the path from source to destination keep e.g.
   reservation states for the flows.  The flow label provides easy
   identification and utilizes efficient lookup, e.g. using a hash
   function on the 3-tuple (source address, destination address, flow
   label).

   Using the IPv6 flow label, packets can be mapped easily to specific
   flows, with the following features:

   o  Transport Layer Protocol Independence: Since the mapping is
      directly specified in the IP header, all possible layer 4
      protocols are supported, even protocols to be specified in a far
      future.

   o  Support for Network Layer Encryption: The mapping is independent
      of payload encryption (e.g. by IPsec).

   o  Support for Fragmentation: If fragmentation of a large IP packet
      is necessary, all fragments contain the same flow label.
      Therefore, fragmentation does not cause any flow-marking problem.

   o  Flow Sharing: By marking packets with a flow label, it is possible
      to share a single flow (IntServ reservation) with several
      communication associations from host A to host B. For example, a
      video stream via UDP and a HTTP download via TCP could share a
      single reservation.  For the user, flow sharing has the advantage
      that if one of its communication associations temporarily requires
      lower bandwidth than expected, other associations sharing the same
      flow may use the remaining bandwidth.  That is, his possibly
      expensive reservation is fully utilized.  Flow sharing also helps
      keeping the total number of reservations a router has to handle
      small, reducing their CPU and memory requirements and therefore
      cost.



Dreibholz               Expires January 12, 2009                [Page 4]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


   o  Multi-Flow Connections: One communication association can divide
      up its packets to several flows, simply by marking packets with
      different flow labels.  This technique can be used for layered
      transmission.  That is, a stream (e.g. a video) is divided up into
      several parts (called layers).  For example, the first layer (base
      layer) of a video contains a low-quality version, the second (1st
      enhancement layer) the data to generate a higher-quality version,
      etc..  Now, the first layer can be mapped to a high-quality
      reservation (guaranteed bandwidth, low loss rate) at higher cost,
      but the following layers can be mapped to lower-quality
      reservations (e.g. higher loss rate) or even best effort at lower
      cost.  Research shows that the total transmission cost can be
      highly reduced using layered transmission (see [Dre2001] for
      details).

2.1.2.  The Limitations of IntServ via IPv4

   Using IntServ with IPv4, there are several problems that can only be
   solved with high management effort:

   o  No Transport Layer Protocol Independence: It is necessary to mark
      the packets within the layer 4 protocol header.  For example, the
      TCP, UDP or SCTP port numbers can be used to mark flows (with
      limitations, see below).  But for new protocols (e.g.
      experimental, new standards, proprietary), software updates for
      *all* IntServ routers are necessary to recognize the packet flow!

   o  No Support for Network Layer Encryption: Since it is necessary to
      read fields of the layer 4 protocol header, it may not be
      encrypted.  Therefore, e.g. the usage of IPsec is impossible.

   o  Support for Fragmentation: Only the first fragment of a large
      packet contains the layer 4 header necessary to map the packet to
      a flow.  Mapping other fragments would require the hops to
      remember packet identities and try to map fragments to packet
      identities.  Due to the management effort and memory requirements,
      this is not realistic for high-bandwidth backbone routers;
      especially when packet reordering must be considered.
      Furthermore, load sharing or traffic distribution would be
      impossible.

   o  No Flow Sharing: It is usually impossible for two different
      communication associations to share the same flow, e.g. if TCP
      flows are recognized using port numbers.  This makes it necessary
      to reserve an IntServ flow for each communication association.
      This implies an increased number of flow states for routers to
      keep and maintain.  Furthermore, if one association temporarily
      uses a lower bandwidth, the free bandwidth of its flow cannot



Dreibholz               Expires January 12, 2009                [Page 5]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


      easily be borrowed to another association.

   o  No Multi-Flow Connections: To use layered transmission, e.g. a
      video via UDP, the transmission of every layer would require own
      port numbers.  In the case of connection-oriented transmission
      protocols (e.g.  TCP, SCTP), every layer would even require its
      own connection setup and management.  Depending on the transport
      protocol, the number of communication associations and the number
      of flows, much more work is necessary compared to IPv6 using flow
      labels.

   All in all, using IntServ flows with IPv4 requires much more work
   compared to IPv6, where simply the flow label can be used.  It is
   therefore useful to add such a field to IPv4, too.  An appropriate
   place to add such a field is an IPv4 option header.

2.2.  Definition of the Flow Label Option

   IPv4 (see [RFC0791]) already defines an option header for a 16-bit
   SATNET stream identifier.  Since this identifier would be
   incompatible to the 20-bit IPv6 flow label, reuse of this existing
   option header is inappropriate.  Therefore, a new one is defined as
   follows.

   Flow Label Option

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     |0 0 0 0 0 0 0 0|0 0 0 0 0 0 0 0|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0 0 0 0 0 0 0|0 0 0 0|              Flow Label               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   o  Type: 143

   o  Length: 8 octets

   o  Flow Label: The 20-bit flow label.  All definitions of [RFC1809]
      and [RFC2460] for the IPv6 flow label are also valid for this
      field.  A value of zero denotes that no flow label is used.  In
      this case, the flow label option is in fact unnecessary.

   The Flow Label option SHOULD be copied on fragmentation.  It MUST be
   the first option of the IP header and therefore MAY NOT appear more
   than once per IPv4 packet.  The Router Alert option SHOULD NOT be
   used to mark the necessity for routers to examine the options.
   Placing the Flow Label option as first option allows for easy



Dreibholz               Expires January 12, 2009                [Page 6]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


   processing in hardware.


















































Dreibholz               Expires January 12, 2009                [Page 7]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


3.  Translation between IPv6 and IPv4

   Since the new IPv4 flow label is fully compatible to the IPv6 flow
   label, the field MAY be translated in the other protocol's one during
   protocol translation.  That is, a router can translate an IPv6 packet
   set from an IPv6-only host to an IPv4-mapped address of an IPv4-only
   host and the flow label may simply be copied.  The same may also be
   applied in the backwards direction.

   Note, that copying the flow label during protocol translation is not
   mandatory.  There may be IntServ reservation reasons for not copying
   but setting the flow label to zero.  But a router MAY NOT set the
   flow label to another value than the copy or 0, since the source is
   responsible to ensure that the source address combined with the flow
   label is network-unique




































Dreibholz               Expires January 12, 2009                [Page 8]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


4.  References

4.1.  References

   [RFC0791]  Postel, J., "Internet Protocol", STD 5, RFC 791,
              September 1981.

   [RFC1633]  Braden, B., Clark, D., and S. Shenker, "Integrated
              Services in the Internet Architecture: an Overview",
              RFC 1633, June 1994.

   [RFC1809]  Partridge, C., "Using the Flow Label Field in IPv6",
              RFC 1809, June 1995.

   [RFC2205]  Braden, B., Zhang, L., Berson, S., Herzog, S., and S.
              Jamin, "Resource ReSerVation Protocol (RSVP) -- Version 1
              Functional Specification", RFC 2205, September 1997.

   [RFC2208]  Mankin, A., Baker, F., Braden, B., Bradner, S., O'Dell,
              M., Romanow, A., Weinrib, A., and L. Zhang, "Resource
              ReSerVation Protocol (RSVP) Version 1 Applicability
              Statement Some Guidelines on Deployment", RFC 2208,
              September 1997.

   [RFC2209]  Braden, B. and L. Zhang, "Resource ReSerVation Protocol
              (RSVP) -- Version 1 Message Processing Rules", RFC 2209,
              September 1997.

   [RFC2210]  Wroclawski, J., "The Use of RSVP with IETF Integrated
              Services", RFC 2210, September 1997.

   [RFC2211]  Wroclawski, J., "Specification of the Controlled-Load
              Network Element Service", RFC 2211, September 1997.

   [RFC2212]  Shenker, S., Partridge, C., and R. Guerin, "Specification
              of Guaranteed Quality of Service", RFC 2212,
              September 1997.

   [RFC2460]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", RFC 2460, December 1998.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

4.2.  Informative References

   [Dre2001]  Dreibholz, T., "Management of Layered Variable Bitrate
              Multimedia Streams Over DiffServ with A Priori Knowledge",



Dreibholz               Expires January 12, 2009                [Page 9]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


              Masters Thesis University of Bonn, Institute for Computer
              Science, February 2001.

















































Dreibholz               Expires January 12, 2009               [Page 10]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


Author's Address

   Thomas Dreibholz
   University of Duisburg-Essen, Institute for Experimental Mathematics
   Ellernstrasse 29
   45326 Essen, Nordrhein-Westfalen
   Germany

   Phone: +49-201-1837637
   Fax:   +49-201-1837673
   Email: dreibh@iem.uni-due.de
   URI:   http://www.iem.uni-due.de/~dreibh/







































Dreibholz               Expires January 12, 2009               [Page 11]

Internet-Draft          An IPv4 Flowlabel Option               July 2008


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.











Dreibholz               Expires January 12, 2009               [Page 12]

