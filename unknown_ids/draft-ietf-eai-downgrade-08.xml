<?xml version="1.0"?> 
<!-- $Id: draft-ietf-eai-downgrade-08.xml,v 1.7 2008/07/14 08:08:12 fujiwara Exp $ -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
  <!ENTITY % rfc2119 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
  <!ENTITY % rfc1652 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.1652.xml'>
  <!ENTITY % rfc2045 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2045.xml'>
  <!ENTITY % rfc2047 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2047.xml'>
  <!ENTITY % rfc2183 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2183.xml'>
  <!ENTITY % rfc2231 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2231.xml'>
  <!ENTITY % rfc2821 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2821.xml'>
  <!ENTITY % rfc2822 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2822.xml'>
  <!ENTITY % rfc3461 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3461.xml'>
  <!ENTITY % rfc3864 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3864.xml'>
<!--  <!ENTITY % rfc3987 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3987.xml'> -->
  <!ENTITY % rfc4021 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4021.xml'>
  <!ENTITY % rfc4952 PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4952.xml'>
  <!ENTITY % I-D.ietf-eai-smtpext PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-smtpext-13.xml'>
  <!ENTITY % I-D.ietf-eai-utf8headers PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-utf8headers-12.xml'>
  <!ENTITY % I-D.ietf-eai-dsn PUBLIC ''
    'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-eai-dsn-06.xml'>
  ]>

<?rfc compact='yes'?>
<?rfc toc='yes'?>

<!-- Validator on -->
<?rfc strict="yes" ?>

<!-- Expand crefs and put them inline -->
<?rfc comments='yes' ?>
<?rfc inline='yes' ?>  

<!-- RFC references as names, not numbers -->
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes" ?>

<rfc category="exp" ipr="full3978" docName="draft-ietf-eai-downgrade-08.txt">
<!-- ipr: full2026 / noDerivativeWorks2026 / none -->

<front>
  <title abbrev="UTF8SMTP Downgrade">
    Downgrading mechanism for Email Address Internationalization
  </title>
  <author initials="K.F." surname="Fujiwara" fullname="Kazunori Fujiwara" role="editor">
    <organization>JPRS</organization>
    <address>
	<postal>
	<street>Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</street>
	<city>Chiyoda-ku</city>
	<region>Tokyo</region>
	<code>101-0065</code>
	<country>Japan</country>
	</postal>
	<phone>+81 3 5215 8451</phone>
	<email>fujiwara@jprs.co.jp</email>
    </address>
  </author>
  <author initials="Y.Y." surname="YONEYA" fullname="Yoshiro YONEYA" role="editor">
    <organization>JPRS</organization>
    <address>
	<postal>
	<street>Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</street>
	<city>Chiyoda-ku</city>
	<region>Tokyo</region>
	<code>101-0065</code>
	<country>Japan</country>
	</postal>
	<phone>+81 3 5215 8451</phone>
	<email>yone@jprs.co.jp</email>
    </address>
  </author>
  <date month="July" day="14" year="2008" />
  <area>Applications</area>
  <workgroup>Email Address Internationalization (EAI)</workgroup>
  <!-- <area ...>, <workgroup ...>, <keyword ...>, <keyword ...> <note..> -->

  <abstract>
    <t>
	Traditional mail systems handle only ASCII characters in SMTP
	envelope and mail header fields.
	The Email Address Internationalization (UTF8SMTP) extension allows
	UTF-8 characters in SMTP envelope and mail header fields.
	To avoid rejecting internationalized Email messages when a server
	in the delivery path does not support the UTF8SMTP extension,
	some sort of converting mechanism is required.
	This document describes a downgrading mechanism
	for Email Address Internationalization.
	Note that this is a way to downgrade, not tunnel.  There is no
	associated up-conversion mechanism, although internationalized
	email clients might use original internationalized addresses or
	other data when displaying or replying to downgraded messages.
    </t>
  </abstract>
</front>

<middle>
  <section title="Introduction" anchor="intro">
    <t>
	Traditional mail systems which are defined
	by <xref target="RFC2821" /> and <xref target="RFC2822" />
	allow ASCII characters in SMTP envelope and mail header field values.
	The UTF8SMTP extension
		<xref target="RFC4952" />,
		<xref target="I-D.ietf-eai-utf8headers" /> and
		<xref target="I-D.ietf-eai-smtpext" />
	allows UTF-8 characters in SMTP envelope and mail header field values.
    </t>
    <t>

If an envelope address or header field contains non-ASCII 
characters, the message cannot be delivered unless every system
in the delivery path supports UTF8SMTP. 

This document describes a downgrading mechanism to avoid rejection of
such messages when a server which does not support the UTF8SMTP
extension is encountered.

Downgrading mechanism converts envelope and header fields to an
all-ASCII representation.
    </t>
    <t>     
<xref target="I-D.ietf-eai-utf8headers" />
allows UTF-8 characters to be used in
mail header fields and MIME header fields.  The downgrading
mechanism specified here converts mail header fields and MIME
header fields to ASCII.
    </t>
    <t>
	This document does not change any protocols
	except by defining new header fields. It describes the conversion
	method from the internationalized email envelopes/messages
	which are defined in 
		<xref target="RFC4952" />
		<xref target="I-D.ietf-eai-utf8headers" />
		<xref target="I-D.ietf-eai-smtpext" />
	to the traditional email envelopes/messages
	which are defined in
		<xref target="RFC2821" />
		<xref target="RFC2822" />.
    </t>
    <t>
	<xref target="I-D.ietf-eai-smtpext"/> section 2.2 defines when
	downgrading occurs.
	If the SMTP client has an UTF8SMTP envelope or an internationalized message
	and the SMTP server doesn't support the UTF8SMTP SMTP extension,
	then the SMTP client MUST NOT send a UTF8SMTP envelope
	or an internationalized message to the SMTP server.
	The section shows 4 choices.
	The fourth choice is downgrading, as described here.
    </t>
    <t>
	Downgrading may be implemented
	in MUAs, MSAs, MTAs which act as the SMTP client,
	or in MDAs, POP servers, IMAP servers which store or offer
	UTF8SMTP envelopes or internationalized messages
	to non-UTF8SMTP compliant systems
	which include message stores.
    </t>
    <t>
	This document tries to define the downgrading process clearly and
	it preserves the original information as much as possible.
    </t>
    <t>
	Downgrading in UTF8SMTP consists of the following four parts:
	<list style="symbols">
	<t>New header fields definition</t>
	<t>SMTP downgrading</t>
	<t>Email header fields downgrading</t>
	<t>MIME header fields downgrading</t>
	</list>
	<vspace blankLines="1" />
    </t>
    <t>
	In <xref target="downgradedheader" />,
	many header fields starting with "Downgraded-"
	are introduced.
	They preserve the original envelope information and the original header fields.
	</t>
    <t>
	The SMTP downgrading is described in <xref target="smtpdowngrading" />.
	It generates ASCII only envelope information from an UTF8SMTP envelope.
    </t>
    <t>
	The Email header fields downgrading is described in <xref target="HeaderDowngrading" />.
	It generates ASCII only header fields.
    </t>
    <t>
	The MIME header fields are expanded in <xref target="I-D.ietf-eai-utf8headers" />.
	The MIME header fields downgrading is described in <xref target="MIMEheaderdowngrading" />.
	It generates ASCII only MIME header fields.
    </t>
  </section>

  <section title="Terminology">
    <t>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
      in this document are to be interpreted as described in RFC
      2119 <xref target="RFC2119" />.
    </t>
    <t>
   All specialized terms used in this specification are defined in the
   EAI overview <xref target="RFC4952" /> or in
	<xref target="RFC2821" /><xref target="RFC2822" />,
	MIME documents
		<xref target="RFC2045" />
		<xref target="RFC2047" />
		<xref target="RFC2183" />
		<xref target="RFC2231" />.
   The terms "ASCII address", "internationalized email address", "non-ASCII
   address", "i18mail address", "UTF8SMTP", "message" and "mailing list"
   are used with the definitions from <xref target="RFC4952" /> document.
    </t>
    <t>
	This document depends on <xref target="I-D.ietf-eai-smtpext" />,
	<xref target="I-D.ietf-eai-utf8headers" />, and
	<xref target="I-D.ietf-eai-dsn" />.
	Key words used in these document are used in this document, too.
    </t>
    <t>
	The term "non-ASCII" is an UTF-8 string which contains at least
	one non-ASCII character. 
    </t>
    <t>
	An "UTF8SMTP envelope" has Email originator/recipient addresses
	expanded by <xref target="I-D.ietf-eai-smtpext"/> and
	<xref target="I-D.ietf-eai-dsn"/>.
    </t>
    <t>
	An "UTF8SMTP message" is Email messages expanded by
	<xref target="I-D.ietf-eai-utf8headers" />.
    </t>
  </section>

  <section title="New header fields definition" anchor="downgradedheader">
  <t>
New header fields starting with "Downgraded-" are defined here to
preserve those original envelope and header values which contain
UTF-8 characters.  During downgrading, one new "Downgraded-"
header field is added for each original envelope or header field
which cannot be passed as-is to a server which does not support
UTF8SMTP.  The original envelope or header field is removed or
rewritten.  Only those envelope and header fields which contain
non-ASCII characters are affected.  The result of this process
is a message which is compliant with existing email
specifications <xref target="RFC2821" /> and <xref target="RFC2822" />.
The original internationalized information can be retrieved by examining the
"Downgraded-" header fields which were added.  Even though the
information is not lost, the original message cannot be
perfectly reconstructed.  Hence, downgrading is a one-way
process.  However, an internationalized client might use the
information in the "Downgraded-" header fields when processing a
downgraded message, for example, such as displaying or composing
a reply.
    </t>
	<section title="Envelope information preservation headers">
    <t>
	Two headers "Downgraded-Mail-From:" and "Downgraded-Rcpt-To:" are defined
	to preserve SMTP envelope downgraded information.
	SMTP envelope downgraded information consists of
	the original non-ASCII address and the downgraded all-ASCII address.
	The header field syntax is specified as follows: 
<figure>
  <artwork><![CDATA[
fields      =/ downgradedmailfrom / downgradedrcptto
downgradedmailfrom = "Downgraded-Mail-From:" [FWS] "<" uPath ">" 1*[FWS]
                                     "<" Mailbox ">" [FWS] CRLF
downgradedrcptto = "Downgraded-Rcpt-To:" [FWS] "<" uPath ">" 1*[FWS]
                                     "<" Mailbox ">" [FWS] CRLF
  ]]></artwork>
</figure>
     </t>
     <t>
	Original non-ASCII address &lt;uPath&gt; is defined in <xref target="I-D.ietf-eai-smtpext" />;
	it is treated as unstructured in this header
	and it is encoded according to <xref target="RFC2047" />.
	&lt;Mailbox&gt; is defined in <xref target="RFC2821" />, section 4.1.2.
     </t>
	</section>
    <section title="Address header field preservation headers" anchor="AddressHeaderPreservationHeaders">
    <t>
      The address header fields preservation headers are defined
      to preserve the original header field.
      Their value field holds the original header field value.
      Any original header field value is treated as an &lt;unstructured&gt;
	and it MUST be encoded according to <xref target="RFC2047" />
	with charset='UTF-8'.
	The header field syntax is specified as follows: 

<figure>
  <artwork>
<![CDATA[
fields     =/ known-downgraded-headers ":" unstructued CRLF
known-downgraded-headers =  "Downgraded-" original-headers
original-headers = "From" / "To" / "Cc" / "Bcc" /
                   "Sender" / "Reply-To" /
                   "Resent-From" / "Resent-Sender" /
                   "Resent-To" / "Resent-Cc" / "Return-Path"
]]>
  </artwork>
</figure>
	Preserving a header field in a downgraded header field is defined as:
	<list style="numbers">
	<t>Generate new downgraded header field whose value is the original header field value.</t>
	<t>Encode the generated header according to <xref target="RFC2047" /> with charset='UTF-8'.</t>
	</list>
    </t>
    </section>
    <section title="Unknown header fields preservation headers" anchor="unknownencapsulation">
    <t>
	The unknown header fields preservation headers are defined to
	encapsulate those original header field which contains non-ASCII
	characters and are not otherwise provided for in the this
	specification.  The encapsulation header field name is the
	concatenation of "Downgraded-" and the original name.  The value
	field holds the original header field value.
    </t>
    <t>
	Any original header field value is treated as an unstructured value
	and it MUST be encoded according to <xref target="RFC2047" />
	with charset='UTF-8'.
	The header field syntax is specified as follows: 

<figure>
  <artwork>
<![CDATA[
fields     =/ unknown-downgraded-headers ":" unstructued CRLF
unknown-downgraded-headers =  "Downgraded-" original-header-field-name
original-header-field-name = field-name

field-name      =       1*ftext

ftext           =       %d33-57 /               ; Any character except
                        %d59-126                ;  controls, SP, and
                                                ;  ":".
]]>
  </artwork>
</figure>
	</t>
	<t>
	Encapsulating a header field in a "Downgraded-" header field is defined as:
	<list style="numbers">
	<t>Generate new "Downgraded-" header whose value is the original header field value.</t>
	<t>Encode the generated header field value according to
	 <xref target="RFC2047" /> with charset='UTF-8'.
	 To preserve space characters,
	 the whole header field value which include space characters SHOULD be encoded.
	</t>
	<t>Remove the original header field.</t>
	</list>
    </t>
    </section>
  </section>

  <section title="SMTP Downgrading" anchor="smtpdowngrading">
    <t>
	Target of downgrading elements in SMTP envelope are below:
    </t>
    <t>
	<list style="symbols">
	 <t>&lt;reverse-path&gt; of MAIL FROM command</t>
	 <t>&lt;forward-path&gt; of RCPT TO command</t>
	 <t>ORCPT parameter of RCPT TO command</t>
	</list>
    </t>
    <section title="Path element downgrading" anchor="pathdowngrading">
    <t>
	Downgrading the &lt;path&gt; of MAIL FROM and RCPT TO commands uses ALT-ADDRESS parameter defined in
	<xref target="I-D.ietf-eai-smtpext"/>.  A SMTP command is downgradable if
	the &lt;path&gt; contains non-ASCII address and the command has an ALT-ADDRESS parameter which specifies an ASCII address.
	Since only non-ASCII addresses are downgradable, specifying an
	ALT-ADDRESS value for an all-ASCII address is invalid for use
	with this specification, and no interpretation is assigned to
	it. This restriction allows for future extension of the
	specification even though no such extensions are currently
	anticipated.
    </t>
    <t>
	Note that even if no downgrading is performed on the envelope,
	message header fields and message body MIME header fields
	 that contain non-ASCII characters MUST be downgraded.
	This is described in <xref target="HeaderDowngrading" /> and <xref target="MIMEheaderdowngrading" />.
    </t>
    <t>
	When downgrading, replace each &lt;path&gt; which contains non-ASCII mail address
	with its specified alternative ASCII address
	and preserve the original information using "Downgraded-Mail-From"
	and "Downgraded-Rcpt-To" header fields as defined in <xref target="downgradedheader" />.
	Before replacing, decode the ALT-ADDRESS parameter
	value because it is encoded as xtext <xref target="RFC3461" />.
     </t>
     <t>
	To avoid disclosing recipient addresses,
	the downgrading process MUST NOT add "Downgraded-Rcpt-To:" header
	if the SMTP downgrading targets multiple recipients.
	See <xref target="security" /> for more detail.
     </t>
     <t>
	As a result of the recipient address downgrading,
	the domain part of the recipient address prior to downgrading
	might be different from the domain part of the new recipient address.
	If the result of address resolution
	for the domain part of the new recipient address contains
	the server at the connection destination of the SMTP session for the
	recipient address prior to downgrading,
	the SMTP connection is valid for the new recipient address.
	Otherwise, the downgrading process MUST NOT send the downgraded message
	to the new recipient address via the connection
	and MUST try to send the downgraded message to the new recipient address.
     </t>
     </section>
     <section title="ORCPT downgrading" anchor="orcptdowngrading">
     <t>
	The "RCPT TO" command can have an ORCPT parameter if the DSN
	extension <xref target="RFC3461" /> is supported.
	If the ORCPT parameter contains an "utf-8" address
	and the address contains non-ASCII characters,
	the ORCPT parameter MUST be converted to utf-8-addr-xtext form or
	utf-8-addr-unitext form
	which are described in <xref target="I-D.ietf-eai-dsn" />.
     </t>
    </section>
  </section>

  <section title="Email header fields downgrading" anchor="HeaderDowngrading">
    <t>
	This section defines the conversion method to ASCII for each header field
	which may contain non-ASCII characters.
    </t>
    <t>
	<xref target="I-D.ietf-eai-utf8headers" /> expands
	Received: header fields, 
	<xref target="RFC2822" /> ABNF elements
	&lt;mailbox&gt;, &lt;word&gt;, &lt;comment&gt;, &lt;unstructured&gt;,
	<xref target="RFC2045" /> ABNF element &lt;value&gt;.
    </t>
    <t>
	Header field downgrading is defined below for each ABNF element.
	Downgrading an unknown header field is also defined as ENCAPSULATION downgrading.
	Converting the header field terminates when no non-ASCII characters
	remain in the header field.
    </t>
    <t>
    <list style="hanging">
    <t hangText="RECEIVED downgrading: ">
	If the header field name is "Received:" and
	the FOR clause contains a non-ASCII addresses, 
	remove the FOR clause from the header field.
	The other part does not contain non-ASCII values.
	  <vspace blankLines="1" />
    </t>
    <t hangText="UNSTRUCTURED downgrading: ">
	If the header field has an &lt;unstructured&gt; field which contains non-ASCII characters,
	encode the field according to <xref target="RFC2047" /> with charset='UTF-8'.
	To preserve space characters,
	the whole header field value which include space characters SHOULD be encoded.
	  <vspace blankLines="1" />
    </t>
    <t hangText="WORD downgrading: ">
	If the header field has any &lt;word&gt;
	fields which contains non-ASCII characters,
	encode the fields according to <xref target="RFC2047" /> with charset='UTF-8'.
	  <vspace blankLines="1" />
    </t>
    <t hangText="COMMENT downgrading: ">
	If the header field has any &lt;comment&gt;
	fields which contains non-ASCII characters,
	encode the fields according to <xref target="RFC2047" /> with charset='UTF-8'.
	  <vspace blankLines="1" />
    </t>
    <t hangText="MIME-VALUE downgrading: ">
	If the header field has any &lt;value&gt; elements defined by <xref target="RFC2045" />
	and the elements contain non-ASCII characters,
	encode the &lt;value&gt; elements
	by <xref target="RFC2231" /> with charset='UTF-8' and the Language information empty.
	If the &lt;value&gt; element is &lt;quoted-string&gt;
		and it contains &lt;CFWS&gt; outside the DQUOTE,
	remove the &lt;CFWS&gt; before this conversion.
	  <vspace blankLines="1" />
    </t>
    <t hangText="DISPLAY-NAME downgrading: ">
	If the header field has any &lt;mailbox&gt; elements and
	they have &lt;display-name&gt; elements which contain non-ASCII characters,
	encode the &lt;display-name&gt; elements
	according to <xref target="RFC2047" /> with charset='UTF-8'.
	  <vspace blankLines="1" />
    </t>
    <t hangText="MAILBOX downgrading: ">
	The &lt;mailbox&gt; elements have no equivalent format for non-ASCII addresses.
	If the header field has any &lt;mailbox&gt; elements which contain non-ASCII characters,
	preserve the header field in each Address header field preservation header defined in <xref target="AddressHeaderPreservationHeaders" />,
	and rewrite each &lt;mailbox&gt; element to ASCII only format.
	The &lt;mailbox&gt; element which contains non-ASCII characters is one of three formats.
	<vspace blankLines="1" />
	<list style="symbols">
	<t>[ Display-name ] &quot;&lt;&quot; Utf8-addr-spec 1*FCS &quot;&lt;&quot; Addr-spec &quot;&gt;&gt;&quot;
	  <vspace blankLines="1" />
		Rewrite it as
	  <vspace blankLines="1" />
                  [ Display-name ] "&lt;" Addr-spec "&gt;"
	  <vspace blankLines="1" />
	</t>
	<t>[ Display-name ] &quot;&lt;&quot; Utf8-addr-spec &quot;&gt;&quot;</t>
	<t>Utf8-addr-spec
	  <vspace blankLines="1" />
		Rewrite both as
	  <vspace />
		[ Display-name ] "Internationalized Address " Encoded-word
	  <vspace blankLines="0" />
		" Removed:;"
	  <vspace blankLines="1" />
		where the &lt;Encoded-word&gt; is the original &lt;Utf8-addr-spec&gt; encoded
		according to <xref target="RFC2047" />.
	</t>
	</list>
	  <vspace blankLines="1" />
    </t>
    <t hangText="ENCAPSULATION downgrading: ">
	if the header field contains non-ASCII characters
	and for which no rule is given above,
	encapsulate it in a Downgraded header field
	described in <xref target="unknownencapsulation" />
	as a last resort.
	  <vspace blankLines="1" />
    </t>
    </list>
    </t>

    <section title="Downgrading method for each header field">
    <t>
	Header fields are listed in <xref target="RFC4021" />.
	This section describes the downgrading method for each header field.
    </t>
    <t>
	If the whole mail header field does not contain non-ASCII characters,
	email header field downgrading is not required.
	Each header field's downgrading method is described below.
    </t>
    <t>
    <list style="symbols">
    <t>Address header fields which contain &lt;mailbox&gt;s
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="From:" />
	<t hangText="Sender:" />
	<t hangText="Reply-To:" />
	<t hangText="To:" />
	<t hangText="Cc:" />
	<t hangText="Bcc:" />
	<t hangText="Resent-From:" />
	<t hangText="Resent-Sender:" />
	<t hangText="Resent-To:" />
	<t hangText="Resent-Cc:" />
	<t hangText="Return-Path:" />
	</list>
	<vspace blankLines="1" />
	If the header field contains &lt;mailbox&gt; elements
	 which contains non-ASCII addresses,
	preserve the header field in a downgraded header before the conversion.
	Then perform COMMENT downgrading, DISPLAY-NAME downgrading and MAILBOX downgrading.
	<vspace blankLines="1" />
    </t>
    <t>Downgrading Non-ASCII in comments
	  <vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Date:" />
	<t hangText="Message-ID:" />
	<t hangText="In-Reply-To:" />
	<t hangText="References:" />
	<t hangText="Resent-Date:" />
	<t hangText="Resent-Message-ID:" />
	<t hangText="MIME-Version:" />
	<t hangText="Content-ID:" />
	</list>
	<vspace blankLines="1" />
	These header fields do not contain non-ASCII characters except in comments.
	If the header contains UTF-8 characters in comments,
	perform COMMENT downgrading.
	<vspace blankLines="1" />
    </t>
    <t>Trace header fields
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Received:" />
	</list>
	<vspace blankLines="1" />
	perform COMMENT downgrading and
	perform RECEIVED downgrading.
	<vspace blankLines="1" />
    </t>
    <t>MIME Content header fields
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Content-Type:" />
	<t hangText="Content-Disposition:" />
	</list>
	<vspace blankLines="1" />
	Perform MIME-VALUE downgrading.
	<vspace blankLines="1" />
    </t>
    <t>Non-ASCII in &lt;unstructured&gt;
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Subject:" />
	<t hangText="Comments:" />
	<t hangText="Content-Description:" />
	</list>
	<vspace blankLines="1" />
	Perform UNSTRUCTURED downgrading.
	<vspace blankLines="1" />
    </t>
    <t>Non-ASCII in &lt;unstructured&gt; or &lt;phrase&gt;
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Keywords:" />
	</list>
	<vspace blankLines="1" />
	Perform WORD downgrading.
	<vspace blankLines="1" />
    </t>
    <t>Other header fields
	<vspace blankLines="1" />
	All other header fields which contains non-ASCII characters
	are user-defined, missing from this draft
	or future defined header fields.
	Perform ENCAPSULATION downgrading as a last resort.
	<vspace blankLines="1" />
    </t>
    </list>
    </t>
    </section>
  </section>
  <section title="MIME body part headers downgrading" anchor="MIMEheaderdowngrading">
    <t>
	MIME body part header fields may contain non-ASCII characters
	<xref target="I-D.ietf-eai-utf8headers" />.
	This section defines the conversion method to ASCII only header fields
	 for each MIME header field which contains non-ASCII characters.
	Parse the message body's MIME structure for all levels and
	check each MIME header field whether it contains non-ASCII characters.
	If the header field contains non-ASCII characters in the header value,
	the header is a target of the MIME body part headers downgrading.
	Each MIME header field's downgrading method is described below.
	COMMENT downgrading, MIME-VALUE downgrading, UNSTRUCTURED downgrading
	are described in <xref target="HeaderDowngrading" />.
	<vspace blankLines="1" />
	<list style="hanging">
	<t hangText="Content-ID:">
	  <vspace />
	  The Content-ID: header does not contain non-ASCII characters except in comments.
	  If the header contains UTF-8 characters in comments,
		perform COMMENT downgrading.
	  <vspace blankLines="1" />
	</t>
	<t hangText="Content-Type:" />
	<t hangText="Content-Disposition:">
	  <vspace />
		Perform MIME-VALUE downgrading.
	  <vspace blankLines="1" />
	</t>
	<t hangText="Content-Description:">
	  <vspace />
		Perform UNSTRUCTURED downgrading.
	  <vspace blankLines="1" />
	</t>
	</list>
    </t>
  </section>

	<section title="Security considerations" anchor="security">
	<t>
	<list style="symbols">
	<t>
	A Downgraded message's header fields contain ASCII characters only.
	But they still contain MIME encapsulated header fields which contains
	non-ASCII UTF-8 characters.
	Furthermore, the body part may contain UTF-8 characters.
	Implementations parsing Internet messages need
	 to accept UTF-8 body parts and UTF-8 header fields which are MIME encoded.
	</t>
	<t>
		Rewriting headers increases the opportunities for
		undetected spoofing.
		<vspace blankLines="1" />
	</t>
	<t>
   Addresses that do not appear in the message headers may appear in the
   RCPT commands to an SMTP server for a number of reasons.  Copying
   information from the Envelope into headers risks inadvertent information
   disclosure (see <xref target="RFC2821" /> and 
		<xref target="smtpdowngrading" />).
		<vspace blankLines="1" />
	</t>
	<t>
	The techniques described here invalidates methods that depend
	on digital signatures over the envelope or any part of the message
	which includes the top-level header or body part headers.
	Depending on the specific message being downgraded, DKIM
	especially, but also possibly S/MIME, PGP, and similar
	techniques are all likely to break.
		<vspace blankLines="1" />
	</t>
	<t>
	Many gateways and servers on the Internet will
	discard headers with which they are not familiar.
	To the extent to which the downgrade procedures depend on
	new headers (e.g., "Downgraded-") to avoid information
	loss, the risk of having those headers dropped and
	its implications must be identified.  In particular,
	if the Downgraded headers are dropped,
	there is no possibility of
	reconstructing the original information
	at any point (before, during, or after delivery).
		<vspace blankLines="1" />
	</t>
	</list>
    </t>
    <t>
See "Security considerations" section in <xref target="RFC4952"/> for more discussion.
    </t>
  </section>

  <section title="Implementation notes">
    <section title="Trivial downgrading">
    <t>
Downgrading is an alternative to avoid the rejection of messages
which require UTF8SMTP support by a server which does not provide
this. Implementing the full specification of this document is
desirable, but a partial implementation is also possible.
    </t>
    <t>
If a partial downgrading implementation confronts an unsupported
downgrading target, the implementation MUST NOT send the message
to a server which does not support UTF8SMTP.  Instead, it MUST
reject the message or generate a notification of
non-deliverability.
    </t>
    <t>
	A partial downgrading, Trivial downgrading is discussed.
	It does not support non-ASCII addresses
	   in SMTP envelope and address header fields,
	   unknown header fields downgrading,
	   the MIME body part headers downgrading.
	It supports 
	  <list style="symbols">
	    <t>some simple header fields downgrading: Subject</t>
	    <t>comments and display name downgrading: From, To, Cc</t>
	    <t>trace header field downgrading: Received</t>
	  </list>
	</t>
	<t>
	Otherwise, the downgrading fails.
    </t>
	<t>
	Trivial downgrading targets mail messages which are generated by
	UTF8SMTP aware MUAs and contain
	non-ASCII characters in comments, display names, unstructured parts
	without using non-ASCII E-mail addresses.
	This mail message does not contain non-ASCII E-mail addresses in the SMTP Envelope
	and its header fields. But it is not deliverable via a UTF8SMTP un-aware SMTP server.
	Implementing full specification downgrading may be hard,
	but trivial downgrading saves mail messages without using non-ASCII 
	addresses.
	</t>
    </section>
    <section title="7bit transport consideration">
	<t>
	The SMTP client may encounter a SMTP server which does not support the 8BITMIME SMTP extension <xref target="RFC1652" />.
	The server does not support "8bit" or "binary" data.
	Implementers need to consider converting "8bit" data to "base64" or "quoted-printable" encoded form and adjust the "Content-Transfer-Encoding" header field accordingly.
	If the body contains multiple MIME parts, this conversion must be performed for each MIME part according to <xref target="RFC2045" />.
	</t>
    </section>
  </section>

  <section title="IANA Considerations" anchor="iana">
    <t>
	 IANA is requested to register the following header fields in the
	 Permanent Message Header Field Repository, in accordance with the
	 procedures set out in <xref target="RFC3864" />.
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Mail-From</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Rcpt-To</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-From</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Sender</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-To</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Cc</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Reply-To</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Bcc</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Resent-From</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Resent-To</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Resent-Cc</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Resent-Sender</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Downgraded-Return-Path</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
	<vspace blankLines="1" />
    </t>
    <t>
	Furthermore, IANA is requested to reserve all the field names
	that start with "Downgraded-" for unknown header fields downgrading
	described in <xref target="unknownencapsulation" />,
	in accordance with the procedures set out in <xref target="RFC3864" />.
	<vspace blankLines="1" />
    <list style="hanging">
	<t hangText="Header field name:">Names which starts by "Downgraded-"</t>
	<t hangText="Applicable protocol:">mail</t>
	<t hangText="Status:">experimental</t>
	<t hangText="Author/change controller:">IETF</t>
	<t hangText="Specification document(s):">This document (<xref target="downgradedheader" />)</t>
    </list>
    </t>
  </section>

  <section title="Acknowledgements">
    <t>

	Significant comments and suggestions were received from John
	Klensin, Harald Alvestrand, Chris Newman, Randall Gellens,
	Charles Lindsey,
	Marcos Sanz, Alexey Melnikov, Frank Ellermann, Edward Lewis,
	S. Moonesamy and JET members.

    </t>
  </section>

  <section title="Change History">
    <t>
	This section is used for tracking the update of this document.  Will be
	removed after finalize.
    </t>
    <section title="draft-yoneya-ima-downgrade: Version 00">
	<t>
	<list style="symbols">
	  <t>Initial version</t>
	  <t>Followed draft-yeh-ima-utf8headers-00 and 
	     draft-yao-smtpext-00</t>
	</list>
	</t>
    </section>
    <section title="draft-yoneya-ima-downgrade: Version 01">
	<t>
	<list style="symbols">
	  <t>Document structure was changed</t>
	  <t>Followed draft-yeh-ima-utf8headers-01 and 
	     draft-yao-smtpext-02</t>
	  <t>Downgrading requirements were added</t>
	  <t>SMTP DATA encapsulation method was proposed</t>
	  <t>Downgrading examples was provided</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 00">
	<t>
	<list style="symbols">
	  <t>Followed draft-yeh-ima-utf8headers-01 and 
	     draft-ietf-eai-smtpext-00</t>
	  <t>No header downgrading method was proposed</t>
	  <t>Header encapsulation method was proposed</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 01">
	<t>
	<list style="symbols">
	  <t>Followed draft-ietf-eai-utf8headers-00</t>
	  <t>Header conversion and encapsulation method was merged</t>
	  <t>Header conversion method was defined in detail</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 02">
	<t>
	<list style="symbols">
	  <t>Followed draft-ietf-eai-utf8headers-01 and
	     draft-ietf-eai-smtpext-01</t>
	  <t>Specification about algorithmic generated address is removed</t>
	  <t>No header downgrading method was removed</t>
	  <t>SMTP DATA encapsulation method was removed</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 03">
	<t>
	<list style="symbols">
	  <t>Followed draft-ietf-eai-utf8headers-03 and
	     draft-ietf-eai-smtpext-03</t>
	  <t>Downgraded: and Envelope-Downgraded: headers definition was added</t>
	  <t>Mail header fields downgrading method was refined</t>
	  <t>Examples in Appendix A were refined</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 04">
	<t>
	<list style="symbols">
	  <t>Followed draft-ietf-eai-utf8headers-06,
	     draft-ietf-eai-smtpext-07
	     and draft-ietf-eai-dsn-02</t>
	  <t>Downgrading requirements and conditions were moved to Introduction.</t>
	  <t>Descriptions about upgrading were removed.</t>
	  <t>SPF and DKIM discussion were removed.</t>
	  <t>Added many header fields downgrading.</t>
	  <t>Allow address literal rewriting without alternate ASCII address in header fields.</t>
	  <t>Added MIME body part headers downgrading.</t>
	  <t>Added ORCPT downgrading.</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 05">
	<t>
	<list style="symbols">
	  <t>fixed examples
		<list style="symbols">
		<t>ALT-ADDRESS parameter mistake</t>
		<t>RFC2047(x) notation was changed to encoded-word format</t>
	    </list>
	</t>
	  <t>Added implementation consideration section and trivial downgrading</t>
	  <t>Downgraded: and Envelope-Downgraded: headers are separated for each original headers.</t>
	<t>Removed list-* header fields downgrading</t>
	<t>Changed the way of writing the header field downgrading section</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 06">
	<t>
	<list style="symbols">
        <t>Moved decoding downgraded messages as a separate document</t>
	<t>Added a text to UNSTRUCTURED downgrading</t>
	<t>Added "replacing SMTP connection" if necessary to SMTP downgrading.</t>
	<t>fixed examples</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 07">
	<t>
	<list style="symbols">
    <t>Fixed some typos</t>
	<t>Added a text about 7bit transport</t>
	</list>
	</t>
    </section>
    <section title="draft-ietf-eai-downgrade: Version 08">
	<t>
	<list style="symbols">
    <t>Comments from the working group last call (wording)</t>
	</list>
	</t>
    </section>
  </section>

</middle>

<back>
  <references title="Normative References">
    &rfc4952;
    &I-D.ietf-eai-smtpext;
    &I-D.ietf-eai-utf8headers;
    &I-D.ietf-eai-dsn;
    &rfc1652;
    &rfc2045;
    &rfc2047;
    &rfc2183;
    &rfc2231;
    &rfc2821;
    &rfc2822;
    &rfc3461;
    &rfc3864;
    <!-- &rfc3987; -->
    &rfc4021;
    &rfc2119;
  </references>

  <section title="Examples">
    <section title="Downgrading example 1">
	<t>
	This section shows an SMTP Downgrading example.
	Consider a mail message where:
	<list style="symbols">
	  <t>
	    The sender address is "NON-ASCII-local@example.com" which is a non-ASCII
	    address. Its ASCII alternative is "ASCII-local@example.com" and its display-name is "DISPLAY-local".
	  </t>
	  <t>
	    The "To:" address is "NON-ASCII-remote1@example.net" which is a non-ASCII address. Its
	    ASCII alternative is "ASCII-remote1@example.net" and its display-name is "DISPLAY-remote1".
	  </t>
	  <t>
	    The "Cc:" address is a non-ASCII address "NON-ASCII-remote2@example.org"
		without alternative ASCII address.
		Its display-name is "DISPLAY-remote2".
	  </t>
	  <t>Three display-names contain non-ASCII characters.</t>
	  <t>
	    The Subject header is "NON-ASCII-SUBJECT" which contains non-ASCII
	    characters.
	  </t>
	  <t>Assuming the "To:" recipient's MTA (example.net) does not support UTF8SMTP.</t>
	  <t>assuming the "Cc:" recipient's MTA (example.org) supports UTF8SMTP.</t>
	</list>
	The example SMTP envelope/message is shown in <xref target="example-originaleaismtpsession" />.
	In this example, the "To:" recipient's session is the focus.
	</t>
	<t>
	<figure title="Original envelope/message (example 1)" anchor="example-originaleaismtpsession">
	  <artwork>
<![CDATA[
MAIL FROM: <NON-ASCII-local@example.com>
            ALT-ADDRESS=ASCII-local@example.com
RCPT TO: <NON-ASCII-remote1@example.net>
          ALT-ADDRESS=ASCII-remote1@example.net
RCPT TO: <NON-ASCII-remote2@example.org>
-------------------------------------------------------------
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local <NON-ASCII-local@example.com
 <ASCII-local@example.com>>
To: DISPLAY-remote1 <NON-ASCII-remote1@example.net
 <ASCII-remote1@example.net>>
Cc: DISPLAY-remote2 <NON-ASCII-remote2@example.org>
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
	</t>

	<t>
	In this example, there are two SMTP recipients, one is "To:", the other is "Cc:".
	The SMTP downgrading treats To: session downgrading.
	<xref target="example-smtpdowngrading" /> shows SMTP downgraded example.
	</t>

	<t>
	<figure title="SMTP Downgraded envelope/message (example 1)" anchor="example-smtpdowngrading">
	  <artwork>
<![CDATA[
MAIL FROM: <ASCII-local@example.com>
RCPT TO: <ASCII-remote1@example.net>
-------------------------------------------------------------
Downgraded-Mail-From: =?UTF-8?Q?<NON-ASCII-local@example.com>_?=
 =?UTF-8?Q?<ASCII-local@example.com>?=
Downgraded-Rcpt-To: =?UTF-8?Q?<NON-ASCII-remote1@example.net>_?=
 =?UTF-8?Q?<ASCII-remote1@example.net>?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local <NON-ASCII-local@example.com
 <ASCII-local@example.com>>
To: DISPLAY-remote1 <NON-ASCII-remote1@example.net
 <ASCII-remote1@example.net>>
Cc: DISPLAY-remote2 <NON-ASCII-remote2@example.org>
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
	</t>

	<t>
	After SMTP downgrading, header fields downgrading is performed.
	Final downgraded message is shown in <xref target="example-headerconversiondowngrading" />.
	Return-Path header will be added by the final destination MTA.
	<figure title="Downgraded message (example 1)" anchor="example-headerconversiondowngrading">

	  <artwork>
<![CDATA[
Return-Path: <ASCII-local@example.com>
Downgraded-Mail-From: =?UTF-8?Q?<NON-ASCII-local@example.com>_?=
 =?UTF-8?Q?<ASCII-local@example.com>?=
Downgraded-Rcpt-To: =?UTF-8?Q?<NON-ASCII-remote1@example.net>_?=
 =?UTF-8?Q?<ASCII-remote1@example.net>?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
From: =?UTF-8?Q?DISPLAY-local?= <ASCII-local@example.com>
Downgraded-From: =?UTF-8?Q?DISPLAY-local_<NON-ASCII-local@example.com_?=
 =?UTF-8?Q?<ASCII-local@example.com>>?=
To: =?UTF-8?Q?DISPLAY-remote1?= <ASCII-remote1@example.net>
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?<NON-ASCII-remote1@example.net_<ASCII-remote1@example.net>>?=
Cc: =?UTF-8?Q?DISPLAY-remote2?= Internationalized address
 =?UTF-8?Q?NON-ASCII-remote2@example.org?= removed:;
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?<NON-ASCII-remote2@example.org>?=
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
      </t>
    </section>

    <section title="Downgrading example 2">
      <t>
	In many cases, the sender wants to use non-ASCII address and
	the recipient is a traditional mail user.
	The SMTP server handing mail for the recipient and/or the recipient's MUA does not support UTF8SMTP extension.
	Consider a mail message where:  
	<list style="symbols">
	  <t>
	    The sender address is "NON-ASCII-local@example.com" which is a non-ASCII
	    address. Its ASCII alternative is "ASCII-local@example.com". It has a display-name "DISPLAY-local" which contains non-ASCII characters.
	  </t>
	  <t>
	    The "To:" address is "ASCII-remote1@example.net" which is ASCII only. It has a display-name "DISPLAY-remote1" which contains non-ASCII characters.
	  </t>
	  <t>
	    The "Subject:" header is "NON-ASCII-SUBJECT" which contains non-ASCII
	    characters.
	  </t>
	</list>
	The second example envelope/message is shown in
	<xref target="example-originaleaismtpsession2" />.
      </t>

      <t>
	<figure title="Original message (example 2)" anchor="example-originaleaismtpsession2">
	  <artwork>
<![CDATA[
MAIL From: <NON-ASCII-local@example.com>
            ALT-ADDRESS=ASCII-local@example.com
RCPT TO: <ASCII-remote1@example.net>
-------------------------------------------------------------
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local <NON-ASCII-local@example.com
 <ASCII-local@example.com>>
To: DISPLAY-remote1 <ASCII-remote1@example.net>
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
      </t>

      <t>
	In this example, SMTP session is downgradable.
	<xref target="example-smtpdowngrading2" /> shows SMTP downgraded envelope/message.
      </t>

      <t>
	<figure title="SMTP Downgraded envelope/message (example 2)" anchor="example-smtpdowngrading2">
	  <artwork>
<![CDATA[
MAIL From: <ASCII-local@example.com>
RCPT TO: <ASCII-remote1@example.net>
-------------------------------------------------------------
Downgraded-Mail-From: =?UTF-8?Q?<NON-ASCII-local@example.com>_?=
 ?=UTF8?Q?<ASCII-local@example.com>?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local <NON-ASCII-local@example.com
 <ASCII-local@example.com>>
To: DISPLAY-remote1 <ASCII-remote1@example.net>
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
      </t>

      <t>
	After SMTP downgrading, header fields downgrading is performed.
	The downgraded example is shown in <xref target="example-headerconversiondowngrading2" />.
	<figure title="Downgraded message (example 2)" anchor="example-headerconversiondowngrading2">
	  <artwork>
<![CDATA[
Return-Path: <ASCII-local@example.com>
Downgraded-Mail-From: =?UTF-8?Q?<NON-ASCII-local@example.com>_?=
 =?UTF8?Q?<ASCII-local@example.com>?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
Downgraded-From: =?UTF-8?Q?DISPLAY-local_<NON-ASCII-local@example.com_?=
 =?UTF-8?Q?<ASCII-local@example.com>>?=
From: =?UTF-8?Q?DISPLAY-local?= <ASCII-local@example.com>
To: =?UTF-8?Q?DISPLAY-remote1?= <ASCII-remote1@example.net>
Date: DATE

MAIL_BODY
]]>
	  </artwork>
	</figure>
      </t>
    </section>

  </section>

</back>

</rfc>
