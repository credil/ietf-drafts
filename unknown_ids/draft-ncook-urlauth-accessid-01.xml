<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced. 
     An alternate method (rfc include) is described in the references. -->

<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC5234 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5234.xml">
<!ENTITY RFC5092 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5092.xml">
<!ENTITY I-D.narten-iana-considerations-rfc2434bis SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.narten-iana-considerations-rfc2434bis.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc category="std" docName="draft-ncook-urlauth-accessid-01" ipr="trust200811" updates="5092">

  <front>
    <title abbrev="IMAP URL - Access Identifier Extension">Internet Message Access Protocol (IMAP) - URL Access Identifier Extension</title>

    <author fullname="Neil L Cook" initials="N.L." 
            surname="Cook">
      <organization>Cloudmark</organization>

      <address>
	<email>neil.cook@noware.co.uk</email>

        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <date month="January" year="2009" />

    <area>Applications</area>

    <workgroup>Lemonade</workgroup>

    <keyword>lemonade</keyword>
    <keyword>urlauth</keyword>
    <keyword>access identifier</keyword>
    <keyword>extension</keyword>
    <keyword>IANA</keyword>

     <abstract>
      <t>
	The existing IMAP URL specification (RFC 5092) lists 
	several &lt;access&gt; identifiers and &lt;access&gt; identifier prefixes,
	that can be used to restrict access to URLAUTH-generated
	URLs. However, these identifiers do not provide facilities for
	new services such as streaming. This document proposes a set
	of new &lt;access&gt; identifiers as well as an IANA mechanism to
	register new &lt;access&gt; identifiers for future
	applications. 
      </t>
      <t>
	This document updates RFC 5092.
      </t>
    </abstract>

  </front>

  <middle>
    <section title="Introduction">
      <t>
	The IMAP URL specification  <xref target="RFC5092">
	</xref> provides a way to carry authorization information 
	in IMAP URLs. Several authorization &lt;access&gt; identifiers are
	specified in the document, which allow URLAUTH-authorized URLs
	to be used only by anonymous users, authenticated users, or
	message submission entities. However there is no mechanism
	defined to create new &lt;access&gt; identifiers, and overloading the
	existing mechanisms has security as well as administrative
	implications.
      </t>
      <t>
	This document describes a new &lt;access&gt; identifier "stream", to
	be used by message streaming entities (as described in <xref
	target="STREAMING"></xref>), and defines an IANA
	registration template, which can be used to register new &lt;access&gt;
	identifiers for future applications. IANA definitions for the existing access
	identifiers and prefixes from RFC 5092 are also defined in
	this document - this document updates RFC 5092 and should be
	taken as the master in the event of any differences or discrepancies.
      </t>
    </section>

    <section title="Conventions Used in this Document">
      <t>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
	NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
	"OPTIONAL" in this document are to be interpreted as described in
	<xref target="RFC2119">RFC 2119</xref>.
      </t>

      <t>
	In examples, "C:" and "S:" indicate lines sent by the client and
	server respectively. If a single "C:" or "S:" label applies to multiple
	lines, then some of the line breaks between those lines are for editorial
	clarity only and may not be part of the actual protocol
	exchange.
      </t>
    </section>

    <section anchor="accessid"
             title="Additional Authorized Access Identifiers">
      <section anchor="existing" title="Existing Access Identifiers">
	<t>
	  The IMAP URL specification, <xref target="RFC5092"> IMAPURL
	  </xref>, specifies the following authorized &lt;access&gt;
	  identifiers:
	  <list style="symbols">
	    <t>
	      "authuser" - Indicating that use of this URL is
	      limited to authenticated IMAP sessions that are logged in as any
	      non-anonymous user
	    </t>
	    
	    <t>
	      "anonymous" - Indicating that use of this URL is
	      not restricted by session authorization identity
	    </t>
	  </list> 
	</t>
	<t>
	  Additionally the following &lt;access&gt; identifier prefixes are
	  defined:
	  <list style="symbols">
	    <t>
	      "submit+" - Followed by a userid, indicating that only a
	      userid authorized as a message submission  entity on
	      behalf of the specified  userid is permitted to use this URL
	    </t>
	    
	    <t>
	      "user+" - Followed by a userid, indicating  that use of
	      this URL is limited to IMAP sessions that are  logged in
	      as the specified userid
	    </t>
	  </list> 
	</t>
      </section>

      <section anchor="new" title="Requirement for Additional Access Identifiers">
	<t>
	  The existing &lt;access&gt; identifiers are suitable for
	  user-based authorization, but only the "submit+" &lt;access&gt;
	  identifier prefix is suitable for entities acting on behalf
	  of a user. Generic support for external entities acting on
	  behalf of users is required for new services such as <xref 
	  target="STREAMING">streaming</xref>.
	</t>
	<t>
	  The "submit+" &lt;access&gt; identifier prefix is not
	  suitable for use as a general mechanism to grant access to
	  entities acting on behalf of users, for reasons that
	  include:
	  <list style="symbols">
	    <t>
	      Security - The IMAP server maintains a list of
	      submission server entities that are entitled to retrieve
	      IMAP URLs specifying the "submit+" &lt;ccess&gt; identifier prefix. If
	      this list is extended to include the set of all external
	      entities that could act on behalf of users, then the
	      attack surface would be increased.
	    </t>
	    <t>
	      Administration - When URLAUTH-style IMAP URLs are
	      presented to an IMAP server by entities acting on
	      behalf of users, the server administrator
	      has no way of determining the intended use of that URL
	      from the server logs.
	    </t>
	    <t>
	      Resourcing - Without a mechanism to distinguish
	      between the application for which an IMAP URL is to be
	      used, the IMAP server has no way to prioritize
	      resources for particular applications. For example,
	      the server could prioritize "submit+" URL fetch
	      requests over other access identifiers.
	    </t>
	  </list>
	</t>
      </section>
	 
      <section anchor="spec" title="Additional Access Identifier Specification">	
	<t>
	  The previous section established that additional access identifiers are
	  required to support applications, such as <xref
	  target="STREAMING">streaming</xref>, that require entities
	  to retrieve URLAUTH URLs on behalf of users. This section
	  describes the scope and meaning of any additional &lt;access&gt;
	  identifiers that are created.
	</t>
	<t>
	  Additional &lt;access&gt; identifiers MUST take one of two forms
	  (<xref target="abnf"></xref> gives the formal ABNF syntax):
	  <list style="symbols">
	    <t>
	      &lt;access&gt; identifier - The name of the application e.g. "stream"
	    </t>
	    <t>
	      &lt;access&gt; identifier prefix - The name of the application
	      e.g. "stream" followed by a "+" and then a userid. For example
	      "stream+testuser". 
	    </t>
	  </list>
	  In both cases, the semantics are the same as those for
	  "submit+", i.e. the  &lt;access&gt; identifier or
	  &lt;access&gt; identifier prefix
	  (which MUST be followed by a userid),  indicates that only
	  a userid authorized as an application entity for the
	  specified application is permitted to use this
	  URL.  In the case of &lt;access&gt; identifier prefixes, the
	  IMAP server SHALL NOT validate the specified 
	  userid but MUST validate that the IMAP session has an
	  authorization identity that is authorized as an application
	  entity for the specified application. The application entity
	  itself MAY choose to perform validation on any specified
	  userid before attempting to retrieve the URL.
	</t>
	<t>
	  The authorization granted by any &lt;access&gt; identifiers
	  used as described above is self-describing, and so requires
	  the IMAP server to provide an extensible mechanism for
	  associating userids with new applications. For example,
	  imagine a new application "foo" is created, which requires
	  application entities to retrieve URLs on behalf of users. In
	  this case, the IMAP server would need to provide a way to
	  register a new application "foo", and to associate the set
	  of userids to be used by those entities with the application
	  "foo". Any attempt to retrieve URLs containing the
	  &lt;access&gt; identifier "foo" would be checked for
	  authorization against the list of userids associated with
	  the application "foo". 
	</t>
	<t>
	  <xref target="IANA"></xref> provides the template required
	  to register new &lt;access&gt; identifiers or prefixes with IANA.
	</t>
      </section>

      <section anchor="stream" title="Defining an access identifier
	for Streaming">
	<t>
	  One application that makes use of URLAUTH-authorized URLs is
	  that of streaming multimedia files received as
	  internet messaging attachments. This application is
	  described in <xref target="STREAMING"></xref>.
	</t>
	<t>
	  See <xref target="iana_stream"></xref> for the IANA
	  registration template for the "stream" &lt;access&gt; identifier.
	</t>
      </section>
    </section>

    <section anchor="abnf" title="Formal Syntax">
	  <t>
	    The following syntax specification uses the Augmented
	    Backus-Naur Form (ABNF) notation as specified in
	      <xref target="RFC5234"></xref>. 
	  </t>
	  <t>
	    Except as noted otherwise, all alphabetic characters are
	    case-insensitive.  The use of upper or lower case
	    characters to define token strings is for editorial
	    clarity only.  Implementations MUST accept these strings
	    in a case-insensitive fashion. 
	  </t>
	  
	  <t>
	    The ABNF specified below updates the formal syntax
	    of &lt;access&gt; identifier as defined in <xref target="RFC5092">IMAP
	    URL</xref>.
	  </t>
      <figure>
	<artwork type="abnf"><![CDATA[
	application = 1*(ALPHA/DIGIT)
	
	access      =/ application / (application "+" enc-user)
		      ]]></artwork>
      </figure>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>
	This document was inspired by discussions in the Lemonade
	Working Group.
      </t>

    </section>

    <!-- Possibly a 'Contributors' section ... -->

    <section anchor="IANA" title="IANA Considerations">
      <t>
	Access identifiers and prefixes MUST be specified in a
	standards track or IESG approved experimental RFC. This
	section gives the IAN registration entries for the existing
	access identifiers and prefixes from RFC 5092 as well as the
	entry for the "stream" application.
      </t>
      
      <section anchor="template" title="Access Identifier Registration Template">
	<figure>
	  <artwork><![CDATA[
	To: iana@iana.org
	Subject: IMAP URL Access Identifier Registration

	Type:          [Either "<access> identifier" or 
                        "<access> identifier prefix"]
	
	Application:   [Name of the application, e.g. "stream"]
	
	Description:   [A description of the application and its use 
                        of IMAP URLs] 

	RFC Number:    [Number of the RFC that the application was
                        defined in ]
 
	Contact:       [email and/or physical address to contact for
	                additional information]
	]]></artwork>
	</figure>
      </section>

      <section anchor="iana_stream" title="Stream Application
					   Registration">
	<figure>
	  <preamble>
	  </preamble> 
	  <artwork><![CDATA[
	  To: iana@iana.org
	  Subject: IMAP URL Access Identifier Registration
	  
	  Type:          <access> identifier
	  
	  Application:   stream
	  
	  Description:   Used by SIP Media Servers to retrieve 
                         attachments for streaming to email 
                         clients
	  
	  RFC Number:    This RFC
	  
	  Contact:       Neil Cook mailto:neil.cook@noware.co.uk
	  ]]></artwork>
	</figure>
      </section>

      <section anchor="iana_submit+" title="Submit Application
					   Registration">
	<figure>
	  <preamble>
	  </preamble> 
	  <artwork><![CDATA[
	  To: iana@iana.org
	  Subject: IMAP URL Access Identifier Registration
	  
	  Type:          <access> identifier prefix
	  
	  Application:   submit
	  
	  Description:   Used by message submission entities to
                         retrieve attachments to be included in
			 submitted messages
	  
	  RFC Number:    This RFC
	  
	  Contact:       Neil Cook mailto:neil.cook@noware.co.uk
	  ]]></artwork>
	</figure>
      </section>

      <section anchor="iana_user+" title="User Application
					   Registration">
	<figure>
	  <preamble>
	  </preamble> 
	  <artwork><![CDATA[
	  To: iana@iana.org
	  Subject: IMAP URL Access Identifier Registration
	  
	  Type:          <access> identifier prefix
	  
	  Application:   user
	  
	  Description:   Used to restrict access to to IMAP sessions
	                 that are logged in as the specified userid
	  
	  RFC Number:    This RFC
	  
	  Contact:       Neil Cook mailto:neil.cook@noware.co.uk
	  ]]></artwork>
	</figure>
      </section>
      
      <section anchor="iana_authuser" title="Authuser Application
					   Registration">
	<figure>
	  <preamble>
	  </preamble> 
	  <artwork><![CDATA[
	  To: iana@iana.org
	  Subject: IMAP URL Access Identifier Registration
	  
	  Type:          <access> identifier
	  
	  Application:   authuser
	  
	  Description:   Used to restrict access to to IMAP sessions
	                 that are logged in as any non-anonymous
                         user of that IMAP server
	  
	  RFC Number:    This RFC
	  
	  Contact:       Neil Cook mailto:neil.cook@noware.co.uk
	  ]]></artwork>
	</figure>
      </section>

      <section anchor="iana_anonymous" title="Anonymous Application
					   Registration">
	<figure>
	  <preamble>
	  </preamble> 
	  <artwork><![CDATA[
	  To: iana@iana.org
	  Subject: IMAP URL Access Identifier Registration
	  
	  Type:          <access> identifier
	  
	  Application:   anonymous
	  
	  Description:   Indicates that use of this URL is
                         not restricted by session authorization
			 identity
	  
	  RFC Number:    This RFC
	  
	  Contact:       Neil Cook mailto:neil.cook@noware.co.uk
	  ]]></artwork>
	</figure>
      </section>


    </section>

    <section anchor="Security" title="Security Considerations">
      <t>
	The extension to &lt;access&gt; identifiers specified in this document
	provides a mechanism for extending the semantics of the
	"submit+" &lt;access&gt; prefix to arbitrary applications. The
	use of such additional &lt;access&gt; identifiers and prefixes is
	primarily for security purposes, i.e. to prevent the
	overloading of "submit+" as a generic mechanism to allow
	entities to retrieve IMAP URLs on behalf of userids. Other
	than this,
	the security implications are identical to those discussed in
	Section 10.1 of <xref target="RFC5092">IMAPURL</xref>.
      </t>
    </section>

  </middle>

  <!--  *****BACK MATTER ***** -->

  <back>
    <!-- References split into informative and normative -->

    <!-- There are 2 ways to insert reference entries from the citation libraries:
     1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
     2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
        (for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

     Both are cited textually in the same manner: by using xref elements.
     If you use the PI option, xml2rfc will, by default, try to find included files in the same
     directory as the including file. You can also define the XML_LIBRARY environment variable
     with a value containing a set of directories to search.  These can be either in the local
     filing system or remote ones accessed by http (http://domain/dir/... ).-->

    <references title="Normative References">
       &RFC2119;
       &RFC5234;
       &RFC5092;
     </references>

    <references title="Informative References">
      <!-- Here we use entities that we defined at the beginning. -->

       <reference anchor="STREAMING">
        <front>
          <title>Streaming Internet Messaging Attachments</title>
          
          <author initials="N." surname="Cook">
            <organization></organization>
          </author>
          
          <date month="Dec" year="2008" />
        
	</front>
	<seriesInfo name="draft-ietf-lemonade-streaming-08.txt (Work
			  in Progress)" value="" />

      </reference>

     </references>
  </back>
</rfc>
