Internet Working Group                                       Y. Jiang
                                                              L. Yong
Internet Draft                                                  Huawei
                                                              M. Paul
                                                      Deutsche Telekom
Intended status: Standards Track                            F. Jounay
                                                 France Telecom Orange
Expires: January 2012                                    July 11, 2011



                      VPLS PE Model for E-Tree Support
                   draft-jiang-l2vpn-vpls-pe-etree-04.txt


Status of this Memo

   This Internet-Draft is submitted to IETF in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html

   This Internet-Draft will expire on January 11, 2012.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors. All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.



Jiang, et al          Expires January 11, 2012                [Page 1]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


Abstract

   A generic VPLS solution for E-Tree services is proposed which uses
   VLANs to indicate root/leaf traffic. A VPLS Provider Edge (PE) model
   is illustrated as an example for the solution. In the solution, E-
   Tree VPLS PEs are interconnected by tagged PWs, the MAC address based
   Ethernet forwarding engine and the PW works in the same way as before.
   A signaling mechanism for E-Tree capability and VLAN mapping
   negotiation is further described.

Table of Contents

   1.   Introduction .............................................. 2
   2.   Conventions used in this document ......................... 4
   3.   Terminology ............................................... 4
   4.   PE Model with E-Tree Support .............................. 4
      4.1. Existing PE Models ..................................... 5
      4.2. A New PE Model with E-Tree Support ..................... 8
   5.   PW for E-Tree Support ..................................... 9
      5.1. PW Encapsulation ....................................... 9
      5.2. VLAN Mapping ........................................... 9
      5.3. PW Processing ......................................... 10
         5.3.1.  PW Processing in the VLAN Mapping Mode .......... 10
         5.3.2.  PW Processing in the Compatible Mode ............ 11
         5.3.3.  PW Processing in the Optimized Mode ............. 12
   6.   LDP Extensions for E-Tree Support ........................ 13
   7.   BGP Extensions for E-Tree Support ........................ 15
   8.   Applicability ............................................ 15
   9.   Security Considerations .................................. 15
   10.  IANA Considerations ...................................... 15
   11.  References ............................................... 16
      11.1.   Normative References ............................... 16
      11.2.   Informative References ............................. 16
   12.  Acknowledgments .......................................... 17
   Appendix A. Other PE Models for E-Tree ........................ 18
      A.1. PE Model With a VSI and No bridge ..................... 18



1. Introduction

   The E-Tree service is defined in Metro Ethernet Forum (MEF) as a
   Rooted-Multipoint EVC service. It is a multipoint Ethernet service
   with special restrictions: the frames from a root may be received by
   any other root or leaf, and the frames from a leaf may be received by
   any root, but MUST not be received by a leaf. Further, an E-Tree
   service may include multiple roots and multiple leaves. Although VPMS


Jiang, et al          Expires January 11, 2012                [Page 2]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   or P2MP multicast is a somewhat simplified version of this service,
   in fact, there is no exact corresponding terminology in IETF.

   [Etree-req] gives the requirements for providing E-Tree solutions in
   the VPLS and the need to filter leaf to leaf traffic.

   [vpls-etree] describes a PW control word based E-Tree solution, where
   a bit in the PW control word is used to indicate the root/leaf
   attribute for a packet. The Ethernet forwarder in the VPLS is also
   extended to filter the leaf-leaf traffic based on the <ingress port,
   egress port, CW L-bit> tuple.

   [Etree-2PW] proposes another E-Tree solution where root and leaf
   traffic are classified and forwarded in the same VSI but with two
   separate PWs.

   Both solutions are only applicable to "VPLS only" networks.

   In fact, VPLS PE usually consists of a bridge module itself (see
   [RFC4664] and [RFC6246]), moreover, E-Tree services may cross both
   Ethernet and VPLS domains. Therefore, it is necessary to develop an
   E-Tree solution both for "VPLS only" scenarios and for interworking
   between Ethernet and VPLS.

   IEEE 802.1 has incorporated the generic E-Tree solution in the latest
   version of 802.1Q [802.1aq], which is just an improvement on the
   traditional asymmetric VLAN mechanism. In the solution, VLANs are
   used to indicate root/leaf attribute of a packet: one VLAN ID is used
   to indicate the frames originated from the roots and another VLAN ID
   is used to indicate the frames originated from the leaves. At a leaf
   port, the bridge can then filter out all the frames from other leaf
   ports based on the VLAN ID. It is better to reuse the same mechanism
   in VPLS than to develop a new mechanism. The latter will introduce
   more complexity to interwork with IEEE 802.1Q solution.

   This document introduces how the Ethernet VLAN solution can be used
   to support generic E-Tree services in the VPLS. The solution proposed
   here is fully compatible with the IEEE bridge architecture and the
   IETF PWE3 technology, and VPLS scalability and simplicity is also
   well kept. With this mechanism, it is also convenient to deploy a
   converged E-Tree service across both Ethernet and MPLS networks.

   Firstly, a typical VPLS PE model is introduced as an example, the
   model is extended in which a Tree VSI is connected to a VLAN bridge
   with a dual-VLAN interface.




Jiang, et al          Expires January 11, 2012                [Page 3]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   This document then discusses the PW encapsulation and PW processing
   such as VLAN mapping options for transporting E-Tree services in a
   VPLS.

   Finally, it describes the signaling extensions for E-Tree support and
   PE processing procedures.



2. Conventions used in this document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].



3. Terminology

   E-Tree: a Rooted-Multipoint EVC service according to the definition
   in MEF

   EVC: Ethernet Virtual Connection, as defined in MEF 4.0

   T-VSI: Tree VSI, a VSI with E-Tree support

   Root AC, an AC attached with a root

   Leaf AC, an AC attached with a leaf

   Root VLAN, a VLAN ID used to indicate all the frames that are
   originated at a root AC

   Leaf VLAN, a VLAN ID used to indicate all the frames that are
   originated at a leaf AC



4. PE Model with E-Tree Support

   "VPLS only" PE architecture as outlined in Fig. 1 of [Etree-req] is a
   simplification of the VPLS and PWE3 architecture, several common VPLS
   PE architectures are discussed in more details in [RFC4664] and
   [RFC6246].





Jiang, et al          Expires January 11, 2012                [Page 4]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   Therefore, VLAN based E-Tree solution are demonstrated with the help
   of a typical VPLS PE model. Other PE models are further discussed in
   Appendix A.

4.1. Existing PE Models

   According to [RFC4664], there are at least three models possible for
   a VPLS PE, including:

   o A single bridge module, a single VSI;

   o A single bridge module, multiple VSIs;

   o Multiple bridge modules, each attaches to a VSI.

   The second PE model is commonly used. A typical example is further
   depicted in Fig. 1 and Fig. 2 [RFC6246], where an S-VLAN bridge
   module is connected to multiple VSIs each with a single VLAN virtual
   interface.

                      +-------------------------------+
                      |  802.1ad Bridge Module Model  |
                      |                               |
           +---+      |  +------+      +-----------+  |
           |CE |---------|C-VLAN|------|           |  |
           +---+      |  |bridge|------|           |  |
                      |  +------+      |           |  |
                      |     o          |   S-VLAN  |  |
                      |     o          |           |  |
                      |     o          |   Bridge  |  |
           +---+      |  +------+      |           |  |
           |CE |---------|C-VLAN|------|           |  |
           +---+      |  |bridge|------|           |  |
                      |  +------+      +-----------+  |
                      +-------------------------------+

                Figure 1  The Model of 802.1ad Bridge Module











Jiang, et al          Expires January 11, 2012                [Page 5]

Internet-Draft        VPLS PE Model for E-Tree               July 2011



           +----------------------------------------+
           |           VPLS-capable PE model        |
           |   +---------------+          +------+  |
           |   |               |          |VSI-1 |------------
           |   |               |==========|      |------------ PWs
           |   |     Bridge    ------------      |------------
           |   |               | S-VLAN-1 +------+  |
           |   |     Module    |             o      |
           |   |               |             o      |
           |   |   (802.1ad    |             o      |
           |   |    bridge)    |             o      |
           |   |               |             o      |
           |   |               | S-VLAN-n +------+  |
           |   |               ------------VSI-n |-------------
           |   |               |==========|      |------------- PWs
           |   |               |     ^    |      |-------------
           |   +---------------+     |    +------+  |
           |                         |              |
           +-------------------------|--------------+
                            LAN emulation Interface

                      Figure 2  VPLS-capable PE Model

   In this PE model, Ethernet frames from Customer Edges (CEs) will
   cross multiple stages of bridge modules (i.e., C-VLAN and S-VLAN
   bridge) and a VSI in a PE before being sent on the PW to a remote PE.
   Therefore, the association between an AC port and a PW on a VSI as
   required in [vpls-etree] or [Etree-2PW] is difficult, sometimes even
   impossible.

   This model could be further enhanced: When Ethernet frames arrive at
   a PE, a root VLAN or a leaf VLAN tag is added. Then the frames with
   the root VLAN tag are transmitted both on the roots and the leaves,
   while the frames with the leaf VLAN tag are transmitted on the roots
   but dropped on the leaves (these VLAN tags are removed before the
   frames are transmitted over the wire). It was demonstrated in
   [802.1aq] that the E-Tree service in Ethernet networks can be well
   supported with this mechanism.

   Assuming this mechanism is implemented in the bridge module, it is
   quite straightforward to infer a VPLS PE model with two VSIs to
   support the E-Tree (as shown in Fig. 3). But this model will require
   two VSIs per PE and two sets of PWs per E-Tree service, which is
   poorly scalable in a large MPLS/VPLS network; in addition, both these
   VSIs have to share their learned MAC addresses.



Jiang, et al          Expires January 11, 2012                [Page 6]

Internet-Draft        VPLS PE Model for E-Tree               July 2011




           +----------------------------------------+
           |           VPLS-capable PE model        |
           |   +---------------+          +------+  |
           |   |               |          |VSI-1 |------------
           |   |               |==========|      |------------ PWs
           |   |     Bridge    ------------      |------------
           |   |               | Root     +------+  |
           |   |     Module    | S-VLAN             |
           |   |               |                    |
           |   |   (802.1ad    |                    |
           |   |    bridge)    |                    |
           |   |               | Leaf               |
           |   |               | S-VLAN   +------+  |
           |   |               ------------VSI-2 |-------------
           |   |               |==========|      |------------- PWs
           |   |               |     ^    |      |-------------
           |   +---------------+     |    +------+  |
           |                         |              |
           +-------------------------|--------------+
                            LAN emulation Interface

               Figure 3  VPLS PE Model for E-Tree with 2 VSIs
























Jiang, et al          Expires January 11, 2012                [Page 7]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


4.2. A New PE Model with E-Tree Support

   In order to support the E-Tree in a more scalable way, a new VPLS PE
   model with a single Tree VSI (T-VSI, a VSI with E-Tree support) is
   proposed. As depicted in Fig. 4, the bridge module is connected to
   the T-VSI with a dual-VLAN virtual interface, i.e., both the root
   VLAN and the leaf VLAN are connected to the same T-VSI, and they
   share the same FIB and work in shared VLAN learning. In this way,
   only one VPLS instance and one set of PWs is needed per E-Tree
   service, and the scalability of VPLS is improved.

           +----------------------------------------+
           |           VPLS-capable PE model        |
           |   +---------------+          +------+  |
           |   |               |==========|TVSI-1|------------
   +---+AC |   |               ------------      |------------ PWs
   |CE |-------|     Bridge    ------------      |------------
   +---+   |   |               | Root &   +------+  |
           |   |     Module    | Leaf VLAN   o      |
           |   |               |             o      |
           |   |               |             o      |
           |   |               |             o      |
           |   |               |             o      |
   +---+AC |   |               |   VLAN-n +------+  |
   |CE |-------|               ------------VSI-n |-------------
   +---+   |   |               |==========|      |------------- PWs
           |   |               |     ^    |      |-------------
           |   +---------------+     |    +------+  |
           |                         |              |
           +-------------------------|--------------+
                            LAN emulation Interface

           Figure 4  VPLS PE Model for E-Tree with a Single T-VSI

   For an untagged port (customer sites attached to the PEs with
   untagged ports), the Ethernet frames received from the root ACs can
   be firstly tagged with a root C-VLAN, and then added with another
   root S-VLAN. Optionally, the frames from the root ACs can be tagged
   with the root S-VLAN tag directly in the VPLS network domain.

   For a C-VLAN tagged port, the Ethernet frames received from the root
   ACs can be added with a root S-VLAN, or the C-VLAN can be translated
   to the root S-VLAN in the VPLS network domain.

   For an S-VLAN tagged port, the S-VLAN tag in the Ethernet frames
   received from the root ACs can be translated to the root S-VLAN in
   the VPLS network domain.


Jiang, et al          Expires January 11, 2012                [Page 8]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   In a similar way, the traffic from the leaf ACs is tagged and
   transported on the leaf S-VLAN.

   This document will use the VLAN in its more general meaning in the
   latter sections.



5. PW for E-Tree Support

5.1. PW Encapsulation

   For a VPLS instance to support an E-Tree service, its Ethernet PW
   should work in the tagged mode (PW type 0x0004) as described in
   [RFC4448], and a VLAN tag must be carried in each frame in the PW to
   indicate the E-Tree root/leaf attribute.

   Raw PW may also be used to carry E-Tree service, as the VLAN
   indicating the E-Tree root/leaf attribute can be translated by the
   bridge module or by another Ethernet edge device.

   A pair of T-VSIs in a VPLS is interconnected with a bidirectional PW.
   The VLAN indicating root/leaf attribute of the frame is carried in
   the PW, and the peer PE must drop all the frames with a leaf VLAN on
   each egress port associated with a leaf.

5.2. VLAN Mapping

   There are two ways of manipulating VLANs for an E-Tree in VPLS:

   o Global VLAN based that is, provisioning two global VLANs (Root
      VLAN, Leaf VLAN) across the VPLS network, thus no VLAN mapping is
      needed at all, or the VLAN mapping is done completely in the
      Ethernet domains.

   o Local VLAN based, that is, provisioning two local VLANs for each
      PE (which participates in the E-Tree) in the VPLS network
      independently.

   The first method requires no VLAN mapping in the PW, but two unique
   VLANs must be allocated in the VPLS (they may be provisioned by
   management or signaled by some control protocols), and the PW
   processing procedure as described in [RFC4448] applies.






Jiang, et al          Expires January 11, 2012                [Page 9]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   The second method is more scalable in the use of VLANs, but needs a
   VLAN mapping mechanism in the PW similar to what is already described
   in Section 4.3 of [RFC4448]. It is assumed that for each PE with E-
   Tree capability there is a VLAN mapping module that can be enabled
   when VLAN mapping is needed for a PW. Actual VLAN mapping mode can be
   provisioned or determined by a signaling protocol as described in
   Section 6 when PW is being established.

5.3. PW Processing

5.3.1.PW Processing in the VLAN Mapping Mode

   In the VLAN Mapping mode, two VPLS PEs with E-Tree capability are
   inter-connected with a PW (For example, the scenario of Fig. 5
   depicts the interconnection of two PEs miscellaneously attached with
   roots and leaves).

                  +------------------------+
                  |  VPLS PE with T-VSI    |
                  |                        |
        +----+    | +------+       +-----+ |  PW
        |Root|------| VLAN |-------|T-VSI|----------
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Leaf|------|      |       |     |---------+
        +----+    | +------+       +-----+ |       |
                  |                        |       |
                  +------------------------+       |
                                                   |
                  +------------------------+       |
                  |  VPLS PE with T-VSI    |       |
                  |                        |       |
        +----+    | +------+       +-----+ |  PW   |
        |Root|------| VLAN |-------|T-VSI|---------+
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Leaf|------|      |       |     |----------
        +----+    | +------+       +-----+ |
                  |                        |
                  +------------------------+

              Figure 5 T-VSI Interconnected in the Normal Mode

   If a PE is in the VLAN mapping mode for a PW, then in the data plane
   the PE MUST map the VLAN in each frame as follows:




Jiang, et al          Expires January 11, 2012               [Page 10]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


    o Upon transmitting frames on the PW, map from local VLAN to remote
    VLAN (i.e., the local leaf VLAN in a frame is translated to the
    remote leaf VLAN; the local root VLAN in a frame is translated to the
    remote root VLAN).

    o Upon receiving frames on the PW, map from remote VLAN to local VLAN,
    and the frames are further forwarded or dropped in the egress bridge
    module using the filtering mechanism as described in [802.1aq].

5.3.2.PW Processing in the Compatible Mode

   The new VPLS PE model can work in a traditional VPLS network
   seamlessly in the compatibility mode. As shown in Fig. 6, the VPLS PE
   with T-VSI can be attached with root and/or leaf nodes, while the
   VPLS PE with a traditional VSI can only be attached with root nodes.


                  +------------------------+
                  |  VPLS PE with T-VSI    |
                  |                        |
        +----+    | +------+       +-----+ |  PW
        |Root|------| VLAN |-------|T-VSI|----------
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Leaf|------|      |       |     |---------+
        +----+    | +------+       +-----+ |       |
                  |                        |       |
                  +------------------------+       |
                                                   |
                  +------------------------+       |
                  |  VPLS PE with VSI      |       |
                  |                        |       |
        +----+    | +------+       +-----+ |  PW   |
        |Root|------| VLAN |-------|VSI  |---------+
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Root|------|      |       |     |----------
        +----+    | +------+       +-----+ |
                  |                        |
                  +------------------------+

             Figure 6 T-VSI interconnected with Traditional VSI

   If a PE is in the Compatible mode for a PW, then in the data plane
   the PE MUST map the VLAN in each frame as follows:




Jiang, et al          Expires January 11, 2012               [Page 11]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


    o Upon transmitting frames on the PW, map both local root and local
    leaf VLAN to the remote VLAN.

    o Upon receiving frames on the PW, map the remote VLAN to the local
    root VLAN.

5.3.3.PW Processing in the Optimized Mode

   When two PEs are connected with their T-VSIs and one PE (e.g., PE2)
   is attached with only leaves, as shown in the scenario of Fig. 6, the
   peer PE (e.g., PE1) should then work in the optimization mode. In
   this case, PE1 should not send the frames originated from the local
   leaf VLAN to PE2, i.e., these frames are dropped rather than
   transported over the PW. The bandwidth efficiency of the VPLS can
   thus be improved. The signaling for the PE attached with only leaves
   is specified in Section 6.
                  +------------------------+
                  |VPLS PE with T-VSI (PE1)|
                  |                        |
        +----+    | +------+       +-----+ |  PW
        |Root|------| VLAN |-------|T-VSI|----------
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Leaf|------|      |       |     |---------+
        +----+    | +------+       +-----+ |       |
                  |                        |       |
                  +------------------------+       |
                                                   |
                  +------------------------+       |
                  |VPLS PE with T-VSI (PE2)|       |
                  |                        |       |
        +----+    | +------+       +-----+ |  PW   |
        |Leaf|------| VLAN |-------|T-VSI|---------+
        +----+    | | BRG  |       |     |----------
        +----+    | |      |-------|     |----------
        |Leaf|------|      |       |     |----------
        +----+    | +------+       +-----+ |
                  |                        |
                  +------------------------+

    Figure 7 T-VSI interconnected with one side attached with only leaves

   If a PE is in the Optimized Mode for a PW, then in the data plane,
   before proceeding as listed in Section 5.3.1 upon transmit, the PE
   SHOULD first operate as follows:

   o Drop a frame if its VLAN ID matches the local leaf VLAN ID.


Jiang, et al          Expires January 11, 2012               [Page 12]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


6. LDP Extensions for E-Tree Support

   In addition to the signaling procedures as specified in [RFC4447],
   this document proposes a new interface parameter sub-TLV to provision
   an E-Tree service and negotiate the VLAN mapping function, as follows:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  E-Tree       |   Length=8    |           Reserved        |P|V|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |          Root VLAN ID         |          Leaf VLAN ID         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                          Figure 8  E-Tree Sub-TLV

   Where:

   o E-Tree is the sub-TLV identifier to be assigned by IANA.

   o Length is the length of the sub TLV in octets.

   o Reserved bits MUST be set to zero on transmit and be ignored on
      receive.

   o P is a Leaf-only bit, it is set to 1 to indicate that the PE is
      attached with only leaves, and set to 0 otherwise.

   o V is a bit indicating the sender's VLAN mapping capability. A PE
      capable of VLAN mapping MUST set this bit, and clear it otherwise.

   o Root VLAN ID is the value of the local root VLAN.

   o Leaf VLAN ID is the value of the local leaf VLAN.

   When setting up a PW for the E-Tree based VPLS, two PEs negotiate the
   E-Tree support using the above E-Tree sub-TLV. Note PW type of 0x0004
   should be used during the PW negotiation.

   A PE that wishes to support E-Tree service MUST include an E-Tree
   Sub-TLV in its PW label mapping message and include its local root
   VLAN ID and leaf VLAN ID in the TLV.  A PE that has the VLAN mapping
   capability MUST set the V bit to 1, and a PE is attached with only
   leaves SHOULD set the P bit to 1.






Jiang, et al          Expires January 11, 2012               [Page 13]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   In default, for each PW, VLAN-Mapping-Mode, Compatible-Mode, and
   Optimized-Mode are all set to FALSE.

   A PE that receives a PW label mapping message with an E-Tree Sub-TLV
   from its peer PE must process it as follows:

   1) if the root and leaf VLAN ID in the message match the local root
      and leaf VLAN ID, then continue to 3);

   2) else {

          if the bit V is cleared, then {

                if the PE is capable of VLAN mapping, then it MUST set
                VLAN-Mapping-Mode to TRUE;

                else {

                     A label release message with the error code "E-Tree
                     VLAN mapping not supported" is sent to the peer PE
                     and exit the process;

                     }

          }

          if the bit V is set, and the PE is capable of VLAN mapping,
          then the PE with the minimum IP address MUST set VLAN-Mapping-
          Mode to TRUE;

      }

   3) If the P bit is set, then:

      {

          If the PE is a leaf-only node itself, then a label release
      message with the error code "Leaf to Leaf PW error" is sent to the
      peer PE and exit the process;

          Else the PE SHOULD set the Optimized-Mode to TRUE.

      }

   If a PE has sent an E-Tree Sub-TLV but does not receive any E-Tree
   Sub-TLV in its peer's PW label mapping message, then set Compatible-



Jiang, et al          Expires January 11, 2012               [Page 14]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   Mode to TRUE if the PE is VLAN mapping capable, otherwise a label
   release message is sent and an error is logged.

   Data plane processing for this PW is as following:

   If Optimized-Mode is TRUE, then data plane processing is as described
   in Section 5.3.3.

   Else if Compatible-Mode is TRUE, then data plane processing is as
   described in Section 5.3.2.

   Else if VLAN-Mapping-Mode is TRUE, then data plane processing is as
   described in Section 5.3.1.

   PW processing as described in [RFC4448] proceeds as usual.

7. BGP Extensions for E-Tree Support

   BGP may also be used to distribute the E-Tree and VLAN mapping
   information. It is to be specified in the next version.

8. Applicability

   The solution is applicable to LDP VPLS [RFC4762] and may also be
   applicable to BGP VPLS [RFC4761].

   The solution is applicable to both "VPLS Only" network and VPLS with
   Ethernet aggregation network.

9. Security Considerations

   To be added in the future version.

10.  IANA Considerations

   IANA is requested to allocate a value for E-Tree in the Pseudowire
   Interface Parameters Sub-TLV type registry.

   Parameter ID   Length       Description
   =======================================
   TBD            8            E-Tree


   IANA is requested to allocate a new LDP status code from the registry
   of name "STATUS CODE NAME SPACE". The following value is suggested:




Jiang, et al          Expires January 11, 2012               [Page 15]

Internet-Draft        VPLS PE Model for E-Tree               July 2011



   Range/Value     E     Description
   ------------- -----   ----------------------
   TBD             0     E-Tree VLAN mapping not supported


11.  References

11.1.  Normative References

   [RFC2119] Bradner, S., "Key words for use in RFCs to Indicate
             Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC4447] Martini, L., and et al, "Pseudowire Setup and Maintenance
             Using Label Distribution Protocol (LDP)", RFC 4447, April
             2006.

   [RFC4448] Martini, L., and et al, "Encapsulation Methods for
             Transport of Ethernet over MPLS Networks", RFC 4448, April
             2006.

   [RFC4762] Lasserre, M. and Kompella, V., "Virtual Private LAN
             Services using LDP", RFC 4762, January 2007.

11.2. Informative References

   [RFC3985] Bryant, S., and Pate, P., "Pseudo Wire Emulation Edge-to-
             Edge (PWE3) Architecture", RFC 3985, March 2005.

   [RFC4664] Andersson, L., and Rosen, E., "Framework for Layer 2
             Virtual Private Networks (L2VPNs)", RFC 4664, September
             2006.

   [RFC6246] Sajassi, A., and et al, "Virtual Private LAN Service (VPLS)
             Interoperability with Customer Edge (CE) Bridges", RFC 6246,
             June 2011

   [ETree-req] Key, R., et al, "Requirements for MEF E-Tree Support in
             VPLS", draft-key-l2vpn-vpls-etree-reqt-02, October 2010

   [vpls-etree] Key, R., and et al, "Extension to VPLS for E-Tree",
             draft-key-l2vpn-vpls-etree-04, October 2010

   [802.1aq] IEEE 802.1aq D3.6, Virtual Bridged Local Area Networks -
             Amendment 9: Shortest Path Bridging, February 2011




Jiang, et al          Expires January 11, 2012               [Page 16]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   [Etree-2PW] Ram, R., and et al., Extension to LDP-VPLS for E-Tree
             Using Two PW, draft-ram-l2vpn-ldp-vpls-etree-2pw-00.txt,
             October 2010

12.  Acknowledgments

   The authors would like to thank Adrian Farrel and Susan Hares for
   their valuable comments and advices.








































Jiang, et al          Expires January 11, 2012               [Page 17]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


Appendix A. Other PE Models for E-Tree

A.1. PE Model With a VSI and No bridge

   If there is no bridge module in a PE, the PE may consist of Native
   Service Processors (NSPs) as shown in Figure A.1 (adapted from Fig. 5
   of [RFC3985]) where  any transformation operation for VLANs (e.g.,
   VLAN insertion/removal or VLAN mapping) may be applied. Thus a root
   VLAN or leaf VLAN can be added by the NSP depending on the UNI type
   (root/leaf) associated with the AC over which the packet arrives.

   Further, when a packet with a leaf VLAN exits a forwarder and arrives
   at the NSP, the NSP must drop the packet if the egress AC is
   associated with a leaf UNI.

   Tagged PW and VLAN mapping work in the same way as in the typical PE
   model.

           +----------------------------------------+
           |                PE Device               |
   Multiple+----------------------------------------+
   AC      |      |          |        Single        | PW Instance
   <------>o  NSP #          +      PW Instance     X<---------->
           |      |          |                      |
           |------|  VSI     |----------------------|
           |      |          |        Single        | PW Instance
   <------>o  NSP #Forwarder +      PW Instance     X<---------->
           |      |          |                      |
           |------|          |----------------------|
           |      |          |        Single        | PW Instance
   <------>o  NSP #          +      PW Instance     X<---------->
           |      |          |                      |
           +----------------------------------------+

        Figure A.1  PE model with a VSI and no bridge module













Jiang, et al          Expires January 11, 2012               [Page 18]

Internet-Draft        VPLS PE Model for E-Tree               July 2011


   Authors' Addresses

   Yuanlong Jiang
   Huawei Technologies Co., Ltd.
   Bantian, Longgang district
   Shenzhen 518129, China
   Email: jiangyuanlong@huawei.com

   Lucy Yong
   Huawei USA
   1700 Alma Dr. Suite 500
   Plano, TX 75075, USA
   Email: lucyyong@huawei.com

   Manuel Paul
   Deutsche Telekom
   Goslarer Ufer 35
   10589 Berlin, Germany
   Email: manuel.paul@telekom.de

   Frederic Jounay
   France Telecom Orange
   2, avenue Pierre-Marzin
   22307 Lannion Cedex, France
   Email: frederic.jounay@orange-ftgroup.com























Jiang, et al          Expires January 11, 2012               [Page 19]

