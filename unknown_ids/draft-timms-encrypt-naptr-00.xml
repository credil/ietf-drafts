<?xml version="1.0" encoding="US-ASCII"?>
<?xml version="1.0"?>
<?xml-stylesheet type='text/xsl' href='http://greenbytes.de/tech/webdav/rfc2629.xslt' ?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc strict="yes"?>
<?rfc sortrefs="yes"?>

<rfc category="exp" ipr="full3978" docName="&lt;draft-timms-encrypt-naptr-00.txt&gt;">

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC1034 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1034.xml">
<!ENTITY RFC1035 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1035.xml">
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC2397 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2397.xml">
<!ENTITY RFC3401 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3401.xml">
<!ENTITY RFC3402 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3402.xml">
<!ENTITY RFC3403 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3403.xml">
<!ENTITY RFC3404 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3404.xml">
<!ENTITY RFC3405 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3405.xml">
<!ENTITY RFC3548 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3548.xml">
<!ENTITY RFC3761 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3761.xml">
<!ENTITY RFC3833 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3833.xml">
<!ENTITY RFC3986 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3986.xml">
<!ENTITY RFC4035 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4035.xml">
]>

<front>
<title abbrev="ENUM Encryption">IANA Registration for Encrypted ENUM</title>

  <author initials="B" surname="Timms" fullname="Ben Timms">
   <organization>Telnic</organization>
   <address>
    <postal>
     <street>8 Wilfred Street</street>
     <city>London</city>
     <code>SW1E 6PL</code>
     <country>United Kingdom</country>
    </postal>
    <email>btimms@telnic.org</email>
   </address>
  </author>
  
  <author initials="J" surname="Reid" fullname="Jim Reid">
   <organization>Telnic</organization>
   <address>
    <postal>
     <street>8 Wilfred Street</street>
     <city>London</city>
     <code>SW1E 6PL</code>
     <country>United Kingdom</country>
    </postal>
    <email>jim@telnic.org</email>
   </address>
  </author>
  
  <author initials="J." surname="Schlyter" fullname="Jakob Schlyter">
   <organization>Kirei AB</organization>
   <address>
    <postal>
     <street>P.O. Box 53204</street>
     <city>Goteborg</city>
     <code>SE-400 16</code>
     <country>Sweden</country>
    </postal>
    <email>jakob@kirei.se</email>
   </address>
  </author>
  

  
<date month="November" year="2007" />

<area>RAI</area>
<workgroup>ENUM</workgroup>

<keyword>Internet-Draft</keyword>
<keyword>DNS</keyword>
<keyword>NAPTR</keyword>
<keyword>ENUMSERVICE</keyword>
<keyword>x-crypto</keyword>


<abstract>
<t>This document requests IANA registration of the "X-Crypto"  Enumservice. This Enumservice indicates that its NAPTR holds a Uniform Resource Identifier that carries encrypted content from the fields of another (unpublished) Protected NAPTR, for use in E.164 Number Mapping (ENUM).</t>
</abstract>
  
</front>

<middle>

<section title="Introduction">
<section anchor="problem" title="The problem">
<t>DNS (<xref target="RFC1034">RFC 1034</xref>,<xref target="RFC1035">RFC 1035</xref>) is a global system; it does not differentiate on the data it returns. If a NAPTR <xref target="RFC3403"></xref> is published in DNS, then by definition the same Resource Record Set (RRset) will be returned in response to a query, regardless of the user placing that query.</t>

<t>Where URIs <xref target="RFC3986"></xref> are published within DNS (inside NAPTRs), the registrant may prefer to make these available only to groups of individuals that he or she has selected. Given the global nature of DNS, this can be a problem.</t>

<t>It is not reliably possible to return different RRset content to different queries, depending on the user making the request. Even if the authoritative server has been configured to discriminate based on the source of the query, if there are any intermediary recursive resolvers, the query may not even be passed to the authoritative server and the response returned to the querying DNS client may not be as the authoritative server would have chosen. It can also be challenging to configure and maintain the authoritative server, and this may also involve special configuration of each client that will query for and use the data.</t>

<section anchor="needs" title="The requirements">
<t>The same content should be published in DNS and so made available to all without discrimination. There should be no special processing required of DNS components. This will match the distributed design of the DNS and maintain the effectiveness of the cacheing architecture. </t>

<t>However, the value of chosen content should be protected in such a way that it is understandable only by a selected set of users.</t>

<t>It is important that the recipient of this data can detect immediately that it is protected, and either process it to extract the protected content, or immediately discard the data if it is not interested in such protected records.</t>
</section>
</section>

<section anchor="solution" title="The solution">
<t>A general solution for all DNS resource records that meets these requirements is very difficult; the performance requirements for DNS in general are severe. NAPTRs stored in ENUM <xref target="RFC3761"></xref> domains may contain personally identifying information, so finding a solution may be considered more pressing for such NAPTRs, and some restrictions or processing costs may therefore be acceptable. Also, in the case of NAPTRs a solution may be possible, as the problem is more restricted. NAPTRs hold a small number of well defined fields. Not all of these fields in a NAPTR will be sensitive and so require protection.</t>

<t>Those fields to be protected can be encrypted using a key known to the intended users. Thus a "Protected" NAPTR can be processed into two parts; the protected fields carried in a ciphertext, and the public fields. A "Container" NAPTR can itself be used to carry this ciphertext (inside its Regexp field content, in a URI), along with those fields that are considered public and are not protected. These public fields can be copied from the Protected NAPTR into this Container NAPTR.</t>

<t>The Container NAPTR can be stored and retrieved in the normal way. It will have an Enumservice that indicates that it acts as a container and MUST be decoded before the original Protected NAPTR can be reconstructed and processed. When an ENUM client retrieves such a Container NAPTR, it can immediately know that this requires special processing, and if that client is not interested in such processing, the NAPTR can be discarded.</t>

<section anchor="protFields" title="Protected fields">
<t>There is no great benefit to encrypting all of the RRDATA for a NAPTR. The ORDER and PREFERENCE/PRIORITY fields are used to indicate the preferred order in which the records within a returned NAPTR RRset should be processed. Whether a particular NAPTR acts as a container for a Protected NAPTR's content or not, the order in which it should be processed should remain the same. Otherwise, it might be possible for a Container NAPTR to be considered first (as it had a low numerical order value), but, once decoded, the Protected NAPTR content it contained was of a much lower priority, and so should not be processed at that point.</t>

<t>Thus the ORDER and PREFERENCE/PRIORITY field values should be considered public and be copied from the Protected NAPTR into the Container NAPTR. However, all the other fields (flags, services, regexp, and replacement) are sensitive in nature, and so would form the plaintext that would be protected before publication in DNS.</t>
</section>

<section anchor="protProcess" title="Protection process">
<t>The NAPTR to be protected can have these sensitive fields placed into a plaintext buffer. The buffer content is then encrypted using an appropriate key to create a ciphertext. The ciphertext can then be "armoured" into a form that can be presented in a data URI<xref target="RFC2397"></xref>. That URI can then be placed in a Container NAPTR, along with the "public" ORDER and PREFERENCE/PRIORITY fields from the Protected NAPTR.</t>

<t>If this Container NAPTR has an appropriate Enumservice then its nature will be immediately detectable by the recipient of that NAPTR. If the recipient has the appropriate key to decode the URI data, then it can decrypt the URI content to form a buffer with the plaintext fields. These fields (in combination ORDER and PREFERENCE/PRIORITY fields that have been copied into the Container NAPTR and have not been encoded) can be reconstructed into the fields that would have existed in the original Protected NAPTR. That Protected NAPTR content can then be processed by the client in the normal way.</t>
</section>
</section>
</section>

<section anchor="termin" title="Terminology">
<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119">RFC 2119</xref>.</t>
</section>

<section anchor="xcryptoReg" title="Enumservice Registration - X-Crypto">
<t>The following template contains information required for the
IANA registrations of the 'X-Crypto' Enumservice, according to
Section 3 of RFC 3761:</t>
<t>Enumservice Name: "X-Crypto"</t>
<t>Enumservice Type: "x-crypto"</t>
<t>Enumservice Subtype: "data"</t>
<t>Enumservice Sub-subtype: see <xref target="ciphersuite"/></t>
<t>URI Schemes: "data"</t>

<t>Functional Specification: see <xref target="functional"/></t>

<t>Security Specification: see <xref target="security"/></t>

<t>Intended Usage: COMMON</t>
<t>Author(s): Ben Timms, Jim Reid, Jakob Schlyter. (for authors contact details see Authors' Addresses section).</t>
<t>Any other information that the author deems interesting: None</t>
</section>

<section anchor="functional" title="Functional Specification">
<t>The basic concept is covered in <xref target="solution"></xref> and the process is covered in <xref target="protProcess"></xref>. This section describes in detail how the each of the fields are handled.</t>

<t>Publication and use of a NAPTR with this Enumservice is based on two concepts:
<list>
<t>A Protected NAPTR that contains sensitive field values, and is not stored and published in DNS.</t>
<t>A Container NAPTR with this Enumservice that holds the protected fields in encrypted form within its Regexp field. This NAPTR carries the "x-crypto" Enumservice</t>
</list>
</t>

<t>The Container NAPTR resource record fields are as follows:</t>

<section title="Order">
<t>The value of the order field is copied in clear from the Protected NAPTR into the Container NAPTR. It is not encoded.</t>
</section>

<section title="Preference">
<t>The value of the preference field is copied in clear from the Protected NAPTR to the Container NAPTR. It is not encoded.</t>
</section>

<section title="Services">
<t>The value of the services field for the Container NAPTR is set to "E2U+x-crypto:data:"
combined with the <xref target="ciphersuite">ciphersuite
sub-subtype</xref>.</t>
</section>

<section title="Regexp">
<t>The <xref target="payload">encrypted payload</xref> is encoded in Base64 <xref target="RFC3548"></xref>, and transported as a <xref target="RFC2397">data URI</xref>
inside the Container NAPTR.</t>

<t>Container NAPTR Regexp Example:
<vspace blankLines='0' />
!^.*$!data:;base64,bWVrbWl0YXNkaWdvYXQK!</t>
</section>

<section title="Replacement">
<t>The value of the Container NAPTR's replacement field MUST be set to ".".</t>
</section>

<section anchor="payload" title="Encrypted Payload">
<t>The processed content consists of encrypted, optionally padded ciphertext reflecting a portion of the Protected NAPTR's RDATA. The Flags, Services, Regexp and Replacement fields of the Protected NAPTR are treated as the plaintext to be processed.</t>

<t>Once the encrypted payload has been generated, it is further encoded in Base64, and this is then used as the value of the Container NAPTR's URI.</t>
</section>

</section>

<section anchor="ciphersuite" title="Ciphersuite Subtypes">
<t>The enumservice sub-subtype carries the ciphersuite used for the encrypted payload.</t>

<t>Ciphersuite sub-subtype example: RSA 1024-bit with PKCS#1.5 padding and no hash would be encoded as 0x8210 and presented as enumservice "E2U+x-crypto:data:8210".</t>

<section title="Crypto Algoritms">
<t>A 1-byte field indicating the encryption algorithm used for the <xref target="payload">encrypted payload</xref>.</t>
<texttable>
<ttcol>Value</ttcol>
<ttcol>Encryption Algorithm</ttcol>
<c>0x00</c><c>NULL</c>
<c>0x81</c><c>RSA-512</c>
<c>0x82</c><c>RSA-1024</c>
<c>0x83</c><c>RSA-1536</c>
<c>0x84</c><c>RSA-2048</c>
<c>0x85</c><c>RSA-3072</c>
<c>0x86</c><c>RSA-4096</c>
</texttable>
</section>

<section title="Padding">
<t>A 4-bit field indicating what padding algorithm is used for the <xref target="payload">encrypted payload</xref>.</t>
<texttable>
<ttcol>Value</ttcol>
<ttcol>Padding Algorithm</ttcol>
<c>0x0</c><c>NULL</c>
<c>0x1</c><c>PKCS #1.5</c>
<c>0x2</c><c>OAEP</c>
</texttable>
</section>

<section title="Hash">
<t>A 4-bit field indicating what hash algorithm used for the <xref target="payload">encrypted payload</xref>.</t>
<texttable>
 <ttcol>Value</ttcol>
 <ttcol>Hash Algorithm</ttcol>
 <c>0x0</c><c>NULL</c>
 <c>0x1</c><c>MD2</c>
 <c>0x2</c><c>MD5</c>
 <c>0x3</c><c>SHA-1</c>
 <c>0x4</c><c>SHA-224</c>
 <c>0x5</c><c>SHA-256</c>
 <c>0x6</c><c>SHA-384</c>
 <c>0x7</c><c>SHA-512</c>
</texttable>
</section>

</section>
   
<section anchor="example" title="Example">
<t>Move along, nothing to see here (yet).</t>
</section>

<section anchor="security" title="Security Considerations">
<t>This is an Enumservice for a NAPTR intended to carry protected NAPTR content in encrypted form. It does not discuss the means by which the keys needed to decrypt the protected content are exchanged. For this Enumservice registration, this is considered "out of scope". However, the technique for key exchange is important, and must be considered thoroughly; there is little point in using a complex encryption scheme if the keys are available to eavesdroppers.</t>

<t>There are limitations on field size within DNS, so that, for example, the Regexp field has a maximum length of 255 octets. Several of these octets will be taken up with the sub-field delimiters, with the ERE sub-field content, and with the URI scheme itself. There is limited space to carry the armoured ciphertext as the data URI value, given the armouring choice proposed here and the simple use of the existing Regexp field to carry the protected data. This will in turn limit the choices for encryption method, has algorithm, and any padding.</t>

<t>Both of these issues mean that the environment in which NAPTRs with this Enumservice can be used may be restricted, and further security analysis will depend on deployment experience.</t>
<t>An analysis of threats specific to the dependence of ENUM on the DNS, and the applicability of <xref target="RFC4035">DNSSEC ("Domain Name Security") </xref> to these, is provided in <xref target="RFC3833"></xref>.</t>
</section>

<section anchor="iana" title="IANA Considerations">
<t>This document requests registration of the "X-Crypto" Enumservice with the "x-crypto:data:&lt;ciphersuite&gt;" type according to the guidelines and specifications in RFC 3761 <xref target="RFC3761"></xref> and the definitions in this document. This Enumservice is intended for use with the "data:" URI scheme.</t>
</section>

<section anchor="shouts" title="Acknowledgements">
<t>The authors gratefully acknowledge the contributions of Romek Szczesniak. He helped greatly to clarify some of the issues with deployed security schemes and current implementations. We also acknowledge the support of Khashayar Mahdavi whose original idea this draft embodies, and Henri Asseily for driving the development of the environment in which this is being used.</t>
</section>
  
</middle>

<back>

  <references title="Normative References">
   &RFC2119;
   &RFC3761;
   &RFC2397;
   &RFC3403;
   &RFC3548;
  </references>

  <references title="Informative References">
   &RFC1034;
   &RFC1035;
<!--
   &RFC3401;
   &RFC3402;
   &RFC3404;
   &RFC3405;
-->
   &RFC3833;
   &RFC3986;
   &RFC4035;
  </references>

 </back>

</rfc>
