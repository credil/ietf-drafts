<?xml version="1.0" encoding="US-ASCII"?>

<!-- This template is for creating an Internet Draft using xml2rfc,

     which is available here: http://xml.resource.org. -->

<!-- add baseURL http://xml.resource.org/authoring/ here -->

<!DOCTYPE rfc SYSTEM "http://xml.resource.org/authoring/rfc2629.dtd" [

<!-- One method to get references from the online citation libraries.

     There has to be one entity for each item to be referenced. 

     An alternate method (rfc include) is described in the references. -->

<!ENTITY RFC2616 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2616.xml">

<!ENTITY RFC1123 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1123.xml">

<!ENTITY RFC4287 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4287.xml">

<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">

<!ENTITY RFC5829 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5829.xml">

<!ENTITY RFC5988 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5988.xml">

<!ENTITY RFC4151 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4151.xml">

<!ENTITY RFC5785 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5785.xml">

<!ENTITY RFC6415 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6415.xml">

<!ENTITY RFC6690 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6690.xml">

<!ENTITY I-D.masinter-dated-uri SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-masinter-dated-uri-10.xml">

]>

<!-- add baseURL http://www.mementoweb.org/guide/rfc/ID/ here, change xslt to xsl -->

<?xml-stylesheet type='text/xsl' href='http://www.mementoweb.org/guide/rfc/ID/rfc2629.xsl' ?>

<!-- used by XSLT processors -->

<!-- For a complete list and description of processing instructions (PIs), 

     please see http://xml.resource.org/authoring/README.html. -->

<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.

     (Here they are set differently than their defaults in xml2rfc v1.32) -->

<?rfc strict="yes" ipr="trust200902" ?>

<!-- give errors regarding ID-nits and DTD validation -->

<!-- control the table of contents (ToC) -->

<?rfc toc="yes"?>

<!-- generate a ToC -->

<?rfc tocdepth="4"?>

<!-- the number of levels of subsections in ToC. default: 3 -->

<!-- control references -->

<?rfc symrefs="yes"?>

<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->

<?rfc sortrefs="yes" ?>

<!-- sort the reference entries alphabetically -->

<!-- control vertical white space 

     (using these PIs as follows is recommended by the RFC Editor) -->

<?rfc compact="yes" ?>

<!-- do not start each main section on a new page -->

<?rfc subcompact="no" ?>

<!-- keep one blank line between list items -->

<!-- end of list of popular I-D processing instructions -->

<rfc category="info" docName="draft-vandesompel-memento-06" ipr="trust200902">

  <!-- category values: std, bcp, info, exp, and historic

     ipr values: full3667, noModification3667, noDerivatives3667

     you can add the attributes updates="NNNN" and obsoletes="NNNN" 

     they will automatically be output with "(if approved)" -->



  <!-- ***** FRONT MATTER ***** -->



  <!-- ***** FRONT MATTER ***** -->



  <front>

    <!-- The abbreviated title is used in the page header - it is only necessary if the 

         full title is longer than 39 characters -->



    <title abbrev="HTTP Memento">HTTP framework for time-based access to resource states -- Memento</title>



    <!-- add 'role="editor"' below for the editors if appropriate -->



    <!-- Another author who claims to be an editor -->

    <author fullname="Herbert VandeSompel" initials="H." surname="VandeSompel">
      <organization>Los Alamos National Laboratory</organization>
      <address>
        <postal>
          <street>PO Box 1663</street>
          <!-- Reorder these if your country does things differently -->
          <city>Los Alamos</city>
          <region>New Mexico</region>
          <code>87545</code>
          <country>USA</country>
        </postal>
        <phone>+1 505 667 1267</phone>
        <email>hvdsomp@gmail.com</email>
		<uri>http://public.lanl.gov/herbertv/</uri>
        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <author fullname="Michael Nelson" initials="M.L." surname="Nelson">
      <organization>Old Dominion University</organization>
      <address>
        <postal>
          <street></street>
          <!-- Reorder these if your country does things differently -->
          <city>Norfolk</city>
          <region>Virginia</region>
          <code>23529</code>
          <country>USA</country>
        </postal>
        <phone>+1 757 683 6393</phone>
        <email>mln@cs.odu.edu</email>
		<uri>http://www.cs.odu.edu/~mln/</uri>
        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <author fullname="Robert Sanderson" initials="R.D." surname="Sanderson">
      <organization>Los Alamos National Laboratory</organization>
      <address>
        <postal>
          <street>PO Box 1663</street>
          <!-- Reorder these if your country does things differently -->
          <city>Los Alamos</city>
          <region>New Mexico</region>
          <code>87545</code>
          <country>USA</country>
        </postal>
        <phone>+1 505 665 5804</phone>
        <email>azaroth42@gmail.com</email>
        <uri>http://public.lanl.gov/rsanderson/</uri>
        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <date month="February" year="2013" />

    <!-- If the month and year are both specified and are the current ones, xml2rfc will fill 

         in the current day for you. If only the current year is specified, xml2rfc will fill 

	 in the current day and month for you. If the year is not the current one, it is 

	 necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the 

	 purpose of calculating the expiry date).  With drafts it is normally sufficient to 

	 specify just the year. -->

    <!-- Meta-data Declarations -->

    <area>General</area>

    <workgroup>Internet Engineering Task Force</workgroup>

    <!-- WG name at the upperleft corner of the doc,

         IETF is fine for individual submissions.  

	 If this element is not present, the default is "Network Working Group",

         which is used by the RFC Editor as a nod to the history of the IETF. -->

    <keyword>HTTP</keyword>
    <keyword>content negotiation</keyword>
    <keyword>datetime negotiation</keyword>
    <keyword>resource versions</keyword>
    <keyword>archival resources</keyword>
    <keyword>Memento</keyword>

    <!-- Keywords will be incorporated into HTML output

         files in a meta tag but they have no effect on text or nroff

         output. If you submit your draft to the RFC Editor, the

         keywords will be used for the search engine. -->

<abstract>

<t>
  The HTTP-based Memento framework bridges the present and past Web. It facilitates obtaining representations 
  of prior states of a resource by leveraging the resource's URI and a preferred datetime. 
  To this end, the framework introduces datetime negotiation, a variation on content negotiation. 
It also facilitates recongizing a resource that encapsulates a frozen prior state of another resource 
by expressing that state's datetime and by providing an appropriately typed link to that other resource. 
</t>

</abstract>

</front>

<middle>

  <!-- ********************************************************************************************************************** -->

  <!-- ********************************************************************************************************************** -->

<section title="Introduction">

<section title="Terminology">

<t>
This specification uses the terms "resource", "request", "response", "entity-body", "content negotiation", 
"user agent", "server" as described in <xref target="RFC2616"></xref>, and it uses the terms "representation" and 
"resource state" as described in <xref target="W3C.REC-aww-20041215"></xref>.
</t>
  
<t>
  In addition, the following terms specific to the Memento framework are introduced:
</t>

<t><list style="symbols">

  <t>
    Original Resource: An Original Resource is a resource that exists or used to exist, and for which access 
    to one of its prior states may be required.
  </t>
  
  <t>
    Memento: A Memento for an Original Resource is a resource that encapsulates a prior state of the Original Resource. 
    A Memento for an Original Resource as it existed at time T is a resource that encapsulates the state the Original 
    Resource had at time T. 
  </t>
  
  <t>
    TimeGate: A TimeGate for an Original Resource is a resource that is capable of datetime negotiation to support   
    access to prior states of the Original Resource. 
  </t>
  
  <t>
    TimeMap: A TimeMap for an Original Resource is a resource from which a list of URIs of Mementos of the Original Resource is available.
  </t>
  


</list> </t>

</section>
  
  <section title="Notational Conventions" anchor="notation">
    
    <t>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" 
      in this document are to be interpreted as described in <xref target="RFC2119"></xref>.
    </t>
    
    <t>
      When needed for extra clarity, the following conventions are used: 
    </t>
    
    <t><list style="symbols">
      
      <t>URI-R is used to denote the URI of an Original Resource.</t>  
      
      <t>URI-G is used to denote the URI of a TimeGate.</t>  
      
      <t>URI-M is used to denote the URI of a Memento.</t>  
      
      <t>URI-T is used to denote the URI of a TimeMap.</t>  
      
    </list></t>
    
  </section>

<section title="Purpose">

<t>
The state of an Original Resource may change over time. Dereferencing its URI at any specific moment  
yields a response that reflects the resource's state at that moment: a representation of the resource's state (e.g. "200 OK" HTTP status code), 
an indication of its non-existence (e.g. "404 Not Found" HTTP status code), a relation to another resource (e.g. "302 Found" HTTP status code), etc.
However, responses may also exist that reflect prior states of an Original Resource: 
a representation of a prior state of the Original Resource, an indication that the Original Resource 
did not exist at some time in the past, a relation that the Original Resource 
had to another resource at some time in the past, etc.
Mementos that provide such responses exist in web archives, content management systems, or revision control systems, among others. 
For any given Original Resource several Mementos may exist, each 
one reflecting a frozen prior state of the Original Resource. 
</t>

<t>Examples are:</t>

  <t>Mementos for Original Resource http://www.ietf.org/ :</t>
  
  <t><list style="symbols">
    <t>http://web.archive.org/web/19970107171109/http://www.ietf.org/</t>
    <t>http://webarchive.nationalarchives.gov.uk/20080906200044/http://www.ietf.org/</t>
</list></t>

  <t>Mementos for Original Resource http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol :</t>
  
  <t><list style="symbols">
    <t>http://en.wikipedia.org/w/index.php?title=Hypertext_Transfer_Protocol&amp;oldid=366806574</t> 
    <t>http://en.wikipedia.org/w/index.php?title=Hypertext_Transfer_Protocol&amp;oldid=33912</t>
    <t>http://web.archive.org/web/20071011153017/http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol</t>
</list></t>

<t>Mementos for Original Resource http://www.w3.org/TR/webarch/ :</t>
  
  <t><list style="symbols">
    <t>http://www.w3.org/TR/2004/PR-webarch-20041105/</t>
    <t>http://www.w3.org/TR/2002/WD-webarch-20020830/</t>
    <t>http://webarchive.nationalarchives.gov.uk/20100304163140/http://www.w3.org/TR/webarch/</t>
</list></t>


  <t>
    In the abstract, the Memento framework introduces a mechanism to access versions of web resources that:
  </t>
  
  <t><list style="symbols">
    
    <t>Is fully distributed in the sense that resource versions may reside on multiple servers, and that any such server 
      is likely only aware of the versions it holds;</t>
    
    <t>Uses the global notion of datetime as a resource version indicator and access key;</t>
    
    <t>Leverages the following primitives of <xref target="W3C.REC-aww-20041215"></xref>: 
      resource, resource state, representation, content negotiation, 
      and link.</t>
    
  </list></t>
  
  <t>The core components of Memento's mechanism to access resource versions are:</t>
    
    <t>
      1. The abstract notion of the state of an Original Resource (URI-R) as it existed at datetime T. 
      Note the relationship with the ability to identify the state of a resource at datetime T by means of a URI  
      as intended by the proposed Dated URI scheme <xref target="I-D.masinter-dated-uri"></xref>. 
    </t>
    
    <t>
      2. A "bridge" from the present to the past, consisting of:
    </t>
    
<t><list style="symbols">
      
      <t>The existence of a TimeGate (URI-G), 
        which is aware of (at least part of the) version history of the Original Resource (URI-R);</t>
      
      <t>The ability to negotiate in the datetime dimension with that TimeGate (URI-G), 
        as a means to access the state that the Original Resource (URI-R) had at datetime T.</t>
      
    </list></t>
    
    <t>
      3. A "bridge" from the past to the present, consisting of an appropriately typed link from a Memento (URI-M), 
      which encapsulates the state the Original Resource (URI-R) had at datetime T, to the Original Resource (URI-R).
    </t>
  
  <t>
    This document is concerned 
    with specifying an instantiation of these abstractions for resources that are identified by HTTP(S) URIs.
  </t>
  

</section>
  
</section>
  
  
  <!-- ********************************************************************************************************************** -->
  
  <!-- ********************************************************************************************************************** -->

<section title="HTTP headers, Relation Types" anchor="component-1.1">

  <t>
    The Memento framework is concerned with HEAD and GET interactions with Original Resources, TimeGates, Mementos, and TimeMaps 
    that are identified by 
    HTTP or HTTPS URIs. 
    Details are only provided for resources identified by HTTP URIs but apply similarly to those with HTTPS URIs.
  </t>

<section title="HTTP Headers">

<t>
The Memento framework operates at the level of HTTP request and response headers. It introduces two new headers 
("Accept-Datetime", "Memento-Datetime") and introduces new values for two existing headers ("Vary", "Link"). 
Other HTTP headers are present or absent in Memento response/request cycles as specified by <xref target="RFC2616"></xref>.
</t>

<section title="Accept-Datetime, Memento-Datetime" anchor="Accept-Memento-Datetime">

<t>
The "Accept-Datetime" request header is trasnmitted by a user agent to indicate it wants to access a 
past state of an Original Resource. To that end, the "Accept-Datetime" header is conveyed in an 
HTTP request issued against a TimeGate for an Original Resource, and its value indicates the datetime of 
the desired past state of the Original Resource. 
</t>
  
  <t>
    Example of an "Accept-Datetime" request header:
  </t>
  
  <figure>
    <artwork align="left"><![CDATA[ 
Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT
]]></artwork>
  </figure>

<t>
The "Memento-Datetime" response header is used by a server to indicate that a response 
reflects a prior state of an Original Resource. Its value expresses the datetime of that 
state. The URI of the Original Resource for which the response reflects a prior state is provided as the 
Target IRI 
  of a link provided in the HTTP "Link" header that has a 
  Relation Type of "original" (see <xref target="Link-Header-Relation-Types"></xref>).
</t>

<t>
    The presence of a "Memento-Datetime" header and associated value for a given response constitutes a promise that 
    the resource state reflected in the response will no longer change (see <xref target="SpecialCases-Sticky"></xref>).
</t>
  
  <t>
    Example of a "Memento-Datetime" response header:
  </t>
  
  <figure>
    <artwork align="left"><![CDATA[ 
Memento-Datetime: Wed, 30 May 2007 18:47:52 GMT
]]></artwork>
  </figure>

    <t>Values for the "Accept-Datetime" and "Memento-Datetime" headers consist of a MANDATORY datetime expressed according to the 
    <xref target="RFC1123"></xref> format, which is formalized by the rfc1123-date construction 
    rule of the BNF in <xref target="datetime-BNF"></xref>. The datetime MUST be represented 
  in Greenwich Mean Time (GMT).
</t> 
  


  
  <figure align="center" anchor="datetime-BNF" title="BNF for the datetime format">
    
    <artwork align="left"><![CDATA[

accept-dt-value = rfc1123-date *SP
rfc1123-date = wkday "," SP date1 SP time SP "GMT"
date1        = 2DIGIT SP month SP 4DIGIT 
                  ; day month year (e.g., 20 Mar 1957)
time         = 2DIGIT ":" 2DIGIT ":" 2DIGIT 
                  ; 00:00:00 - 23:59:59 (e.g., 14:33:22)
wkday        = "Mon" | "Tue" | "Wed" | "Thu" | "Fri" | "Sat" | 
               "Sun" 
month        = "Jan" | "Feb" | "Mar" | "Apr" | "May" | "Jun" | 
               "Jul" | "Aug" | "Sep" | "Oct" | "Nov" | "Dec"

]]></artwork>
    
  </figure>
  
    
</section>

  <section title="Vary">
    
    <t>
      Generally, the "Vary" header is used in HTTP responses to indicate the dimensions in which content negotiation is possible. In the Memento 
      framework, a TimeGate uses the "Vary" header with a value that includes "accept-datetime" to convey that datetime negotation is possible.
    </t>  
    
    <t>
      For example, this use of the "Vary" header indicates that datetime is the only dimension in which negotiation is possible:
    </t>
    
    <figure>
      <artwork align="left"><![CDATA[
Vary: accept-datetime
]]></artwork>
    </figure>
    
    <t>
      The use of the "Vary" header in this example shows that both datetime negotiation, and media type content negotiation are possible:
    </t>
    
    <figure>
      <artwork align="left"><![CDATA[
Vary: accept-datetime, accept
]]></artwork>
    </figure>
    
  </section>
  
  <section title="Link">
    
    <t>
      The Memento framework defines the "original", "timegate", "timemap", and "memento" Relation Types to convey typed links 
      among Original Resources, TimeGates, Mementos, and TimeMaps. The are defined in 
      <xref target="Link-Header-Relation-Types"></xref>, below.
      In addition, existing Relation Types may be used, for example, to support navigating among Mementos. 
      Examples are "first", "last", "prev", "next", "predecessor-version", 
      "successor-version" as detailed in <xref target="RFC5988"></xref> and <xref target="RFC5829"></xref>.
    </t>
    
  </section>

</section>

<section title="Relation Types" anchor="Link-Header-Relation-Types">

<t>
This section introduces the Relation Types used in the Memento framework. 
They are defined in a general way and their use in HTTP "Link" Headers <xref target="RFC5988"></xref> is described in detail. 
The use of these Relation Types in TimeMaps is described in 
  <xref target="Pattern6"></xref>.</t>
     
  <section title="Relation Type &quot;original&quot;">
    
    <t>
      "original" --  A link with an "original" Relation Type is used to
      point from a TimeGate or a Memento to its associated Original Resource. 
    </t>
    
    <t>
      Use in HTTP "Link" headers: A TimeGate and a Memento 
      MUST include exactly one link with an "original" Relation Type in their HTTP "Link" header.
    </t>
  
    
  </section>

<section title="Relation Type &quot;timegate&quot;">

<t>
  "timegate" -- A link with a "timegate" Relation Type is used to
  point from the Original Resource, as well as from a Memento associated with the Original
  Resource, to a TimeGate for the Original Resource. 
</t>
  
<t>
  Use in HTTP "Link" headers: An Original Resource and a Memento SHOULD include a link with a "timegate" Relation Type 
  in their HTTP "Link" header.
  Since multiple TimeGates can exist for any Original Resource, multiple "timegate" links MAY occur, each with a distinct Target IRI.  
</t>

</section>

<section title="Relation Type &quot;timemap&quot;">

<t>
  "timemap" -- A link with a "timemap" Relation Type is used to
  point from a TimeGate or a Memento associated with an Original Resource, as well as from the Original Resource itself, 
  to a TimeMap for the Original Resource.
</t>
  
  <t>
    Attributes: A link with a "timemap" Relation Type SHOULD use the "type" attribute to convey the mime type of the 
    TimeMap serialization. The "from" and "until" 
    attributes may be used to express the start and end of the temporal interval covered by Mementos listed in the TimeMap. 
    That is, the linked TimeMap 
    will not contain Mementos with archival datetimes outside of the expressed temporal interval. Attempts SHOULD be made to convey this interval as accurately as possible.
    The value for the these attributes MUST be a datetime expressed according 
    to the rfc1123-date construction rule of the BNF in <xref target="datetime-BNF"></xref> and it MUST be represented 
    in Greenwich Mean Time (GMT).       
  </t>
  
  
  <t>
    Use in HTTP "Link" headers: An Original Resource, a TimeGate and a Memento SHOULD include 
    a link with a "timemap" Relation Type in their HTTP "Link" header. 
    Multiple such links, each with a distinct Target IRI, MAY be expressed 
    as a means to point to different TimeMaps or to different serializations of the same TimeMap. 
    In all cases, use of the "from" and "until" attributes is OPTIONAL.
  </t>
  
</section>

<section anchor="memento-rel" title="Relation Type &quot;memento&quot;">

<t>
  "memento" -- A link with a "memento" Relation Type is used to
  point from a TimeGate or a Memento for an Original
  Resource, as well as from the Original Resource itself, to a Memento for the Original Resource.
</t>
  
  <t>
    Attributes: A link with a "memento" Relation Type MUST include a "datetime" attribute with a value that matches the "Memento-Datetime" 
    of the Memento that is the target of the link; that is, 
    the value of the "Memento-Datetime" header that is returned when the URI of the linked Memento is dereferenced. 
    The value for the "datetime" attribute MUST be a datetime expressed according 
    to the rfc1123-date construction rule of the BNF in <xref target="datetime-BNF"></xref> and it MUST be represented 
    in Greenwich Mean Time (GMT). 
    This link MAY include a "license" attribute to associate a license with the Memento; the value for the "license" 
    attribute SHOULD be a URI.  
  </t>
  
  
  <t>Use in HTTP "Link" headers: An Original Resource, a TimeGate and a Memento MAY 
    include links in their HTTP "Link" headers with a "memento" Relation Type. For responses in which 
  a Memento is selected, the provision of navigational links that lead to Mementos other than the selected one 
  can be beneficial to the user agent. Of special importance are links that lead to the temporally first and last Memento known to 
  the responding server, as well as links leading to Mementos that are temporally adjacent to the selected 
  one.</t>
  
  </section>
  
</section>
  
  
  <section anchor="headers-summary" title="Memento response headers: Summary">
    
    <t>The below table summarizes the use of the Vary, Memento-Datetime, and Link headers in 
    responses from Original Resources, TimeGates, and Mementos. 
    The value of the Vary header MUST contain the "accept-datetime" value, whereas the 
    value of the Memento-Datetime header MUST convey the datetime of the state 
    of the Original Resource that is encapsulated in the Memento selected by the response. 
    From now on, this datetime will be 
    referred to as the archival datetime of the Memento.</t>
    
    <t>The Link header can contain links with the  
    "original", "timegate", "timemap", and "memento" Relation Types and their use for the various resource types is
    also detailed in the table.</t>
    
    <t>The inclusion of Memento headers and links in responses from the respective resources is as shown in the table 
      irrespective of whether an HTTP HEAD/GET request against their URI includes an "Accept-Datetime" request header: 
    requests with and without an "Accept-Datetime" header yield the inclusion of the same response headers.  
    Values for those response headers depend on the request.</t>
    
    <t>The use of response headers and links for specific scenarios can be derived from this table. For example:</t>
    
    <t><list style="symbols">
      <t>URI-R&lt;&gt;URI-G&lt;&gt;URI-M - If the TimeGate is distinct from 
        the associated Original Resource and Memento, then their use 
        is as shown in the respective columns.</t>
      <t>URI-R=URI-G - If the TimeGate coincides with the Original Resource, then 
        their use is obtained by taking the union of the headers for a TimeGate and for an Original Resource and 
        by selecting REQUIRED over RECOMMENDED and REQUIRED over PROHIBITED.  For example, this case must have a 
        "Vary" header that includes an 
        "accept-datetime" value.</t>
      <t>URI-R=URI-M - If the Original Resource and its Memento coincide (the Original Resource is a FixedResource 
        as per <xref target="W3C.gen-ont-20090420"></xref>), their 
        use is obtained by taking the union of the headers for an Original Resource and for a Memento and 
        by selecting REQUIRED over RECOMMENDED and REQUIRED over PROHIBITED. 
        For example, this case must have a "Memento-Datetime" header.</t>
    </list></t>
    
    <texttable anchor="Headers-Table" title="Memento Headers">  
      <ttcol align="center">Response Header</ttcol>    
      <ttcol align="center">Original Resource</ttcol>    
      <ttcol align="center">TimeGate</ttcol>     
      <ttcol align="center">Memento</ttcol>
      <c>Vary: accept-datetime</c>     
      <c>PROHIBITED</c>     
      <c>REQUIRED, 1</c>     
      <c>PROHIBITED</c>
      <c>Memento-Datetime</c>     
      <c>PROHIBITED</c>     
      <c>PROHIBITED</c>     
      <c>REQUIRED, 1</c>
      <c>Link</c>     
      <c>RECOMMENDED, 0 or 1</c>     
      <c>REQUIRED, 1</c>     
      <c>REQUIRED, 1</c>
      <c>"original" link</c>     
      <c>NA</c>     
      <c>REQUIRED, 1</c>     
      <c>REQUIRED, 1</c>
      <c>"timegate" link</c>     
      <c>RECOMMENDED, 0 or more</c>     
      <c>NA</c>    
      <c>RECOMMENDED, 0 or more</c>
      <c>"timemap" link</c>    
      <c>RECOMMENDED, 0 or more</c>    
      <c>RECOMMENDED, 0 or more</c>    
      <c>RECOMMENDED, 0 or more</c>
      <c>"memento" link</c>     
      <c>OPTIONAL, 0 or more</c>    
      <c>OPTIONAL, 0 or more</c>     
      <c>OPTIONAL, 0 or more</c>
    </texttable>

  </section>
</section>
  
  
  <section title="General considerations regarding Datetime Negotiation" anchor="General">
    
    <t>
      In order to respond to a datetime negotiation request, 
      the server uses an internal algorithm to select the Memento that best meets the user agent's 
      datetime preference. The exact nature of the selection algorithm is at the server's discretion
      but SHOULD be consistent, for example, always selecting the Memento 
      that is nearest in time relative to the requested datetime, always selecting the Memento that is 
      nearest in the past relative to the requested datetime, etc.
    </t>
    
    <t>
      Due to the sparseness of Mementos in most systems, 
      the value of the "Memento-Datetime" header returned by a server may differ 
      (significantly) from the value conveyed by the user agent in "Accept-Datetime".
    </t>
    
    <t>
      Although a Memento encapsulates a prior state of an Original Resource, the entity-body returned in response to an HTTP GET 
      request issued against a Memento may very well not be byte-to-byte the same as an entity-body that was previously returned 
      by that Original Resource. Various reasons exist why there are significant chances these would be different yet do convey 
      substantially the same information. These include format migrations as part of a digital preservation strategy, 
      URI-rewriting as applied by some web archives, and the addition of banners as a means to brand web archives. 
    </t>
    
    <t> 
      When negotiating in the datetime dimension, the regular content negotiation dimensions (media type, 
      character encoding, language, and compression) remain available. 
      It is the TimeGate server's responsibility to honor (or not) such 
      content negotiation, and in doing so it MUST always first select a Memento that meets 
      the user agent's datetime preference, and then 
      consider honoring regular content negotiation for it. As a result of this approach, the returned Memento will not 
      necessarily meet the user agent's regular content negotiation preferences. Therefore, it is RECOMMENDED that the server 
      provides "memento" links in the HTTP "Link" header pointing at Mementos that do meet the user agent's regular content 
      negotiation requests and that have a value for the "Memento-Datetime" header 
      in the temporal vicinity of the user agent's preferred datetime value.
    </t>
    
    <t>A user agent that engages in datetime negotiation with a resource typically starts by issuing an HTTP HEAD, not GET,
      request with an "Accept-Datetime" header in order to determine how to proceed. This strategy is related to 
      the existence of various server implementation patterns as will become clear in the below.</t>
    
    <t>In the following sections, the HTTP status code of the responses with an entity-body is shown as 
      "200 OK", but a series of "206 Partial Content" responses could be substituted.</t>
    
    
    
  </section>

<!-- ********************************************************************************************************************** -->

<!-- ********************************************************************************************************************** -->

  <section title="HTTP Interactions for Datetime Negotiation" anchor="component-1.2">

  <t>This section describes the HTTP interactions of the Memento framework for a variety 
    of scenarios. First, <xref target="intro-flow"></xref> provides a schematic overview of a successful 
    request/response chain that 
    involves datetime negotiation. Dashed lines depict HTTP transactions between user agent and server. 
    The interactions are for a scenario where the Original Resource resides on one server, 
    whereas both its TimeGate and Mementos reside on another. Scenarios also exist in which all these resources 
    are on the same server (for example, content management systems) or all are 
    on different servers (for example, an aggregator of TimeGates). 
  </t>
           
    <!--
      
      xxxxxxxxxxxxxxxxxxxxxxxx max width for pics xxxxxxxxxxxxxxxxxxxxxxxxx
      
    -->

    <figure align="center" anchor="intro-flow" title="A datetime negotiation request/response chain">
      
      <artwork align="left"><![CDATA[
1: UA --- HTTP HEAD/GET; Accept-Datetime: T ----------------> URI-R
2: UA <-- HTTP 200; Link: URI-G ----------------------------- URI-R
3: UA --- HTTP HEAD/GET; Accept-Datetime: T ----------------> URI-G
4: UA <-- HTTP 302; Location: URI-M; Vary; Link: 
      URI-R,URI-T ------------------------------------------> URI-G
5: UA --- HTTP GET URI-M; Accept-Datetime: T ---------------> URI-M
6: UA <-- HTTP 200; Memento-Datetime: T; Link:  
      URI-R,URI-T,URI-G ------------------------------------- URI-M
]]></artwork>
      
    </figure>   
    
    <t><list style="symbols">
      
      <t>
        Step 1: The user agent that wants to access a prior state of the Original Resource 
        issues an HTTP HEAD/GET against URI-R that has an "Accept-Datetime" HTTP header 
        with a value of the datetime of the desired state.
      </t>
      
      <t>
        Step 2: The response from URI-R includes an HTTP "Link" header 
        with a Relation Type of "timegate" pointing at a TimeGate (URI-G) for the Original Resource.
      </t>
      
      <t>
        Step 3: The user agent starts the datetime negotiation process with the TimeGate by issuing 
        an HTTP GET request against URI-G that has an "Accept-Datetime" 
        HTTP header with a value of the datetime of the desired prior state of the Original Resource.
      </t>
      
      <t>
        Step 4: The response from URI-G includes a "Location" header pointing at 
        a Memento (URI-M) for the Original Resource. 
        In addition, the response contains an HTTP "Link" header with a Relation Type of "original" 
        pointing at the Original Resource (URI-R), and an HTTP "Link" header with a Relation Type 
        of "timemap" pointing at a TimeMap (URI-T).
      </t>
      
      <t>
        Step 5: The user agent issues an HTTP GET request against URI-M.
      </t>
      
      <t>
        Step 6: The response from URI-M includes a "Memento-Datetime" HTTP header with a 
        value of the archival datetime of the Memento.  
        It also contains an HTTP "Link" header with a Relation Type of "original" pointing at the  
        Original Resource (URI-R), 
        with a Relation Type of "timegate" pointing at a TimeGate (URI-G) 
        for the Original Resource, and with a Relation Type of "timemap" pointing at a TimeMap (URI-T) 
        for the Original Resource. 
        The state that is expressed by the response is the state the Original 
        Resource had at the archival datetime expressed in the "Memento-Datetime" header.
      </t>
      
    </list></t>
    
    <t>
      <xref target="intro-flow"></xref> depicts a specific pattern to implement the Memento framework. Multiple patterns 
      exist and they can be grouped as follows:
    </t>
    
    <t><list style="symbols">
      <t><xref target="Pattern1">Pattern 1</xref> - The Original Resource acts as its own TimeGate</t>
      <t><xref target="Pattern2">Pattern 2</xref> - A remote resource acts as a TimeGate for the Original Resource</t>
      <t><xref target="Pattern3">Pattern 3</xref> - The Original Resource is a Fixed Resource</t>
      <t><xref target="Pattern4">Pattern 4</xref> - Mementos without a TimeGate</t>
    </list></t>
    
    <t>Details of the HTTP interactions for common cases for each of those patterns are provided in 
      <xref target="Pattern1"></xref> through <xref target="Pattern4"></xref>. 
      Special cases are described in <xref target="SpecialCases"></xref>.</t>
    
    <t>
      <xref target="Pattern1-Request1"></xref> shows a user agent that attemtps to 
      datetime negotiate with the Original Resource http://a.example.org/ by including an 
      "Accept-Datetime" header in its HTTP HEAD request. This initiating request is the same 
      for <xref target="Pattern1">Pattern 1</xref> through <xref target="Pattern3">Pattern 3</xref>.
    </t>
    
    <figure title="User Agent Attempts Datetime Negotiation With Original Resource" align="center" anchor="Pattern1-Request1">       
      <artwork align="left"><![CDATA[
HEAD / HTTP/1.1
Host: a.example.org
Accept-Datetime: Tue, 11 Sep 2001 20:35:00 GMT
Connection: close
]]></artwork>         
    </figure>
    
    <section title="Pattern 1 - The Original Resource acts as its own TimeGate" anchor="Pattern1">
      
      <t>In this implementation pattern, the Original Resource acts as its own TimeGate, which means that 
      URI-R and URI-G coincide. Content management systems and revision control systems can support datetime negotiation 
      in this way as they are commonly aware of the version history of their own resources.</t>
      
      <t>The response to this request when datetime negotiation for this resource is supported 
        depends on the negotiation style it uses (200-style or 302-style) and on the existence or absence of a 
        URI-M for Mementos that is distinct from the URI-R of the associated Original Resource. 
        The various cases are summarized in 
        the below table and the server responses for each are detailed in the remainder of this section.        
      </t>
      
      <texttable anchor="Pattern1-Table" title="Pattern 1">  
        <ttcol align="center">Pattern</ttcol>    
        <ttcol align="center">Original Resource</ttcol>    
        <ttcol align="center">TimeGate</ttcol>     
        <ttcol align="center">Memento</ttcol>
        <ttcol align="center">Negotiation Style</ttcol>
        <c><xref target="Pattern1.1">Pattern 1.1</xref></c>     
        <c>URI-R</c>     
        <c>URI-R</c>     
        <c>URI-M</c>
        <c>302</c>
        <c><xref target="Pattern1.2">Pattern 1.2</xref></c>     
        <c>URI-R</c>     
        <c>URI-R</c>    
        <c>URI-M</c>
        <c>200</c> 
        <c><xref target="Pattern1.3">Pattern 1.3</xref></c>    
        <c>URI-R</c>     
        <c>URI-R</c>    
        <c>URI-R</c>
        <c>200</c> 
      </texttable>  
      
      <section title="Pattern 1.1 - URI-R=URI-G ; 302-style negotiation ; distinct URI-M for Mementos" anchor="Pattern1.1">
        
          <t>
            In this case, the response to the user agent's request of <xref target="Pattern1-Request1"></xref> has a "302 Found" HTTP status code, 
          and the "Location" header conveys the URI-M of the selected Memento.  As per <xref target="headers-summary"></xref>, 
            the use of Memento response headers and links in the response from URI-R=URI-G is as follows:</t>
          
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST NOT contain a "Memento-Datetime" header.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
          that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
          subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
          </list></t>
        
        <t>The server's response to the request of <xref target="Pattern1-Request1"></xref> is shown in 
          <xref target="Pattern1.1-Response1"></xref>. Note the inclusion of the recommended link 
          to the TimeGate that, in this case, has a Target IRI that is the URI-R of the Original Resource.</t>
           
        <figure align="center" anchor="Pattern1.1-Response1" title="Response from URI-R=URI-G for Pattern 1.1">
          <artwork align="left"><![CDATA[
HTTP/1.1 302 Found
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Vary: accept-datetime
Location: 
 http://a.example.org/?version=20010911203610
Link: <http://a.example.org/>; rel="original timegate"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>
        </figure>
        
        <t>In a subsequent request, shown in <xref target="Pattern1-Request2"></xref>, 
          the user agent can obtain the selected Memento by issuing an HTTP GET request 
        against the URI-M that was provided in the "Location" header. The inclusion of the "Accept-Datetime" 
        header in this request is not needed but will typically occur as the user agent is in 
        datetime negotiation mode.</t>
        
        <figure title="User Agent Requests Selected Memento" align="center" anchor="Pattern1-Request2">       
          <artwork align="left"><![CDATA[
GET /?version=20010911203610 HTTP/1.1
Host: a.example.org
Accept-Datetime: Tue, 11 Sep 2001 20:35:00 GMT
Connection: close
]]></artwork>         
        </figure>
        
        <t>The response has a "200 OK" HTTP status code and the entity-body of the response 
          contains the representation of the selected Memento.
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-M is as follows:</t>
        
        <t><list style="symbols">
          <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
          Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern1-Request2"></xref> is shown in 
          <xref target="Pattern1.1-Response2"></xref>. Note the provision of the required "original", 
          and the recommended "timegate" and "timemap" links. 
          The former two point to the Original Resource, which acts as its own TimeGate. The latter has  
        "from" and "until" attributes to indicate the temporal interval covered by Mementos listed in the 
        linked TimeMap.</t>
        
        <figure title="Response from URI-M for Pattern 1.1" align="center" anchor="Pattern1.1-Response2">   
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:06:51 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original timegate",
 <http://a.example.org/?version=all&style=timemap>
   ; rel="timemap"; type="application/link-format"
   ; from="Tue, 15 Sep 2000 11:28:26 GMT"
   ; until="Wed, 20 Jan 2010 09:34:33 GMT"
Content-Length: 23364
Content-Type: text/html;charset=utf-8
Connection: close
]]></artwork>  
        </figure> 
        
      </section>
      
      <section title="Pattern 1.2 - URI-R=URI-G ; 200-style negotiation ; distinct URI-M for Mementos" anchor="Pattern1.2">
        
        <t>
          In this case, the response to the user agent's request of <xref target="Pattern1-Request1"></xref> 
          has a "200 OK" HTTP status code, 
          and the "Content-Location" header conveys the URI-M of the selected Memento.  
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-R=URI-G is as follows:</t>
        
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
            selected Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern1-Request1"></xref> is shown in 
          <xref target="Pattern1.2-Response1"></xref>. Note the provision of optional "memento" links 
        pointing at the oldest and most recent Memento for the Original Resource known to the 
        responding server.</t>
        
        <figure align="center" anchor="Pattern1.2-Response1" title="Response from URI-R=URI-G for Pattern 1.2">
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Vary: accept-datetime
Content-Location: 
 http://a.example.org/?version=20010911203610
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original timegate",
 <http://a.example.org/?version=20000915112826>
 ; rel="memento first"; datetime="Tue, 15 Sep 2000 11:28:26 GMT",
 <http://a.example.org/?version=20100120093433>
 ; rel="memento last"; datetime="Wed, 20 Jan 2010 09:34:33 GMT"
Content-Length: 2312
Content-Type: text/html; charset=UTF-8
Connection: close
]]></artwork>
        </figure>
        
        <t>In a subsequent request, which is the same as <xref target="Pattern1-Request1"></xref> but with 
          HTTP GET instead of HEAD, the user agent can obtain the representation of the selected Memento. It will 
          be provided as the entity-body of a response that has the same Memento headers as in 
          <xref target="Pattern1.2-Response1"></xref>.</t> 
        
        
      </section>
      
      <section title="Pattern 1.3 - URI-R=URI-G ; 200-style negotiation ; no distinct URI-M for Mementos" anchor="Pattern1.3">
        
        <t>
          In this case, the response to the user agent's request of <xref target="Pattern1-Request1"></xref> 
          has a "200 OK" HTTP status code, and it does not contain a 
          "Content-Location" nor "Location" header as there is no URI-M of the selected Memento to convey.  
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-R=URI-G is as follows:</t>
        
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
            selected Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern1-Request1"></xref> is shown in 
          <xref target="Pattern1.3-Response1"></xref>. The recommended "timemap" and "timegate" links are included 
          in addition to the mandatory "original" link.</t>
        
        <figure align="center" anchor="Pattern1.3-Response1" title="Response from URI-R=URI-G for Pattern 1.3">
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Vary: accept-datetime
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original timegate",
 <http://a.example.org/?version=all&style=timemap>
   ; rel="timemap"; type="application/link-format"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>
        </figure>
        
        <t>In a subsequent request, which is the same as <xref target="Pattern1-Request1"></xref> but with 
          HTTP GET instead of HEAD, the user agent can obtain the representation of the selected Memento. It will 
          be provided as the entity-body of a response that has the same Memento headers as in 
          <xref target="Pattern1.3-Response1"></xref>.</t>        
        
      </section>
      
    </section>
    
    <section title="Pattern 2 - A remote resource acts as a TimeGate for the Original Resource" anchor="Pattern2">
      
      <t>In this implementation pattern, the Original Resource does not act as its own TimeGate, which means that 
        URI-R and URI-G are different. This pattern is typically implemented by servers for which the history of their 
        resources is recorded in remote systems such as web archives and transactional archives <xref target="Fitch"></xref>. 
        But servers that maintain their own history, such as content management systems and Version Control Systems, 
        may also implement this pattern, for 
        example, to distribute the load involved in responding to requests for current and prior representations of resources 
        between different servers.</t>
      
      <t>This pattern is summarized in the below table and is detailed in the remainder of this section. 
        Three cases exist that differ regarding the negotiation style that is used by the remote TimeGate and 
        regarding the existence of a URI-M for Mementos that is distinct from the URI-G of the TimeGate. 
      </t>
         
      <texttable anchor="Pattern2-Table" title="Pattern 2">  
        <ttcol align="center">Pattern</ttcol>    
        <ttcol align="center">Original Resource</ttcol>    
        <ttcol align="center">TimeGate</ttcol>     
        <ttcol align="center">Memento</ttcol>
        <ttcol align="center">Negotiation Style</ttcol>
        <c><xref target="Pattern2.1">Pattern 2.1</xref></c>     
        <c>URI-R</c>     
        <c>URI-G</c>     
        <c>URI-M</c>
        <c>302</c>
        <c><xref target="Pattern2.2">Pattern 2.2</xref></c>     
        <c>URI-R</c>     
        <c>URI-G</c>    
        <c>URI-M</c>
        <c>200</c> 
        <c><xref target="Pattern2.3">Pattern 2.3</xref></c>    
        <c>URI-R</c>     
        <c>URI-G</c>    
        <c>URI-G</c>
        <c>200</c> 
      </texttable>
      
      <t>The response by the Original Resource to the request shown in <xref target="Pattern1-Request1"></xref>
        is the same for all three cases. As per <xref target="headers-summary"></xref>, the use of headers and links 
        in the response from URI-R is as follows:
      </t>
      
      <t><list style="symbols">
        <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
        <t>The response MUST NOT contain a "Memento-Datetime" header.</t>
        <t>The "Link" header SHOULD be provided. 
          It MUST NOT include a link with an "original" Relation Type. 
          It SHOULD include a link with a "timegate" Relation Type that has the URI-G of the TimeGate as Target IRI. 
          It SHOULD include a link with a "timemap" Relation Type that has the URI-T of the TimeGate as Target IRI.
          Multiple "timegate" and "timemap" links can be provided to accommodate situations in which the server is aware of 
          multiple TimeGates or Timemaps for the Original Resource.</t> 
      </list></t>
      
      <t><xref target="Pattern2-Response1"></xref> shows such a response. Note the absence of an 
      "original" link as the responding resource is neither a TimeGate or a Memento.</t>
      
      <figure title="Response from URI-R&lt;&gt;URI-G for Pattern 2" align="center" anchor="Pattern2-Response1">  
        <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:02:12 GMT
Server: Apache
Link: <http://arxiv.example.net/timegate/http://a.example.org/>
   ; rel="timegate"
Content-Length: 255
Connection: close
Content-Type: text/html; charset=iso-8859-1
]]></artwork>
      </figure>
      
      <t>Once a user agent has obtained the URI-G of a remote TimeGate for the Original Resource 
        it can engage in datetime negotation with that TimeGate. <xref target="Pattern2-Request2"></xref>
        shows the request issued against the TimeGate whereas <xref target="Pattern2.1"></xref> through 
        <xref target="Pattern2.3"></xref> 
        detail the responses for various TimeGate implementation patterns.  
      </t>
      
      <figure title="User Agent Engages in Datetime Negotiation With Remote TimeGate" align="center" anchor="Pattern2-Request2">        
        <artwork align="left"><![CDATA[
HEAD /timegate/http://a.example.org/ HTTP/1.1
Host: arxiv.example.net
Accept-Datetime: Tue, 11 Sep 2001 20:35:00 GMT
Connection: close
]]></artwork>       
      </figure> 
      
      <section title="Pattern 2.1 - URI-R&lt;&gt;URI-G ; 302-style negotiation ; distinct URI-M for Mementos" anchor="Pattern2.1">
        
        <t>
          In case the TimeGate uses a 302 negotiation style, the response to the user agent's request of 
          <xref target="Pattern2-Request2"></xref> has a "302 Found" HTTP status code, 
          and the "Location" header conveys the URI-M of the selected Memento.  As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-G is as follows:</t>
        
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST NOT contain a "Memento-Datetime" header.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern2-Request2"></xref> is shown in 
          <xref target="Pattern2.1-Response1"></xref>. It contains the mandatory "original" link that 
        points back to the Original Resource associated with this TimeGate and it shows the 
        recommended "timemap" link that includes "from" and "until" attributes.</t>
        
        <figure title="Response from URI-G&lt;&gt;URI-R for Pattern 2.1" align="center" anchor="Pattern2.1-Response1">  
          <artwork align="left"><![CDATA[
HTTP/1.1 302 Found
Date: Thu, 21 Jan 2010 00:02:14 GMT
Server: Apache
Vary: accept-datetime
Location: 
 http://arxiv.example.net/web/20010911203610/http://a.example.org/
Link: <http://a.example.org/>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org/>
   ; rel="timemap"; type="application/link-format"
   ; from="Tue, 15 Sep 2000 11:28:26 GMT"
   ; until="Wed, 20 Jan 2010 09:34:33 GMT"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>
        </figure>  

        <t>In a subsequent HTTP GET request, shown in <xref target="Pattern2.1-Request2"></xref>, 
          the user agent can obtain the selected Memento by issuing an HTTP GET request 
          against the URI-M that was provided in the "Location" header. The inclusion of the "Accept-Datetime" 
          header in this request is not needed but will typically occur as the user agent is in 
          datetime negotiation mode.</t>
        
        <figure title="User Agent Requests Selected Memento" align="center" anchor="Pattern2.1-Request2">       
          <artwork align="left"><![CDATA[
GET /web/20010911203610/http://a.example.org/ HTTP/1.1
Host: arxiv.example.net/
Accept-Datetime: Tue, 11 Sep 2001 20:35:00 GMT
Connection: close
]]></artwork>         
        </figure>
        
        <t>The response has a "200 OK" HTTP status code. 
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-M is as follows:</t>
        
        <t><list style="symbols">
          <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
            Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern2.1-Request2"></xref> is shown in 
          <xref target="Pattern2.1-Response2"></xref>. Note the provision of the recommended "timegate" and "timemap" links. 
          </t>
        
        <figure title="Response from URI-M for Pattern 2.1" align="center" anchor="Pattern2.1-Response2">   
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:02:15 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org/>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org/>
   ; rel="timegate"
Content-Length: 23364
Content-Type: text/html;charset=utf-8
Connection: close
]]></artwork>  
        </figure> 
        
      </section>
      
      <section title="Pattern 2.2 - URI-R&lt;&gt;URI-G ; 200-style negotiation ; distinct URI-M for Mementos" anchor="Pattern2.2">
        
        <t>
          In case the TimeGate uses a 200 negotiation style, and each Memento has a distinct URI-M, 
          the response to the user agent's request of 
          <xref target="Pattern2-Request2"></xref> has a "200 OK" HTTP status code, 
          and the "Content-Location" header conveys the URI-M of the selected Memento.  
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-G is as follows:</t>
        
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
            Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern2-Request2"></xref> is shown in 
          <xref target="Pattern2.2-Response1"></xref>.</t>
        
        <figure title="Response from URI-G&lt;&gt;URI-R for Pattern 2.2" align="center" anchor="Pattern2.2-Response1">   
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Vary: accept-datetime
Content-Location: 
 http://arxiv.example.net/web/20010911203610/http://a.example.org/
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org/>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org/>
   ; rel="timegate"
Content-Length: 23364
Content-Type: text/html; charset=UTF-8
Connection: close
]]></artwork>  
        </figure> 
        
        <t>In a subsequent request, which is the same as <xref target="Pattern2-Request2"></xref> but with 
          HTTP GET instead of HEAD, the user agent can obtain the representation of the selected Memento. It will 
          be provided as the entity-body of a response that has the same Memento headers as 
          <xref target="Pattern2.2-Response1"></xref>.</t> 
        
      </section>
      
      <section title="Pattern 2.3 - URI-R&lt;&gt;URI-G ; 200-style negotiation ; no distinct URI-M for Mementos" anchor="Pattern2.3">
        
        <t>
          In case the TimeGate uses a 200 negotiation style, but Mementos have no distinct URIs, 
          the response to the user agent's request of 
          <xref target="Pattern2-Request2"></xref> has a "200 OK" HTTP status code, 
          and it does not contain a "Content-Location" nor "Location" header as there is no URI-M of the selected Memento to convey.
          As per <xref target="headers-summary"></xref>, 
          the use of Memento response headers and links in the response from URI-G is as follows:</t>
        
        <t><list style="symbols">
          <t>The "Vary" header MUST be provided and it MUST include the "accept-datetime" value.</t>
          <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the 
            Memento.</t>
          <t>The "Link" header MUST be provided and it MUST contain at least a link with the "original" Relation Type 
            that has the URI-R of the Original Resource as Target IRI. The provision of other links is encouraged and is 
            subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
        </list></t>
        
        <t>The server's response to the request of <xref target="Pattern2-Request2"></xref> is shown in 
          <xref target="Pattern2.3-Response1"></xref>.</t>
        
        <figure title="Response from URI-G&lt;&gt;URI-R for Pattern 2.3" align="center" anchor="Pattern2.3-Response1">   
          <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Vary: accept-datetime
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org/>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org/>
   ; rel="timegate"
Content-Length: 23364
Content-Type: text/html; charset=UTF-8
Connection: close
]]></artwork>  
        </figure> 
        
        <t>In a subsequent request, which is the same as <xref target="Pattern2-Request2"></xref> but with 
          HTTP GET instead of HEAD, the user agent can obtain the representation of the selected Memento. It will 
          be provided as the entity-body of a response that has the same Memento headers as 
          <xref target="Pattern2.3-Response1"></xref>.</t> 
        
      </section>
      
    </section>
    
    <section title="Pattern 3 - The Original Resource is a Fixed Resource" anchor="Pattern3">
      
      <t>This pattern does not involve datetime negotiation with a TimeGate but it can be implemented 
      for Original Resources that never change state or do not change anymore past a certain point in their existence, 
      meaning that URI-R and URI-M coincide either from the outset or starting at some point in time. This pattern
      is summarized in the below table. 
      Examples are tweets or stable media resources on news sites.</t>
      
      <texttable anchor="Pattern3-Table" title="Pattern 3">  
        <ttcol align="center">Pattern</ttcol>    
        <ttcol align="center">Original Resource</ttcol>    
        <ttcol align="center">TimeGate</ttcol>     
        <ttcol align="center">Memento</ttcol>
        <ttcol align="center">Negotiation Style</ttcol>
        <c>Pattern 3</c>     
        <c>URI-R</c>     
        <c>-</c>    
        <c>URI-R</c>
        <c>-</c>
      </texttable>
      
      <t>
        Servers that host such resources can support the Memento framework by treating the stable resource 
        (FixedResource as per <xref target="W3C.gen-ont-20090420"></xref>) as a Memento.        
        As per <xref target="headers-summary"></xref>, 
        the use of Memento response headers and links in responses from such a stable resource is as follows:
      </t>
      
      <t><list style="symbols">
        <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
        <t>The response MUST include a "Memento-Datetime" header. Its value expresses the datetime at which the resource 
          became stable. Providing this value includes a promise that the resource has not changed since this datetime 
        and will not change anymore beyond it.</t>
        <t>The "Link" header MUST be provided and MUST have a link with the "original" Relation Type 
          that has the URI-R of the stable resource itself as Target IRI.</t> 
      </list></t>
      
      <t><xref target="Pattern3-Response1"></xref> shows a response to an HTTP HEAD request 
        for the resource with URI-R http://a.example.org/ that has been stable since March 20th 2009.
      </t>
      
      <figure title="Response from URI-R=URI-M for Pattern 3" align="center" anchor="Pattern3-Response1">   
        <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Fri, 20 Mar 2009 11:00:00 GMT
Link: <http://a.example.org/>; rel="original"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>  
      </figure> 
         
    </section>
    
    <section title="Pattern 4 - Mementos without a TimeGate" anchor="Pattern4">
      
      <t>
        Cases may occur in which a server hosts Mementos but does not expose a TimeGate for them. 
        This can, for example, be the case if the server's Mementos result from taking a 
        snapshot of the state of a set of Original Resources from another server as it is being retired. 
        As a result, only a single Memento per Original Resource is hosted, making the introduction of a TimeGate 
        unnecessary. But it may also be the case for servers that host multiple Mementos for an Original Resource but consider 
        exposing TimeGates too expensive. In this case, URI-R and URI-M are distinct, but a TimeGate is absent. This case is 
        summarized in the below table.
      </t>
      
      <texttable anchor="Pattern4-Table" title="Pattern 4">  
        <ttcol align="center">Pattern</ttcol>    
        <ttcol align="center">Original Resource</ttcol>    
        <ttcol align="center">TimeGate</ttcol>     
        <ttcol align="center">Memento</ttcol>
        <ttcol align="center">Negotiation Style</ttcol>
        <c>Pattern 4</c>     
        <c>URI-R</c>     
        <c>-</c>    
        <c>URI-M</c>
        <c>-</c>
      </texttable>
      
      <t>Servers that host such Mementos without TimeGates can still support the Memento framework by providing the 
        appropriate Memento headers and links. As per <xref target="headers-summary"></xref>, 
        these are as follows for a response from URI-M:
      </t>
      
      <t><list style="symbols">
        <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
        <t>The response MUST include a "Memento-Datetime" header. Its value expresses the archival datetime of the Memento.</t>
        <t>The "Link" header MUST be provided and it MUST have a link with the "original" Relation Type 
          that has the URI-R of the associated Original Resource as Target IRI.
          The provision of other links is encouraged and is 
          subject to the considerations described in <xref target="Link-Header-Relation-Types"></xref>.</t> 
      </list></t>

      <t><xref target="Pattern4-Response1"></xref> shows a response to an HTTP HEAD request 
        for the Memento with URI-M http://arxiv.example.net/web/20010911203610/http://a.example.org/. 
        Note the use of links: three links have the URI-M of the Memento as Target IRI and have 
        respective Relation Types "memento", "first", and "last". This combination indicates that this is the only Memento 
        for the Original Resource with Target IRI provided by the "original" link 
        (http://a.example.org/) that the server is aware of. Note also that such a response 
        does not imply that there is no server whatsoever that exposes a TimeGate; it merely means that the responding 
        server neither provides nor is aware of the location of a TimeGate.
      </t>
      
      
      <figure title="Response from URI-M&lt;&gt;URI-R for Pattern 4" align="center" anchor="Pattern4-Response1">   
        <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Tue, 11 Sep 2001 20:36:10 GMT
Link: <http://a.example.org/>; rel="original",
 <http://arxiv.example.net/web/20010911203610/http://a.example.org/>
   ; rel="first last memento"
   ; datetime="Tue, 11 Sep 2001 20:36:10 GMT"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>  
      </figure> 

      

      
      </section>
    
    
    
 
    
    <section anchor="SpecialCases" title="Special Cases">
      
      <section anchor="SpecialCases-OR-nolink" title="Original Resource provides no &quot;timegate&quot; link">
      
      <t>
        Cases exist in which the 
        response from the Original Resource does not contain a "timegate" link, including:</t>
      
      <t><list style="symbols">
        <t>The Original Resource's server does not support the Memento framework;</t>
        <t>The Original Resource no longer exists and the responding server is not aware of its prior existence;</t>
        <t>The server that hosted the Original Resource no longer exists.</t>       
      </list></t>
      
      <t>In all these cases, the user agent SHOULD attempt to determine an appropriate TimeGate for the Original Resource, 
        either automatically or interactively supported by the user.</t>
      
      </section>
      
      <section title="Server exists but Original Resource no longer does" anchor="SpecialCases-OR">
        
        <t>
          If possible, a server SHOULD also provide a "timegate" link in responses
          to requests for an Original Resource that the server knows used to exist, but no longer 
          provides a current representation.
          This may allow access to Mementos for the Original Resource even if it no longer exists. 
          A server's response to a request for the discontinued resource http://a.example.org/pic
          is illustrated in <xref target="SpecialCases-OR-404"></xref>.
        </t>
        
        <figure align="center" anchor="SpecialCases-OR-404" title="Response from an Original Resource that not longer exists">
          <artwork align="left"><![CDATA[
HTTP/1.1 404 Not Found
Date: Thu, 21 Jan 2010 00:02:12 GMT
Server: Apache
Link: 
 <http://arxiv.example.net/timegate/http://a.example.org/pic> 
  ; rel="timegate"
Content-Length: 255
Connection: close
Content-Type: text/html; charset=iso-8909-1

]]></artwork>
        </figure>
        
      </section>
      
      <section title="Issues with Accept-Datetime" anchor="SpecialCases-AD">
        
        <t>The following special cases may occur regarding the "Accept-Datetime" header when a user agent issues a request 
        against a TimeGate:</t>
        
        <t><list style="symbols">
          <t>If the value of the "Accept-Datetime" is either earlier than the datetime 
            of the first Memento or later than the datetime of the most recent Memento known to the TimeGate, 
            the first or most recent Memento SHOULD be selected, respectively.</t>    
          <t>
            If the value of the "Accept-Datetime" does 
            not conform to the rfc1123-date construction rule of the BNF in <xref target="datetime-BNF"></xref>, 
            the response MUST have a "400 Bad Request" HTTP status code. The use of Memento headers is as per 
            <xref target="headers-summary"></xref>.
          </t> 
          <t>
            If a user agent issues a request against a TimeGate and fails to include an "Accept-Datetime" request header, 
            the most recent Memento SHOULD be selected.
          </t>       
        </list></t>
            
      </section>
      
      

      

      
      <section anchor="SpecialCase-M-3XX" title="Memento of a 3XX response">
        
        <t>Cases exist in which HTTP responses with 3XX status codes are archived. 
          For example, crawl-based web archives commonly archive responses with 
          HTTP status codes "301 Moved Permanently" and "302 Found" whereas Linked Data 
          archives hold on to "303 See Other" responses.</t>
        
        <t>If the Memento requested by the user agent is an archived version of an 
          HTTP response with a 3XX status code, the server's response MUST 
          have the same 3XX HTTP status code. The use of other Memento headers is as described in 
          the Memento column of <xref target="headers-summary"></xref>.</t>
        
        <t>The user agent's handling of an HTTP response with a 3XX status code is not 
          affected by the presence of a "Memento-Datetime" header.  The
          user agent SHOULD behave in the same manner as it does with HTTP responses with a 3XX 
          status code that do not have a "Memento-Datetime" header.</t>
        
        <t>However, the user agent MUST be aware that the URI that was selected 
          from the "Location" header of an HTTP response with a 3XX status code might not be that of a Memento 
          but rather of an Original Resource. In the latter case it SHOULD proceed by looking for a Memento of the 
          selected Original Resource.</t>
        
        <t>For example, <xref target="SpecialCase-M-3XX-Response1"></xref> shows the 
          response to an HTTP GET request for http://a.example.org issued on April 11 2008. This 
          response is archived as a Memento of http://a.example.org that has as URI-M 
          http://arxiv.example.net/web/20080411000650/http://a.example.org.
          The response to an HTTP GET on this URI-M is shown in <xref target="SpecialCase-M-3XX-Response2"></xref>.
          It is a replay of the original response with "Memento-Datetime" and 
          "Link" headers added, to allow a user agent to understand the response is a Memento. 
          In <xref target="SpecialCase-M-3XX-Response2"></xref>, the value of the "Location" 
          header is the same as in the original response; it identifies an Original Resource. 
          The user agent proceeds with finding a Memento for this Original Resource.
          Web archives sometimes overwrite the value that was originally provided in the 
          "Location" header in order to point at a Memento they hold 
          of the resource to which the redirect originally led. 
          This is shown in <xref target="SpecialCase-M-3XX-Response3"></xref>.
          In this case, the user agent may decide it found an appropriate Memento.
        </t>
        
        <figure title="Response is a redirect" align="center" anchor="SpecialCase-M-3XX-Response1">       
          <artwork align="left"><![CDATA[
HTTP/1.1 301 Moved Permanently
Date: Fri, 11 Apr 2008 00:06:50 GMT
Server: Apache
Location: http://b.example.org
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>         
        </figure>
        
        <figure title="Response is a Memento of a redirect; leads to an Original Resource" 
          align="center" anchor="SpecialCase-M-3XX-Response2">       
          <artwork align="left"><![CDATA[
HTTP/1.1 301 Moved Permanently
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Fri, 11 Apr 2008 00:06:50 GMT
Location: http://b.example.org
Link: <http://a.example.org>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>         
        </figure>
        
        <figure title="Response is a Memento of a redirect; leads to a Memento" 
          align="center" anchor="SpecialCase-M-3XX-Response3">       
          <artwork align="left"><![CDATA[
HTTP/1.1 301 Moved Permanently
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Fri, 11 Apr 2008 00:06:50 GMT
Location: 
 http://arxiv.example.net/web/20080411000655/http://b.example.org
Link: <http://a.example.org>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>         
        </figure>
        
      </section>
      
      <section anchor="SpecialCases-M-4XX" title="Memento of responses with 4XX or 5XX HTTP status codes">
        
        <t>Cases exist in which responses with 4XX and 5XX HTTP status codes are archived.
          If the Memento requested by the user agent is an archived version of such an 
          HTTP response, the server's response MUST 
          have the same 4XX or 5XX HTTP status code. The use of other Memento headers is as described in 
          the Memento column of <xref target="headers-summary"></xref>.</t>
        
        <t>For example, <xref target="SpecialCases-M-4XX-Response1"></xref>
          shows the 404 response to an HTTP GET request for http://a.example.org issued on April 11 2008. This 
          response is archived as a Memento of http://a.example.org, 
          that has as URI-M http://arxiv.example.net/web/20080411000650/http://a.example.org.
          The response to an HTTP HEAD on this URI-M is shown in <xref target="SpecialCases-M-4XX-Response2"></xref>.
          It is a replay of the original response with "Memento-Datetime" and 
          "Link" headers added, to allow a user agent to understand the response is a Memento.</t>
        
        <figure title="Response is a 404" align="center" anchor="SpecialCases-M-4XX-Response1">       
          <artwork align="left"><![CDATA[
HTTP/1.1 404 Not Found
Date: Fri, 11 Apr 2008 00:06:50 GMT
Server: Apache
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>         
        </figure>
        
        <figure title="Response is a Memento of a 404" 
          align="center" anchor="SpecialCases-M-4XX-Response2">       
          <artwork align="left"><![CDATA[
HTTP/1.1 404 Not Found
Date: Thu, 21 Jan 2010 00:09:40 GMT
Server: Apache-Coyote/1.1
Memento-Datetime: Fri, 11 Apr 2008 00:06:50 GMT
Link: <http://a.example.org>; rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org>
   ; rel="timemap"; type="application/link-format", 
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>         
        </figure>
        
      </section>    
      
      <section anchor="SpecialCases-Sticky" title="Sticky &quot;Memento-Datetime&quot; value for Mementos">
     
          
          <t>The provision of a "Memento-Datetime" in a response entails a promise that the response is frozen in time.          
            As a consequence, the "Memento-Datetime" header associated with a Memento MUST be "sticky" in the following ways:</t>  
          
          <t><list style="symbols">
          
          <t>The server that originally assigns the "Memento-Datetime" header and value 
          to a specific response MUST retain that header in all future responses to HTTP requests (with or without "Accept-Datetime" header) 
          that occur against the Memento after 
          the time of the original assignment of the header, and it MUST NOT change its associated value.</t>   
          <t>Applications that mirror Mementos at a different URI MUST retain the "Memento-Datetime" header and 
            MUST NOT change its value
          unless mirroring involves a meaningful state change.
          This allows, for example, duplicating a web archive at a new location while preserving the 
          value of the "Memento-Datetime" header of the archived resources. In this example, the "Last-Modified" header 
          will be updated to reflect the time of mirroring at the new URI, whereas the value for "Memento-Datetime" 
          will be maintained.</t>      
          
          </list></t>

        </section>
      
      <section title="Intermediate Resources" anchor="SpecialCases-Intermediate">
        <t>
          An intermediate resource is a resource that issues a redirect to a
          TimeGate, to a Memento, or to another intermediate resource, and thus
          plays an active role in the Memento infrastructure. Intermediate resources commonly exist in 
          web archives on the path from a TimeGate to an appropriate Memento. 
        </t>
        
        <t>A response of an intermediate resource has an HTTP status code indicative of HTTP redirection (e.g. 302) 
          and uses Memento headers and links that allow to recognize that the resource plays a role in the Memento framework:</t>
        
        <t><list style="symbols">
          <t>A "Vary" header that includes an "accept-datetime" value MUST NOT be provided.</t>
          <t>The response MUST NOT include a "Memento-Datetime" header.</t>
          <t>The "Link" header MUST be provided and it MUST have a link with the "original" Relation Type 
            that has the URI-R of the associated Original Resource as Target IRI.
            Links with "timegate", "timemap", and "memento" Relation Types are OPTIONAL and, if provided, 
            MUST pertain to the Original Resource for which the user agent is trying to obtain a Memento.</t> 
        </list></t>
        
        <t>
          A user agent SHOULD follow a redirection provided by an intermediate resource; multiple 
          such redirections can be chained. 
        </t>
        
        <t>Consider the case where a user agent follows the "timegate" link provided in <xref target="Pattern2-Response1"></xref> 
          and engages in datetime negotiation with the assumed TimeGate in the manner shown in 
          <xref target="Pattern2-Request2"></xref>. But instead of receiving a response as shown in 
          <xref target="Pattern2.1-Response1"></xref>, it receives the one shown below in <xref target="Pattern5-Response1"></xref>. 
          Such a response is umabiguosuly recognizable as coming from an intermediate resource. 
        </t>   
        
        <figure title="Redirecting Resource redirects to a TimeGate" align="center" anchor="Pattern5-Response1">  
          <artwork align="left"><![CDATA[
HTTP/1.1 302 Found
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Location: 
 http://arxiv.example.net/new-timegate/http://a.example.org/
Link: <http://a.example.org>; rel="original"
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Connection: close
]]></artwork>
        </figure> 
        
      </section>
    
    </section>
    
    
  </section>
  
  <section title="TimeMaps" anchor="Pattern6">
    
    <t>A TimeMap is introduced to support retrieving a comprehensive list of all Mementos for a specific Original Resource 
      known to a  server. 
      The entity-body of a response to an HTTP GET request issued against a TimeMap's URI-T:</t>
    
    <t><list style="symbols">
      <t>MUST list the URI-R of the Original Resource that the TimeMap is about;</t>
      <t>MUST list the URI-M and archival datetime of each Memento for the Original Resource known to the server, 
        preferably in a single document, 
        or, alternatively in multiple documents that can be gathered by following 
        contained links with a "timemap" Relation Type;
      </t>   
      <t>SHOULD list the URI-G of one or more TimeGates for the Original Resource known to the responding server;</t>
      <t>SHOULD, for self-containment, list the URI-T of the TimeMap itself;</t>
      <t>MUST unambiguously type listed resources as being Original Resource, TimeGate, Memento, or TimeMap.</t>
    </list></t>
    
    <t>
      The entity-body of a response from a TimeMap MAY be serialized in various ways, 
      but the link-value format serialization described here MUST be supported. 
      In this serialization, the entity-body MUST be formatted in the same way as 
      the value of an HTTP "Link" header, and hence MUST comply to the "link-value" 
      construction rule of "Section 5. The Link Header Field" of <xref target="RFC5988"></xref>, and the media type 
      of the entity-body MUST be "application/link-format" as introduced in 
      <xref target="RFC6690"></xref>. Links contained in the entity-body MUST be interpreted as follows:</t>
    
    <t><list style="symbols">
      <t>The Context IRI is set to the anchor parameter, when specified;</t> 
      <t>The Context IRI of links with the "self" Relation Types is the URI-T of the TimeMap, i.e. the URI of the resource from which the TimeMap was requested;</t>
      <t>The Context IRI of all other links is the URI-R of the Original Resource, 
        which is provided as the Target IRI of the link with an "original" Relation Type.</t>
    </list></t>
    
    
    <t>
      In order to retrieve the link-value serialization of a TimeMap, a user agent SHOULD use an 
      "Accept" request header with a value set to "application/link-format". 
      This is shown in <xref target="Pattern6-Request1"></xref>.
    </t>
    
    <figure align="center" anchor="Pattern6-Request1" title="Request for a TimeMap">  
      <artwork align="left"><![CDATA[
GET /timemap/http://a.example.org/ HTTP/1.1
Host: arxiv.example.net
Accept: application/link-format;q=1.0
Connection: close
]]></artwork> 
    </figure>
    
    <t>If the TimeMap requested by the user agent exists, the server's response has a "200 OK" HTTP status code 
      and the list of Mementos is provided in the entity-body of the response. Such a response is shown in 
      <xref target="Pattern6-Response1"></xref>
    </t> 
    
    <figure align="center" anchor="Pattern6-Response1" title="Response from a TimeMap">   
      <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Content-Length: 4883
Content-Type: application/link-format
Connection: close

 <http://a.example.org>;rel="original",
 <http://arxiv.example.net/timemap/http://a.example.org>
   ; rel="self";type="application/link-format"
   ; from="Tue, 20 Jun 2000 18:02:59 GMT"
   ; until="Wed, 09 Apr 2008 20:30:51 GMT",
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate",
 <http://arxiv.example.net/web/20000620180259/http://a.example.org>
   ; rel="first memento";datetime="Tue, 20 Jun 2000 18:02:59 GMT"
   ; license="http://creativecommons.org/publicdomain/zero/1.0/", 
 <http://arxiv.example.net/web/20091027204954/http://a.example.org>
    ; rel="last memento";datetime="Tue, 27 Oct 2009 20:49:54 GMT"
    ; license="http://creativecommons.org/publicdomain/zero/1.0/",
 <http://arxiv.example.net/web/20000621011731/http://a.example.org>
   ; rel="memento";datetime="Wed, 21 Jun 2000 01:17:31 GMT"
   ; license="http://creativecommons.org/publicdomain/zero/1.0/",
 <http://arxiv.example.net/web/20000621044156/http://a.example.org>
   ; rel="memento";datetime="Wed, 21 Jun 2000 04:41:56 GMT"
   ; license="http://creativecommons.org/publicdomain/zero/1.0/",
 ...
]]></artwork>   
    </figure>  
    
    <section title="Index and Paging TimeMaps" anchor="Pattern6-IP">
    
    <t>Cases exist in which a TimeMap points at one or more other TimeMaps:</t>
    
    <t><list style="symbols">
      <t>Index Timemap - A TimeMap can merely point at other TimeMaps and not list any Mementos itself. 
        This can happen when Mementos are spread across several archives that share a front-end.
        An example is shown in <xref target="TimeMap-index"></xref>.</t>
      <t>Paging Timemap - The number of 
        available Mementos can require introducing multiple TimeMaps that can be paged. An example 
        is shown in <xref target="TimeMap-paging"></xref>.
        Note that a Paging TimeMap contains links to other TimeMaps but actually also lists Mementos.</t>     
    </list></t>
    
    <t>In both cases, including the "from" and "until" attributes for "timemap" links is RECOMMENDED as a means 
      to express the temporal span of Mementos listed in each TimeMap. Note that TimeMaps obtained by following a 
      "timemap" link can contain links to further TimeMaps.</t>
    
    <figure align="center" anchor="TimeMap-index" title="Index TimeMap">   
      <artwork align="left"><![CDATA[
<http://a.example.org>;rel="original",
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate",
 <http://arxiv.example.net/timemap/http://a.example.org>
   ; rel="self";type="application/link-format",
 <http://arxiv1.example.net/timemap/http://a.example.org>
   ; rel="timemap";type="application/link-format"
   ; from="Wed, 21 Jun 2000 04:41:56 GMT"
   ; until="Wed, 09 Apr 2008 20:30:51 GMT",
 <http://arxiv2.example.net/timemap/http://a.example.org>
   ; rel="timemap";type="application/link-format"
   ; from="Thu, 10 Apr 2008 20:30:51 GMT"
   ; until="Tue, 27 Oct 2009 20:49:54 GMT",
 <http://arxiv3.example.net/timemap/http://a.example.org>
   ; rel="timemap";type="application/link-format"
   ; from="Thu, 29 Oct 2009 20:30:51 GMT"
]]></artwork>   
    </figure>
    
    <figure align="center" anchor="TimeMap-paging" title="Paging TimeMap">   
      <artwork align="left"><![CDATA[
<http://a.example.org>;rel="original",
 <http://arxiv.example.net/timegate/http://a.example.org>
   ; rel="timegate",
 <http://arxiv.example.net/timemap/1/http://a.example.org>
   ; rel="self";type="application/link-format"
   ; from="Tue, 20 Jun 2000 18:02:59 GMT"
   ; until="Wed, 09 Apr 2008 20:30:51 GMT",
 <http://arxiv.example.net/timemap/2/http://a.example.org>
   ; rel="timemap";type="application/link-format"
   ; from="Thu, 10 Apr 2008 20:30:51 GMT"
   ; until="Tue, 27 Oct 2009 20:49:54 GMT",
 <http://arxiv.example.net/timemap/3/http://a.example.org>
   ; rel="timemap";type="application/link-format"
   ; from="Thu, 29 Oct 2009 20:30:51 GMT"
   ; until="Fri, 31 Aug 2012 12:22:34 GMT"
 <http://arxiv.example.net/web/20000620180259/http://a.example.org>
   ; rel="memento";datetime="Tue, 20 Jun 2000 18:02:59 GMT", 
 <http://arxiv.example.net/web/20000621011731/http://a.example.org>
   ; rel="memento";datetime="Wed, 21 Jun 2000 01:17:31 GMT",
 <http://arxiv.example.net/web/20000621044156/http://a.example.org>
   ; rel="memento";datetime="Wed, 21 Jun 2000 04:41:56 GMT",
 ...
]]></artwork>   
    </figure>
    
    </section>
    
    <section anchor="Special-TM" title="Mementos for TimeMaps">
      
      <t>A TimeMap can itself act as an Original Resource for which a TimeGate and Mementos may exist. Hence, 
        as per <xref target="headers-summary"></xref>, the response from a TimeMap
        could include a "timegate" link to a TimeGate via which prior TimeMap versions are available. And, in cases where 
        URI-T=URI-R=URI-G (a TimeMap is an Original Resource that acts as its own TimeGate), an "original" link 
        pointing at the TimeMap URI-T would be included.</t>
      
      <t>Therefore, caution is required in cases where a TimeMap for an Original Resource wants to explicitly 
        express in a Link header for which Original Resource it is a TimeMap. It can do so by 
        including a "timemap" link that has the URI-R of the Original Resource as Context IRI and the URI-T of the TimeMap as 
        Target IRI. </t>
      
      <t>
        <xref target="SpecialCases-TM-Response1"></xref> shows the response to an HTTP HEAD 
        request against a TimeMap that has http://arxiv.example.net/timemap/http://a.example.org as URI-T. 
        This TimeMap provides information about Mementos for the Original Resource 
        that has http://a.example.org as URI-R. 
        The response includes an "original" link pointing to the Original 
        Resource that this TimeMap is about. Note the use of the "anchor" attribute in this link to convey 
        the URI-R of that Original Resource.
      </t>
      
      <figure align="center" anchor="SpecialCases-TM-Response1" title="TimeMap links to the Original Resource it is about">   
        <artwork align="left"><![CDATA[
HTTP/1.1 200 OK
Date: Thu, 21 Jan 2010 00:06:50 GMT
Server: Apache
Link: <http://arxiv.example.net/timemap/http://a.example.org> 
          ; anchor="http://a.example.org"; rel="timemap"
          ; type="application/link-format"
Content-Length: 0
Content-Type: application/link-format; charset=UTF-8
Connection: close
]]></artwork>   
      </figure>  
      
    </section>     
    
  </section>
  
  <section anchor="IANA" title="IANA Considerations">
    
    <t>
      This memo requires IANA to register the Accept-Datetime and Memento-Datetime HTTP headers defined in 
      <xref target="Accept-Memento-Datetime"></xref> in the appropriate IANA registry.
    </t>
    
    <t>
      This memo requires IANA to register the Relation Types &quot;original&quot;, &quot;timegate&quot;,  
      &quot;timemap&quot;, and &quot;memento&quot; defined in 
      <xref target="Link-Header-Relation-Types"></xref> in the appropriate IANA registry.
    </t>
    
    <t>
      This memo requires IANA to register the "datetime" and "license" attributes for the &quot;memento&quot; Relation Type, 
      as defined in <xref target="memento-rel"></xref>, in the appropriate IANA registry.
    </t>
    
    <t>
      This memo requires IANA to register the "from" and "until" attributes for the &quot;timemap&quot; Relation Type, 
      as defined in <xref target="memento-rel"></xref>, in the appropriate IANA registry.
    </t>
    
  </section>



    <!-- Possibly a 'Contributors' section ... -->







    <section anchor="Security" title="Security Considerations">

<!-- 
      See RFC 3552 for a guide.
-->
      
      <t>Provision of a "timegate" HTTP "Link" header in responses to requests
        for an Original Resource that is protected (e.g., 401 or 403 HTTP
        response codes) is OPTIONAL. The inclusion of this Link when
        requesting authentication is at the server's discretion; cases may
        exist in which a server protects the current state of a resource,
        but supports open access to prior states and thus chooses to
        supply a "timegate" HTTP "Link" header.  Conversely, the server may
        choose to not advertise the TimeGate URIs (e.g., they exist in an
        intranet archive) for unauthenticated requests.</t>
      
      <t>The veracity of archives and the relationships between Original Resources and Mementos is beyond the scope of this document.  
        Even in the absence of malice, it is possible for separate archives to have different Mementos for the same Original Resource 
        at the same datetime if the state of the Original Resource was dependent on the requesting archive's user agent IP address, 
        specific HTTP request headers, and possibly other factors.</t>
        
        <t>Further authentication, encryption and other security related issues are
        otherwise orthogonal to Memento.</t>
      
    </section>
  
  <section title="Changelog">
    
    <t>v06 2013-02-14  HVDS MLN RS  draft-vandesompel-memento-06</t>
    <t><list style="symbols">
      <t>Major overhaul of the presentation of the specification.</t>
      <t>Specification of patterns whereby URI-R=URI-G and with both 200 and 302 negotation style.</t>
      <t>Removal of Discovery section to increase focus on datetime negotation aspects.</t>
    </list></t>
    
    <t>v05 2012-09-01  HVDS MLN RS  draft-vandesompel-memento-05</t>
    <t><list style="symbols">
      <t>Clarified the section on Memento Relation Types.</t>
      <t>Re-introduced "license" attribute for "memento" Relation Type as it will become essential for IIPC.</t>
      <t>Introduced from and until attributes for "timemap" links to accomodate paged TimeMap cases.</t>
      <t>Introduced the notion of Redirecting Resource and inserted related information in various sections.</t>
      <t>Added discovery of Mementos via host-meta.</t>
      <t>Corrected ambiguous uses of the term "representation".</t>
    </list></t>
    
    <t>v04 2012-05-18  HVDS MLN RS  draft-vandesompel-memento-04</t>
    <t><list style="symbols">
      <t>Removed the possibility to use an interval indicator in an Accept-Datetime header as no one is implementing it.</t>
      <t>Corrected typo in Other Relation Types table.</t>
      <t>Added TimeMap examples to illustrate index of TimeMaps and TimeMap paging.</t>
      <t>Changed Discovery component from using robots.txt with Memento-specific add-ons to well-known URI and host-meta.</t>
      <t>Removed "embargo" and "license" attributes for links with a "memento" Relation Type because no one is using them.</t>
    </list></t>
    
    
    <t>v04 2011-12-20  HVDS MLN RS  draft-vandesompel-memento-03</t>
    <t><list style="symbols">
      <t>Added description of Mementos of HTTP responses with 3XX, 4XX and 5XX 
      status code.</t>
      <t>Clarified that a TimeGate must not use the "Memento-Datetime" header.</t>
      <t>Added wording to warn for possible cache problems with Memento
      implementations that choose to have an Original Resource and and its TimeGate 
      coincide.</t>
      </list></t>
    
    <t>v03 2011-05-11  HVDS MLN RS  draft-vandesompel-memento-02</t>
    <t><list style="symbols">
      <t>Added scenario in which a TimeGate redirects to another TimeGate.</t>
      <t>Reorganized TimeGate section to better reflect the difference between requests with and without 
      interval indicator.</t>
      <t>Added recommendation to provide "memento" links to Mementos in the vicinity of the preferred interval 
         provided by the user agent, in case of a 406 response.</t>
      <t>Removed TimeMap Feed material from the Discovery section as a result of discussions regarding (lack of) 
        scalability of the approach with representatives of the International Internet Preservation Consortium.
      An alternative approach to support batch discovery of Mementos will be specified.</t>
    </list></t>
    <t>v02 2011-04-28  HVDS MLN RS  draft-vandesompel-memento-01</t>
    <t><list style="symbols">
      <t>Introduced wording and reference to indicate a Memento is a FixedResource.</t>
      <t>Introduced "Sticky Memento-Datetime" notion and clarified wording about retaining 
      "Memento-Datetime" headers and values when a Memento is mirrored at different URI.</t>
      <t>Introduced section about handling both datetime and regular negotiation.</t>
      <t>Introduced section about Mementos Without TimeGate.</t>
      <t>Made various changes in the section Relation Type "memento", including addition of "license" and "embargo" attributes, 
      and clarification of rules regarding the use of "memento" links.</t>
      <t>Moved section about TimeMaps inside the Datetime Negotiation section, and updated it.</t>
      <t>Restarted the Discovery section from scratch.</t>
    </list></t>
    <t>v01 2010-11-11  HVDS MLN RS  First public version draft-vandesompel-memento-00</t>
    <t>v00 2010-10-19  HVDS MLN RS Limited circulation version</t>
    <t>2010-07-22  HVDS MLN   First internal version</t>

    
  </section>
  
  <section anchor="Acknowledgements" title="Acknowledgements">
    
    <t>The Memento effort is funded by the Library of Congress. 
      Many thanks to Kris Carpenter Negulescu, Michael Hausenblas, Erik Hetzner, Larry Masinter, Gordon Mohr, Mark Nottingham, David Rosenthal, Ed Summers, 
      James Anderson, Tim Starling, Martin Klein for feedback.
      Many thanks to Samuel Adams, Scott Ainsworth, Lyudmilla Balakireva, Frank McCown, Harihar Shankar, Brad Tofel for early implementations.</t>
    
  </section>

</middle>



  <!--  *****BACK MATTER ***** -->



  <back>

    <!-- References split into informative and normative -->



    <!-- There are 2 ways to insert reference entries from the citation libraries:

     1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)

     2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here

        (for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")



     Both are cited textually in the same manner: by using xref elements.

     If you use the PI option, xml2rfc will, by default, try to find included files in the same

     directory as the including file. You can also define the XML_LIBRARY environment variable

     with a value containing a set of directories to search.  These can be either in the local

     filing system or remote ones accessed by http (http://domain/dir/... ).-->



    <references title="Normative References">

&RFC5988;
&RFC6690;
&RFC2616;
&RFC2119;
&RFC5829;
&RFC4287;
&RFC4151;
&RFC5785;
&RFC6415;

    </references>

    <references title="Informative References">

      <!-- Here we use entities that we defined at the beginning. -->

&RFC1123;
&I-D.masinter-dated-uri;



      <!-- A reference written by an organization not a person. -->

      <reference anchor="W3C.gen-ont-20090420"
        target="http://www.w3.org/2006/gen/ont">
        <front>
          <title>Architecture of the World Wide Web</title>
          <author surname="Berners-Lee" fullname="Tim Berners-Lee">
            <organization/>
          </author>
          <date day="20" month="April" year="2009" />
        </front>
      </reference>

      <reference anchor="W3C.REC-aww-20041215"
        target="http://www.w3.org/TR/webarch/">
        <front>
          <title>Architecture of the World Wide Web</title>
          <author surname="Jacobs" fullname="Ian Jacobs">
            <organization/>
            </author>
            <author surname="Walsh" fullname="Norman Walsh">
              <organization/>
          </author>
          <date day="15" month="December" year="2004" />
        </front>
      </reference>
      
      
      <reference anchor="Fitch"
        target="http://ausweb.scu.edu.au/aw03/papers/fitch/paper.html">
        <front>
          <title>Web site archiving - an approach to recording every materially different response produced by a website</title>
          <author surname="Fitch" fullname="Kent Fitch">
            <organization/>
          </author>
          <date day="5" month="July" year="2003" />
        </front>
      </reference>

    </references>







  </back>

</rfc>

